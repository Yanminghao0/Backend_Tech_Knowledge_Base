# ç†”æ–­å™¨å®æˆ˜

> å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•…éšœéš”ç¦»ä¸å®¹é”™ä¿æŠ¤æœºåˆ¶

## ğŸ“‹ ç›®å½•

1. [ç†”æ–­å™¨æ¦‚è¿°](#1-ç†”æ–­å™¨æ¦‚è¿°)
2. [æ ¸å¿ƒåŸç†ä¸çŠ¶æ€æœº](#2-æ ¸å¿ƒåŸç†ä¸çŠ¶æ€æœº)
3. [ä¸»æµå®ç°å¯¹æ¯”](#3-ä¸»æµå®ç°å¯¹æ¯”)
4. [Resilience4jå®æˆ˜](#4-resilience4jå®æˆ˜)
5. [Sentinelå®æˆ˜](#5-sentinelå®æˆ˜)
6. [Hystrixå®æˆ˜ï¼ˆ legacy ï¼‰](#6-hystrixå®æˆ˜-legacy-)
7. [ç†”æ–­å™¨æ¨¡å¼ä¸å…¶ä»–å®¹é”™æ¨¡å¼ç»„åˆ](#7-ç†”æ–­å™¨æ¨¡å¼ä¸å…¶ä»–å®¹é”™æ¨¡å¼ç»„åˆ)
8. [æœ€ä½³å®è·µä¸ç›‘æ§å‘Šè­¦](#8-æœ€ä½³å®è·µä¸ç›‘æ§å‘Šè­¦)

---

## 1. ç†”æ–­å™¨æ¦‚è¿°

### 1.1 å®šä¹‰ä¸ä»·å€¼

ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰æ˜¯ä¸€ç§æ•…éšœéš”ç¦»æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡è°ƒç”¨ã€‚å½“ä¾èµ–æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç†”æ–­å™¨èƒ½å¤Ÿå¿«é€Ÿå¤±è´¥å¹¶é˜»æ­¢æ•…éšœçº§è”ä¼ æ’­ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¼¹æ€§å’Œç¨³å®šæ€§ã€‚

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- æœåŠ¡ä¾èµ–æ•…éšœå¯¼è‡´çš„çº§è”å¤±è´¥
- èµ„æºè€—å°½ä¸ç³»ç»Ÿé›ªå´©
- ç¼“æ…¢å“åº”å¯¼è‡´çš„è¶…æ—¶å †ç§¯
- æ•…éšœæ¢å¤è‡ªåŠ¨åŒ–

### 1.2 åº”ç”¨åœºæ™¯

- å¤–éƒ¨APIè°ƒç”¨ä¿æŠ¤
- æ•°æ®åº“è®¿é—®ç†”æ–­
- ç¼“å­˜æœåŠ¡é™çº§
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆå®¹é”™
- é«˜å¹¶å‘åœºæ™¯æµé‡æ§åˆ¶

```mermaid
graph TD
    A[æœåŠ¡A] -->|è°ƒç”¨| B{ç†”æ–­å™¨}
    B -->|æ­£å¸¸| C[æœåŠ¡B]
    B -->|ç†”æ–­| D[é™çº§ç­–ç•¥]
    C -->|å¤±è´¥ç‡é«˜| E[ç†”æ–­å™¨æ‰“å¼€]
    E -->|ä¸€æ®µæ—¶é—´å| F[åŠå¼€çŠ¶æ€]
    F -->|è¯•æ¢è°ƒç”¨æˆåŠŸ| G[ç†”æ–­å™¨å…³é—­]
    F -->|è¯•æ¢è°ƒç”¨å¤±è´¥| E
```

---

## 2. æ ¸å¿ƒåŸç†ä¸çŠ¶æ€æœº

### 2.1 å·¥ä½œåŸç†

ç†”æ–­å™¨é€šè¿‡ç›‘æ§æœåŠ¡è°ƒç”¨çš„å¤±è´¥ç‡æ¥å†³å®šæ˜¯å¦è§¦å‘ç†”æ–­ä¿æŠ¤ï¼š
1. è®°å½•è°ƒç”¨æˆåŠŸ/å¤±è´¥æ¬¡æ•°
2. å½“å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘ç†”æ–­
3. ç†”æ–­æœŸé—´å¿«é€Ÿå¤±è´¥å¹¶æ‰§è¡Œé™çº§ç­–ç•¥
4. ç»è¿‡æ¢å¤æœŸåè¿›å…¥åŠå¼€çŠ¶æ€è¯•æ¢è°ƒç”¨
5. æ ¹æ®è¯•æ¢ç»“æœå†³å®šå®Œå…¨æ¢å¤æˆ–ç»§ç»­ç†”æ–­

### 2.2 ä¸‰æ€æ¨¡å‹

| çŠ¶æ€ | æè¿° | è½¬æ¢æ¡ä»¶ |
|------|------|----------|
| **å…³é—­ï¼ˆClosedï¼‰** | æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚æ­£å¸¸è½¬å‘ | å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼ â†’ æ‰“å¼€çŠ¶æ€ |
| **æ‰“å¼€ï¼ˆOpenï¼‰** | ç†”æ–­çŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚è¢«æ‹¦æˆª | ç»è¿‡æ¢å¤æœŸ â†’ åŠå¼€çŠ¶æ€ |
| **åŠå¼€ï¼ˆHalf-Openï¼‰** | è¯•æ¢çŠ¶æ€ï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ | è¯•æ¢è¯·æ±‚æˆåŠŸ â†’ å…³é—­çŠ¶æ€<br>è¯•æ¢è¯·æ±‚å¤±è´¥ â†’ æ‰“å¼€çŠ¶æ€ |

### 2.3 æ ¸å¿ƒå‚æ•°

- **å¤±è´¥é˜ˆå€¼**ï¼šè§¦å‘ç†”æ–­çš„å¤±è´¥ç‡ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤50%ï¼‰
- **è¯·æ±‚é˜ˆå€¼**ï¼šç»Ÿè®¡å¤±è´¥ç‡çš„æœ€å°è¯·æ±‚æ•°ï¼ˆé»˜è®¤20ä¸ªï¼‰
- **ç†”æ–­æ—¶é—´çª—å£**ï¼šç†”æ–­å™¨æ‰“å¼€çŠ¶æ€æŒç»­æ—¶é—´ï¼ˆé»˜è®¤5ç§’ï¼‰
- **åŠå¼€è¯•æ¢è¯·æ±‚æ•°**ï¼šåŠå¼€çŠ¶æ€ä¸‹å…è®¸çš„è¯•æ¢è¯·æ±‚æ•°é‡
- **è¶…æ—¶é˜ˆå€¼**ï¼šå®šä¹‰è¯·æ±‚è¶…æ—¶çš„æ—¶é—´ç•Œé™

---

## 3. ä¸»æµå®ç°å¯¹æ¯”

| ç‰¹æ€§ | Resilience4j | Sentinel | Hystrix |
|------|-------------|----------|---------|
| **å¼€å‘è¯­è¨€** | Java | Java | Java |
| **ä¾èµ–** | è½»é‡çº§ï¼ˆä»…vavrï¼‰ | è½»é‡çº§ | è¾ƒé‡ï¼ˆä¾èµ–RxJavaç­‰ï¼‰ |
| **æ ¸å¿ƒåŠŸèƒ½** | ç†”æ–­ã€é™æµã€é‡è¯•ã€èˆ±å£ | ç†”æ–­ã€é™æµã€é™çº§ã€çƒ­ç‚¹é˜²æŠ¤ | ç†”æ–­ã€é™æµã€é™çº§ã€èˆ±å£ |
| **ç›‘æ§** | Micrometer/Prometheus | è‡ªå¸¦Dashboard | Hystrix Dashboard/Turbine |
| **é…ç½®æ–¹å¼** | æ³¨è§£ã€ç¼–ç¨‹å¼ã€é…ç½®æ–‡ä»¶ | æ³¨è§£ã€ç¼–ç¨‹å¼ã€é…ç½®ä¸­å¿ƒ | æ³¨è§£ã€é…ç½®æ–‡ä»¶ |
| **çº¿ç¨‹æ¨¡å‹** | éé˜»å¡ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰ | æ··åˆæ¨¡å¼ | çº¿ç¨‹æ± éš”ç¦»/ä¿¡å·é‡ |
| **å­¦ä¹ æ›²çº¿** | ä½ | ä¸­ | ä¸­ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | é«˜ï¼ˆSpring Cloudæ¨èï¼‰ | é«˜ï¼ˆAlibabaï¼‰ | ä½ï¼ˆå·²åœæ­¢å¼€å‘ï¼‰ |
| **Spring Cloudé›†æˆ** | åŸç”Ÿæ”¯æŒ | Spring Cloud Alibaba | Spring Cloud Netflix |
| **ç†”æ–­ç­–ç•¥** | å¤±è´¥ç‡ã€æ…¢è°ƒç”¨ç‡ | å“åº”æ—¶é—´ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•° | å¤±è´¥ç‡ |

---

## 4. Resilience4jå®æˆ˜

### 4.1 ç¯å¢ƒé…ç½®

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-spring-boot2</artifactId>
    <version>1.7.1</version>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**2. åŸºç¡€é…ç½®**ï¼š
```yaml
resilience4j:
  circuitbreaker:
    instances:
      orderService:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10000
        permittedNumberOfCallsInHalfOpenState: 3
        registerHealthIndicator: true
  retry:
    instances:
      orderService:
        maxRetryAttempts: 3
        waitDuration: 1000
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
  timeout:
    instances:
      orderService:
        timeoutDuration: 3000
```

### 4.2 ç†”æ–­å®ç°

**1. æ³¨è§£å¼ä½¿ç”¨**ï¼š
```java
@RestController
public class OrderController {

    @Autowired
    private OrderService orderService;

    @GetMapping("/order/{id}")
    @CircuitBreaker(name = "orderService", fallbackMethod = "getOrderFallback")
    @Retry(name = "orderService")
    @Timeout(name = "orderService")
    public OrderDTO getOrder(@PathVariable Long id) {
        return orderService.getOrderById(id);
    }

    // é™çº§æ–¹æ³•
    public OrderDTO getOrderFallback(Long id, Exception e) {
        log.warn("è·å–è®¢å•å¤±è´¥ï¼Œæ‰§è¡Œé™çº§ç­–ç•¥: {}", e.getMessage());
        return new OrderDTO(id, "é™çº§è®¢å•", LocalDateTime.now());
    }
}
```

**2. ç¼–ç¨‹å¼ä½¿ç”¨**ï¼š
```java
@Service
public class OrderServiceImpl implements OrderService {

    private final CircuitBreaker circuitBreaker;
    private final RestTemplate restTemplate;

    public OrderServiceImpl(CircuitBreakerRegistry registry, RestTemplate restTemplate) {
        this.circuitBreaker = registry.circuitBreaker("orderService");
        this.restTemplate = restTemplate;
    }

    @Override
    public OrderDTO getOrderById(Long id) {
        // ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹åŒ…è£…è¿œç¨‹è°ƒç”¨
        return Try.ofSupplier(CircuitBreaker.decorateSupplier(circuitBreaker, () -> {
            String url = "http://order-service/orders/" + id;
            return restTemplate.getForObject(url, OrderDTO.class);
        }))
        .recover(e -> new OrderDTO(id, "é™çº§è®¢å•", LocalDateTime.now()))
        .get();
    }
}
```

### 4.3 èˆ±å£æ¨¡å¼

```java
@Service
public class PaymentService {

    // åˆ›å»ºçº¿ç¨‹æ± éš”ç¦»çš„èˆ±å£
    @Bulkhead(name = "paymentService", fallbackMethod = "processPaymentFallback")
    public CompletableFuture<PaymentResult> processPayment(PaymentRequest request) {
        return CompletableFuture.supplyAsync(() -> {
            // å¤„ç†æ”¯ä»˜é€»è¾‘
            return paymentProvider.process(request);
        });
    }

    public CompletableFuture<PaymentResult> processPaymentFallback(PaymentRequest request, Exception e) {
        return CompletableFuture.supplyAsync(() -> {
            return new PaymentResult(false, "æ”¯ä»˜æœåŠ¡é™çº§");
        });
    }
}
```

### 4.4 ç›‘æ§é›†æˆ

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,circuitbreakerevents,metrics
  metrics:
    export:
      prometheus:
        enabled: true
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
```

**Grafanaç›‘æ§é¢æ¿**ï¼š
- resilience4j_circuitbreaker_state (0=closed, 1=open, 2=half-open)
- resilience4j_circuitbreaker_failure_rate
- resilience4j_circuitbreaker_calls

---

## 5. Sentinelå®æˆ˜

### 5.1 ç¯å¢ƒæ­å»º

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
    <version>2.2.7.RELEASE</version>
</dependency>
<dependency>
    <groupId>com.alibaba.csp</groupId>
    <artifactId>sentinel-dashboard</artifactId>
    <version>1.8.2</version>
</dependency>
```

**2. å¯åŠ¨Sentinel Dashboard**ï¼š
```bash
java -jar sentinel-dashboard-1.8.2.jar --server.port=8080
open http://localhost:8080 # é»˜è®¤è´¦å·å¯†ç ï¼šsentinel/sentinel
```

**3. åº”ç”¨é…ç½®**ï¼š
```yaml
spring:
  application:
    name: order-service
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080
        port: 8719
      eager: true
      datasource:
        ds1:
          nacos:
            server-addr: localhost:8848
            dataId: ${spring.application.name}-sentinel-rules
            groupId: DEFAULT_GROUP
            rule-type: flow
```

### 5.2 æµé‡æ§åˆ¶è§„åˆ™

**1. ä»£ç å®šä¹‰è§„åˆ™**ï¼š
```java
@Configuration
public class SentinelConfig {

    @PostConstruct
    public void initRules() {
        // æµæ§è§„åˆ™
        List<FlowRule> flowRules = new ArrayList<>();
        FlowRule rule = new FlowRule();
        rule.setResource("getOrder");
        rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
        rule.setCount(10); // QPSé˜ˆå€¼10
        flowRules.add(rule);
        FlowRuleManager.loadRules(flowRules);

        // ç†”æ–­è§„åˆ™
        List<DegradeRule> degradeRules = new ArrayList<>();
        DegradeRule degradeRule = new DegradeRule();
        degradeRule.setResource("getOrder");
        degradeRule.setGrade(RuleConstant.DEGRADE_GRADE_EXCEPTION_RATIO);
        degradeRule.setCount(0.5); // å¼‚å¸¸æ¯”ä¾‹é˜ˆå€¼50%
        degradeRule.setTimeWindow(10); // ç†”æ–­æ—¶é—´çª—å£10ç§’
        degradeRules.add(degradeRule);
        DegradeRuleManager.loadRules(degradeRules);
    }
}
```

**2. æ³¨è§£å¼ä½¿ç”¨**ï¼š
```java
@RestController
public class OrderController {

    @GetMapping("/order/{id}")
    @SentinelResource(value = "getOrder", fallback = "getOrderFallback", blockHandler = "getOrderBlockHandler")
    public OrderDTO getOrder(@PathVariable Long id) {
        if (id == 0) {
            throw new RuntimeException("æ¨¡æ‹ŸæœåŠ¡å¼‚å¸¸");
        }
        return orderService.getOrderById(id);
    }

    // å¼‚å¸¸é™çº§æ–¹æ³•
    public OrderDTO getOrderFallback(Long id) {
        return new OrderDTO(id, "Sentinelå¼‚å¸¸é™çº§è®¢å•", LocalDateTime.now());
    }

    // æµæ§é™çº§æ–¹æ³•
    public OrderDTO getOrderBlockHandler(Long id, BlockException e) {
        return new OrderDTO(id, "Sentinelæµæ§é™çº§è®¢å•", LocalDateTime.now());
    }
}
```

### 5.3 çƒ­ç‚¹å‚æ•°é™æµ

```java
@SentinelResource(value = "getProduct", blockHandler = "getProductBlockHandler")
@GetMapping("/product/{id}")
public ProductDTO getProduct(@PathVariable Long id) {
    return productService.getProductById(id);
}

// çƒ­ç‚¹å‚æ•°è§„åˆ™é…ç½®
@PostConstruct
public void initHotParamRules() {
    List<ParamFlowRule> rules = new ArrayList<>();
    ParamFlowRule rule = new ParamFlowRule();
    rule.setResource("getProduct");
    rule.setParamIdx(0); // ç¬¬0ä¸ªå‚æ•°
    rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
    rule.setCount(5); // åŸºç¡€é˜ˆå€¼

    // ç‰¹æ®Šå‚æ•°å€¼é™æµ
    ParamFlowItem item = new ParamFlowItem();
    item.setObject(String.valueOf(100)); // å•†å“ID=100
    item.setCount(2); // ç‰¹æ®Šé˜ˆå€¼
    rule.setParamFlowItemList(Collections.singletonList(item));

    rules.add(rule);
    ParamFlowRuleManager.loadRules(rules);
}
```

---

## 6. Hystrixå®æˆ˜ï¼ˆ legacy ï¼‰

> æ³¨æ„ï¼šHystrixå·²åœæ­¢å¼€å‘ï¼Œå»ºè®®ä½¿ç”¨Resilience4jæˆ–Sentinelæ›¿ä»£

### 6.1 åŸºç¡€é…ç½®

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>
```

```yaml
feign:
  hystrix:
    enabled: true

hystrix:
  command:
    default:
      circuitBreaker:
        requestVolumeThreshold: 20
        errorThresholdPercentage: 50
        sleepWindowInMilliseconds: 5000
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 3000
```

### 6.2 æœåŠ¡ç†”æ–­å®ç°

```java
@RestController
@EnableHystrix
public class ProductController {

    @Autowired
    private ProductService productService;

    @GetMapping("/product/{id}")
    @HystrixCommand(fallbackMethod = "getProductFallback",
                   commandProperties = {
                       @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "10"),
                       @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50")
                   })
    public ProductDTO getProduct(@PathVariable Long id) {
        return productService.getProductById(id);
    }

    public ProductDTO getProductFallback(Long id) {
        return new ProductDTO(id, "Hystrixé™çº§å•†å“", BigDecimal.ZERO);
    }
}
```

### 6.3 Feignå®¢æˆ·ç«¯é›†æˆ

```java
@FeignClient(name = "order-service", fallback = OrderFeignFallback.class)
public interface OrderFeignClient {

    @GetMapping("/orders/{id}")
    OrderDTO getOrder(@PathVariable("id") Long id);
}

@Component
public class OrderFeignFallback implements OrderFeignClient {
    @Override
    public OrderDTO getOrder(Long id) {
        return new OrderDTO(id, "Feigné™çº§è®¢å•", LocalDateTime.now());
    }
}
```

---

## 7. ç†”æ–­å™¨æ¨¡å¼ä¸å…¶ä»–å®¹é”™æ¨¡å¼ç»„åˆ

### 7.1 ç†”æ–­å™¨ + é‡è¯•

```java
@CircuitBreaker(name = "paymentService", fallbackMethod = "paymentFallback")
@Retry(name = "paymentService", fallbackMethod = "paymentRetryFallback")
public PaymentResult processPayment(PaymentRequest request) {
    return paymentGateway.process(request);
}
```

### 7.2 ç†”æ–­å™¨ + èˆ±å£

```java
@Service
public class OrderService {
    // è®¢å•æŸ¥è¯¢ä½¿ç”¨Açº¿ç¨‹æ± 
    @CircuitBreaker(name = "orderQueryService")
    @Bulkhead(name = "orderQueryPool")
    public OrderDTO queryOrder(Long id) { ... }

    // è®¢å•åˆ›å»ºä½¿ç”¨Bçº¿ç¨‹æ± 
    @CircuitBreaker(name = "orderCreateService")
    @Bulkhead(name = "orderCreatePool")
    public OrderDTO createOrder(OrderRequest request) { ... }
}
```

### 7.3 ç†”æ–­å™¨ + è¶…æ—¶æ§åˆ¶

```java
@CircuitBreaker(name = "remoteService")
@Timeout(name = "remoteService", fallbackMethod = "timeoutFallback")
public ResultDTO callRemoteService() {
    // è¿œç¨‹è°ƒç”¨é€»è¾‘
}

public ResultDTO timeoutFallback(Exception e) {
    return new ResultDTO("è¶…æ—¶é™çº§å“åº”");
}
```

---

## 8. æœ€ä½³å®è·µä¸ç›‘æ§å‘Šè­¦

### 8.1 ç†”æ–­å™¨é…ç½®æœ€ä½³å®è·µ

- **åˆç†è®¾ç½®é˜ˆå€¼**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹æ€§è°ƒæ•´å¤±è´¥ç‡å’Œè¯·æ±‚é˜ˆå€¼
- **ç²¾ç»†åŒ–èµ„æºå®šä¹‰**ï¼šæŒ‰ä¸šåŠ¡åœºæ™¯å®šä¹‰ä¸åŒçš„ç†”æ–­å™¨èµ„æº
- **é™çº§ç­–ç•¥è®¾è®¡**ï¼š
  - é™æ€é™çº§æ•°æ®ç¼“å­˜
  - å¤‡ç”¨æœåŠ¡è°ƒç”¨
  - éƒ¨åˆ†åŠŸèƒ½é™çº§
- **é¿å…ç†”æ–­å™¨é£æš´**ï¼šä¸åŒæœåŠ¡ä½¿ç”¨ç‹¬ç«‹çš„ç†”æ–­å™¨
- **ç†”æ–­ä¸é™æµç»“åˆ**ï¼šæµé‡æ§åˆ¶åœ¨å‰ï¼Œç†”æ–­ä¿æŠ¤åœ¨å

### 8.2 ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦

**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
- ç†”æ–­å™¨çŠ¶æ€å˜åŒ–
- è°ƒç”¨æˆåŠŸç‡/å¤±è´¥ç‡
- é™çº§æ¬¡æ•°ç»Ÿè®¡
- å“åº”æ—¶é—´åˆ†å¸ƒ
- çº¿ç¨‹æ± /ä¿¡å·é‡ä½¿ç”¨æƒ…å†µ

**Prometheuså‘Šè­¦è§„åˆ™**ï¼š
```yaml
groups:
- name: circuitbreaker_alerts
  rules:
  - alert: CircuitBreakerOpen
    expr: resilience4j_circuitbreaker_state{state="OPEN"} == 1
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "ç†”æ–­å™¨æ‰“å¼€çŠ¶æ€"
      description: "æœåŠ¡ {{ $labels.name }} ç†”æ–­å™¨å·²æ‰“å¼€è¶…è¿‡10ç§’"

  - alert: HighFailureRate
    expr: sum(resilience4j_circuitbreaker_calls{status="failed"}) / sum(resilience4j_circuitbreaker_calls) > 0.3
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "æœåŠ¡è°ƒç”¨å¤±è´¥ç‡é«˜"
      description: "æœåŠ¡è°ƒç”¨å¤±è´¥ç‡è¶…è¿‡30%æŒç»­5åˆ†é’Ÿ"
```

### 8.3 å¸¸è§é—®é¢˜æ’æŸ¥

**1. ç†”æ–­å™¨ä¸è§¦å‘**ï¼š
- æ£€æŸ¥è¯·æ±‚é‡æ˜¯å¦è¾¾åˆ°æœ€å°é˜ˆå€¼
- éªŒè¯å¤±è´¥ç‡è®¡ç®—æ˜¯å¦å‡†ç¡®
- ç¡®è®¤å¼‚å¸¸æ˜¯å¦è¢«æ­£ç¡®æ•è·

**2. ç†”æ–­å™¨æ— æ³•å…³é—­**ï¼š
- æ£€æŸ¥åŠå¼€çŠ¶æ€è¯•æ¢è¯·æ±‚æ˜¯å¦æˆåŠŸ
- éªŒè¯æ¢å¤æœŸè®¾ç½®æ˜¯å¦åˆç†
- æ’æŸ¥ä¾èµ–æœåŠ¡æ˜¯å¦çœŸæ­£æ¢å¤

**3. é™çº§ç­–ç•¥ä¸æ‰§è¡Œ**ï¼š
- ç¡®è®¤é™çº§æ–¹æ³•ç­¾åæ˜¯å¦åŒ¹é…
- æ£€æŸ¥å¼‚å¸¸ç±»å‹æ˜¯å¦æ­£ç¡®
- éªŒè¯ç†”æ–­çŠ¶æ€æ˜¯å¦æ­£ç¡®

**4. æ€§èƒ½é—®é¢˜**ï¼š
- é¿å…é™çº§æ–¹æ³•æ‰§è¡Œè€—æ—¶æ“ä½œ
- åˆç†è®¾ç½®çº¿ç¨‹æ± å‚æ•°
- ä¼˜åŒ–ç†”æ–­åˆ¤æ–­é€»è¾‘

---

## ğŸ“š å‚è€ƒèµ„æº

- [Resilience4jå®˜æ–¹æ–‡æ¡£](https://resilience4j.readme.io/docs)
- [Sentinelå®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/docs/introduction.html)
- [Spring Cloud Circuit Breakeræ–‡æ¡£](https://docs.spring.io/spring-cloud-circuitbreaker/docs/current/reference/html/)
- [Martin Fowlerçš„ç†”æ–­å™¨æ¨¡å¼](https://martinfowler.com/bliki/CircuitBreaker.html)
- [Resilience4jä¸Sentinelæ€§èƒ½å¯¹æ¯”](https://github.com/resilience4j/resilience4j/wiki/Comparisons)