# åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å®æˆ˜

> å¾®æœåŠ¡æ¶æ„ä¸‹çš„å®šæ—¶ä»»åŠ¡ç»Ÿä¸€ç®¡ç†ä¸æ‰§è¡Œæ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¦‚è¿°](#1-åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡åŸç†](#2-æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡åŸç†)
3. [ä¸»æµå®ç°å¯¹æ¯”](#3-ä¸»æµå®ç°å¯¹æ¯”)
4. [XXL-Jobå®æˆ˜](#4-xxl-jobå®æˆ˜)
5. [Elastic-Jobå®æˆ˜](#5-elastic-jobå®æˆ˜)
6. [Quartzåˆ†å¸ƒå¼æ”¹é€ å®æˆ˜](#6-quartzåˆ†å¸ƒå¼æ”¹é€ å®æˆ˜)
7. [ä»»åŠ¡è°ƒåº¦é«˜çº§ç‰¹æ€§](#7-ä»»åŠ¡è°ƒåº¦é«˜çº§ç‰¹æ€§)
8. [æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–](#8-æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–)

---

## 1. åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¦‚è¿°

### 1.1 å®šä¹‰ä¸ä»·å€¼

åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œå¯¹å®šæ—¶ä»»åŠ¡è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€è°ƒåº¦å’Œæ‰§è¡Œçš„ä¸€ç§æœºåˆ¶ã€‚å®ƒè§£å†³äº†å•ä½“è°ƒåº¦å™¨çš„å•ç‚¹æ•…éšœã€èµ„æºé™åˆ¶å’Œæ‰©å±•æ€§é—®é¢˜ï¼Œç¡®ä¿ä»»åŠ¡åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¯é ã€é«˜æ•ˆã€å…¬å¹³åœ°æ‰§è¡Œã€‚

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- å•ç‚¹æ•…éšœé£é™©ï¼šé¿å…å•æœºè°ƒåº¦å™¨æ•…éšœå¯¼è‡´æ‰€æœ‰ä»»åŠ¡å¤±æ•ˆ
- èµ„æºåˆ©ç”¨ç‡ä½ï¼šå……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºæ‰§è¡Œä»»åŠ¡
- ä»»åŠ¡æ‰§è¡Œå†²çªï¼šé˜²æ­¢åŒä¸€ä»»åŠ¡åœ¨å¤šèŠ‚ç‚¹é‡å¤æ‰§è¡Œ
- è´Ÿè½½å‡è¡¡ï¼šä»»åŠ¡åœ¨é›†ç¾¤èŠ‚ç‚¹é—´åˆç†åˆ†é…
- æ°´å¹³æ‰©å±•ï¼šæ”¯æŒè°ƒåº¦èƒ½åŠ›çš„çº¿æ€§æ‰©å±•
- ä»»åŠ¡ç›‘æ§ä¸æ²»ç†ï¼šç»Ÿä¸€çš„ä»»åŠ¡ç®¡ç†å’Œç›‘æ§å¹³å°

### 1.2 åº”ç”¨åœºæ™¯

- **å®šæ—¶ä»»åŠ¡**ï¼šå¦‚æ¯æ—¥æ•°æ®å¤‡ä»½ã€æœˆåº¦æŠ¥è¡¨ç”Ÿæˆ
- **æ‰¹é‡å¤„ç†**ï¼šå¦‚å¤§æ‰¹é‡æ•°æ®å¯¼å…¥å¯¼å‡ºã€æ—¥å¿—åˆ†æ
- **ç³»ç»Ÿç»´æŠ¤**ï¼šå¦‚ç¼“å­˜æ¸…ç†ã€ä¸´æ—¶æ–‡ä»¶åˆ é™¤
- **ä¸šåŠ¡è§¦å‘**ï¼šå¦‚ä¸‹å•å30åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆ
- **æµè®¡ç®—**ï¼šå¦‚å®æ—¶æ•°æ®å¤„ç†ã€æŒ‡æ ‡ç»Ÿè®¡
- **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šå¦‚TCCæ¨¡å¼ä¸­çš„è¡¥å¿æ“ä½œ

### 1.3 æŠ€æœ¯æŒ‘æˆ˜

- **ä»»åŠ¡åˆ†å‘**ï¼šå¦‚ä½•å°†ä»»åŠ¡åˆç†åˆ†é…åˆ°é›†ç¾¤èŠ‚ç‚¹
- **ä¸€è‡´æ€§ä¿è¯**ï¼šç¡®ä¿ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€çš„ä¸€è‡´æ€§
- **æ•…éšœæ¢å¤**ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥åçš„é‡è¯•ä¸æ¢å¤æœºåˆ¶
- **èµ„æºæ§åˆ¶**ï¼šé˜²æ­¢ä»»åŠ¡è¿‡åº¦æ¶ˆè€—ç³»ç»Ÿèµ„æº
- **æ‰§è¡Œè¿½è¸ª**ï¼šä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹çš„ç›‘æ§ä¸è¿½è¸ª
- **æ—¶é—´ç²¾åº¦**ï¼šä¸åŒèŠ‚ç‚¹é—´çš„æ—¶é—´åŒæ­¥é—®é¢˜

```mermaid
graph TD
    A[ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒ] -->|åˆ†é…ä»»åŠ¡| B[æ‰§è¡ŒèŠ‚ç‚¹1]
    A -->|åˆ†é…ä»»åŠ¡| C[æ‰§è¡ŒèŠ‚ç‚¹2]
    A -->|åˆ†é…ä»»åŠ¡| D[æ‰§è¡ŒèŠ‚ç‚¹3]
    B -->|æ±‡æŠ¥ç»“æœ| A
    C -->|æ±‡æŠ¥ç»“æœ| A
    D -->|æ±‡æŠ¥ç»“æœ| A
    A --> E[ä»»åŠ¡ç®¡ç†ç•Œé¢]
    A --> F[ç›‘æ§å‘Šè­¦ç³»ç»Ÿ]
```

---

## 2. æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡åŸç†

### 2.1 æ¶æ„æ¨¡å¼

| æ¨¡å¼ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **ä¸­å¿ƒè°ƒåº¦å¼** | ä¸­å¤®è°ƒåº¦èŠ‚ç‚¹åˆ†é…ä»»åŠ¡ç»™æ‰§è¡ŒèŠ‚ç‚¹ | æ§åˆ¶é›†ä¸­ã€æ˜“äºç®¡ç† | è°ƒåº¦ä¸­å¿ƒå¯èƒ½æˆä¸ºç“¶é¢ˆ |
| **å»ä¸­å¿ƒåŒ–è°ƒåº¦** | å„èŠ‚ç‚¹è‡ªä¸»å†³å®šæ˜¯å¦æ‰§è¡Œä»»åŠ¡ | æ— å•ç‚¹ç“¶é¢ˆ | ä¸€è‡´æ€§éš¾ä»¥ä¿è¯ |
| **æ··åˆè°ƒåº¦** | ä¸­å¿ƒèŠ‚ç‚¹åè°ƒ+èŠ‚ç‚¹è‡ªä¸»å†³ç­– | å…¼é¡¾å¯é æ€§å’Œæ‰©å±•æ€§ | æ¶æ„å¤æ‚ |

### 2.2 æ ¸å¿ƒç»„ä»¶

- **ä»»åŠ¡æ³¨å†Œä¸­å¿ƒ**ï¼šå­˜å‚¨ä»»åŠ¡å…ƒæ•°æ®å’Œæ‰§è¡ŒçŠ¶æ€
- **è°ƒåº¦å™¨**ï¼šè´Ÿè´£ä»»åŠ¡è§¦å‘å’Œåˆ†é…
- **æ‰§è¡Œå™¨**ï¼šæ¥æ”¶å¹¶æ‰§è¡Œä»»åŠ¡
- **ç®¡ç†æ§åˆ¶å°**ï¼šä»»åŠ¡é…ç½®å’Œç›‘æ§ç•Œé¢
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šè®°å½•ä»»åŠ¡æ‰§è¡Œæ—¥å¿—
- **å‘Šè­¦ç³»ç»Ÿ**ï¼šä»»åŠ¡å¼‚å¸¸æ—¶è§¦å‘å‘Šè­¦

### 2.3 ä»»åŠ¡åˆ†å‘ç­–ç•¥

| ç­–ç•¥ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **è½®è¯¢ç­–ç•¥** | ä»»åŠ¡æŒ‰é¡ºåºåˆ†é…åˆ°å„èŠ‚ç‚¹ | èŠ‚ç‚¹æ€§èƒ½ç›¸è¿‘çš„åœºæ™¯ |
| **éšæœºç­–ç•¥** | éšæœºé€‰æ‹©æ‰§è¡ŒèŠ‚ç‚¹ | è´Ÿè½½æ³¢åŠ¨è¾ƒå°çš„åœºæ™¯ |
| **ä¸€è‡´æ€§å“ˆå¸Œ** | åŸºäºä»»åŠ¡IDå“ˆå¸Œåˆ†é… | ä»»åŠ¡ä¸èŠ‚ç‚¹ç»‘å®šçš„åœºæ™¯ |
| **è´Ÿè½½å‡è¡¡ç­–ç•¥** | æ ¹æ®èŠ‚ç‚¹è´Ÿè½½åŠ¨æ€åˆ†é… | èŠ‚ç‚¹æ€§èƒ½å·®å¼‚è¾ƒå¤§çš„åœºæ™¯ |
| **åˆ†ç‰‡å¹¿æ’­ç­–ç•¥** | æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡çš„ä¸åŒåˆ†ç‰‡ | å¤§æ•°æ®é‡å¹¶è¡Œå¤„ç† |

### 2.4 ä¸€è‡´æ€§ä¿è¯æœºåˆ¶

- **åˆ†å¸ƒå¼é”**ï¼šåŸºäºRedis/ZooKeeperå®ç°ä»»åŠ¡æŠ¢å 
- **ä¹è§‚é”**ï¼šé€šè¿‡ç‰ˆæœ¬å·æ§åˆ¶ä»»åŠ¡çŠ¶æ€æ›´æ–°
- **çŠ¶æ€æœº**ï¼šä»»åŠ¡æ‰§è¡ŒçŠ¶æ€çš„ä¸¥æ ¼æµè½¬æ§åˆ¶
- **é€‰ä¸»æœºåˆ¶**ï¼šç¡®ä¿åªæœ‰ä¸»èŠ‚ç‚¹æ‰§è¡Œç‰¹å®šä»»åŠ¡

---

## 3. ä¸»æµå®ç°å¯¹æ¯”

| ç‰¹æ€§ | XXL-Job | Elastic-Job | Quartz | ScheduledExecutorService |
|------|---------|-------------|--------|--------------------------|
| **å¼€å‘è¯­è¨€** | Java | Java | Java | Java |
| **æ¶æ„æ¨¡å¼** | ä¸­å¿ƒè°ƒåº¦å¼ | å»ä¸­å¿ƒåŒ– | ä¸­å¿ƒè°ƒåº¦å¼ | å•æœº |
| **åˆ†å¸ƒå¼æ”¯æŒ** | åŸç”Ÿæ”¯æŒ | åŸç”Ÿæ”¯æŒ | éœ€æ”¹é€  | ä¸æ”¯æŒ |
| **ä»»åŠ¡ç±»å‹** | ä¸°å¯Œ | ä¸°å¯Œ | åŸºç¡€ | åŸºç¡€ |
| **è´Ÿè½½å‡è¡¡** | æ”¯æŒ | æ”¯æŒ | æœ‰é™ | ä¸æ”¯æŒ |
| **æ•…éšœè½¬ç§»** | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ |
| **ä»»åŠ¡åˆ†ç‰‡** | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ |
| **ç›‘æ§å‘Šè­¦** | å®Œå–„ | å®Œå–„ | åŸºç¡€ | æ—  |
| **ç®¡ç†ç•Œé¢** | æœ‰ | æœ‰ | ç¬¬ä¸‰æ–¹ | æ—  |
| **æ˜“ç”¨æ€§** | é«˜ | ä¸­ | ä¸­ | é«˜ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | é«˜ | ä¸­ | é«˜ | é«˜ |
| **å­¦ä¹ æ›²çº¿** | ä½ | ä¸­ | ä¸­ | ä½ |

---

## 4. XXL-Jobå®æˆ˜

### 4.1 XXL-Jobæ¶æ„

```mermaid
graph TD
    A[è°ƒåº¦ä¸­å¿ƒ] -->|è°ƒåº¦ä»»åŠ¡| B[æ‰§è¡Œå™¨é›†ç¾¤]
    C[ç®¡ç†ç•Œé¢] -->|é…ç½®ä»»åŠ¡| A
    B -->|æ‰§è¡Œç»“æœ| A
    A --> D[æ—¥å¿—å­˜å‚¨]
    A --> E[å‘Šè­¦ç³»ç»Ÿ]
```

### 4.2 ç¯å¢ƒæ­å»º

**1. éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒ**ï¼š
```bash
# 1. ä¸‹è½½æºç 
git clone https://github.com/xuxueli/xxl-job.git
cd xxl-job

# 2. åˆå§‹åŒ–æ•°æ®åº“
# æ‰§è¡Œsql/xxl_job.sql

# 3. é…ç½®è°ƒåº¦ä¸­å¿ƒ
# ä¿®æ”¹xxl-job-admin/src/main/resources/application.properties
# ä¸»è¦é…ç½®æ•°æ®åº“è¿æ¥

# 4. ç¼–è¯‘æ‰“åŒ…
mvn clean package -DskipTests

# 5. å¯åŠ¨è°ƒåº¦ä¸­å¿ƒ
java -jar xxl-job-admin/target/xxl-job-admin-2.3.0.jar

# 6. è®¿é—®ç®¡ç†ç•Œé¢
open http://localhost:8080/xxl-job-admin
# é»˜è®¤è´¦å·å¯†ç ï¼šadmin/123456
```

**2. é›†æˆæ‰§è¡Œå™¨**ï¼š
```xml
<dependency>
    <groupId>com.xuxueli</groupId>
    <artifactId>xxl-job-core</artifactId>
    <version>2.3.0</version>
</dependency>
```

```yaml
xxl:
  job:
    admin:
      addresses: http://localhost:8080/xxl-job-admin
    executor:
      appname: order-executor
      port: 9999
      logpath: /data/applogs/xxl-job/jobhandler
      logretentiondays: 30
    accessToken: default_token
```

### 4.3 ä»»åŠ¡å¼€å‘ç¤ºä¾‹

**1. ç¼–å†™ä»»åŠ¡å¤„ç†å™¨**ï¼š
```java
@Component
public class OrderTaskHandler {

    private static final Logger logger = LoggerFactory.getLogger(OrderTaskHandler.class);

    // æ— å‚æ•°ä»»åŠ¡
    @XxlJob("orderCancelJob")
    public void orderCancelJob() throws Exception {
        XxlJobHelper.log("è®¢å•å–æ¶ˆä»»åŠ¡å¼€å§‹æ‰§è¡Œ");

        // ä»»åŠ¡é€»è¾‘
        long timeout = 30 * 60 * 1000; // 30åˆ†é’Ÿ
        Date cancelTime = new Date(System.currentTimeMillis() - timeout);
        int count = orderService.cancelTimeoutOrders(cancelTime);

        XxlJobHelper.log("è®¢å•å–æ¶ˆä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå–æ¶ˆè®¢å•æ•°é‡: {}", count);
        XxlJobHelper.handleSuccess("å–æ¶ˆè®¢å•æ•°é‡: " + count);
    }

    // åˆ†ç‰‡å¹¿æ’­ä»»åŠ¡
    @XxlJob("orderStatisticsJob")
    public void orderStatisticsJob() throws Exception {
        // è·å–åˆ†ç‰‡ä¿¡æ¯
        int shardIndex = XxlJobHelper.getShardIndex();
        int shardTotal = XxlJobHelper.getShardTotal();

        XxlJobHelper.log("è®¢å•ç»Ÿè®¡ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼Œåˆ†ç‰‡ç´¢å¼•: {}, æ€»åˆ†ç‰‡æ•°: {}", shardIndex, shardTotal);

        // åˆ†ç‰‡å¤„ç†é€»è¾‘
        List<Date> dateList = getDateList();
        List<Date> shardDates = shardData(dateList, shardIndex, shardTotal);

        for (Date date : shardDates) {
            orderService.statisticsByDate(date);
        }

        XxlJobHelper.handleSuccess("åˆ†ç‰‡ä»»åŠ¡æ‰§è¡Œå®Œæˆ");
    }

    // åˆ†ç‰‡é€»è¾‘
    private <T> List<T> shardData(List<T> dataList, int shardIndex, int shardTotal) {
        List<T> shardData = new ArrayList<>();
        for (int i = 0; i < dataList.size(); i++) {
            if (i % shardTotal == shardIndex) {
                shardData.add(dataList.get(i));
            }
        }
        return shardData;
    }
}
```

**2. åœ¨è°ƒåº¦ä¸­å¿ƒé…ç½®ä»»åŠ¡**ï¼š
1. ç™»å½•XXL-Jobç®¡ç†ç•Œé¢
2. è¿›å…¥"ä»»åŠ¡ç®¡ç†"é¡µé¢ï¼Œç‚¹å‡»"æ–°å¢"
3. é…ç½®ä»»åŠ¡å‚æ•°ï¼š
   - ä»»åŠ¡æè¿°ï¼šè®¢å•è¶…æ—¶å–æ¶ˆä»»åŠ¡
   - æ‰§è¡Œå™¨ï¼šé€‰æ‹©å¯¹åº”çš„æ‰§è¡Œå™¨
   - ä»»åŠ¡ç±»å‹ï¼šBEANæ¨¡å¼
   - JobHandlerï¼šorderCancelJob
   - è°ƒåº¦ç±»å‹ï¼šCRON
   - CRONè¡¨è¾¾å¼ï¼š0 0/5 * * * ?
   - è·¯ç”±ç­–ç•¥ï¼šè½®è¯¢
   - é˜»å¡å¤„ç†ç­–ç•¥ï¼šå•æœºä¸²è¡Œ
   - ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼š60ç§’

### 4.4 é«˜å¯ç”¨éƒ¨ç½²

**1. è°ƒåº¦ä¸­å¿ƒé›†ç¾¤**ï¼š
- éƒ¨ç½²å¤šä¸ªè°ƒåº¦ä¸­å¿ƒå®ä¾‹
- é…ç½®ç›¸åŒçš„æ•°æ®åº“
- å‰ç«¯é…ç½®è´Ÿè½½å‡è¡¡

**2. æ‰§è¡Œå™¨é›†ç¾¤**ï¼š
- éƒ¨ç½²å¤šä¸ªæ‰§è¡Œå™¨å®ä¾‹
- ç¡®ä¿appnameä¸€è‡´
- è°ƒåº¦ä¸­å¿ƒè‡ªåŠ¨å‘ç°æ‰€æœ‰å®ä¾‹

---

## 5. Elastic-Jobå®æˆ˜

### 5.1 Elastic-Jobæ¶æ„

```mermaid
graph TD
    A[ZooKeeper] -->|åè°ƒ| B[ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹é›†ç¾¤]
    C[æ§åˆ¶å°] -->|é…ç½®ä»»åŠ¡| A
    B -->|æ‰§è¡Œä»»åŠ¡| D[ä¸šåŠ¡ç³»ç»Ÿ]
    B -->|ç›‘æ§æ•°æ®| E[ç›‘æ§ç³»ç»Ÿ]
```

### 5.2 ç¯å¢ƒæ­å»º

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.dangdang</groupId>
    <artifactId>elastic-job-lite-core</artifactId>
    <version>2.1.5</version>
</dependency>
<dependency>
    <groupId>com.dangdang</groupId>
    <artifactId>elastic-job-lite-spring</artifactId>
    <version>2.1.5</version>
</dependency>
```

**2. é…ç½®ZooKeeper**ï¼š
```java
@Configuration
public class ElasticJobConfig {

    @Bean
    public ZookeeperRegistryCenter registryCenter() {
        ZookeeperConfiguration zkConfig = new ZookeeperConfiguration("localhost:2181", "elastic-job-demo");
        zkConfig.setSessionTimeoutMilliseconds(10000);
        return new ZookeeperRegistryCenter(zkConfig);
    }
}
```

### 5.3 ä»»åŠ¡å¼€å‘ç¤ºä¾‹

**1. ç®€å•ä»»åŠ¡**ï¼š
```java
@Component
public class InventoryCheckJob implements SimpleJob {

    private static final Logger logger = LoggerFactory.getLogger(InventoryCheckJob.class);

    @Autowired
    private InventoryService inventoryService;

    @Override
    public void execute(ShardingContext shardingContext) {
        logger.info("åº“å­˜æ£€æŸ¥ä»»åŠ¡å¼€å§‹æ‰§è¡Œ: {}", shardingContext);

        // è·å–åˆ†ç‰‡ä¿¡æ¯
        int shardingItem = shardingContext.getShardingItem();
        int shardingTotalCount = shardingContext.getShardingTotalCount();

        // æ‰§è¡Œåˆ†ç‰‡ä»»åŠ¡
        inventoryService.checkInventory(shardingItem, shardingTotalCount);

        logger.info("åº“å­˜æ£€æŸ¥ä»»åŠ¡æ‰§è¡Œå®Œæˆ: {}", shardingContext);
    }
}
```

**2. é…ç½®ä»»åŠ¡**ï¼š
```java
@Configuration
public class JobConfig {

    @Autowired
    private ZookeeperRegistryCenter registryCenter;

    @Autowired
    private InventoryCheckJob inventoryCheckJob;

    @Bean(initMethod = "init")
    public JobScheduler inventoryCheckJobScheduler() {
        // ä½œä¸šé…ç½®
        JobCoreConfiguration coreConfig = JobCoreConfiguration.newBuilder(
            "inventoryCheckJob", "0 0 1 * * ?", 3)
            .shardingItemParameters("0=sharding0,1=sharding1,2=sharding2")
            .description("åº“å­˜æ£€æŸ¥ä»»åŠ¡")
            .failover(true)
            .jobParameter("parameter")
            .misfire(true)
            .build();

        // ç®€å•ä½œä¸šé…ç½®
        SimpleJobConfiguration simpleJobConfig = new SimpleJobConfiguration(
            coreConfig, InventoryCheckJob.class.getCanonicalName());

        // ä½œä¸šè°ƒåº¦å™¨
        return new SpringJobScheduler(
            inventoryCheckJob,
            registryCenter,
            simpleJobConfig,
            new JobEventConfig(eventTraceDataSource()));
    }
}
```

**3. æ§åˆ¶å°éƒ¨ç½²**ï¼š
```bash
# ä¸‹è½½æ§åˆ¶å°
wget https://github.com/elasticjob/elastic-job-console/releases/download/v2.1.5/elastic-job-console-2.1.5.tar.gz

tar -zxvf elastic-job-console-2.1.5.tar.gz
cd elastic-job-console-2.1.5

# å¯åŠ¨æ§åˆ¶å°
bin/start.sh

# è®¿é—®æ§åˆ¶å°
open http://localhost:8899
```

---

## 6. Quartzåˆ†å¸ƒå¼æ”¹é€ å®æˆ˜

### 6.1 Quartzé›†ç¾¤é…ç½®

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.quartz-scheduler</groupId>
    <artifactId>quartz</artifactId>
    <version>2.3.2</version>
</dependency>
<dependency>
    <groupId>org.quartz-scheduler</groupId>
    <artifactId>quartz-jobs</artifactId>
    <version>2.3.2</version>
</dependency>
```

**2. æ•°æ®åº“é…ç½®**ï¼š
```java
@Configuration
public class QuartzConfig {

    @Bean
    public SchedulerFactoryBean schedulerFactoryBean(DataSource dataSource) {
        SchedulerFactoryBean schedulerFactoryBean = new SchedulerFactoryBean();
        schedulerFactoryBean.setDataSource(dataSource);
        schedulerFactoryBean.setApplicationContextSchedulerContextKey("applicationContext");

        // é›†ç¾¤é…ç½®
        Properties properties = new Properties();
        properties.setProperty("org.quartz.scheduler.instanceName", "quartz-cluster");
        properties.setProperty("org.quartz.scheduler.instanceId", "AUTO");
        properties.setProperty("org.quartz.jobStore.class", "org.quartz.impl.jdbcjobstore.JobStoreTX");
        properties.setProperty("org.quartz.jobStore.driverDelegateClass", "org.quartz.impl.jdbcjobstore.StdJDBCDelegate");
        properties.setProperty("org.quartz.jobStore.tablePrefix", "QRTZ_");
        properties.setProperty("org.quartz.jobStore.isClustered", "true");
        properties.setProperty("org.quartz.jobStore.clusterCheckinInterval", "15000");
        properties.setProperty("org.quartz.threadPool.class", "org.quartz.simpl.SimpleThreadPool");
        properties.setProperty("org.quartz.threadPool.threadCount", "10");

        schedulerFactoryBean.setQuartzProperties(properties);
        schedulerFactoryBean.setOverwriteExistingJobs(true);
        schedulerFactoryBean.setAutoStartup(true);

        return schedulerFactoryBean;
    }
}
```

### 6.2 ä»»åŠ¡å¼€å‘ç¤ºä¾‹

**1. åˆ›å»ºJobç±»**ï¼š
```java
public class ReportJob implements Job {

    private static final Logger logger = LoggerFactory.getLogger(ReportJob.class);

    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        logger.info("æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡å¼€å§‹æ‰§è¡Œ");

        try {
            // è·å–Jobå‚æ•°
            JobDataMap jobDataMap = context.getJobDetail().getJobDataMap();
            String reportType = jobDataMap.getString("reportType");
            Date reportDate = jobDataMap.getDate("reportDate");

            // æ‰§è¡ŒæŠ¥è¡¨ç”Ÿæˆé€»è¾‘
            ReportService reportService = SpringContextHolder.getBean(ReportService.class);
            reportService.generateReport(reportType, reportDate);

            logger.info("æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡æ‰§è¡Œå®Œæˆ");
        } catch (Exception e) {
            logger.error("æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡æ‰§è¡Œå¤±è´¥", e);
            throw new JobExecutionException("æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡æ‰§è¡Œå¤±è´¥", e, false);
        }
    }
}
```

**2. è°ƒåº¦ä»»åŠ¡**ï¼š
```java
@Service
public class QuartzJobService {

    @Autowired
    private Scheduler scheduler;

    public void scheduleReportJob(String jobName, String reportType, Date reportDate, String cronExpression) throws SchedulerException {
        // åˆ›å»ºJobDetail
        JobDetail jobDetail = JobBuilder.newJob(ReportJob.class)
            .withIdentity(jobName, "REPORT_GROUP")
            .usingJobData("reportType", reportType)
            .usingJobData("reportDate", reportDate)
            .storeDurably()
            .build();

        // åˆ›å»ºTrigger
        Trigger trigger = TriggerBuilder.newTrigger()
            .withIdentity(jobName + "_TRIGGER", "REPORT_TRIGGER_GROUP")
            .withSchedule(CronScheduleBuilder.cronSchedule(cronExpression))
            .startNow()
            .build();

        // è°ƒåº¦ä»»åŠ¡
        scheduler.scheduleJob(jobDetail, trigger);
    }
}
```

---

## 7. åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦é«˜çº§ç‰¹æ€§

### 7.1 ä»»åŠ¡åˆ†ç‰‡ç­–ç•¥å®ç°

**1. è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥**ï¼š
```java
public class CustomShardingStrategy implements JobShardingStrategy {
    @Override
    public Map<JobInstance, List<Integer>> sharding(List<JobInstance> jobInstances, JobConfiguration jobConfiguration) {
        Map<JobInstance, List<Integer>> result = new HashMap<>();
        int shardingTotalCount = jobConfiguration.getShardingTotalCount();

        // å®ç°è‡ªå®šä¹‰åˆ†ç‰‡é€»è¾‘
        for (int i = 0; i < jobInstances.size(); i++) {
            JobInstance jobInstance = jobInstances.get(i);
            List<Integer> shardingItems = new ArrayList<>();
            for (int j = i; j < shardingTotalCount; j += jobInstances.size()) {
                shardingItems.add(j);
            }
            result.put(jobInstance, shardingItems);
        }

        return result;
    }
}
```

### 7.2 ä»»åŠ¡ç›‘æ§ä¸è¿½è¸ª

**1. ä»»åŠ¡æ‰§è¡Œç›‘æ§**ï¼š
```java
@Component
public class JobMonitorListener extends JobListenerSupport {

    private static final Logger logger = LoggerFactory.getLogger(JobMonitorListener.class);

    @Autowired
    private JobMonitorService jobMonitorService;

    @Override
    public String getName() {
        return "jobMonitorListener";
    }

    @Override
    public void jobToBeExecuted(JobExecutionContext context) {
        // ä»»åŠ¡æ‰§è¡Œå‰è®°å½•
        JobMonitorDTO monitorDTO = new JobMonitorDTO();
        monitorDTO.setJobName(context.getJobDetail().getKey().getName());
        monitorDTO.setJobGroup(context.getJobDetail().getKey().getGroup());
        monitorDTO.setStartTime(new Date());
        monitorDTO.setStatus(JobStatus.RUNNING);
        jobMonitorService.saveJobMonitor(monitorDTO);

        // å­˜å‚¨ç›‘æ§IDåˆ°JobExecutionContext
        context.getJobDetail().getJobDataMap().put("monitorId", monitorDTO.getId());
    }

    @Override
    public void jobWasExecuted(JobExecutionContext context, JobExecutionException jobException) {
        // ä»»åŠ¡æ‰§è¡Œåæ›´æ–°çŠ¶æ€
        Long monitorId = context.getJobDetail().getJobDataMap().getLong("monitorId");
        JobMonitorDTO monitorDTO = jobMonitorService.getJobMonitorById(monitorId);

        monitorDTO.setEndTime(new Date());
        monitorDTO.setDuration(monitorDTO.getEndTime().getTime() - monitorDTO.getStartTime().getTime());

        if (jobException != null) {
            monitorDTO.setStatus(JobStatus.FAILED);
            monitorDTO.setErrorMessage(jobException.getMessage());
        } else {
            monitorDTO.setStatus(JobStatus.SUCCESS);
        }

        jobMonitorService.updateJobMonitor(monitorDTO);

        // å¼‚å¸¸å‘Šè­¦
        if (jobException != null) {
            jobMonitorService.sendAlarm(monitorDTO);
        }
    }
}
```

### 7.3 åŠ¨æ€ä»»åŠ¡ç®¡ç†

**1. åŠ¨æ€æ·»åŠ ä»»åŠ¡**ï¼š
```java
@Service
public class DynamicJobService {

    @Autowired
    private Scheduler scheduler;

    public void addJob(String jobName, String jobGroup, String cronExpression, Class<? extends Job> jobClass, Map<String, Object> params) throws SchedulerException {
        // åˆ›å»ºJobKey
        JobKey jobKey = new JobKey(jobName, jobGroup);

        // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²å­˜åœ¨
        if (scheduler.checkExists(jobKey)) {
            throw new SchedulerException("ä»»åŠ¡å·²å­˜åœ¨: " + jobName + "-" + jobGroup);
        }

        // åˆ›å»ºJobDetail
        JobDetail jobDetail = JobBuilder.newJob(jobClass)
            .withIdentity(jobKey)
            .storeDurably()
            .build();

        // è®¾ç½®å‚æ•°
        if (params != null && !params.isEmpty()) {
            JobDataMap jobDataMap = jobDetail.getJobDataMap();
            for (Map.Entry<String, Object> entry : params.entrySet()) {
                jobDataMap.put(entry.getKey(), entry.getValue());
            }
        }

        // åˆ›å»ºTrigger
        Trigger trigger = TriggerBuilder.newTrigger()
            .withIdentity(jobName + "_trigger", jobGroup)
            .withSchedule(CronScheduleBuilder.cronSchedule(cronExpression))
            .startNow()
            .build();

        // è°ƒåº¦ä»»åŠ¡
        scheduler.scheduleJob(jobDetail, trigger);
    }

    public void pauseJob(String jobName, String jobGroup) throws SchedulerException {
        JobKey jobKey = new JobKey(jobName, jobGroup);
        scheduler.pauseJob(jobKey);
    }

    public void resumeJob(String jobName, String jobGroup) throws SchedulerException {
        JobKey jobKey = new JobKey(jobName, jobGroup);
        scheduler.resumeJob(jobKey);
    }

    public void updateJobCron(String jobName, String jobGroup, String cronExpression) throws SchedulerException {
        TriggerKey triggerKey = new TriggerKey(jobName + "_trigger", jobGroup);
        CronTrigger trigger = (CronTrigger) scheduler.getTrigger(triggerKey);

        if (trigger == null) {
            throw new SchedulerException("è§¦å‘å™¨ä¸å­˜åœ¨: " + triggerKey);
        }

        // å¦‚æœcronè¡¨è¾¾å¼æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸æ›´æ–°
        if (trigger.getCronExpression().equals(cronExpression)) {
            return;
        }

        // æ›´æ–°è§¦å‘å™¨
        trigger = trigger.getTriggerBuilder()
            .withIdentity(triggerKey)
            .withSchedule(CronScheduleBuilder.cronSchedule(cronExpression))
            .build();

        // é‡æ–°è°ƒåº¦ä»»åŠ¡
        scheduler.rescheduleJob(triggerKey, trigger);
    }

    public void deleteJob(String jobName, String jobGroup) throws SchedulerException {
        JobKey jobKey = new JobKey(jobName, jobGroup);
        scheduler.deleteJob(jobKey);
    }
}
```

---

## 8. æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–

### 8.1 ä»»åŠ¡è®¾è®¡æœ€ä½³å®è·µ

**1. ä»»åŠ¡ç²’åº¦æ§åˆ¶**ï¼š
- é¿å…è¶…å¤§ä»»åŠ¡ï¼Œæ‹†åˆ†ä¸ºå°ä»»åŠ¡
- å•ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´æ§åˆ¶åœ¨åˆ†é’Ÿçº§
- å¤§æ•°æ®é‡ä»»åŠ¡é‡‡ç”¨åˆ†ç‰‡å¤„ç†

**2. å¹‚ç­‰æ€§è®¾è®¡**ï¼š
```java
@Service
public class OrderService {
    // åŸºäºå”¯ä¸€IDå®ç°å¹‚ç­‰
    public void processOrder(String orderId) {
        // 1. æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
        if (hasProcessed(orderId)) {
            log.info("è®¢å•å·²å¤„ç†: {}", orderId);
            return;
        }

        // 2. æ‰§è¡Œå¤„ç†é€»è¾‘
        // ...

        // 3. æ ‡è®°ä¸ºå·²å¤„ç†
        markAsProcessed(orderId);
    }
}
```

**3. ä»»åŠ¡å‚æ•°ä¼ é€’**ï¼š
- é¿å…ä¼ é€’å¤§é‡æ•°æ®ï¼Œå¯ä¼ é€’IDåæŸ¥è¯¢
- ä½¿ç”¨åºåˆ—åŒ–æ–¹å¼ä¼ é€’å¤æ‚å¯¹è±¡
- æ•æ„Ÿå‚æ•°éœ€åŠ å¯†ä¼ è¾“

### 8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**1. æ•°æ®åº“ä¼˜åŒ–**ï¼š
- ä»»åŠ¡ç›¸å…³è¡¨æ·»åŠ åˆé€‚ç´¢å¼•
- å¤§è¡¨åˆ†åŒºï¼ˆæŒ‰æ—¶é—´/ä»»åŠ¡IDï¼‰
- å®šæœŸæ¸…ç†å†å²ä»»åŠ¡æ•°æ®

**2. å¹¶å‘æ§åˆ¶**ï¼š
- åˆç†è®¾ç½®çº¿ç¨‹æ± å¤§å°
- æ§åˆ¶ä»»åŠ¡å¹¶å‘åº¦
- ä½¿ç”¨å¼‚æ­¥å¤„ç†éå…³é”®è·¯å¾„

**3. ç½‘ç»œä¼˜åŒ–**ï¼š
- è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨åŒæœºæˆ¿éƒ¨ç½²
- å‡å°‘ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç½‘ç»œè¯·æ±‚
- æ‰¹é‡å¤„ç†è¿œç¨‹è°ƒç”¨

### 8.3 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

**1. ä»»åŠ¡æ‰§è¡Œè¶…æ—¶**ï¼š
- ä¼˜åŒ–ä»»åŠ¡é€»è¾‘ï¼Œå‡å°‘æ‰§è¡Œæ—¶é—´
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- å®ç°ä»»åŠ¡æ–­ç‚¹ç»­è·‘

**2. ä»»åŠ¡æ•°æ®ä¸ä¸€è‡´**ï¼š
- é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡
- å®ç°æœ€ç»ˆä¸€è‡´æ€§
- å®šæœŸæ•°æ®æ ¡éªŒä¸ä¿®å¤

**3. é›†ç¾¤è´Ÿè½½ä¸å‡**ï¼š
- ä¼˜åŒ–åˆ†ç‰‡ç­–ç•¥
- å®ç°åŠ¨æ€è´Ÿè½½å‡è¡¡
- é¿å…ä»»åŠ¡ä¾èµ–ç‰¹å®šèŠ‚ç‚¹

**4. ä»»åŠ¡ç›‘æ§å‘Šè­¦**ï¼š
- å…³é”®æŒ‡æ ‡ç›‘æ§ï¼ˆæˆåŠŸç‡ã€æ‰§è¡Œæ—¶é—´ï¼‰
- å¤šçº§å‘Šè­¦æœºåˆ¶ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ï¼‰
- å‘Šè­¦æŠ‘åˆ¶ä¸èšåˆ

---

## ğŸ“š å‚è€ƒèµ„æº

- [XXL-Jobå®˜æ–¹æ–‡æ¡£](https://www.xuxueli.com/xxl-job/)
- [Elastic-Jobå®˜æ–¹æ–‡æ¡£](https://shardingsphere.apache.org/elasticjob/legacy/)
- [Quartzå®˜æ–¹æ–‡æ¡£](http://www.quartz-scheduler.org/documentation/)
- [åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°è®¾è®¡ä¸å®ç°](https://time.geekbang.org/column/article/162858)
- [Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜](https://book.douban.com/subject/10484692/)