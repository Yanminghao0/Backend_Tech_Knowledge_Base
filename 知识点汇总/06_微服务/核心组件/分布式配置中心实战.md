# åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒå®æˆ˜

> å¾®æœåŠ¡æ¶æ„ä¸‹çš„é…ç½®ç»Ÿä¸€ç®¡ç†ä¸åŠ¨æ€æ›´æ–°æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ¦‚è¿°](#1-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„è®¾è®¡](#2-æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„è®¾è®¡)
3. [ä¸»æµå®ç°å¯¹æ¯”](#3-ä¸»æµå®ç°å¯¹æ¯”)
4. [Spring Cloud Configå®æˆ˜](#4-spring-cloud-configå®æˆ˜)
5. [Apolloé…ç½®ä¸­å¿ƒå®æˆ˜](#5-apolloé…ç½®ä¸­å¿ƒå®æˆ˜)
6. [Nacosé…ç½®ä¸­å¿ƒå®æˆ˜](#6-nacosé…ç½®ä¸­å¿ƒå®æˆ˜)
7. [é…ç½®ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡](#7-é…ç½®ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡)
8. [æœ€ä½³å®è·µä¸å®‰å…¨ç­–ç•¥](#8-æœ€ä½³å®è·µä¸å®‰å…¨ç­–ç•¥)

---

## 1. åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ¦‚è¿°

### 1.1 å®šä¹‰ä¸ä»·å€¼

åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ˜¯ä¸€ç§é›†ä¸­ç®¡ç†åº”ç”¨é…ç½®çš„åŸºç¡€è®¾æ–½ï¼Œèƒ½å¤Ÿå®ç°é…ç½®çš„ç»Ÿä¸€å­˜å‚¨ã€ç‰ˆæœ¬æ§åˆ¶ã€åŠ¨æ€æ›´æ–°å’Œç¯å¢ƒéš”ç¦»ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é…ç½®ç®¡ç†çš„å¤æ‚æ€§é—®é¢˜ã€‚

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- é…ç½®åˆ†æ•£åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¸­ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†
- ç¯å¢ƒé…ç½®æ··ä¹±ï¼Œå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸ä¸€è‡´
- é…ç½®ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡ï¼Œå½±å“ç³»ç»Ÿå¯ç”¨æ€§
- æ•æ„Ÿé…ç½®ï¼ˆå¦‚æ•°æ®åº“å¯†ç ï¼‰æ˜æ–‡å­˜å‚¨ï¼Œå­˜åœ¨å®‰å…¨é£é™©
- ç¼ºä¹é…ç½®å˜æ›´å®¡è®¡å’Œè¿½æº¯èƒ½åŠ›

### 1.2 æ¼”è¿›å†ç¨‹

| é˜¶æ®µ | é…ç½®æ–¹å¼ | ç¼ºç‚¹ |
|------|----------|------|
| 1.0 | æœ¬åœ°é…ç½®æ–‡ä»¶ | åˆ†æ•£ç®¡ç†ã€ä¿®æ”¹éœ€é‡å¯ã€ç¯å¢ƒä¸ä¸€è‡´ |
| 2.0 | é›†ä¸­å¼é…ç½®æ–‡ä»¶ | ç¼ºä¹åŠ¨æ€æ›´æ–°ã€ç‰ˆæœ¬æ§åˆ¶ä¸è¶³ |
| 3.0 | åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ | é›†ä¸­ç®¡ç†ã€åŠ¨æ€æ›´æ–°ã€ç¯å¢ƒéš”ç¦»ã€ç‰ˆæœ¬æ§åˆ¶ |

### 1.3 å…¸å‹åº”ç”¨åœºæ™¯

- å¤šç¯å¢ƒé…ç½®ç®¡ç†
- åŠ¨æ€åŠŸèƒ½å¼€å…³
- é™æµç†”æ–­è§„åˆ™åŠ¨æ€è°ƒæ•´
- æ•°æ®åº“è¿æ¥å‚æ•°åŠ¨æ€é…ç½®
- æœåŠ¡å‘ç°åœ°å€ç®¡ç†
- æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨

```mermaid
graph TD
    A[é…ç½®ä¸­å¿ƒ] -->|å­˜å‚¨é…ç½®| B[é…ç½®ä»“åº“]
    C[ç®¡ç†ç•Œé¢] -->|æ›´æ–°é…ç½®| A
    A -->|æ¨é€é…ç½®| D[æœåŠ¡é›†ç¾¤]
    D -->|æ‹‰å–é…ç½®| A
    B -->|ç‰ˆæœ¬æ§åˆ¶| E[Git/SVN]
```

---

## 2. æ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„è®¾è®¡

### 2.1 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| **é›†ä¸­ç®¡ç†** | æ‰€æœ‰åº”ç”¨é…ç½®ç»Ÿä¸€å­˜å‚¨ï¼Œæ”¯æŒæŒ‰åº”ç”¨ã€æ¨¡å—ã€ç¯å¢ƒç»„ç»‡ |
| **åŠ¨æ€æ›´æ–°** | é…ç½®ä¿®æ”¹åå®æ—¶æ¨é€åˆ°åº”ç”¨ï¼Œæ— éœ€é‡å¯æœåŠ¡ |
| **ç¯å¢ƒéš”ç¦»** | æ”¯æŒå¤šç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰é…ç½®ç®¡ç† |
| **ç‰ˆæœ¬æ§åˆ¶** | è®°å½•é…ç½®å˜æ›´å†å²ï¼Œæ”¯æŒå›æ»šåˆ°å†å²ç‰ˆæœ¬ |
| **é…ç½®æ¨é€** | ä¸»åŠ¨æ¨é€é…ç½®æ›´æ–°åˆ°åº”ç”¨ï¼Œä½å»¶è¿Ÿå“åº” |
| **æƒé™æ§åˆ¶** | åŸºäºè§’è‰²çš„é…ç½®è®¿é—®å’Œä¿®æ”¹æƒé™ç®¡ç† |
| **é…ç½®æ ¡éªŒ** | é…ç½®æ ¼å¼å’Œå†…å®¹åˆæ³•æ€§æ ¡éªŒ |
| **æ•æ„Ÿé…ç½®åŠ å¯†** | æ”¯æŒæ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨å’Œä¼ è¾“ |
| **å®¡è®¡æ—¥å¿—** | è®°å½•é…ç½®å˜æ›´æ“ä½œæ—¥å¿—ï¼Œæ»¡è¶³åˆè§„è¦æ±‚ |
| **é«˜å¯ç”¨** | é›†ç¾¤éƒ¨ç½²ï¼Œä¿è¯é…ç½®æœåŠ¡ä¸ä¸­æ–­ |

### 2.2 æ¶æ„è®¾è®¡

**1. ç»å…¸ä¸‰å±‚æ¶æ„**ï¼š
```
å®¢æˆ·ç«¯å±‚ <--> æœåŠ¡ç«¯å±‚ <--> å­˜å‚¨å±‚
```

**2. ç»„ä»¶èŒè´£**ï¼š
- **å®¢æˆ·ç«¯**ï¼šåµŒå…¥åº”ç”¨ï¼Œæ‹‰å–/æ¥æ”¶é…ç½®ï¼Œæœ¬åœ°ç¼“å­˜
- **æœåŠ¡ç«¯**ï¼šæä¾›é…ç½®ç®¡ç†APIï¼Œå¤„ç†é…ç½®è¯·æ±‚ï¼Œæ¨é€æ›´æ–°
- **å­˜å‚¨å±‚**ï¼šæŒä¹…åŒ–å­˜å‚¨é…ç½®æ•°æ®ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶

**3. é…ç½®æ›´æ–°æµç¨‹**ï¼š
```mermaid
graph LR
    A[ç”¨æˆ·æ›´æ–°é…ç½®] --> B[é…ç½®æœåŠ¡ç«¯]
    B --> C[å­˜å‚¨é…ç½®å¹¶è®°å½•ç‰ˆæœ¬]
    B --> D[æ¨é€é…ç½®å˜æ›´é€šçŸ¥]
    D --> E[å®¢æˆ·ç«¯æ¥æ”¶é€šçŸ¥]
    E --> F[æ‹‰å–æœ€æ–°é…ç½®]
    F --> G[åº”ç”¨æ–°é…ç½®]
```

---

## 3. ä¸»æµå®ç°å¯¹æ¯”

| ç‰¹æ€§ | Spring Cloud Config | Apollo | Nacos | Diamond | Disconf |
|------|---------------------|--------|-------|---------|---------|
| **å¼€å‘è¯­è¨€** | Java | Java | Java | Java | Java |
| **é…ç½®å­˜å‚¨** | Git/SVN | MySQL | MySQL/Derby | MySQL | ZooKeeper |
| **åŠ¨æ€æ›´æ–°** | æ”¯æŒï¼ˆéœ€ç»“åˆBusï¼‰ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **æ¨é€æœºåˆ¶** | è¢«åŠ¨æ‹‰å– | ä¸»åŠ¨æ¨é€ | ä¸»åŠ¨æ¨é€ | ä¸»åŠ¨æ¨é€ | ä¸»åŠ¨æ¨é€ |
| **ç¯å¢ƒç®¡ç†** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **æƒé™æ§åˆ¶** | å¼± | å®Œå–„ | å®Œå–„ | ä¸€èˆ¬ | ä¸€èˆ¬ |
| **UIç•Œé¢** | æ—  | å®Œå–„ | å®Œå–„ | ç®€å• | å®Œå–„ |
| **é«˜å¯ç”¨** | ä¾èµ–Gitå’Œæ¶ˆæ¯æ€»çº¿ | æ”¯æŒé›†ç¾¤ | æ”¯æŒé›†ç¾¤ | æ”¯æŒé›†ç¾¤ | ä¾èµ–ZooKeeper |
| **æ˜“ç”¨æ€§** | ä¸­ | é«˜ | é«˜ | ä¸­ | ä¸­ |
| **ç”Ÿæ€é›†æˆ** | Spring CloudåŸç”Ÿ | å¤šæ¡†æ¶æ”¯æŒ | Spring Cloud/Dubbo | é˜¿é‡Œç³» | ç™¾åº¦ç³» |
| **ç¤¾åŒºæ´»è·ƒåº¦** | ä¸­ | é«˜ | é«˜ | ä½ | ä½ |
| **é…ç½®åŠ å¯†** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **é…ç½®æ ¡éªŒ** | åŸºæœ¬ | å®Œå–„ | å®Œå–„ | åŸºæœ¬ |

---

## 4. Spring Cloud Configå®æˆ˜

### 4.1 ç¯å¢ƒæ­å»º

**1. æœåŠ¡ç«¯é…ç½®**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-config-server</artifactId>
</dependency>
```

```yaml
# application.yml
server:
  port: 8888

spring:
  application:
    name: config-server
  cloud:
    config:
      server:
        git:
          uri: https://github.com/yourusername/config-repo.git
          search-paths: '{application}'
          username: yourusername
          password: yourpassword
          default-label: main
  security:
    user:
      name: config-user
      password: config-password
```

```java
@SpringBootApplication
@EnableConfigServer
public class ConfigServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConfigServerApplication.class, args);
    }
}
```

**2. å®¢æˆ·ç«¯é…ç½®**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

```yaml
# bootstrap.yml
spring:
  application:
    name: order-service
  cloud:
    config:
      uri: http://config-user:config-password@localhost:8888
      label: main
      profile: dev
      fail-fast: true
```

### 4.2 é…ç½®ä»“åº“ç»“æ„

```
config-repo/
â”œâ”€â”€ order-service/
â”‚   â”œâ”€â”€ order-service-dev.yml
â”‚   â”œâ”€â”€ order-service-test.yml
â”‚   â””â”€â”€ order-service-prod.yml
â”œâ”€â”€ user-service/
â”‚   â”œâ”€â”€ user-service-dev.yml
â”‚   â””â”€â”€ user-service-prod.yml
â””â”€â”€ common.yml
```

### 4.3 åŠ¨æ€åˆ·æ–°é…ç½®

**1. æ·»åŠ Actuatorä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**2. æš´éœ²åˆ·æ–°ç«¯ç‚¹**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: refresh,health,info
```

**3. ä½¿ç”¨@RefreshScope**ï¼š
```java
@RestController
@RefreshScope
public class ConfigController {

    @Value("${app.version:1.0.0}")
    private String appVersion;

    @Value("${app.timeout:3000}")
    private int timeout;

    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> configMap = new HashMap<>();
        configMap.put("appVersion", appVersion);
        configMap.put("timeout", timeout);
        return configMap;
    }
}
```

**4. è§¦å‘åˆ·æ–°**ï¼š
```bash
# å•ä¸ªå®ä¾‹åˆ·æ–°
curl -X POST http://localhost:8080/actuator/refresh

# æ‰€æœ‰å®ä¾‹åˆ·æ–°ï¼ˆç»“åˆSpring Cloud Busï¼‰
curl -X POST http://localhost:8888/actuator/bus-refresh
```

### 4.4 é›†æˆæ¶ˆæ¯æ€»çº¿å®ç°è‡ªåŠ¨åˆ·æ–°

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bus-amqp</artifactId>
</dependency>
```

```yaml
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest

management:
  endpoints:
    web:
      exposure:
        include: bus-refresh,health,info
```

**æ‰¹é‡åˆ·æ–°æ‰€æœ‰æœåŠ¡**ï¼š
```bash
curl -X POST http://localhost:8888/actuator/bus-refresh
```

**åˆ·æ–°æŒ‡å®šæœåŠ¡**ï¼š
```bash
curl -X POST http://localhost:8888/actuator/bus-refresh/user-service:
```

---

## 5. Apolloé…ç½®ä¸­å¿ƒå®æˆ˜

### 5.1 Apolloæ¶æ„

```mermaid
graph TD
    A[Portal] -->|ç®¡ç†é…ç½®| B[Admin Service]
    B --> C[Config Service]
    D[Client] -->|æ‹‰å–é…ç½®| C
    C <--> E[Meta Server]
    D -->|æœåŠ¡å‘ç°| E
    B <--> F[æ•°æ®åº“]
    C <--> F
```

### 5.2 ç¯å¢ƒæ­å»º

```bash
# ä¸‹è½½æºç 
git clone https://github.com/ctripcorp/apollo.git
cd apollo

# ç¼–è¯‘æºç 
mvn clean package -DskipTests

# åˆå§‹åŒ–æ•°æ®åº“
sql/apolloportaldb.sql
sql/apolloconfigdb.sql

# å¯åŠ¨æœåŠ¡
cd apollo-adminservice/target/
java -jar apollo-adminservice-1.9.2.jar

cd apollo-configservice/target/
java -jar apollo-configservice-1.9.2.jar

cd apollo-portal/target/
java -jar apollo-portal-1.9.2.jar

# è®¿é—®ç®¡ç†ç•Œé¢
open http://localhost:8070
```

### 5.3 å®¢æˆ·ç«¯é›†æˆ

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.ctrip.framework.apollo</groupId>
    <artifactId>apollo-client</artifactId>
    <version>1.9.2</version>
</dependency>
```

**2. é…ç½®Apollo**ï¼š
```yaml
app:
  id: order-service
apollo:
  meta: http://localhost:8080
  bootstrap:
    enabled: true
    namespaces: application,common,redis
```

**3. ä½¿ç”¨é…ç½®**ï¼š
```java
@RestController
public class ApolloConfigController {

    // æ–¹å¼ä¸€ï¼š@Valueæ³¨è§£
    @Value("${app.version:1.0.0}")
    private String appVersion;

    // æ–¹å¼äºŒï¼šApolloé…ç½®å¯¹è±¡
    @ApolloConfig
    private Config config;

    // æ–¹å¼ä¸‰ï¼š@ConfigurationProperties
    @Autowired
    private AppConfig appConfig;

    // ç›‘å¬é…ç½®å˜åŒ–
    @ApolloConfigChangeListener
    private void onChange(ConfigChangeEvent changeEvent) {
        if (changeEvent.isChanged("app.version")) {
            appVersion = config.getProperty("app.version", "1.0.0");
            System.out.println("app.version changed to: " + appVersion);
        }
    }

    @GetMapping("/apollo-config")
    public Map<String, Object> getConfig() {
        Map<String, Object> result = new HashMap<>();
        result.put("appVersion", appVersion);
        result.put("timeout", config.getIntProperty("app.timeout", 3000));
        result.put("maxUsers", appConfig.getMaxUsers());
        return result;
    }

    @Configuration
    @ConfigurationProperties(prefix = "app")
    public static class AppConfig {
        private int maxUsers;

        // getter and setter
        public int getMaxUsers() { return maxUsers; }
        public void setMaxUsers(int maxUsers) { this.maxUsers = maxUsers; }
    }
}
```

---

## 6. Nacosé…ç½®ä¸­å¿ƒå®æˆ˜

### 6.1 ç¯å¢ƒæ­å»º

```bash
# ä¸‹è½½Nacos
wget https://github.com/alibaba/nacos/releases/download/2.0.3/nacos-server-2.0.3.tar.gz

tar -zxvf nacos-server-2.0.3.tar.gz
cd nacos/bin

# å¯åŠ¨å•æœºæ¨¡å¼
sh startup.sh -m standalone

# è®¿é—®æ§åˆ¶å°
open http://localhost:8848/nacos
# é»˜è®¤è´¦å·å¯†ç ï¼šnacos/nacos
```

### 6.2 å®¢æˆ·ç«¯é›†æˆ

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    <version>2.2.7.RELEASE</version>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

**2. é…ç½®Nacos**ï¼š
```yaml
# bootstrap.yml
spring:
  application:
    name: order-service
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        file-extension: yaml
        namespace: public
        group: DEFAULT_GROUP
        # å¤šé…ç½®é›†
        extension-configs:
          - data-id: common.yaml
            group: COMMON_GROUP
            refresh: true
          - data-id: redis.yaml
            group: COMMON_GROUP
            refresh: true
```

### 6.3 åŠ¨æ€é…ç½®ä¸ç›‘å¬

```java
@RestController
@RefreshScope
public class NacosConfigController {

    @Value("${app.version:1.0.0}")
    private String appVersion;

    @Value("${app.timeout:3000}")
    private int timeout;

    @Autowired
    private NacosConfigManager nacosConfigManager;

    @PostConstruct
    public void init() throws NacosException {
        // ç›‘å¬é…ç½®å˜åŒ–
        nacosConfigManager.getConfigService().addListener(
            "order-service.yaml", 
            "DEFAULT_GROUP", 
            new Listener() {
                @Override
                public void receiveConfigInfo(String configInfo) {
                    System.out.println("é…ç½®æ›´æ–°: " + configInfo);
                    // å¤„ç†é…ç½®å˜æ›´
                }

                @Override
                public Executor getExecutor() {
                    return null;
                }
            }
        );
    }

    @GetMapping("/nacos-config")
    public Map<String, Object> getConfig() {
        Map<String, Object> result = new HashMap<>();
        result.put("appVersion", appVersion);
        result.put("timeout", timeout);
        return result;
    }
}
```

---

## 7. é…ç½®ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡

### 7.1 é›†ç¾¤éƒ¨ç½²

**1. Spring Cloud Configé›†ç¾¤**ï¼š
```yaml
# æ‰€æœ‰Config Serverè¿æ¥åŒä¸€Gitä»“åº“
spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/yourusername/config-repo.git
          username: yourusername
          password: yourpassword

# å‰ç«¯é…ç½®è´Ÿè½½å‡è¡¡
```

**2. Apolloé›†ç¾¤**ï¼š
```
# éƒ¨ç½²å¤šä¸ªConfig Serviceå’ŒAdmin Serviceå®ä¾‹
# é…ç½®Meta ServeræŒ‡å‘æ‰€æœ‰Config Service
# æ•°æ®åº“ä¸»ä»å¤åˆ¶
```

**3. Nacosé›†ç¾¤**ï¼š
```bash
# ä¿®æ”¹cluster.conf
192.168.1.101:8848
192.168.1.102:8848
192.168.1.103:8848

# å¯åŠ¨é›†ç¾¤
sh startup.sh -p embedded
```

### 7.2 æ•°æ®æŒä¹…åŒ–

**1. é…ç½®æ•°æ®å­˜å‚¨**ï¼š
- Spring Cloud Config: ä¾èµ–Gitä»“åº“
- Apollo: MySQLæ•°æ®åº“
- Nacos: MySQLæ•°æ®åº“

**2. æ•°æ®å¤‡ä»½ç­–ç•¥**ï¼š
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- Gitä»“åº“å¤šåˆ†æ”¯ç®¡ç†
- é…ç½®å˜æ›´å®¡è®¡æ—¥å¿—

### 7.3 å®¹ç¾è®¾è®¡

**1. æœ¬åœ°ç¼“å­˜**ï¼š
- å®¢æˆ·ç«¯ç¼“å­˜é…ç½®åˆ°æœ¬åœ°æ–‡ä»¶
- é…ç½®ä¸­å¿ƒä¸å¯ç”¨æ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜

**2. å¤šåŒºåŸŸéƒ¨ç½²**ï¼š
```mermaid
graph TD
    subgraph åŒºåŸŸA
        A1[é…ç½®ä¸­å¿ƒèŠ‚ç‚¹1] --> A2[é…ç½®ä¸­å¿ƒèŠ‚ç‚¹2]
    end
    subgraph åŒºåŸŸB
        B1[é…ç½®ä¸­å¿ƒèŠ‚ç‚¹1] --> B2[é…ç½®ä¸­å¿ƒèŠ‚ç‚¹2]
    end
    A1 --> B1
    A2 --> B2
```

**3. é™çº§ç­–ç•¥**ï¼š
- é…ç½®ä¸­å¿ƒä¸å¯ç”¨æ—¶ï¼Œåº”ç”¨ä½¿ç”¨æœ€åå·²çŸ¥çš„æœ‰æ•ˆé…ç½®
- å…³é”®é…ç½®æœ¬åœ°å›ºåŒ–
- é…ç½®æ›´æ–°å¤±è´¥å‘Šè­¦

---

## 8. æœ€ä½³å®è·µä¸å®‰å…¨ç­–ç•¥

### 7.1 é…ç½®ç®¡ç†æœ€ä½³å®è·µ

**1. é…ç½®åˆ†ç±»**ï¼š
- **åº”ç”¨é…ç½®**ï¼šåº”ç”¨ç‰¹æœ‰é…ç½®
- **å…¬å…±é…ç½®**ï¼šå¤šä¸ªåº”ç”¨å…±äº«çš„é…ç½®
- **ç¯å¢ƒé…ç½®**ï¼šä¸åŒç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®
- **æ•æ„Ÿé…ç½®**ï¼šæ•°æ®åº“å¯†ç ã€APIå¯†é’¥ç­‰
- **åŸºç¡€é…ç½®**ï¼šåº”ç”¨åç§°ã€ç«¯å£å·ç­‰åŸºæœ¬ä¿¡æ¯
- **ä¸šåŠ¡é…ç½®**ï¼šä¸šåŠ¡è§„åˆ™ã€é˜ˆå€¼ç­‰

**2. å‘½åè§„èŒƒ**ï¼š
```
# æ¨èæ ¼å¼
{application}.{profile}.{file-extension}

# ç¤ºä¾‹
order-service.dev.yaml
user-service.prod.yaml
common.yaml
```

**3. é…ç½®ç‰ˆæœ¬æ§åˆ¶**ï¼š
- ä½¿ç”¨Gitç®¡ç†é…ç½®ï¼ˆSpring Cloud Configï¼‰
- åˆ©ç”¨é…ç½®ä¸­å¿ƒè‡ªå¸¦ç‰ˆæœ¬åŠŸèƒ½
- å®šæœŸæ ‡è®°é…ç½®ç‰ˆæœ¬

**4. é…ç½®å˜æ›´æµç¨‹**ï¼š
1. å¼€å‘äººå‘˜æäº¤é…ç½®å˜æ›´ç”³è¯·
2. é…ç½®å˜æ›´å®¡æ ¸
3. æµ‹è¯•ç¯å¢ƒéªŒè¯
4. ç”Ÿäº§ç¯å¢ƒç°åº¦å‘å¸ƒ
5. é…ç½®å˜æ›´è®°å½•ä¸å®¡è®¡

### 8.2 æ•æ„Ÿé…ç½®å¤„ç†

**1. Nacosé…ç½®åŠ å¯†**ï¼š
```yaml
spring:
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        encrypt:
          key: your-secret-key
```

**2. Apolloé…ç½®åŠ å¯†**ï¼š
- åœ¨Apolloæ§åˆ¶å°å¼€å¯é…ç½®åŠ å¯†
- ä½¿ç”¨`@EncryptField`æ³¨è§£

**3. è‡ªå®šä¹‰åŠ å¯†å®ç°**ï¼š
```java
@Component
public class ConfigEncryptor {
    private static final String SECRET_KEY = "your-secret-key";

    // åŠ å¯†
    public String encrypt(String content) {
        // å®ç°åŠ å¯†é€»è¾‘
    }

    // è§£å¯†
    public String decrypt(String encryptedContent) {
        // å®ç°è§£å¯†é€»è¾‘
    }
}
```

### 8.3 æ€§èƒ½ä¼˜åŒ–

**1. å®¢æˆ·ç«¯ä¼˜åŒ–**ï¼š
- åˆç†è®¾ç½®é…ç½®æ‹‰å–é—´éš”
- æ‰¹é‡è·å–é…ç½®
- æœ¬åœ°ç¼“å­˜ä¼˜åŒ–

**2. æœåŠ¡ç«¯ä¼˜åŒ–**ï¼š
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- é…ç½®ç¼“å­˜
- è¯»å†™åˆ†ç¦»

**3. ç½‘ç»œä¼˜åŒ–**ï¼š
- é…ç½®ä¸­å¿ƒä¸åº”ç”¨åŒåŒºåŸŸéƒ¨ç½²
- å‹ç¼©é…ç½®ä¼ è¾“å†…å®¹
- é™åˆ¶å•æ¬¡é…ç½®å¤§å°

### 8.4 ç›‘æ§ä¸å‘Šè­¦

**1. å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
- é…ç½®åŠ è½½æˆåŠŸç‡
- é…ç½®æ›´æ–°é¢‘ç‡
- é…ç½®æ‹‰å–è€—æ—¶
- æœåŠ¡ç«¯å¥åº·çŠ¶æ€
- é…ç½®åŒæ­¥å»¶è¿Ÿ

**2. å‘Šè­¦ç­–ç•¥**ï¼š
- é…ç½®æ›´æ–°å¤±è´¥å‘Šè­¦
- é…ç½®ä¸­å¿ƒä¸å¯ç”¨å‘Šè­¦
- é…ç½®åŠ è½½å¼‚å¸¸å‘Šè­¦
- æ•æ„Ÿé…ç½®å˜æ›´å‘Šè­¦
- é…ç½®åŒæ­¥è¶…æ—¶å‘Šè­¦

**3. å®ç°æ–¹å¼**ï¼š
```yaml
# Prometheusç›‘æ§é…ç½®ç¤ºä¾‹
scrape_configs:
  - job_name: 'config-center'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['config-server:8888', 'nacos-server:8848', 'apollo-configservice:8080']
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Spring Cloud Configå®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-cloud-config/docs/current/reference/html/)
- [Apolloå®˜æ–¹æ–‡æ¡£](https://ctripcorp.github.io/apollo/)
- [Nacoså®˜æ–¹æ–‡æ¡£](https://nacos.io/zh-cn/docs/what-is-nacos.html)
- [Spring Cloud Alibabaæ–‡æ¡£](https://github.com/alibaba/spring-cloud-alibaba/wiki)
- [åˆ†å¸ƒå¼ç³»ç»Ÿé…ç½®ç®¡ç†å®è·µ](https://martinfowler.com/articles/distributed-configuration.html)