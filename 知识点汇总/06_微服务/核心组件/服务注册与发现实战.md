# æœåŠ¡æ³¨å†Œä¸å‘ç°å®æˆ˜

> å¾®æœåŠ¡æ¶æ„ä¸‹çš„æœåŠ¡æ²»ç†æ ¸å¿ƒæŠ€æœ¯

## ğŸ“‹ ç›®å½•

1. [æœåŠ¡æ³¨å†Œä¸å‘ç°æ¦‚è¿°](#1-æœåŠ¡æ³¨å†Œä¸å‘ç°æ¦‚è¿°)
2. [æ ¸å¿ƒåŸç†](#2-æ ¸å¿ƒåŸç†)
3. [ä¸»æµå®ç°å¯¹æ¯”](#3-ä¸»æµå®ç°å¯¹æ¯”)
4. [Eurekaå®æˆ˜](#4-eurekaå®æˆ˜)
5. [Consulå®æˆ˜](#5-consulå®æˆ˜)
6. [Nacoså®æˆ˜](#6-nacoså®æˆ˜)
7. [é«˜å¯ç”¨éƒ¨ç½²ç­–ç•¥](#7-é«˜å¯ç”¨éƒ¨ç½²ç­–ç•¥)
8. [æœ€ä½³å®è·µä¸é—®é¢˜æ’æŸ¥](#8-æœ€ä½³å®è·µä¸é—®é¢˜æ’æŸ¥)

---

## 1. æœåŠ¡æ³¨å†Œä¸å‘ç°æ¦‚è¿°

### 1.1 å®šä¹‰ä¸ä»·å€¼

æœåŠ¡æ³¨å†Œä¸å‘ç°æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£è‡ªåŠ¨æ£€æµ‹å’Œè·Ÿè¸ªå¯ç”¨æœåŠ¡å®ä¾‹ï¼Œå®ç°æœåŠ¡ä½ç½®çš„åŠ¨æ€ç®¡ç†ã€‚

**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- å¾®æœåŠ¡å®ä¾‹åŠ¨æ€æ‰©ç¼©å®¹å¯¼è‡´çš„åœ°å€å˜åŒ–
- æœåŠ¡é—´é€šä¿¡çš„è´Ÿè½½å‡è¡¡
- æœåŠ¡å¥åº·çŠ¶æ€ç›‘æ§
- æ•…éšœè‡ªåŠ¨è½¬ç§»

### 1.2 åº”ç”¨åœºæ™¯

- å¾®æœåŠ¡æ¶æ„ä¸‹çš„æœåŠ¡é€šä¿¡
- äº‘åŸç”Ÿç¯å¢ƒä¸­çš„åŠ¨æ€æœåŠ¡ç®¡ç†
- å®¹å™¨åŒ–éƒ¨ç½²çš„æœåŠ¡åè°ƒ
- DevOpsæŒç»­éƒ¨ç½²æµç¨‹é›†æˆ

```mermaid
graph TD
    A[æœåŠ¡æä¾›è€…] -->|æ³¨å†ŒæœåŠ¡| B[æœåŠ¡æ³¨å†Œä¸­å¿ƒ]
    C[æœåŠ¡æ¶ˆè´¹è€…] -->|æŸ¥è¯¢æœåŠ¡| B
    B -->|è¿”å›æœåŠ¡åˆ—è¡¨| C
    C -->|è°ƒç”¨æœåŠ¡| A
    A -->|å¥åº·æ£€æŸ¥| B
```

---

## 2. æ ¸å¿ƒåŸç†

### 2.1 å·¥ä½œæµç¨‹

1. **æœåŠ¡æ³¨å†Œ**ï¼šæœåŠ¡å¯åŠ¨æ—¶å°†è‡ªèº«ä¿¡æ¯ï¼ˆåœ°å€ã€ç«¯å£ã€æœåŠ¡åç­‰ï¼‰æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ
2. **å¥åº·æ£€æŸ¥**ï¼šæ³¨å†Œä¸­å¿ƒå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
3. **æœåŠ¡å‘ç°**ï¼šæ¶ˆè´¹è€…ä»æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢å¯ç”¨æœåŠ¡åˆ—è¡¨
4. **è´Ÿè½½å‡è¡¡**ï¼šæ¶ˆè´¹è€…æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æœåŠ¡å®ä¾‹
5. **æœåŠ¡ä¸‹çº¿**ï¼šæœåŠ¡å…³é—­å‰ä»æ³¨å†Œä¸­å¿ƒæ³¨é”€

### 2.2 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| **æœåŠ¡æ³¨å†Œä¸­å¿ƒ** | å­˜å‚¨æœåŠ¡å…ƒæ•°æ®ï¼Œæä¾›æœåŠ¡æ³¨å†Œä¸æŸ¥è¯¢æ¥å£ |
| **æœåŠ¡æä¾›è€…** | æ³¨å†Œè‡ªèº«æœåŠ¡ï¼Œæä¾›æœåŠ¡åŠŸèƒ½ |
| **æœåŠ¡æ¶ˆè´¹è€…** | æŸ¥è¯¢æœåŠ¡åˆ—è¡¨ï¼Œè°ƒç”¨æœåŠ¡ |
| **å¥åº·æ£€æŸ¥å™¨** | ç›‘æ§æœåŠ¡å¥åº·çŠ¶æ€ |
| **è´Ÿè½½å‡è¡¡å™¨** | åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹é—´åˆ†é…è¯·æ±‚ |

### 2.3 æœåŠ¡å…ƒæ•°æ®

æœåŠ¡æ³¨å†Œä¸­å¿ƒå­˜å‚¨çš„å…³é”®ä¿¡æ¯ï¼š
- æœåŠ¡åç§°ï¼ˆService Nameï¼‰
- å®ä¾‹IDï¼ˆInstance IDï¼‰
- ç½‘ç»œåœ°å€ï¼ˆHostã€Portï¼‰
- å¥åº·æ£€æŸ¥åœ°å€
- å…ƒæ•°æ®æ ‡ç­¾ï¼ˆMetadataï¼‰
- çŠ¶æ€ï¼ˆUP/DOWN/STARTING/OUT_OF_SERVICEï¼‰

---

## 3. ä¸»æµå®ç°å¯¹æ¯”

| ç‰¹æ€§ | Eureka | Consul | Nacos | ZooKeeper | etcd |
|------|--------|--------|-------|-----------|------|
| **å¼€å‘è¯­è¨€** | Java | Go | Java | Java | Go |
| **ä¸€è‡´æ€§åè®®** | AP | CP+AP | CP+AP | CP | CP |
| **æœåŠ¡å‘ç°** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **å¥åº·æ£€æŸ¥** | å®¢æˆ·ç«¯å¿ƒè·³ | HTTP/gRPC/TCP | å®¢æˆ·ç«¯å¿ƒè·³/HTTP/MySQL | å®¢æˆ·ç«¯å¿ƒè·³ | å®¢æˆ·ç«¯å¿ƒè·³ |
| **é…ç½®ç®¡ç†** | ä¸æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **å¤šæ•°æ®ä¸­å¿ƒ** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ | æœ‰é™ | æœ‰é™ |
| **æ˜“ç”¨æ€§** | é«˜ | ä¸­ | é«˜ | ä½ | ä¸­ |
| **æ€§èƒ½** | é«˜ | ä¸­ | é«˜ | ä¸­ | é«˜ |
| **ç”Ÿæ€é›†æˆ** | Spring Cloud | å¤šè¯­è¨€æ”¯æŒ | Spring Cloud/Dubbo | å¤šè¯­è¨€æ”¯æŒ | å¤šè¯­è¨€æ”¯æŒ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | ä¸­ | é«˜ | é«˜ | é«˜ | é«˜ |

---

## 4. Eurekaå®æˆ˜

### 4.1 æœåŠ¡ç«¯æ­å»º

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
</dependency>
```

**2. é…ç½®æ–‡ä»¶**ï¼š
```yaml
server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false
    fetchRegistry: false
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
  server:
    enableSelfPreservation: false # å…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼
    evictionIntervalTimerInMs: 30000 # æ¸…ç†é—´éš”ï¼ˆæ¯«ç§’ï¼‰
```

**3. å¯åŠ¨ç±»**ï¼š
```java
@SpringBootApplication
@EnableEurekaServer
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

### 4.2 å®¢æˆ·ç«¯é…ç½®

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

**2. é…ç½®æ–‡ä»¶**ï¼š
```yaml
spring:
  application:
    name: user-service

eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
  instance:
    preferIpAddress: true # ä¼˜å…ˆä½¿ç”¨IPåœ°å€æ³¨å†Œ
    lease-renewal-interval-in-seconds: 30 # å¿ƒè·³é—´éš”
    lease-expiration-duration-in-seconds: 90 # è¿‡æœŸæ—¶é—´
```

**3. å¯åŠ¨ç±»**ï¼š
```java
@SpringBootApplication
@EnableDiscoveryClient
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 4.3 é«˜å¯ç”¨é›†ç¾¤é…ç½®

```yaml
# èŠ‚ç‚¹1é…ç½®
eureka:
  instance:
    hostname: eureka-server1
  client:
    serviceUrl:
      defaultZone: http://eureka-server2:8762/eureka/,http://eureka-server3:8763/eureka/

# èŠ‚ç‚¹2é…ç½®
eureka:
  instance:
    hostname: eureka-server2
  client:
    serviceUrl:
      defaultZone: http://eureka-server1:8761/eureka/,http://eureka-server3:8763/eureka/

# èŠ‚ç‚¹3é…ç½®
eureka:
  instance:
    hostname: eureka-server3
  client:
    serviceUrl:
      defaultZone: http://eureka-server1:8761/eureka/,http://eureka-server2:8762/eureka/
```

---

## 5. Consulå®æˆ˜

### 5.1 å®‰è£…ä¸å¯åŠ¨

```bash
# ä¸‹è½½Consul
brew install consul # MacOS
# æˆ–ä»å®˜ç½‘ä¸‹è½½ï¼šhttps://www.consul.io/downloads

# å¯åŠ¨å¼€å‘æ¨¡å¼
consul agent -dev -client=0.0.0.0

# è®¿é—®Webç•Œé¢
open http://localhost:8500
```

### 5.2 æœåŠ¡æ³¨å†Œ

**1. é…ç½®æ–‡ä»¶æ–¹å¼**ï¼š
```json
// service.json
{
  "service": {
    "name": "user-service",
    "id": "user-service-1",
    "address": "127.0.0.1",
    "port": 8080,
    "check": {
      "http": "http://127.0.0.1:8080/actuator/health",
      "interval": "10s",
      "timeout": "5s"
    },
    "tags": ["microservice", "user"]
  }
}

# æ³¨å†ŒæœåŠ¡
consul services register service.json
```

**2. Spring Cloudé›†æˆ**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-consul-discovery</artifactId>
</dependency>
```

```yaml
spring:
  application:
    name: user-service
  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        service-name: ${spring.application.name}
        health-check-path: /actuator/health
        health-check-interval: 10s
        tags: microservice,user
```

### 5.3 æœåŠ¡å‘ç°ä¸è°ƒç”¨

```java
@RestController
public class UserController {

    @Autowired
    private LoadBalancerClient loadBalancerClient;

    @GetMapping("/call-order-service")
    public String callOrderService() {
        // é€šè¿‡æœåŠ¡åè·å–æœåŠ¡å®ä¾‹
        ServiceInstance instance = loadBalancerClient.choose("order-service");
        if (instance == null) {
            return "Order service not available";
        }

        // è°ƒç”¨æœåŠ¡
        String url = String.format("http://%s:%s/orders", instance.getHost(), instance.getPort());
        RestTemplate restTemplate = new RestTemplate();
        return restTemplate.getForObject(url, String.class);
    }
}
```

---

## 6. Nacoså®æˆ˜

### 6.1 Nacoså®‰è£…ä¸å¯åŠ¨

```bash
# ä¸‹è½½Nacos
wget https://github.com/alibaba/nacos/releases/download/2.0.3/nacos-server-2.0.3.tar.gz

tar -zxvf nacos-server-2.0.3.tar.gz
cd nacos/bin

# å¯åŠ¨å•æœºæ¨¡å¼
sh startup.sh -m standalone

# è®¿é—®æ§åˆ¶å°
open http://localhost:8848/nacos
# é»˜è®¤è´¦å·å¯†ç ï¼šnacos/nacos
```

### 6.2 æœåŠ¡æ³¨å†Œä¸å‘ç°

**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    <version>2.2.7.RELEASE</version>
</dependency>
```

**2. é…ç½®æ–‡ä»¶**ï¼š
```yaml
spring:
  application:
    name: user-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: public
        group: DEFAULT_GROUP
        service: ${spring.application.name}
        weight: 1
        cluster-name: DEFAULT
```

**3. å¯åŠ¨ç±»**ï¼š
```java
@SpringBootApplication
@EnableDiscoveryClient
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 6.3 é…ç½®ç®¡ç†

**1. æ·»åŠ é…ç½®ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    <version>2.2.7.RELEASE</version>
</dependency>
```

**2. é…ç½®æ–‡ä»¶**ï¼š
```yaml
# bootstrap.yml
spring:
  application:
    name: user-service
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        file-extension: yaml
        namespace: public
        group: DEFAULT_GROUP
        extension-configs:
          - data-id: common.yaml
            group: COMMON_GROUP
            refresh: true
```

**3. ä½¿ç”¨é…ç½®**ï¼š
```java
@RestController
@RefreshScope // æ”¯æŒé…ç½®åŠ¨æ€åˆ·æ–°
public class ConfigController {

    @Value("${user.service.version:1.0.0}")
    private String version;

    @Value("${user.service.timeout:3000}")
    private int timeout;

    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        config.put("version", version);
        config.put("timeout", timeout);
        return config;
    }
}
```

---

## 7. é«˜å¯ç”¨éƒ¨ç½²ç­–ç•¥

### 7.1 é›†ç¾¤éƒ¨ç½²æ¨¡å¼

**1. ä¸»ä»å¤åˆ¶æ¨¡å¼**ï¼š
- ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¤šä¸ªä»èŠ‚ç‚¹
- ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ä»èŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹
- é€‚ç”¨äºä¸­å°è§„æ¨¡é›†ç¾¤

**2. é›†ç¾¤åˆ†ç‰‡æ¨¡å¼**ï¼š
- å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†æ•°æ®
- æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
- é€‚ç”¨äºå¤§è§„æ¨¡é›†ç¾¤

### 7.2 å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²

```mermaid
graph TD
    subgraph æ•°æ®ä¸­å¿ƒA
        A1[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹1] --> A2[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹2]
        A2 --> A3[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹3]
        A1 --> A3
    end

    subgraph æ•°æ®ä¸­å¿ƒB
        B1[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹1] --> B2[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹2]
        B2 --> B3[æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹3]
        B1 --> B3
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
```

### 7.3 å®¹ç¾ç­–ç•¥

- å¼‚åœ°å¤šæ´»éƒ¨ç½²
- ç†”æ–­é™çº§æœºåˆ¶
- æœåŠ¡å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨å‰”é™¤
- æ•°æ®å¤‡ä»½ä¸æ¢å¤
- æµé‡æ§åˆ¶ä¸è¿‡è½½ä¿æŠ¤

---

## 8. æœ€ä½³å®è·µä¸é—®é¢˜æ’æŸ¥

### 8.1 æœ€ä½³å®è·µ

**1. æœåŠ¡è®¾è®¡**ï¼š
- ä½¿ç”¨æœ‰æ„ä¹‰çš„æœåŠ¡å
- å®ç°å¥åº·æ£€æŸ¥æ¥å£
- è®¾ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- é…ç½®é€‚å½“çš„å…ƒæ•°æ®æ ‡ç­¾

**2. æ€§èƒ½ä¼˜åŒ–**ï¼š
- å®¢æˆ·ç«¯ç¼“å­˜æœåŠ¡åˆ—è¡¨
- æ‰¹é‡æ³¨å†Œä¸å¿ƒè·³ä¼˜åŒ–
- åˆç†è®¾ç½®å¥åº·æ£€æŸ¥é—´éš”
- é¿å…æ³¨å†Œä¸­å¿ƒæˆä¸ºç“¶é¢ˆ

**3. å®‰å…¨æªæ–½**ï¼š
- å¯ç”¨æ³¨å†Œä¸­å¿ƒè®¤è¯
- åŠ å¯†æœåŠ¡é€šä¿¡
- é™åˆ¶è®¿é—®IP
- å®šæœŸè½®æ¢å¯†é’¥

### 8.2 å¸¸è§é—®é¢˜æ’æŸ¥

**1. æœåŠ¡æ³¨å†Œä¸ä¸Š**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
- éªŒè¯ç«¯å£æ˜¯å¦å¼€æ”¾
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—å’Œæ³¨å†Œä¸­å¿ƒæ—¥å¿—
- æ£€æŸ¥å¥åº·æ£€æŸ¥é…ç½®

**2. æœåŠ¡è°ƒç”¨å¤±è´¥**ï¼š
- æ£€æŸ¥æœåŠ¡çŠ¶æ€æ˜¯å¦æ­£å¸¸
- éªŒè¯æœåŠ¡å‘ç°é…ç½®
- æŸ¥çœ‹è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

**3. æ³¨å†Œä¸­å¿ƒé›†ç¾¤é—®é¢˜**ï¼š
- æ£€æŸ¥èŠ‚ç‚¹é—´é€šä¿¡
- éªŒè¯æ•°æ®ä¸€è‡´æ€§
- æŸ¥çœ‹é€‰ä¸¾æ—¥å¿—
- æ£€æŸ¥æŒä¹…åŒ–é…ç½®

### 8.3 ç›‘æ§ä¸å‘Šè­¦

- ç›‘æ§æ³¨å†Œä¸­å¿ƒå¥åº·çŠ¶æ€
- ç›‘æ§æœåŠ¡å®ä¾‹æ•°é‡å˜åŒ–
- ç›‘æ§æœåŠ¡è°ƒç”¨æˆåŠŸç‡
- è®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦é˜ˆå€¼

---

## ğŸ“š å‚è€ƒèµ„æº

- [Spring Cloud Eurekaå®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/)
- [Consulå®˜æ–¹æ–‡æ¡£](https://www.consul.io/docs)
- [Nacoså®˜æ–¹æ–‡æ¡£](https://nacos.io/zh-cn/docs/what-is-nacos.html)
- [Spring Cloud Alibabaæ–‡æ¡£](https://github.com/alibaba/spring-cloud-alibaba/wiki)
- [æœåŠ¡æ³¨å†Œä¸å‘ç°æ¨¡å¼](https://microservices.io/patterns/service-discovery.html)