## è¿‡æ»¤å™¨æ¨¡å¼ (Filter Pattern)

### æ¦‚è¿°
è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆFilter Patternï¼‰ä¹Ÿç§°ä¸ºæ ‡å‡†æ¨¡å¼ï¼ˆCriteria Patternï¼‰ï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ä¸åŒçš„æ ‡å‡†æ¥è¿‡æ»¤ä¸€ç»„å¯¹è±¡ï¼Œé€šè¿‡é€»è¾‘è¿ç®—ä»¥è§£è€¦çš„æ–¹å¼å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚è¿™ç§æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼Œå®ƒç»“åˆå¤šä¸ªæ ‡å‡†æ¥è·å¾—å•ä¸€æ ‡å‡†ã€‚

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šè¿‡æ»¤å™¨æ¨¡å¼å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ä¸åŒçš„æ ‡å‡†æ¥è¿‡æ»¤ä¸€ç»„å¯¹è±¡ï¼Œé€šè¿‡é€»è¾‘è¿ç®—ä»¥è§£è€¦çš„æ–¹å¼æŠŠå®ƒä»¬è¿æ¥èµ·æ¥ã€‚

**è§£å†³é—®é¢˜**ï¼š
- å¦‚ä½•æ ¹æ®ä¸åŒæ¡ä»¶è¿‡æ»¤ä¸€ç»„å¯¹è±¡
- å¦‚ä½•ç»„åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶
- å¦‚ä½•å°†è¿‡æ»¤é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®ç­›é€‰åŠŸèƒ½ï¼ˆå¦‚ç”µå•†å¹³å°çš„å•†å“ç­›é€‰ï¼‰
- æŠ¥è¡¨ç”Ÿæˆç³»ç»Ÿ
- æ—¥å¿—è¿‡æ»¤ä¸åˆ†æ
- æƒé™æ§åˆ¶

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Criteria {
        <<interface>>
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class CriteriaMale {
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class CriteriaFemale {
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class CriteriaSingle {
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class AndCriteria {
        -criteria: Criteria
        -otherCriteria: Criteria
        +AndCriteria(criteria: Criteria, otherCriteria: Criteria)
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class OrCriteria {
        -criteria: Criteria
        -otherCriteria: Criteria
        +OrCriteria(criteria: Criteria, otherCriteria: Criteria)
        +meetCriteria(List~Person~ persons): List~Person~
    }
    class Person {
        -name: String
        -gender: String
        -maritalStatus: String
        +Person(name: String, gender: String, maritalStatus: String)
        +getName(): String
        +getGender(): String
        +getMaritalStatus(): String
    }

    Criteria <|-- CriteriaMale
    Criteria <|-- CriteriaFemale
    Criteria <|-- CriteriaSingle
    Criteria <|-- AndCriteria
    Criteria <|-- OrCriteria
    AndCriteria --> Criteria
    OrCriteria --> Criteria
```

## ğŸ’» ä»£ç å®ç°

### 1. åŸºç¡€å®ç°

```java
import java.util.List;
import java.util.ArrayList;

// è¢«è¿‡æ»¤çš„å¯¹è±¡
class Person {
    private String name;
    private String gender;
    private String maritalStatus;

    public Person(String name, String gender, String maritalStatus) {
        this.name = name;
        this.gender = gender;
        this.maritalStatus = maritalStatus;
    }

    // Getters
    public String getName() { return name; }
    public String getGender() { return gender; }
    public String getMaritalStatus() { return maritalStatus; }
}

// è¿‡æ»¤å™¨æ¥å£
interface Criteria {
    List<Person> meetCriteria(List<Person> persons);
}

// å…·ä½“è¿‡æ»¤å™¨ï¼šç”·æ€§
class CriteriaMale implements Criteria {
    @Override
    public List<Person> meetCriteria(List<Person> persons) {
        List<Person> malePersons = new ArrayList<>();
        for (Person person : persons) {
            if (person.getGender().equalsIgnoreCase("MALE")) {
                malePersons.add(person);
            }
        }
        return malePersons;
    }
}

// å…·ä½“è¿‡æ»¤å™¨ï¼šå¥³æ€§
class CriteriaFemale implements Criteria {
    @Override
    public List<Person> meetCriteria(List<Person> persons) {
        List<Person> femalePersons = new ArrayList<>();
        for (Person person : persons) {
            if (person.getGender().equalsIgnoreCase("FEMALE")) {
                femalePersons.add(person);
            }
        }
        return femalePersons;
    }
}

// å…·ä½“è¿‡æ»¤å™¨ï¼šå•èº«
class CriteriaSingle implements Criteria {
    @Override
    public List<Person> meetCriteria(List<Person> persons) {
        List<Person> singlePersons = new ArrayList<>();
        for (Person person : persons) {
            if (person.getMaritalStatus().equalsIgnoreCase("SINGLE")) {
                singlePersons.add(person);
            }
        }
        return singlePersons;
    }
}

// ä¸æ¡ä»¶è¿‡æ»¤å™¨
class AndCriteria implements Criteria {
    private Criteria criteria;
    private Criteria otherCriteria;

    public AndCriteria(Criteria criteria, Criteria otherCriteria) {
        this.criteria = criteria;
        this.otherCriteria = otherCriteria;
    }

    @Override
    public List<Person> meetCriteria(List<Person> persons) {
        List<Person> firstCriteriaPersons = criteria.meetCriteria(persons);
        return otherCriteria.meetCriteria(firstCriteriaPersons);
    }
}

// æˆ–æ¡ä»¶è¿‡æ»¤å™¨
class OrCriteria implements Criteria {
    private Criteria criteria;
    private Criteria otherCriteria;

    public OrCriteria(Criteria criteria, Criteria otherCriteria) {
        this.criteria = criteria;
        this.otherCriteria = otherCriteria;
    }

    @Override
    public List<Person> meetCriteria(List<Person> persons) {
        List<Person> firstCriteriaItems = criteria.meetCriteria(persons);
        List<Person> otherCriteriaItems = otherCriteria.meetCriteria(persons);

        for (Person person : otherCriteriaItems) {
            if (!firstCriteriaItems.contains(person)) {
                firstCriteriaItems.add(person);
            }
        }
        return firstCriteriaItems;
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class CriteriaPatternDemo {
    public static void main(String[] args) {
        List<Person> persons = new ArrayList<>();

        persons.add(new Person("Robert", "Male", "Single"));
        persons.add(new Person("John", "Male", "Married"));
        persons.add(new Person("Laura", "Female", "Married"));
        persons.add(new Person("Diana", "Female", "Single"));
        persons.add(new Person("Mike", "Male", "Single"));
        persons.add(new Person("Bobby", "Male", "Single"));

        Criteria male = new CriteriaMale();
        Criteria female = new CriteriaFemale();
        Criteria single = new CriteriaSingle();
        Criteria singleMale = new AndCriteria(single, male);
        Criteria singleOrFemale = new OrCriteria(single, female);

        System.out.println("Males:");
        printPersons(male.meetCriteria(persons));

        System.out.println("\nFemales:");
        printPersons(female.meetCriteria(persons));

        System.out.println("\nSingle Males:");
        printPersons(singleMale.meetCriteria(persons));

        System.out.println("\nSingle or Females:");
        printPersons(singleOrFemale.meetCriteria(persons));
    }

    public static void printPersons(List<Person> persons) {
        for (Person person : persons) {
            System.out.println("Person: [ Name : " + person.getName() + ", Gender : " + person.getGender() + ", Marital Status : " + person.getMaritalStatus() + " ]");
        }
    }
}
```

### 2. Java 8 Stream APIå®ç°

```java
import java.util.List;
import java.util.ArrayList;
import java.util.stream.Collectors;

public class StreamCriteriaDemo {
    public static void main(String[] args) {
        List<Person> persons = new ArrayList<>();
        // æ·»åŠ äººå‘˜æ•°æ®...

        // ä½¿ç”¨Stream APIå®ç°è¿‡æ»¤
        List<Person> singleMales = persons.stream()
                .filter(p -> p.getGender().equalsIgnoreCase("MALE"))
                .filter(p -> p.getMaritalStatus().equalsIgnoreCase("SINGLE"))
                .collect(Collectors.toList());
    }
}
```

## ğŸ” æºç åº”ç”¨

### 1. Javaä¸­çš„è¿‡æ»¤å™¨æ¨¡å¼
- **`java.util.function.Predicate`**ï¼šJava 8å‡½æ•°å¼æ¥å£ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå‚æ•°çš„å¸ƒå°”å€¼å‡½æ•°
- **`java.util.stream.Stream.filter()`**ï¼šStream APIä¸­çš„è¿‡æ»¤æ–¹æ³•
- **`javax.servlet.Filter`**ï¼šServletè§„èŒƒä¸­çš„è¿‡æ»¤å™¨æ¥å£

```java
// Servletè¿‡æ»¤å™¨ç¤ºä¾‹
public class LoggingFilter implements Filter {
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        // å¤„ç†è¯·æ±‚
        System.out.println("Request received from: " + request.getRemoteAddr());
        chain.doFilter(request, response); // å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
        // å¤„ç†å“åº”
        System.out.println("Response sent to: " + request.getRemoteAddr());
    }
}
```

### 2. Springæ¡†æ¶ä¸­çš„åº”ç”¨
- **`org.springframework.web.filter.OncePerRequestFilter`**ï¼šç¡®ä¿è¿‡æ»¤å™¨åªæ‰§è¡Œä¸€æ¬¡
- **`org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter`**ï¼šSpring Securityè®¤è¯è¿‡æ»¤å™¨

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘**ï¼šå¤šä¸ªè¿‡æ»¤å™¨ç»„åˆå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤§é‡æ•°æ®æ—¶
2. **ç©ºæŒ‡é’ˆå¤„ç†**ï¼šè¿‡æ»¤æ¡ä»¶ä¸­åº”æ³¨æ„å¤„ç†nullå€¼
3. **çº¿ç¨‹å®‰å…¨**ï¼šè¿‡æ»¤å™¨åº”è¯¥è®¾è®¡ä¸ºæ— çŠ¶æ€ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨
4. **é¿å…è¿‡åº¦è¿‡æ»¤**ï¼šè¿‡å¤šçš„è¿‡æ»¤æ¡ä»¶ç»„åˆå¯èƒ½å¯¼è‡´ç»“æœé›†ä¸ºç©º
5. **ç»“æœç¼“å­˜**ï¼šå¯¹äºé¢‘ç¹ä½¿ç”¨çš„è¿‡æ»¤ç»“æœï¼Œè€ƒè™‘è¿›è¡Œç¼“å­˜

## ğŸ“ æœ€ä½³å®è·µ

1. **ä½¿ç”¨å‡½æ•°å¼æ¥å£**ï¼šJava 8+ä¼˜å…ˆä½¿ç”¨Predicateæ¥å£
2. **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šé€šè¿‡ç»„åˆè€Œéç»§æ‰¿æ¥åˆ›å»ºå¤æ‚è¿‡æ»¤æ¡ä»¶
3. **ä½¿ç”¨å»ºé€ è€…æ¨¡å¼**ï¼šå¤æ‚è¿‡æ»¤æ¡ä»¶å¯ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ„å»º
4. **è¿”å›ç©ºé›†åˆè€Œénull**ï¼šè¿‡æ»¤æ–¹æ³•åº”è¿”å›ç©ºé›†åˆè€Œénull
5. **å‘½åè§„èŒƒ**ï¼šè¿‡æ»¤å™¨ç±»ååº”æ¸…æ™°è¡¨è¾¾å…¶åŠŸèƒ½ï¼Œå¦‚`PriceRangeFilter`
6. **å•å…ƒæµ‹è¯•**ï¼šä¸ºæ¯ä¸ªè¿‡æ»¤å™¨ç¼–å†™å•å…ƒæµ‹è¯•

## ğŸ“š ç›¸å…³æ¨¡å¼

- **ç»„åˆæ¨¡å¼**ï¼šè¿‡æ»¤å™¨æ¨¡å¼ä¸­çš„ç»„åˆè¿‡æ»¤å™¨å®ç°ä½¿ç”¨äº†ç»„åˆæ¨¡å¼
- **ç­–ç•¥æ¨¡å¼**ï¼šæ¯ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¸€ç§è¿‡æ»¤ç­–ç•¥
- **è´£ä»»é“¾æ¨¡å¼**ï¼šè¿‡æ»¤å™¨é“¾çš„å®ç°ä¸è´£ä»»é“¾æ¨¡å¼ç±»ä¼¼
- **è¿­ä»£å™¨æ¨¡å¼**ï¼šé€šå¸¸ä¸è¿‡æ»¤å™¨æ¨¡å¼ä¸€èµ·ä½¿ç”¨æ¥éå†å’Œç­›é€‰é›†åˆ

---

## ğŸ“ æ€»ç»“

è¿‡æ»¤å™¨æ¨¡å¼é€šè¿‡å°†è¿‡æ»¤é€»è¾‘å°è£…åœ¨ç‹¬ç«‹çš„è¿‡æ»¤å™¨ç±»ä¸­ï¼Œå®ç°äº†è¿‡æ»¤æ¡ä»¶çš„çµæ´»ç»„åˆå’Œå¤ç”¨ã€‚å®ƒç‰¹åˆ«é€‚åˆéœ€è¦å¤šç§æ¡ä»¶ç»„åˆç­›é€‰æ•°æ®çš„åœºæ™¯ï¼Œå¦‚ç”µå•†å¹³å°çš„å•†å“ç­›é€‰ã€æ•°æ®æŠ¥è¡¨ç”Ÿæˆç­‰ã€‚åœ¨Java 8åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç»“åˆStream APIå’ŒPredicateæ¥å£æ›´ç®€æ´åœ°å®ç°è¿‡æ»¤åŠŸèƒ½ã€‚