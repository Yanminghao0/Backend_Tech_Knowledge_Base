# è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰

> ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆ

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: è¡Œä¸ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­â­
- **å…³é”®è¯**: è¯·æ±‚ä¼ é€’ã€è¿‡æ»¤å™¨é“¾ã€æ‹¦æˆªå™¨

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å¦‚ä½•å°†è¯·æ±‚çš„å‘é€è€…ä¸æ¥æ”¶è€…è§£è€¦
- å¦‚ä½•åŠ¨æ€æŒ‡å®šå¤„ç†è¯·æ±‚çš„å¯¹è±¡é›†åˆ
- å¦‚ä½•è®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†åŒä¸€ä¸ªè¯·æ±‚
- å¦‚ä½•åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤è¯·æ±‚

**é€‚ç”¨åœºæ™¯**ï¼š
- å½“æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œä¸”å…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šæ—¶
- å½“ä½ æƒ³åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤è¯·æ±‚æ—¶
- å½“éœ€è¦åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚æ—¶
- åœ¨è¯·æ±‚å¤„ç†é“¾ä¸­åŠ¨æ€æ’å…¥æˆ–åˆ é™¤å¤„ç†è€…æ—¶
- å¸¸è§äºæ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨ã€äº‹ä»¶å¤„ç†ç­‰åœºæ™¯

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Handler {
        <<interface>>
        +setNext(handler: Handler)
        +handleRequest(request: Request)
    }
    class ConcreteHandler1 {
        -nextHandler: Handler
        +setNext(handler: Handler)
        +handleRequest(request: Request)
    }
    class ConcreteHandler2 {
        -nextHandler: Handler
        +setNext(handler: Handler)
        +handleRequest(request: Request)
    }
    class ConcreteHandler3 {
        -nextHandler: Handler
        +setNext(handler: Handler)
        +handleRequest(request: Request)
    }
    class Client {
        +main()
    }

    Handler <|-- ConcreteHandler1
    Handler <|-- ConcreteHandler2
    Handler <|-- ConcreteHandler3
    Client --> Handler
    ConcreteHandler1 --> Handler : nextHandler
    ConcreteHandler2 --> Handler : nextHandler
    ConcreteHandler3 --> Handler : nextHandler
```

**æ ¸å¿ƒè§’è‰²**ï¼š
- **Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰**ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€å¤„ç†è€…çš„å¼•ç”¨
- **ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰**ï¼šå®ç°Handleræ¥å£ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯·æ±‚è½¬å‘ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…
- **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…æäº¤è¯·æ±‚

**å·¥ä½œæµç¨‹**ï¼š
1. å®¢æˆ·ç«¯åˆ›å»ºå¤„ç†é“¾
2. å®¢æˆ·ç«¯å‘é“¾ä¸­çš„ç¬¬ä¸€ä¸ªå¤„ç†è€…å‘é€è¯·æ±‚
3. æ¯ä¸ªå¤„ç†è€…åˆ¤æ–­è‡ªå·±æ˜¯å¦èƒ½å¤„ç†è¯¥è¯·æ±‚
4. å¦‚æœå¯ä»¥å¤„ç†ï¼Œåˆ™å¤„ç†å®Œæ¯•ï¼›å¦‚æœä¸èƒ½ï¼Œåˆ™å°†è¯·æ±‚è½¬å‘ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…
5. ç›´åˆ°æŸä¸ªå¤„ç†è€…å¤„ç†è¯·æ±‚æˆ–è¯·æ±‚åˆ°è¾¾é“¾å°¾

## ğŸ’» ä»£ç å®ç°

### 1. åŸºç¡€å®ç°ï¼ˆè¯·å‡å®¡æ‰¹æµç¨‹ï¼‰

```java
// è¯·æ±‚ç±»
public class LeaveRequest {
    private String employeeName; // å‘˜å·¥å§“å
    private int days; // è¯·å‡å¤©æ•°
    private String reason; // è¯·å‡åŸå› 

    public LeaveRequest(String employeeName, int days, String reason) {
        this.employeeName = employeeName;
        this.days = days;
        this.reason = reason;
    }

    // getteræ–¹æ³•
    public String getEmployeeName() { return employeeName; }
    public int getDays() { return days; }
    public String getReason() { return reason; }
}

// æŠ½è±¡å¤„ç†è€…
public abstract class Leader {
    protected Leader nextLeader; // ä¸‹ä¸€ä¸ªå¤„ç†è€…

    // è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è€…
    public void setNextLeader(Leader nextLeader) {
        this.nextLeader = nextLeader;
    }

    // å¤„ç†è¯·æ±‚çš„æŠ½è±¡æ–¹æ³•
    public abstract void handleRequest(LeaveRequest leaveRequest);
}

// å…·ä½“å¤„ç†è€… - ç›´å±ç»ç†
public class Director extends Leader {
    @Override
    public void handleRequest(LeaveRequest leaveRequest) {
        // ç›´å±ç»ç†å¯ä»¥å¤„ç†3å¤©ä»¥å†…çš„è¯·å‡
        if (leaveRequest.getDays() <= 3) {
            System.out.println("ç›´å±ç»ç†æ‰¹å‡†äº†" + leaveRequest.getEmployeeName() + "çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡" + leaveRequest.getDays() + "å¤©ï¼ŒåŸå› ï¼š" + leaveRequest.getReason());
        } else {
            // è¶…è¿‡3å¤©ï¼Œæäº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…
            if (nextLeader != null) {
                nextLeader.handleRequest(leaveRequest);
            } else {
                System.out.println("æ— äººå¤„ç†è¯·å‡ç”³è¯·");
            }
        }
    }
}

// å…·ä½“å¤„ç†è€… - éƒ¨é—¨ç»ç†
public class Manager extends Leader {
    @Override
    public void handleRequest(LeaveRequest leaveRequest) {
        // éƒ¨é—¨ç»ç†å¯ä»¥å¤„ç†3-7å¤©çš„è¯·å‡
        if (leaveRequest.getDays() > 3 && leaveRequest.getDays() <= 7) {
            System.out.println("éƒ¨é—¨ç»ç†æ‰¹å‡†äº†" + leaveRequest.getEmployeeName() + "çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡" + leaveRequest.getDays() + "å¤©ï¼ŒåŸå› ï¼š" + leaveRequest.getReason());
        } else {
            // è¶…è¿‡7å¤©ï¼Œæäº¤ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…
            if (nextLeader != null) {
                nextLeader.handleRequest(leaveRequest);
            } else {
                System.out.println("æ— äººå¤„ç†è¯·å‡ç”³è¯·");
            }
        }
    }
}

// å…·ä½“å¤„ç†è€… - æ€»ç»ç†
public class GeneralManager extends Leader {
    @Override
    public void handleRequest(LeaveRequest leaveRequest) {
        // æ€»ç»ç†å¯ä»¥å¤„ç†7-30å¤©çš„è¯·å‡
        if (leaveRequest.getDays() > 7 && leaveRequest.getDays() <= 30) {
            System.out.println("æ€»ç»ç†æ‰¹å‡†äº†" + leaveRequest.getEmployeeName() + "çš„è¯·å‡ç”³è¯·ï¼Œè¯·å‡" + leaveRequest.getDays() + "å¤©ï¼ŒåŸå› ï¼š" + leaveRequest.getReason());
        } else {
            // è¶…è¿‡30å¤©ï¼Œæ— æ³•æ‰¹å‡†
            if (leaveRequest.getDays() > 30) {
                System.out.println("è¯·å‡å¤©æ•°è¿‡å¤šï¼Œæ— æ³•æ‰¹å‡†" + leaveRequest.getEmployeeName() + "çš„è¯·å‡ç”³è¯·");
            } else if (nextLeader != null) {
                nextLeader.handleRequest(leaveRequest);
            } else {
                System.out.println("æ— äººå¤„ç†è¯·å‡ç”³è¯·");
            }
        }
    }
}

// å®¢æˆ·ç«¯
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºå¤„ç†è€…
        Leader director = new Director(); // ç›´å±ç»ç†
        Leader manager = new Manager(); // éƒ¨é—¨ç»ç†
        Leader generalManager = new GeneralManager(); // æ€»ç»ç†

        // è®¾ç½®è´£ä»»é“¾
        director.setNextLeader(manager);
        manager.setNextLeader(generalManager);

        // åˆ›å»ºè¯·å‡è¯·æ±‚
        LeaveRequest request1 = new LeaveRequest("å¼ ä¸‰", 2, "æ„Ÿå†’å‘çƒ§");
        LeaveRequest request2 = new LeaveRequest("æå››", 5, "å®¶ä¸­æœ‰äº‹");
        LeaveRequest request3 = new LeaveRequest("ç‹äº”", 15, "å‡ºå›½æ—…æ¸¸");
        LeaveRequest request4 = new LeaveRequest("èµµå…­", 35, "é•¿æœŸä¼‘å…»");

        // æäº¤è¯·æ±‚
        System.out.println("=== è¯·æ±‚1 ===");
        director.handleRequest(request1);

        System.out.println("\n=== è¯·æ±‚2 ===");
        director.handleRequest(request2);

        System.out.println("\n=== è¯·æ±‚3 ===");
        director.handleRequest(request3);

        System.out.println("\n=== è¯·æ±‚4 ===");
        director.handleRequest(request4);
    }
}
```

### 2. é«˜çº§å®ç°ï¼ˆè¿‡æ»¤å™¨é“¾æ¨¡å¼ï¼‰

```java
import java.util.ArrayList;
import java.util.List;

// è¯·æ±‚ç±»
public class Request {
    private String content; // è¯·æ±‚å†…å®¹

    public Request(String content) {
        this.content = content;
    }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
}

// å“åº”ç±»
public class Response {
    private String result; // å“åº”ç»“æœ

    public String getResult() { return result; }
    public void setResult(String result) { this.result = result; }
}

// è¿‡æ»¤å™¨æ¥å£
public interface Filter {
    void doFilter(Request request, Response response, FilterChain chain);
}

// å…·ä½“è¿‡æ»¤å™¨ - HTMLè½¬ä¹‰è¿‡æ»¤å™¨
public class HtmlFilter implements Filter {
    @Override
    public void doFilter(Request request, Response response, FilterChain chain) {
        // å¤„ç†è¯·æ±‚
        String content = request.getContent();
        // æ›¿æ¢HTMLç‰¹æ®Šå­—ç¬¦
        content = content.replace("<", "&lt;").replace(">", "&gt;");
        request.setContent(content);

        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
        chain.doFilter(request, response);

        // å¤„ç†å“åº”
        String result = response.getResult();
        result += "-HtmlFilter";
        response.setResult(result);
    }
}

// å…·ä½“è¿‡æ»¤å™¨ - æ•æ„Ÿè¯è¿‡æ»¤å™¨
public class SensitiveFilter implements Filter {
    @Override
    public void doFilter(Request request, Response response, FilterChain chain) {
        // å¤„ç†è¯·æ±‚
        String content = request.getContent();
        // æ›¿æ¢æ•æ„Ÿè¯
        content = content.replace("è‰²æƒ…", "***").replace("æš´åŠ›", "***");
        request.setContent(content);

        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
        chain.doFilter(request, response);

        // å¤„ç†å“åº”
        String result = response.getResult();
        result += "-SensitiveFilter";
        response.setResult(result);
    }
}

// å…·ä½“è¿‡æ»¤å™¨ - URLè¿‡æ»¤å™¨
public class UrlFilter implements Filter {
    @Override
    public void doFilter(Request request, Response response, FilterChain chain) {
        // å¤„ç†è¯·æ±‚
        String content = request.getContent();
        // å°†URLè½¬æ¢ä¸ºé“¾æ¥
        content = content.replaceAll("(http://[^ ]+)", "<a href='$1'>$1</a>");
        request.setContent(content);

        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
        chain.doFilter(request, response);

        // å¤„ç†å“åº”
        String result = response.getResult();
        result += "-UrlFilter";
        response.setResult(result);
    }
}

// è¿‡æ»¤å™¨é“¾
public class FilterChain {
    private List<Filter> filters = new ArrayList<>();
    private int index = 0; // å½“å‰è¿‡æ»¤å™¨ç´¢å¼•

    // æ·»åŠ è¿‡æ»¤å™¨
    public FilterChain addFilter(Filter filter) {
        filters.add(filter);
        return this; // é“¾å¼è°ƒç”¨
    }

    // æ‰§è¡Œè¿‡æ»¤å™¨é“¾
    public void doFilter(Request request, Response response) {
        if (index == filters.size()) {
            return;
        }

        Filter filter = filters.get(index);
        index++;
        filter.doFilter(request, response, this);
    }
}

// å®¢æˆ·ç«¯
public class Client {
    public static void main(String[] args) {
        String msg = "å¤§å®¶å¥½:)<script>, æˆ‘æƒ³è®¿é—® http://example.com, è°ˆè®ºä¸€äº›å…³äºè‰²æƒ…å’Œæš´åŠ›çš„å†…å®¹";
        Request request = new Request(msg);
        Response response = new Response();
        response.setResult("å¤„ç†ç»“æœ:");

        // åˆ›å»ºè¿‡æ»¤å™¨é“¾
        FilterChain chain = new FilterChain();
        chain.addFilter(new HtmlFilter())
             .addFilter(new SensitiveFilter())
             .addFilter(new UrlFilter());

        // æ‰§è¡Œè¿‡æ»¤
        chain.doFilter(request, response);

        System.out.println("åŸå§‹å†…å®¹: " + msg);
        System.out.println("è¿‡æ»¤åè¯·æ±‚: " + request.getContent());
        System.out.println("è¿‡æ»¤åå“åº”: " + response.getResult());
    }
}
```

## ğŸ” æºç åº”ç”¨

### Javaä¸­çš„è´£ä»»é“¾æ¨¡å¼

- **`java.util.logging.Logger`**ï¼šæ—¥å¿—å¤„ç†å™¨é“¾

```java
// Javaæ—¥å¿—ç³»ç»Ÿä¸­çš„è´£ä»»é“¾æ¨¡å¼
Logger logger = Logger.getLogger("com.example");
logger.setLevel(Level.ALL);

// åˆ›å»ºæ§åˆ¶å°å¤„ç†å™¨
ConsoleHandler consoleHandler = new ConsoleHandler();
consoleHandler.setLevel(Level.INFO);

// åˆ›å»ºæ–‡ä»¶å¤„ç†å™¨
FileHandler fileHandler;
try {
    fileHandler = new FileHandler("app.log");
    fileHandler.setLevel(Level.WARNING);
    // æ·»åŠ åˆ°æ—¥å¿—å™¨
    logger.addHandler(fileHandler);
    logger.addHandler(consoleHandler);
} catch (IOException e) {
    e.printStackTrace();
}

// æ—¥å¿—æ¶ˆæ¯ä¼šè¢«ä¼ é€’ç»™æ‰€æœ‰å¤„ç†å™¨
logger.severe("ä¸¥é‡é”™è¯¯"); // ä¼šè¢«ä¸¤ä¸ªå¤„ç†å™¨å¤„ç†
logger.warning("è­¦å‘Šä¿¡æ¯"); // ä¼šè¢«ä¸¤ä¸ªå¤„ç†å™¨å¤„ç†
logger.info("æ™®é€šä¿¡æ¯"); // åªä¼šè¢«æ§åˆ¶å°å¤„ç†å™¨å¤„ç†
logger.config("é…ç½®ä¿¡æ¯"); // ä¸ä¼šè¢«ä»»ä½•å¤„ç†å™¨å¤„ç†
```

- **`javax.servlet.Filter`**ï¼šServletè¿‡æ»¤å™¨é“¾

```java
// Webåº”ç”¨ä¸­çš„è¿‡æ»¤å™¨é…ç½®
@WebFilter("/*")
public class EncodingFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        request.setCharacterEncoding("UTF-8");
        response.setCharacterEncoding("UTF-8");
        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
        chain.doFilter(request, response);
    }
}
```

### Springæ¡†æ¶ä¸­çš„åº”ç”¨

- **`org.springframework.web.filter.DelegatingFilterProxy`**ï¼šSpring Webè¿‡æ»¤å™¨ä»£ç†

- **`org.springframework.security.web.FilterChainProxy`**ï¼šSpring Securityè¿‡æ»¤å™¨é“¾

```java
// Spring Securityé…ç½®ä¸­çš„è¿‡æ»¤å™¨é“¾
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .and()
            .csrf()
                .and()
            .addFilterBefore(new CustomFilter(), UsernamePasswordAuthenticationFilter.class);
    }
}
```

- **`org.springframework.beans.factory.support.AbstractBeanFactory`**ï¼šBeanå®šä¹‰å¤„ç†å™¨é“¾

### å…¶ä»–æ¡†æ¶ä¸­çš„åº”ç”¨

- **Netty**ï¼šChannelPipelineä¸­çš„ChannelHandleré“¾
- **MyBatis**ï¼šæ’ä»¶æ‹¦æˆªå™¨é“¾
- **Struts2**ï¼šæ‹¦æˆªå™¨æ ˆ
- **Django**ï¼šä¸­é—´ä»¶(Middleware)é“¾
- **Express.js**ï¼šä¸­é—´ä»¶(Middleware)é“¾

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é“¾çš„å®Œæ•´æ€§**ï¼šç¡®ä¿é“¾çš„å®Œæ•´æ€§ï¼Œé¿å…è¯·æ±‚åˆ°è¾¾é“¾å°¾æœªè¢«å¤„ç†

```java
// è‰¯å¥½å®è·µï¼šåœ¨é“¾å°¾æ·»åŠ é»˜è®¤å¤„ç†è€…
public class DefaultHandler extends Leader {
    @Override
    public void handleRequest(LeaveRequest leaveRequest) {
        System.out.println("æ— äººå¤„ç†" + leaveRequest.getEmployeeName() + "çš„è¯·å‡ç”³è¯·");
    }
}

// ä½¿ç”¨é»˜è®¤å¤„ç†è€…
Leader director = new Director();
Leader manager = new Manager();
Leader generalManager = new GeneralManager();
Leader defaultHandler = new DefaultHandler();

director.setNextLeader(manager);
manager.setNextLeader(generalManager);
generalManager.setNextLeader(defaultHandler); // æ·»åŠ é»˜è®¤å¤„ç†è€…
```

2. **å¾ªç¯å¼•ç”¨é£é™©**ï¼šé¿å…å¤„ç†è€…ä¹‹é—´å½¢æˆå¾ªç¯å¼•ç”¨

3. **æ€§èƒ½é—®é¢˜**ï¼šè¿‡é•¿çš„è´£ä»»é“¾å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œè¯·æ±‚éœ€è¦ç»è¿‡å¤šä¸ªå¤„ç†è€…

4. **è°ƒè¯•å›°éš¾**ï¼šè´£ä»»é“¾è¾ƒé•¿æ—¶ï¼Œè°ƒè¯•å’Œè¿½è¸ªè¯·æ±‚æµç¨‹ä¼šå˜å¾—å¤æ‚

5. **å¤„ç†é¡ºåº**ï¼šè´£ä»»é“¾çš„å¤„ç†é¡ºåºå¾ˆé‡è¦ï¼Œéœ€è¦åˆç†å®‰æ’å¤„ç†è€…é¡ºåº

6. **è´£ä»»è¾¹ç•Œ**ï¼šæ˜ç¡®æ¯ä¸ªå¤„ç†è€…çš„è´£ä»»è¾¹ç•Œï¼Œé¿å…é‡å æˆ–ç©ºç™½

7. **å¼‚å¸¸å¤„ç†**ï¼šéœ€è¦è€ƒè™‘é“¾ä¸­æŸä¸ªå¤„ç†è€…æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µ

```java
@Override
public void handleRequest(LeaveRequest leaveRequest) {
    try {
        // å¤„ç†è¯·æ±‚
        if (leaveRequest.getDays() <= 3) {
            // å¤„ç†é€»è¾‘
        } else if (nextLeader != null) {
            nextLeader.handleRequest(leaveRequest);
        }
    } catch (Exception e) {
        System.err.println("å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿå¼‚å¸¸: " + e.getMessage());
        // å¼‚å¸¸å¤„ç†ç­–ç•¥
    }
}
```

## ğŸ“ æœ€ä½³å®è·µ

1. **æ§åˆ¶é“¾çš„é•¿åº¦**ï¼šé¿å…åˆ›å»ºè¿‡é•¿çš„è´£ä»»é“¾ï¼Œä¸€èˆ¬å»ºè®®ä¸è¶…è¿‡5ä¸ªå¤„ç†è€…

2. **ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ„å»ºè´£ä»»é“¾**ï¼šä½¿é“¾çš„åˆ›å»ºæ›´åŠ æ¸…æ™°

```java
// ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ„å»ºè´£ä»»é“¾
public class HandlerChainBuilder {
    private Leader head;
    private Leader tail;

    public HandlerChainBuilder addHandler(Leader handler) {
        if (head == null) {
            head = handler;
            tail = handler;
        } else {
            tail.setNextLeader(handler);
            tail = handler;
        }
        return this;
    }

    public Leader build() {
        return head;
    }
}

// ä½¿ç”¨å»ºé€ è€…
Leader chain = new HandlerChainBuilder()
    .addHandler(new Director())
    .addHandler(new Manager())
    .addHandler(new GeneralManager())
    .addHandler(new DefaultHandler())
    .build();
```

3. **ä½¿ç”¨æšä¸¾å®šä¹‰å¤„ç†è€…ç±»å‹**ï¼šä½¿å¤„ç†è€…ç±»å‹æ›´åŠ æ˜ç¡®

4. **ç»“åˆå·¥å‚æ¨¡å¼åˆ›å»ºå¤„ç†è€…**ï¼šæ ¹æ®æ¡ä»¶åŠ¨æ€åˆ›å»ºå¤„ç†è€…

5. **ä½¿ç”¨æ³¨è§£é…ç½®è´£ä»»é“¾**ï¼šåœ¨Springç­‰æ¡†æ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£è‡ªåŠ¨è£…é…è´£ä»»é“¾

```java
// ä½¿ç”¨æ³¨è§£é…ç½®è´£ä»»é“¾
@Component
public class HandlerChainConfig {
    @Autowired
    private Director director;

    @Autowired
    private Manager manager;

    @Autowired
    private GeneralManager generalManager;

    @Bean
    public Leader handlerChain() {
        director.setNextLeader(manager);
        manager.setNextLeader(generalManager);
        return director;
    }
}
```

6. **æä¾›è·å–é“¾ç»“æ„çš„æ–¹æ³•**ï¼šä¾¿äºè°ƒè¯•å’Œç›‘æ§

7. **è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼åŒ…è£…è¯·æ±‚**ï¼šä½¿è¯·æ±‚æ›´åŠ çµæ´»

## ğŸ“š ç›¸å…³æ¨¡å¼

- **å‘½ä»¤æ¨¡å¼**ï¼šéƒ½å¯ä»¥ç”¨äºè§£è€¦å‘é€è€…å’Œæ¥æ”¶è€…ï¼Œä½†è´£ä»»é“¾æ¨¡å¼å…³æ³¨è¯·æ±‚çš„ä¼ é€’ï¼Œå‘½ä»¤æ¨¡å¼å…³æ³¨è¯·æ±‚çš„å°è£…
- **è£…é¥°å™¨æ¨¡å¼**ï¼šéƒ½æ¶‰åŠå¯¹è±¡é“¾ï¼Œä½†è£…é¥°å™¨æ¨¡å¼å…³æ³¨ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼Œè´£ä»»é“¾æ¨¡å¼å…³æ³¨è¯·æ±‚çš„ä¼ é€’å’Œå¤„ç†
- **ç»„åˆæ¨¡å¼**ï¼šå½“è´£ä»»é“¾ä¸­çš„å¤„ç†è€…æ˜¯ç»„åˆå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆä½¿ç”¨
- **æ‹¦æˆªå™¨æ¨¡å¼**ï¼šæ˜¯è´£ä»»é“¾æ¨¡å¼çš„ä¸€ç§å˜ä½“ï¼Œå¸¸ç”¨äºæ¡†æ¶è®¾è®¡
- **çŠ¶æ€æ¨¡å¼**ï¼šéƒ½æ¶‰åŠå¯¹è±¡è¡Œä¸ºçš„åŠ¨æ€åˆ†å‘ï¼Œä½†çŠ¶æ€æ¨¡å¼å…³æ³¨å¯¹è±¡çŠ¶æ€çš„å˜åŒ–ï¼Œè´£ä»»é“¾æ¨¡å¼å…³æ³¨è¯·æ±‚çš„ä¼ é€’
- **ç­–ç•¥æ¨¡å¼**ï¼šéƒ½å¯ä»¥æ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œä½†ç­–ç•¥æ¨¡å¼éœ€è¦å®¢æˆ·ç«¯çŸ¥é“å…·ä½“ç­–ç•¥ï¼Œè´£ä»»é“¾æ¨¡å¼åˆ™ç”±é“¾è‡ªåŠ¨é€‰æ‹©

