# çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰

> å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸º

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: è¡Œä¸ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­
- **å…³é”®è¯**: çŠ¶æ€æœºã€çŠ¶æ€è½¬æ¢ã€è¡Œä¸ºåˆ‡æ¢

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šå…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å¦‚ä½•å¤„ç†å…·æœ‰å¤šç§çŠ¶æ€çš„å¯¹è±¡ï¼Œä¸”çŠ¶æ€è½¬æ¢é€»è¾‘å¤æ‚
- å¦‚ä½•é¿å…ä½¿ç”¨å¤§é‡æ¡ä»¶è¯­å¥ï¼ˆif-else/switch-caseï¼‰æ¥å¤„ç†çŠ¶æ€ç›¸å…³è¡Œä¸º
- å¦‚ä½•å°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–
- å¦‚ä½•ä½¿çŠ¶æ€è½¬æ¢æ›´åŠ æ˜ç¡®å’Œå¯ç»´æŠ¤

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸš¦ **çŠ¶æ€é©±åŠ¨è¡Œä¸º**ï¼šå¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå…¶çŠ¶æ€ï¼Œä¸”çŠ¶æ€ç»å¸¸å˜åŒ–
- ğŸ® **æ¸¸æˆå¼€å‘**ï¼šè§’è‰²çŠ¶æ€ï¼ˆç«™ç«‹ã€è¡Œèµ°ã€è·³è·ƒã€æ”»å‡»ï¼‰
- ğŸ“± **UIçŠ¶æ€ç®¡ç†**ï¼šæŒ‰é’®çŠ¶æ€ï¼ˆå¯ç”¨ã€ç¦ç”¨ã€æ‚¬åœã€ç‚¹å‡»ï¼‰
- ğŸ“ **æ–‡æ¡£ç¼–è¾‘å™¨**ï¼šæ–‡æ¡£çŠ¶æ€ï¼ˆæ–°å»ºã€ç¼–è¾‘ã€ä¿å­˜ã€åªè¯»ï¼‰
- ğŸ­ **å·¥ä½œæµç³»ç»Ÿ**ï¼šå®¡æ‰¹æµç¨‹ï¼ˆæäº¤ã€å®¡æ ¸ä¸­ã€é€šè¿‡ã€æ‹’ç»ï¼‰
- ğŸ“¦ **è®¢å•ç³»ç»Ÿ**ï¼šè®¢å•çŠ¶æ€ï¼ˆå¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²å‘è´§ã€å·²å®Œæˆï¼‰
- ğŸ“Š **çŠ¶æ€æœºå®ç°**ï¼šä»»ä½•éœ€è¦çŠ¶æ€æœºçš„åœºæ™¯
- âš™ï¸ **è®¾å¤‡ç®¡ç†**ï¼šè®¾å¤‡çŠ¶æ€ï¼ˆè¿è¡Œã€æš‚åœã€æ•…éšœã€ç»´æŠ¤ï¼‰
- ğŸš— **äº¤é€šæ§åˆ¶ç³»ç»Ÿ**ï¼šäº¤é€šä¿¡å·ç¯
- ğŸ“¡ **ç½‘ç»œåè®®**ï¼šTCPè¿æ¥çŠ¶æ€ï¼ˆå»ºç«‹ã€ä¼ è¾“ã€å…³é—­ï¼‰

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Context {
        -state: State
        +Context(state: State)
        +request(): void
        +setState(state: State): void
        +getState(): State
    }
    class State {
        <<interface>>
        +handle(context: Context): void
    }
    class ConcreteStateA {
        +handle(context: Context): void
    }
    class ConcreteStateB {
        +handle(context: Context): void
    }
    class ConcreteStateC {
        +handle(context: Context): void
    }
    class Client {
    }

    Context --> State
    State <|-- ConcreteStateA
    State <|-- ConcreteStateB
    State <|-- ConcreteStateC
    Client --> Context
    Client --> State
```

**æ ¸å¿ƒè§’è‰²**ï¼š
- **Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰**ï¼šç»´æŠ¤ä¸€ä¸ªConcreteStateå­ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å®šä¹‰å½“å‰çš„çŠ¶æ€
- **Stateï¼ˆçŠ¶æ€æ¥å£ï¼‰**ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ä¸Contextçš„ä¸€ä¸ªç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸º
- **ConcreteStateï¼ˆå…·ä½“çŠ¶æ€ï¼‰**ï¼šæ¯ä¸€ä¸ªå­ç±»å®ç°ä¸€ä¸ªä¸Contextçš„ä¸€ä¸ªçŠ¶æ€ç›¸å…³çš„è¡Œä¸º
- **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šåˆ›å»ºå¹¶é…ç½®å…·ä½“çŠ¶æ€å¯¹è±¡ï¼Œå°†çŠ¶æ€å¯¹è±¡æ³¨å…¥åˆ°ä¸Šä¸‹æ–‡

**çŠ¶æ€æ¨¡å¼å˜ä½“**ï¼š
1. **ç®€å•çŠ¶æ€æœº**ï¼šåªæœ‰å‡ ä¸ªçŠ¶æ€å’Œç®€å•è½¬æ¢
2. **åˆ†å±‚çŠ¶æ€æœº**ï¼šçŠ¶æ€å¯ä»¥æœ‰å­çŠ¶æ€
3. **å¹¶å‘çŠ¶æ€æœº**ï¼šå¯¹è±¡å¯ä»¥åŒæ—¶å¤„äºå¤šä¸ªçŠ¶æ€
4. **è¢«åŠ¨çŠ¶æ€æœº**ï¼šçŠ¶æ€è½¬æ¢ç”±å¤–éƒ¨è§¦å‘
5. **ä¸»åŠ¨çŠ¶æ€æœº**ï¼šçŠ¶æ€å¯ä»¥è‡ªå·±è§¦å‘è½¬æ¢
6. **åŸºäºè¡¨çš„çŠ¶æ€æœº**ï¼šä½¿ç”¨çŠ¶æ€è½¬æ¢è¡¨å®šä¹‰è¡Œä¸º

## ğŸ’» ä»£ç å®ç°

### 1. åŸºç¡€å®ç°ï¼ˆäº¤é€šä¿¡å·ç¯ï¼‰

```java
// çŠ¶æ€æ¥å£
public interface State {
    void handle(Context context);
    String getStateName();
}

// ä¸Šä¸‹æ–‡ç±»
public class Context {
    private State state;

    public Context(State initialState) {
        this.state = initialState;
        System.out.println("åˆå§‹çŠ¶æ€: " + state.getStateName());
    }

    public void setState(State state) {
        this.state = state;
        System.out.println("çŠ¶æ€è½¬æ¢: " + state.getStateName());
    }

    public void request() {
        state.handle(this);
    }

    public State getState() {
        return state;
    }
}

// å…·ä½“çŠ¶æ€ - çº¢ç¯
public class RedLightState implements State {
    @Override
    public void handle(Context context) {
        System.out.println("çº¢ç¯äº® - è½¦è¾†åœæ­¢");
        // 3ç§’ååˆ‡æ¢åˆ°ç»¿ç¯
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        context.setState(new GreenLightState());
    }

    @Override
    public String getStateName() {
        return "çº¢ç¯";
    }
}

// å…·ä½“çŠ¶æ€ - ç»¿ç¯
public class GreenLightState implements State {
    @Override
    public void handle(Context context) {
        System.out.println("ç»¿ç¯äº® - è½¦è¾†é€šè¡Œ");
        // 5ç§’ååˆ‡æ¢åˆ°é»„ç¯
        try {
            Thread.sleep(5000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        context.setState(new YellowLightState());
    }

    @Override
    public String getStateName() {
        return "ç»¿ç¯";
    }
}

// å…·ä½“çŠ¶æ€ - é»„ç¯
public class YellowLightState implements State {
    @Override
    public void handle(Context context) {
        System.out.println("é»„ç¯äº® - è½¦è¾†å‡†å¤‡åœæ­¢");
        // 2ç§’ååˆ‡æ¢åˆ°çº¢ç¯
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        context.setState(new RedLightState());
    }

    @Override
    public String getStateName() {
        return "é»„ç¯";
    }
}

// å®¢æˆ·ç«¯
public class TrafficLightClient {
    public static void main(String[] args) {
        System.out.println("äº¤é€šä¿¡å·ç¯ç³»ç»Ÿå¯åŠ¨...");
        Context context = new Context(new RedLightState());

        // æ¨¡æ‹Ÿäº¤é€šä¿¡å·ç¯å·¥ä½œ
        for (int i = 0; i < 6; i++) {
            System.out.println("\n--- ä¿¡å·ç¯å‘¨æœŸ " + (i + 1) + " ---");
            context.request();
        }
    }
}
```

### 2. é«˜çº§å®ç°ï¼ˆè®¢å•çŠ¶æ€ç®¡ç†ï¼‰

```java
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

// è®¢å•äº‹ä»¶æšä¸¾
enum OrderEvent {
    PAY, SHIP, DELIVER, CANCEL, REFUND
}

// è®¢å•çŠ¶æ€æ¥å£
interface OrderState {
    void handleEvent(OrderContext context, OrderEvent event);
    String getStateName();
}

// è®¢å•ä¸Šä¸‹æ–‡
class OrderContext {
    private OrderState currentState;
    private final String orderId;
    private final List<String> orderHistory = new ArrayList<>();
    private Date createTime;
    private Date payTime;
    private Date shipTime;
    private Date deliverTime;
    private Date cancelTime;
    private Date refundTime;

    public OrderContext(String orderId) {
        this.orderId = orderId;
        this.createTime = new Date();
        this.currentState = new PendingPaymentState();
        addHistory("è®¢å•åˆ›å»º");
    }

    public void setState(OrderState state) {
        this.currentState = state;
    }

    public void handleEvent(OrderEvent event) {
        currentState.handleEvent(this, event);
    }

    public void addHistory(String action) {
        orderHistory.add(new Date() + " - " + action + " - å½“å‰çŠ¶æ€: " + currentState.getStateName());
    }

    public void printHistory() {
        System.out.println("\nè®¢å•å†å²è®°å½• (è®¢å•ID: " + orderId + "):");
        orderHistory.forEach(System.out::println);
    }

    // Getters and Setters for dates
    public String getOrderId() { return orderId; }
    public Date getCreateTime() { return createTime; }
    public Date getPayTime() { return payTime; }
    public void setPayTime(Date payTime) { this.payTime = payTime; }
    public Date getShipTime() { return shipTime; }
    public void setShipTime(Date shipTime) { this.shipTime = shipTime; }
    public Date getDeliverTime() { return deliverTime; }
    public void setDeliverTime(Date deliverTime) { this.deliverTime = deliverTime; }
    public Date getCancelTime() { return cancelTime; }
    public void setCancelTime(Date cancelTime) { this.cancelTime = cancelTime; }
    public Date getRefundTime() { return refundTime; }
    public void setRefundTime(Date refundTime) { this.refundTime = refundTime; }
    public String getCurrentStateName() { return currentState.getStateName(); }
}

// å¾…æ”¯ä»˜çŠ¶æ€
class PendingPaymentState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        switch (event) {
            case PAY:
                context.setPayTime(new Date());
                context.setState(new PaidState());
                context.addHistory("è®¢å•æ”¯ä»˜æˆåŠŸ");
                break;
            case CANCEL:
                context.setCancelTime(new Date());
                context.setState(new CancelledState());
                context.addHistory("è®¢å•å·²å–æ¶ˆ");
                break;
            default:
                System.out.println("é”™è¯¯: å¾…æ”¯ä»˜è®¢å•ä¸èƒ½æ‰§è¡Œ" + event + "æ“ä½œ");
        }
    }

    @Override
    public String getStateName() {
        return "å¾…æ”¯ä»˜";
    }
}

// å·²æ”¯ä»˜çŠ¶æ€
class PaidState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        switch (event) {
            case SHIP:
                context.setShipTime(new Date());
                context.setState(new ShippedState());
                context.addHistory("è®¢å•å·²å‘è´§");
                break;
            case CANCEL:
                context.setCancelTime(new Date());
                context.setState(new CancelledState());
                context.addHistory("è®¢å•å·²å–æ¶ˆï¼Œç­‰å¾…é€€æ¬¾");
                break;
            default:
                System.out.println("é”™è¯¯: å·²æ”¯ä»˜è®¢å•ä¸èƒ½æ‰§è¡Œ" + event + "æ“ä½œ");
        }
    }

    @Override
    public String getStateName() {
        return "å·²æ”¯ä»˜";
    }
}

// å·²å‘è´§çŠ¶æ€
class ShippedState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        switch (event) {
            case DELIVER:
                context.setDeliverTime(new Date());
                context.setState(new DeliveredState());
                context.addHistory("è®¢å•å·²é€è¾¾");
                break;
            default:
                System.out.println("é”™è¯¯: å·²å‘è´§è®¢å•ä¸èƒ½æ‰§è¡Œ" + event + "æ“ä½œ");
        }
    }

    @Override
    public String getStateName() {
        return "å·²å‘è´§";
    }
}

// å·²é€è¾¾çŠ¶æ€
class DeliveredState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        switch (event) {
            case REFUND:
                context.setRefundTime(new Date());
                context.setState(new RefundedState());
                context.addHistory("è®¢å•å·²é€€æ¬¾");
                break;
            default:
                System.out.println("é”™è¯¯: å·²é€è¾¾è®¢å•ä¸èƒ½æ‰§è¡Œ" + event + "æ“ä½œ");
        }
    }

    @Override
    public String getStateName() {
        return "å·²é€è¾¾";
    }
}

// å·²å–æ¶ˆçŠ¶æ€
class CancelledState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        switch (event) {
            case REFUND:
                context.setRefundTime(new Date());
                context.setState(new RefundedState());
                context.addHistory("è®¢å•å·²é€€æ¬¾");
                break;
            default:
                System.out.println("é”™è¯¯: å·²å–æ¶ˆè®¢å•ä¸èƒ½æ‰§è¡Œ" + event + "æ“ä½œ");
        }
    }

    @Override
    public String getStateName() {
        return "å·²å–æ¶ˆ";
    }
}

// å·²é€€æ¬¾çŠ¶æ€
class RefundedState implements OrderState {
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        System.out.println("é”™è¯¯: å·²é€€æ¬¾è®¢å•ä¸èƒ½æ‰§è¡Œä»»ä½•æ“ä½œ");
    }

    @Override
    public String getStateName() {
        return "å·²é€€æ¬¾";
    }
}

// å®¢æˆ·ç«¯
public class OrderClient {
    public static void main(String[] args) {
        // åˆ›å»ºè®¢å•
        OrderContext order = new OrderContext("ORD-20230515-001");
        System.out.println("åˆå§‹è®¢å•çŠ¶æ€: " + order.getCurrentStateName());

        // å¤„ç†è®¢å•äº‹ä»¶
        order.handleEvent(OrderEvent.PAY);
        System.out.println("æ”¯ä»˜åè®¢å•çŠ¶æ€: " + order.getCurrentStateName());

        order.handleEvent(OrderEvent.SHIP);
        System.out.println("å‘è´§åè®¢å•çŠ¶æ€: " + order.getCurrentStateName());

        // å°è¯•å–æ¶ˆå·²å‘è´§è®¢å•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
        order.handleEvent(OrderEvent.CANCEL);

        order.handleEvent(OrderEvent.DELIVER);
        System.out.println("ç¡®è®¤æ”¶è´§åè®¢å•çŠ¶æ€: " + order.getCurrentStateName());

        // æ‰“å°è®¢å•å†å²
        order.printHistory();

        // åˆ›å»ºå¦ä¸€ä¸ªè®¢å•å¹¶å–æ¶ˆ
        OrderContext order2 = new OrderContext("ORD-20230515-002");
        order2.handleEvent(OrderEvent.CANCEL);
        order2.handleEvent(OrderEvent.REFUND);
        System.out.println("è®¢å•2æœ€ç»ˆçŠ¶æ€: " + order2.getCurrentStateName());
        order2.printHistory();
    }
}
```

## ğŸ” æºç åº”ç”¨

### Javaä¸­çš„çŠ¶æ€æ¨¡å¼
- **`java.lang.Thread.State`**ï¼šçº¿ç¨‹çŠ¶æ€æšä¸¾
- **`java.util.Iterator`**ï¼šè¿­ä»£å™¨çŠ¶æ€
- **`java.nio.channels.Selector`**ï¼šé€‰æ‹©å™¨çŠ¶æ€
- **`javax.faces.lifecycle.Lifecycle`**ï¼šJSFç”Ÿå‘½å‘¨æœŸçŠ¶æ€
- **`java.beans.PropertyChangeSupport`**ï¼šå±æ€§å˜æ›´æ”¯æŒ

```java
// Javaçº¿ç¨‹çŠ¶æ€ç¤ºä¾‹
public class ThreadStateExample {
    public static void main(String[] args) throws InterruptedException {
        Thread thread = new Thread(() -> {
            try {
                Thread.sleep(1000); // TIMED_WAITINGçŠ¶æ€
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        System.out.println("çº¿ç¨‹åˆ›å»ºåçŠ¶æ€: " + thread.getState()); // NEW
        thread.start();
        System.out.println("çº¿ç¨‹å¯åŠ¨åçŠ¶æ€: " + thread.getState()); // RUNNABLE
        Thread.sleep(200);
        System.out.println("çº¿ç¨‹è¿è¡Œä¸­çŠ¶æ€: " + thread.getState()); // TIMED_WAITING
        thread.join();
        System.out.println("çº¿ç¨‹ç»“æŸåçŠ¶æ€: " + thread.getState()); // TERMINATED
    }
}
```

### Springæ¡†æ¶ä¸­çš„åº”ç”¨
- **`org.springframework.statemachine.StateMachine`**ï¼šçŠ¶æ€æœºæ¡†æ¶
- **`org.springframework.batch.core.JobExecution`**ï¼šæ‰¹å¤„ç†ä½œä¸šçŠ¶æ€
- **`org.springframework.webflow.execution.FlowExecution`**ï¼šWebæµç¨‹æ‰§è¡Œ
- **`org.springframework.security.web.authentication.WebAuthenticationDetails`**ï¼šè®¤è¯çŠ¶æ€
- **`org.springframework.messaging.MessageChannel`**ï¼šæ¶ˆæ¯é€šé“çŠ¶æ€

```java
// Spring StateMachineç¤ºä¾‹
@Configuration
@EnableStateMachineFactory
public class StateMachineConfig extends StateMachineConfigurerAdapter<String, String> {

    @Override
    public void configure(StateMachineStateConfigurer<String, String> states) throws Exception {
        states
            .withStates()
                .initial("PENDING")
                .state("PAID")
                .state("SHIPPED")
                .state("DELIVERED")
                .state("CANCELLED")
                .end("COMPLETED")
                .end("REFUNDED");
    }

    @Override
    public void configure(StateMachineTransitionConfigurer<String, String> transitions) throws Exception {
        transitions
            .withExternal()
                .source("PENDING").target("PAID").event("PAY")
                .and()
            .withExternal()
                .source("PAID").target("SHIPPED").event("SHIP")
                .and()
            .withExternal()
                .source("SHIPPED").target("DELIVERED").event("DELIVER")
                .and()
            .withExternal()
                .source("DELIVERED").target("COMPLETED").event("CONFIRM")
                .and()
            .withExternal()
                .source("PENDING").target("CANCELLED").event("CANCEL")
                .and()
            .withExternal()
                .source("CANCELLED").target("REFUNDED").event("REFUND")
                .and()
            .withExternal()
                .source("PAID").target("CANCELLED").event("CANCEL");
    }
}

// ä½¿ç”¨çŠ¶æ€æœº
@Service
public class OrderService {
    private final StateMachineFactory<String, String> stateMachineFactory;

    @Autowired
    public OrderService(StateMachineFactory<String, String> stateMachineFactory) {
        this.stateMachineFactory = stateMachineFactory;
    }

    public void processOrderEvent(String orderId, String event) {
        StateMachine<String, String> stateMachine = stateMachineFactory.getStateMachine(orderId);
        stateMachine.start();
        stateMachine.sendEvent(event);
        System.out.println("è®¢å•" + orderId + "çŠ¶æ€: " + stateMachine.getState().getId());
    }
}
```

### å…¶ä»–æ¡†æ¶ä¸­çš„åº”ç”¨
- **Apache Commons SCXML**ï¼šçŠ¶æ€å›¾æ‰§è¡Œå¼•æ“
- **Akka FSM**ï¼šæœ‰é™çŠ¶æ€æœºå®ç°
- **Qt State Machine Framework**ï¼šQtçŠ¶æ€æœºæ¡†æ¶
- **Android ViewçŠ¶æ€**ï¼šè§†å›¾çŠ¶æ€ç®¡ç†
- **Reactç»„ä»¶çŠ¶æ€**ï¼šReactç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
- **AngularçŠ¶æ€ç®¡ç†**ï¼šNgRxçŠ¶æ€ç®¡ç†
- **iOS UIKit**ï¼šUIæ§ä»¶çŠ¶æ€ç®¡ç†
- **.NET State Pattern**ï¼š.NETæ¡†æ¶ä¸­çš„çŠ¶æ€æ¨¡å¼å®ç°
- **æ¸¸æˆå¼•æ“**ï¼šUnityã€Unrealä¸­çš„åŠ¨ç”»çŠ¶æ€æœº
- **å·¥ä½œæµå¼•æ“**ï¼šActivitiã€Flowableç­‰BPMå¼•æ“

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **çŠ¶æ€çˆ†ç‚¸**ï¼šè¿‡å¤šçš„çŠ¶æ€ä¼šå¯¼è‡´ç³»ç»Ÿå˜å¾—å¤æ‚éš¾ä»¥ç»´æŠ¤

2. **çŠ¶æ€è½¬æ¢å¤æ‚æ€§**ï¼šçŠ¶æ€ä¹‹é—´çš„è½¬æ¢é€»è¾‘å¯èƒ½å˜å¾—å¤æ‚

3. **ä¸Šä¸‹æ–‡ä¸çŠ¶æ€è€¦åˆ**ï¼šä¸Šä¸‹æ–‡å’ŒçŠ¶æ€ä¹‹é—´å¯èƒ½å½¢æˆç´§è€¦åˆ

4. **æµ‹è¯•éš¾åº¦å¢åŠ **ï¼šéœ€è¦æµ‹è¯•æ‰€æœ‰çŠ¶æ€ç»„åˆå’Œè½¬æ¢è·¯å¾„

5. **æ€§èƒ½è€ƒè™‘**ï¼šé¢‘ç¹çš„çŠ¶æ€åˆ‡æ¢å¯èƒ½å½±å“æ€§èƒ½

6. **çŠ¶æ€ä¸€è‡´æ€§**ï¼šç¡®ä¿çŠ¶æ€è½¬æ¢ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´

7. **çŠ¶æ€æŒä¹…åŒ–**ï¼šéœ€è¦è€ƒè™‘çŠ¶æ€çš„æŒä¹…åŒ–å’Œæ¢å¤

8. **å¹¶å‘çŠ¶æ€å¤„ç†**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çŠ¶æ€ç®¡ç†éœ€è¦åŒæ­¥

## ğŸ“ æœ€ä½³å®è·µ

1. **çŠ¶æ€è®¾è®¡åŸåˆ™**ï¼šéµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªçŠ¶æ€ç±»åªè´Ÿè´£ä¸€ä¸ªçŠ¶æ€

```java
// è‰¯å¥½çš„çŠ¶æ€è®¾è®¡
public class OrderPaidState implements OrderState {
    // åªå¤„ç†å·²æ”¯ä»˜çŠ¶æ€ç›¸å…³çš„è¡Œä¸º
    @Override
    public void handleEvent(OrderContext context, OrderEvent event) {
        // åªå®ç°ä¸å·²æ”¯ä»˜çŠ¶æ€ç›¸å…³çš„äº‹ä»¶å¤„ç†
        if (event == OrderEvent.SHIP) {
            // å¤„ç†å‘è´§é€»è¾‘
        } else if (event == OrderEvent.CANCEL) {
            // å¤„ç†å–æ¶ˆé€»è¾‘
        } else {
            // æ‹’ç»å…¶ä»–äº‹ä»¶
        }
    }
}
```

2. **çŠ¶æ€è½¬æ¢ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†çŠ¶æ€è½¬æ¢é€»è¾‘

```java
// çŠ¶æ€è½¬æ¢ç®¡ç†å™¨
public class StateTransitionManager {
    private Map<StateTransition, State> transitions = new HashMap<>();

    public void addTransition(State fromState, Event event, State toState) {
        transitions.put(new StateTransition(fromState, event), toState);
    }

    public State getNextState(State currentState, Event event) {
        return transitions.get(new StateTransition(currentState, event));
    }

    private static class StateTransition {
        private State fromState;
        private Event event;

        // æ„é€ å‡½æ•°ã€equalså’ŒhashCode
    }
}
```

3. **ä½¿ç”¨æšä¸¾å®šä¹‰çŠ¶æ€**ï¼šå¯¹äºç®€å•çŠ¶æ€ï¼Œä½¿ç”¨æšä¸¾å¯ä»¥ç®€åŒ–ä»£ç 

4. **çŠ¶æ€å·¥å‚**ï¼šä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºçŠ¶æ€å¯¹è±¡

5. **çŠ¶æ€æŒä¹…åŒ–**ï¼šå¯¹äºéœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€ï¼Œå®ç°åºåˆ—åŒ–æ¥å£

6. **çŠ¶æ€å†å²è®°å½•**ï¼šè®°å½•çŠ¶æ€è½¬æ¢å†å²ï¼Œä¾¿äºè°ƒè¯•å’Œå®¡è®¡

7. **çŠ¶æ€éªŒè¯**ï¼šåœ¨çŠ¶æ€è½¬æ¢å‰éªŒè¯æ¡ä»¶

8. **é¿å…åµŒå¥—çŠ¶æ€**ï¼šé™¤éå¿…è¦ï¼Œå¦åˆ™é¿å…ä½¿ç”¨åµŒå¥—çŠ¶æ€

9. **çŠ¶æ€æ¨¡å¼ä¸ç­–ç•¥æ¨¡å¼**ï¼šæ˜ç¡®åŒºåˆ†çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯

10. **çŠ¶æ€æœºæ¡†æ¶**ï¼šå¤æ‚çŠ¶æ€ç®¡ç†è€ƒè™‘ä½¿ç”¨æˆç†Ÿçš„çŠ¶æ€æœºæ¡†æ¶

## ğŸ“š ç›¸å…³æ¨¡å¼

- **ç­–ç•¥æ¨¡å¼**ï¼šçŠ¶æ€æ¨¡å¼ä¸ç­–ç•¥æ¨¡å¼ç»“æ„ç›¸ä¼¼ï¼Œä½†æ„å›¾ä¸åŒã€‚çŠ¶æ€æ¨¡å¼å…³æ³¨å¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶çš„è¡Œä¸ºå˜åŒ–ï¼Œè€Œç­–ç•¥æ¨¡å¼å…³æ³¨ç®—æ³•çš„é€‰æ‹©
- **å•ä¾‹æ¨¡å¼**ï¼šé€šå¸¸å°†å…·ä½“çŠ¶æ€å®ç°ä¸ºå•ä¾‹ï¼Œå› ä¸ºçŠ¶æ€å¯¹è±¡ä¸åŒ…å«å¯å˜çŠ¶æ€
- **äº«å…ƒæ¨¡å¼**ï¼šå¤šä¸ªä¸Šä¸‹æ–‡å¯ä»¥å…±äº«çŠ¶æ€å¯¹è±¡
- **å·¥å‚æ¨¡å¼**ï¼šç”¨äºåˆ›å»ºçŠ¶æ€å¯¹è±¡
- **å¤‡å¿˜å½•æ¨¡å¼**ï¼šå¯ä»¥ä¿å­˜å’Œæ¢å¤çŠ¶æ€
- **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šçŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥å…¶ä»–å¯¹è±¡
- **è´£ä»»é“¾æ¨¡å¼**ï¼šå¯ä»¥å¤„ç†çŠ¶æ€è½¬æ¢è¯·æ±‚
- **ç»„åˆæ¨¡å¼**ï¼šç”¨äºå®ç°åˆ†å±‚çŠ¶æ€æœº
- **åŸå‹æ¨¡å¼**ï¼šç”¨äºå¤åˆ¶åŒ…å«çŠ¶æ€çš„å¯¹è±¡
- **è¿­ä»£å™¨æ¨¡å¼**ï¼šå¯ä»¥éå†çŠ¶æ€é›†åˆ

