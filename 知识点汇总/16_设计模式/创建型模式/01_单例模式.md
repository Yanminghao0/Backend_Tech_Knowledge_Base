# å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

> ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: åˆ›å»ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­â­â­
- **å…³é”®è¯**: å”¯ä¸€å®ä¾‹ã€å…¨å±€è®¿é—®ã€å»¶è¿ŸåŠ è½½ã€çº¿ç¨‹å®‰å…¨

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šä¿è¯ä¸€ä¸ªç±»åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- é¿å…åˆ›å»ºå¤šä¸ªå®ä¾‹é€ æˆèµ„æºæµªè´¹
- ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´
- æä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œä¾¿äºç®¡ç†å’Œæ§åˆ¶

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ“ **æ—¥å¿—è®°å½•å™¨**ï¼šå…¨å±€ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å…¥å£
- âš™ï¸ **é…ç½®ç®¡ç†å™¨**ï¼šåº”ç”¨ç¨‹åºé…ç½®ä¿¡æ¯çš„ç®¡ç†
- ğŸ—ƒï¸ **æ•°æ®åº“è¿æ¥æ± **ï¼šç»Ÿä¸€ç®¡ç†æ•°æ®åº“è¿æ¥
- ğŸ”„ **çº¿ç¨‹æ± **ï¼šç®¡ç†çº¿ç¨‹èµ„æº
- ğŸ­ **å·¥å‚å¯¹è±¡**ï¼šç»Ÿä¸€åˆ›å»ºå’Œç®¡ç†å¯¹è±¡
- ğŸ“Š **è®¡æ•°å™¨**ï¼šå…¨å±€è®¡æ•°åŠŸèƒ½
- ğŸŒ **Webåº”ç”¨çš„ServletContext**ï¼šServletä¸Šä¸‹æ–‡å¯¹è±¡

---

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Singleton {
        -instance: Singleton
        -Singleton()
        +getInstance() Singleton
    }

    class Client {
        +main()
    }

    Client --> Singleton : ä½¿ç”¨
```

**ç±»å›¾è¯´æ˜**ï¼š
- `Singleton`ï¼šå•ä¾‹ç±»ï¼ŒåŒ…å«ç§æœ‰æ„é€ å‡½æ•°å’Œé™æ€è·å–å®ä¾‹æ–¹æ³•
- `Client`ï¼šå®¢æˆ·ç«¯ï¼Œé€šè¿‡`getInstance()`æ–¹æ³•è·å–å•ä¾‹å®ä¾‹
- `instance`ï¼šç§æœ‰é™æ€æˆå‘˜ï¼Œä¿å­˜å”¯ä¸€çš„å®ä¾‹å¼•ç”¨

---

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å®ç°

#### 1. é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰

**ç‰¹ç‚¹**ï¼šç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ä½†å¯èƒ½é€ æˆèµ„æºæµªè´¹ã€‚

```java
public class EagerSingleton {
    // 1. ç§æœ‰é™æ€æˆå‘˜ï¼Œåœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹
    private static final EagerSingleton instance = new EagerSingleton();

    // 2. ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºå®ä¾‹
    private EagerSingleton() {
        // é˜²æ­¢é€šè¿‡åå°„åˆ›å»ºå®ä¾‹
        if (instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    // 3. å…¬å…±é™æ€æ–¹æ³•ï¼Œè¿”å›å”¯ä¸€å®ä¾‹
    public static EagerSingleton getInstance() {
        return instance;
    }

    // ä¸šåŠ¡æ–¹æ³•
    public void doSomething() {
        System.out.println("Eager Singleton is working");
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®ç°ç®€å•ï¼Œçº¿ç¨‹å®‰å…¨
- âœ… æ²¡æœ‰åŠ é”ï¼Œæ‰§è¡Œæ•ˆç‡é«˜
- âœ… åœ¨ç±»åŠ è½½æ—¶å°±å®Œæˆå®ä¾‹åŒ–ï¼Œé¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜

**ç¼ºç‚¹**ï¼š
- âŒ å¦‚æœå®ä¾‹ä»æœªä½¿ç”¨ï¼Œä¼šé€ æˆå†…å­˜æµªè´¹
- âŒ æ— æ³•å®ç°å»¶è¿ŸåŠ è½½

---

#### 2. æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼‰

**ç‰¹ç‚¹**ï¼šå»¶è¿ŸåŠ è½½ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆ›å»ºå®ä¾‹ï¼Œä½†çº¿ç¨‹ä¸å®‰å…¨ã€‚

```java
public class LazySingleton {
    // 1. ç§æœ‰é™æ€æˆå‘˜ï¼Œåˆå§‹ä¸ºnull
    private static LazySingleton instance;

    // 2. ç§æœ‰æ„é€ å‡½æ•°
    private LazySingleton() {
        // é˜²æ­¢åå°„åˆ›å»ºå®ä¾‹
        if (instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    // 3. å…¬å…±é™æ€æ–¹æ³•ï¼Œå»¶è¿Ÿåˆ›å»ºå®ä¾‹
    public static LazySingleton getInstance() {
        if (instance == null) {
            instance = new LazySingleton();
        }
        return instance;
    }

    // ä¸šåŠ¡æ–¹æ³•
    public void doSomething() {
        System.out.println("Lazy Singleton is working");
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®ç°äº†å»¶è¿ŸåŠ è½½ï¼ŒèŠ‚çœèµ„æº
- âœ… ä»£ç ç®€å•æ˜“æ‡‚

**ç¼ºç‚¹**ï¼š
- âŒ **çº¿ç¨‹ä¸å®‰å…¨**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹
- âŒ éœ€è¦é¢å¤–å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜

---

### è¿›é˜¶å®ç°

#### 3. åŒæ­¥æ–¹æ³•æ‡’æ±‰å¼ï¼ˆThread-safe Lazyï¼‰

**ç‰¹ç‚¹**ï¼šé€šè¿‡`synchronized`å…³é”®å­—ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ€§èƒ½è¾ƒå·®ã€‚

```java
public class SynchronizedSingleton {
    private static SynchronizedSingleton instance;

    private SynchronizedSingleton() {
        if (instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    // ä½¿ç”¨synchronizedå…³é”®å­—ä¿è¯çº¿ç¨‹å®‰å…¨
    public static synchronized SynchronizedSingleton getInstance() {
        if (instance == null) {
            instance = new SynchronizedSingleton();
        }
        return instance;
    }

    public void doSomething() {
        System.out.println("Synchronized Singleton is working");
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çº¿ç¨‹å®‰å…¨
- âœ… å®ç°äº†å»¶è¿ŸåŠ è½½

**ç¼ºç‚¹**ï¼š
- âŒ **æ€§èƒ½å·®**ï¼šæ¯æ¬¡è·å–å®ä¾‹éƒ½éœ€è¦åŒæ­¥
- âŒ åŒæ­¥èŒƒå›´è¿‡å¤§ï¼Œå½±å“å¹¶å‘æ€§èƒ½

---

#### 4. åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰

**ç‰¹ç‚¹**ï¼šç»“åˆæ‡’åŠ è½½å’Œçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½æœ€ä¼˜çš„æ‡’åŠ è½½å®ç°ã€‚

```java
public class DoubleCheckedSingleton {
    // ä½¿ç”¨volatileå…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åº
    private static volatile DoubleCheckedSingleton instance;

    private DoubleCheckedSingleton() {
        if (instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    public static DoubleCheckedSingleton getInstance() {
        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥
        if (instance == null) {
            synchronized (DoubleCheckedSingleton.class) {
                // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹
                if (instance == null) {
                    instance = new DoubleCheckedSingleton();
                }
            }
        }
        return instance;
    }

    public void doSomething() {
        System.out.println("Double-Checked Singleton is working");
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çº¿ç¨‹å®‰å…¨
- âœ… å»¶è¿ŸåŠ è½½
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šåªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶æ‰åŒæ­¥

**ç¼ºç‚¹**ï¼š
- âŒ å®ç°ç›¸å¯¹å¤æ‚
- âŒ éœ€è¦ç†è§£volatileå…³é”®å­—çš„ä½œç”¨

**å…³é”®ç‚¹è¯´æ˜**ï¼š
- `volatile`å…³é”®å­—ï¼šé˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿`instance = new DoubleCheckedSingleton()`çš„åŸå­æ€§
- åŒé‡æ£€æŸ¥ï¼šå¤–å±‚æ£€æŸ¥é¿å…ä¸å¿…è¦çš„åŒæ­¥ï¼Œå†…å±‚æ£€æŸ¥ç¡®ä¿å•ä¾‹

---

#### 5. é™æ€å†…éƒ¨ç±»ï¼ˆStatic Inner Classï¼‰

**ç‰¹ç‚¹**ï¼šåˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶å®ç°å»¶è¿ŸåŠ è½½ã€‚

```java
public class StaticInnerClassSingleton {
    // ç§æœ‰æ„é€ å‡½æ•°
    private StaticInnerClassSingleton() {
        // é˜²æ­¢åå°„åˆ›å»ºå®ä¾‹
        if (SingletonHolder.instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    // é™æ€å†…éƒ¨ç±»ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getInstance()æ—¶åŠ è½½
    private static class SingletonHolder {
        private static final StaticInnerClassSingleton instance = new StaticInnerClassSingleton();
    }

    // å…¬å…±é™æ€æ–¹æ³•
    public static StaticInnerClassSingleton getInstance() {
        return SingletonHolder.instance;
    }

    public void doSomething() {
        System.out.println("Static Inner Class Singleton is working");
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çº¿ç¨‹å®‰å…¨ï¼ˆç”±JVMä¿è¯ï¼‰
- âœ… å»¶è¿ŸåŠ è½½ï¼ˆé™æ€å†…éƒ¨ç±»åœ¨ä½¿ç”¨æ—¶æ‰åŠ è½½ï¼‰
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šæ²¡æœ‰åŒæ­¥å¼€é”€
- âœ… å®ç°ç®€æ´

**ç¼ºç‚¹**ï¼š
- âŒ æ— æ³•ä¼ é€’å‚æ•°ç»™æ„é€ å‡½æ•°
- âŒ ä¸é€‚ç”¨äºéœ€è¦å¤æ‚åˆå§‹åŒ–é€»è¾‘çš„åœºæ™¯

---

#### 6. æšä¸¾å•ä¾‹ï¼ˆEnum Singletonï¼‰

**ç‰¹ç‚¹**ï¼šä½¿ç”¨æšä¸¾å®ç°å•ä¾‹ï¼Œæœ€å®‰å…¨ã€æœ€ç®€æ´çš„å®ç°æ–¹å¼ã€‚

```java
public enum EnumSingleton {
    INSTANCE;

    // ä¸šåŠ¡æ–¹æ³•
    public void doSomething() {
        System.out.println("Enum Singleton is working");
    }

    // å…¶ä»–æ–¹æ³•
    public void doWork() {
        System.out.println("Doing work with enum singleton");
    }
}

// ä½¿ç”¨æ–¹å¼
public class Client {
    public static void main(String[] args) {
        EnumSingleton singleton = EnumSingleton.INSTANCE;
        singleton.doSomething();
        singleton.doWork();
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… **ç»å¯¹çº¿ç¨‹å®‰å…¨**ï¼šç”±JVMä¿è¯
- âœ… **é˜²æ­¢åå°„æ”»å‡»**ï¼šæšä¸¾ç±»å‹æ— æ³•é€šè¿‡åå°„åˆ›å»ºå®ä¾‹
- âœ… **é˜²æ­¢åºåˆ—åŒ–ç ´å**ï¼šæšä¸¾çš„åºåˆ—åŒ–æœºåˆ¶ç”±JVMç‰¹æ®Šå¤„ç†
- âœ… **ä»£ç ç®€æ´**ï¼šå®ç°æœ€ç®€å•
- âœ… **å•ä¾‹æœ€ä½³å®è·µ**ï¼šã€ŠEffective Javaã€‹ä½œè€…æ¨è

**ç¼ºç‚¹**ï¼š
- âŒ ä¸å¤Ÿçµæ´»ï¼Œæ— æ³•å»¶è¿ŸåŠ è½½ï¼ˆæšä¸¾åœ¨ç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼‰
- âŒ æ— æ³•ç»§æ‰¿å…¶ä»–ç±»ï¼ˆæšä¸¾å·²ç»§æ‰¿Enumç±»ï¼‰

---

## ğŸ” æºç åº”ç”¨

### JDKä¸­çš„åº”ç”¨

#### 1. `Runtime`ç±»

```java
public class Runtime {
    private static Runtime currentRuntime = new Runtime();

    // ç§æœ‰æ„é€ å‡½æ•°
    private Runtime() {}

    // è·å–Runtimeå®ä¾‹
    public static Runtime getRuntime() {
        return currentRuntime;
    }

    // å…¶ä»–æ–¹æ³•...
    public void addShutdownHook(Thread hook) {
        // ...
    }

    public Process exec(String command) throws IOException {
        // ...
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class RuntimeExample {
    public static void main(String[] args) {
        Runtime runtime = Runtime.getRuntime();

        // è·å–JVMå†…å­˜ä¿¡æ¯
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long maxMemory = runtime.maxMemory();

        System.out.println("Total Memory: " + totalMemory / 1024 / 1024 + " MB");
        System.out.println("Free Memory: " + freeMemory / 1024 / 1024 + " MB");
        System.out.println("Max Memory: " + maxMemory / 1024 / 1024 + " MB");
    }
}
```

#### 2. `Desktop`ç±»

```java
public class Desktop {
    private static Desktop desktop;

    // ç§æœ‰æ„é€ å‡½æ•°
    private Desktop() {}

    // è·å–Desktopå®ä¾‹
    public static synchronized Desktop getDesktop() {
        if (desktop == null) {
            desktop = new Desktop();
        }
        return desktop;
    }

    // å…¶ä»–æ–¹æ³•...
    public void browse(URI uri) throws IOException {
        // ...
    }

    public void open(File file) throws IOException {
        // ...
    }
}
```

#### 3. `System`ç±»ä¸­çš„`getSecurityManager()`

```java
public class System {
    private static volatile SecurityManager security;

    public static SecurityManager getSecurityManager() {
        return security;
    }

    public static void setSecurityManager(final SecurityManager s) {
        security = s;
    }
}
```

---

### Springä¸­çš„åº”ç”¨

#### 1. `ApplicationContext`

Springçš„`ApplicationContext`æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä½†Springé€šè¿‡IoCå®¹å™¨ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸã€‚

```java
// Springé…ç½®
@Configuration
public class AppConfig {
    @Bean
    @Scope("singleton") // é»˜è®¤å°±æ˜¯singleton
    public MyService myService() {
        return new MyServiceImpl();
    }
}

// ä½¿ç”¨
public class Main {
    public static void main(String[] args) {
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

        // è·å–çš„å§‹ç»ˆæ˜¯åŒä¸€ä¸ªå®ä¾‹
        MyService service1 = context.getBean(MyService.class);
        MyService service2 = context.getBean(MyService.class);

        System.out.println(service1 == service2); // true
    }
}
```

#### 2. Springä¸­çš„å•ä¾‹Beanæ³¨å†Œ

Springé€šè¿‡`DefaultSingletonBeanRegistry`ç±»ç®¡ç†å•ä¾‹Beanï¼š

```java
public class DefaultSingletonBeanRegistry extends SimpleAliasRegistry implements SingletonBeanRegistry {

    /** Cache of singleton objects: bean name to bean instance */
    private final Map<String, Object> singletonObjects = new ConcurrentHashMap<>(256);

    /** Cache of singleton factories: bean name to ObjectFactory */
    private final Map<String, ObjectFactory<?>> singletonFactories = new HashMap<>(16);

    /** Cache of early singleton objects: bean name to bean instance */
    private final Map<String, Object> earlySingletonObjects = new HashMap<>(16);

    @Override
    public Object getSingleton(String beanName) {
        return getSingleton(beanName, true);
    }

    protected Object getSingleton(String beanName, boolean allowEarlyReference) {
        Object singletonObject = this.singletonObjects.get(beanName);
        if (singletonObject == null && isSingletonCurrentlyInCreation(beanName)) {
            synchronized (this.singletonObjects) {
                singletonObject = this.earlySingletonObjects.get(beanName);
                if (singletonObject == null && allowEarlyReference) {
                    ObjectFactory<?> singletonFactory = this.singletonFactories.get(beanName);
                    if (singletonFactory != null) {
                        singletonObject = singletonFactory.getObject();
                        this.earlySingletonObjects.put(beanName, singletonObject);
                        this.singletonFactories.remove(beanName);
                    }
                }
            }
        }
        return singletonObject;
    }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. çº¿ç¨‹å®‰å…¨é—®é¢˜

**é—®é¢˜**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‡’æ±‰å¼å•ä¾‹å¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨`synchronized`å…³é”®å­—ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰
- ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šï¼ˆæ¨èï¼‰
- ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼‰
- ä½¿ç”¨æšä¸¾ï¼ˆæœ€å®‰å…¨ï¼‰

### 2. åå°„æ”»å‡»

**é—®é¢˜**ï¼šé€šè¿‡åå°„å¯ä»¥è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°åˆ›å»ºæ–°å®ä¾‹ã€‚

```java
public class ReflectionAttack {
    public static void main(String[] args) throws Exception {
        // æ­£å¸¸è·å–å•ä¾‹
        Singleton instance1 = Singleton.getInstance();

        // é€šè¿‡åå°„åˆ›å»ºæ–°å®ä¾‹
        Constructor<Singleton> constructor = Singleton.class.getDeclaredConstructor();
        constructor.setAccessible(true);
        Singleton instance2 = constructor.newInstance();

        System.out.println(instance1 == instance2); // falseï¼Œç ´åäº†å•ä¾‹
    }
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
private Singleton() {
    // åœ¨æ„é€ å‡½æ•°ä¸­æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å®ä¾‹
    if (instance != null) {
        throw new IllegalStateException("Singleton already initialized");
    }
}
```

### 3. åºåˆ—åŒ–ç ´å

**é—®é¢˜**ï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ã€‚

```java
public class SerializationAttack {
    public static void main(String[] args) throws Exception {
        Singleton instance1 = Singleton.getInstance();

        // åºåˆ—åŒ–
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        ObjectOutputStream oos = new ObjectOutputStream(bos);
        oos.writeObject(instance1);
        oos.close();

        // ååºåˆ—åŒ–
        ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(bis);
        Singleton instance2 = (Singleton) ois.readObject();
        ois.close();

        System.out.println(instance1 == instance2); // falseï¼Œç ´åäº†å•ä¾‹
    }
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
public class Singleton implements Serializable {
    private static final long serialVersionUID = 1L;
    private static volatile Singleton instance;

    private Singleton() {}

    public static Singleton getInstance() {
        if (instance == null) {
            synchronized (Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }

    // æ·»åŠ readResolveæ–¹æ³•ï¼Œé˜²æ­¢åºåˆ—åŒ–ç ´å
    protected Object readResolve() {
        return getInstance();
    }
}
```

### 4. ç±»åŠ è½½å™¨é—®é¢˜

**é—®é¢˜**ï¼šä¸åŒçš„ç±»åŠ è½½å™¨å¯èƒ½ä¼šåŠ è½½åŒä¸€ä¸ªç±»çš„å¤šä¸ªå®ä¾‹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ç±»åŠ è½½å™¨
- åœ¨è·å–å®ä¾‹æ—¶æŒ‡å®šç±»åŠ è½½å™¨

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼

| å®ç°æ–¹å¼ | çº¿ç¨‹å®‰å…¨ | å»¶è¿ŸåŠ è½½ | æ€§èƒ½ | æ¨èåº¦ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|------|--------|---------|
| é¥¿æ±‰å¼ | âœ… | âŒ | â­â­â­â­â­ | â­â­â­ | å®ä¾‹ä¸€å®šä¼šä½¿ç”¨ï¼Œå†…å­˜å……è¶³ |
| æ‡’æ±‰å¼ | âŒ | âœ… | â­â­â­â­â­ | â­ | å•çº¿ç¨‹ç¯å¢ƒ |
| åŒæ­¥æ–¹æ³• | âœ… | âœ… | â­â­ | â­â­ | å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ |
| åŒé‡æ£€æŸ¥ | âœ… | âœ… | â­â­â­â­ | â­â­â­â­â­ | å¤§å¤šæ•°åœºæ™¯æ¨è |
| é™æ€å†…éƒ¨ç±» | âœ… | âœ… | â­â­â­â­â­ | â­â­â­â­ | ä¸éœ€è¦ä¼ å‚çš„åœºæ™¯ |
| æšä¸¾ | âœ… | âŒ | â­â­â­â­â­ | â­â­â­â­â­ | **æœ€æ¨è**ï¼Œå®‰å…¨æ€§æœ€é«˜ |

### 2. æ¨èå®ç°æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šé™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼‰
```java
public class RecommendedSingleton {
    private RecommendedSingleton() {
        if (SingletonHolder.instance != null) {
            throw new IllegalStateException("Singleton already initialized");
        }
    }

    private static class SingletonHolder {
        private static final RecommendedSingleton instance = new RecommendedSingleton();
    }

    public static RecommendedSingleton getInstance() {
        return SingletonHolder.instance;
    }
}
```

#### æ–¹æ¡ˆäºŒï¼šæšä¸¾ï¼ˆæœ€å®‰å…¨ï¼‰
```java
public enum SafeSingleton {
    INSTANCE;

    public void doSomething() {
        System.out.println("Safe singleton working");
    }
}
```

#### æ–¹æ¡ˆä¸‰ï¼šåŒé‡æ£€æŸ¥ï¼ˆéœ€è¦å»¶è¿ŸåŠ è½½ä¸”ä¼ å‚ï¼‰
```java
public class ParametricSingleton {
    private static volatile ParametricSingleton instance;
    private final String config;

    private ParametricSingleton(String config) {
        this.config = config;
    }

    public static ParametricSingleton getInstance(String config) {
        if (instance == null) {
            synchronized (ParametricSingleton.class) {
                if (instance == null) {
                    instance = new ParametricSingleton(config);
                }
            }
        }
        return instance;
    }

    public String getConfig() {
        return config;
    }
}
```

### 3. é¿å…æ»¥ç”¨å•ä¾‹

**ä¸è¦ä½¿ç”¨å•ä¾‹çš„åœºæ™¯**ï¼š
- âŒ éœ€è¦å¤šä¸ªå®ä¾‹çš„ä¸šåŠ¡é€»è¾‘
- âŒ éœ€è¦ç»§æ‰¿çš„åœºæ™¯ï¼ˆæšä¸¾å•ä¾‹ï¼‰
- âŒ éœ€è¦å¤æ‚åˆå§‹åŒ–å‚æ•°çš„åœºæ™¯
- âŒ æµ‹è¯•å›°éš¾çš„åœºæ™¯ï¼ˆå•ä¾‹éš¾ä»¥mockï¼‰

**ä½¿ç”¨å•ä¾‹çš„åˆ¤æ–­æ ‡å‡†**ï¼š
- âœ… ç¡®å®åªéœ€è¦ä¸€ä¸ªå®ä¾‹
- âœ… è¯¥å®ä¾‹éœ€è¦è¢«å¤šä¸ªåœ°æ–¹è®¿é—®
- âœ… åˆ›å»ºå®ä¾‹çš„æˆæœ¬è¾ƒé«˜
- âœ… éœ€è¦ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶

---

## ğŸ“š ç›¸å…³æ¨¡å¼

### 1. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰
**å…³ç³»**ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥ç”¨æ¥åˆ›å»ºå•ä¾‹å¯¹è±¡ã€‚
**ç¤ºä¾‹**ï¼š
```java
public class SingletonFactory {
    private static Singleton instance;

    public static Singleton createSingleton() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

### 2. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰
**å…³ç³»**ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼ä¸­çš„å…·ä½“å·¥å‚ç±»é€šå¸¸ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚
**ç¤ºä¾‹**ï¼š
```java
public class DatabaseFactory {
    private static DatabaseFactory instance;

    private DatabaseFactory() {}

    public static DatabaseFactory getInstance() {
        if (instance == null) {
            instance = new DatabaseFactory();
        }
        return instance;
    }

    public Connection createConnection() {
        return new DatabaseConnection();
    }
}
```

### 3. å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰
**å…³ç³»**ï¼šå¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå»ºé€ è€…æœ¬èº«å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚
**ç¤ºä¾‹**ï¼š
```java
public enum ConfigurationBuilder {
    INSTANCE;

    private Configuration config;

    public Configuration build() {
        if (config == null) {
            config = new Configuration();
            // æ„å»ºé…ç½®...
        }
        return config;
    }
}
```

### 4. ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰
**å…³ç³»**ï¼šä»£ç†æ¨¡å¼å¯ä»¥ç”¨æ¥æ§åˆ¶å¯¹å•ä¾‹å¯¹è±¡çš„è®¿é—®ã€‚
**ç¤ºä¾‹**ï¼š
```java
public class SingletonProxy implements SingletonInterface {
    private SingletonInterface realSingleton;

    @Override
    public void doSomething() {
        if (realSingleton == null) {
            realSingleton = RealSingleton.getInstance();
        }
        realSingleton.doSomething();
    }
}
```

### 5. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰
**å…³ç³»**ï¼šå•ä¾‹å¯¹è±¡å¯ä»¥ä½œä¸ºè¢«è§‚å¯Ÿè€…ï¼Œå¤šä¸ªè§‚å¯Ÿè€…ç›‘å¬å…¶çŠ¶æ€å˜åŒ–ã€‚
**ç¤ºä¾‹**ï¼š
```java
public class EventManager implements Observable {
    private static EventManager instance;
    private List<Observer> observers = new ArrayList<>();

    private EventManager() {}

    public static EventManager getInstance() {
        if (instance == null) {
            instance = new EventManager();
        }
        return instance;
    }

    @Override
    public void addObserver(Observer observer) {
        observers.add(observer);
    }

    @Override
    public void notifyObservers(String event) {
        for (Observer observer : observers) {
            observer.update(event);
        }
    }
}
```

---

## ?? æ€»ç»“

å•ä¾‹æ¨¡å¼æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­éœ€è¦æ³¨æ„ï¼š

**æ ¸å¿ƒè¦ç‚¹**ï¼š
1. **ç¡®ä¿å”¯ä¸€æ€§**ï¼šé€šè¿‡ç§æœ‰æ„é€ å‡½æ•°å’Œé™æ€æ–¹æ³•æ§åˆ¶å®ä¾‹åˆ›å»º
2. **çº¿ç¨‹å®‰å…¨**ï¼šé€‰æ‹©åˆé€‚çš„çº¿ç¨‹å®‰å…¨å®ç°æ–¹å¼
3. **é˜²æ­¢ç ´å**ï¼šé˜²èŒƒåå°„æ”»å‡»å’Œåºåˆ—åŒ–ç ´å
4. **åˆç†ä½¿ç”¨**ï¼šé¿å…æ»¥ç”¨å•ä¾‹æ¨¡å¼

**æœ€ä½³å®è·µ**ï¼š
- ä¼˜å…ˆä½¿ç”¨**æšä¸¾å•ä¾‹**ï¼ˆæœ€å®‰å…¨ï¼‰
- å…¶æ¬¡é€‰æ‹©**é™æ€å†…éƒ¨ç±»**ï¼ˆæ€§èƒ½ä¼˜ç§€ï¼‰
- éœ€è¦å»¶è¿ŸåŠ è½½æ—¶ä½¿ç”¨**åŒé‡æ£€æŸ¥é”å®š**
- é¿å…ä½¿ç”¨åŸºæœ¬çš„æ‡’æ±‰å¼å’ŒåŒæ­¥æ–¹æ³•å®ç°

å•ä¾‹æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†è¦æ­£ç¡®å®ç°å¹¶ä¿è¯åœ¨å„ç§æƒ…å†µä¸‹çš„å®‰å…¨æ€§ï¼Œéœ€è¦æ·±å…¥ç†è§£Javaçš„å†…å­˜æ¨¡å‹ã€ç±»åŠ è½½æœºåˆ¶å’Œå¹¶å‘ç¼–ç¨‹çŸ¥è¯†ã€‚

---

