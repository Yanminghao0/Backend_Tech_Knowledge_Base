# å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Method Patternï¼‰

> å®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: åˆ›å»ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­â­â­
- **å…³é”®è¯**: å·¥å‚æ¥å£ã€å»¶è¿Ÿå®ä¾‹åŒ–ã€è§£è€¦åˆ›å»º

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»å
- é€šè¿‡å¼•å…¥å·¥å‚ç­‰çº§ç»“æ„ï¼Œè§£å†³ç®€å•å·¥å‚æ¨¡å¼ä¸­å·¥å‚ç±»èŒè´£è¿‡é‡çš„é—®é¢˜
- æä¾›ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹å¯ä»¥å¼•å…¥æ–°çš„äº§å“

**é€‚ç”¨åœºæ™¯**ï¼š
- å½“ä¸€ä¸ªç±»ä¸çŸ¥é“å®ƒæ‰€å¿…é¡»åˆ›å»ºçš„å¯¹è±¡çš„ç±»æ—¶
- å½“ä¸€ä¸ªç±»å¸Œæœ›ç”±å®ƒçš„å­ç±»æ¥æŒ‡å®šå®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡æ—¶
- å½“ç±»å°†åˆ›å»ºå¯¹è±¡çš„èŒè´£å§”æ‰˜ç»™å¤šä¸ªå¸®åŠ©å­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå¹¶ä¸”ä½ å¸Œæœ›å°†å“ªä¸€ä¸ªå¸®åŠ©å­ç±»æ˜¯ä»£ç†è€…è¿™ä¸€ä¿¡æ¯å±€éƒ¨åŒ–æ—¶

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Product {
        <<interface>>
        +operation()
    }

    class ConcreteProductA {
        +operation()
    }

    class ConcreteProductB {
        +operation()
    }

    class Creator {
        <<abstract>>
        +factoryMethod() Product
        +someOperation()
    }

    class ConcreteCreatorA {
        +factoryMethod() Product
    }

    class ConcreteCreatorB {
        +factoryMethod() Product
    }

    Creator <|-- ConcreteCreatorA
    Creator <|-- ConcreteCreatorB
    ConcreteCreatorA --> ConcreteProductA : creates
    ConcreteCreatorB --> ConcreteProductB : creates
    Product <|-- ConcreteProductA
    Product <|-- ConcreteProductB
    Creator ..> Product : uses
```

**ç±»å›¾è¯´æ˜**ï¼š
- `Product`ï¼šäº§å“æ¥å£ï¼Œå®šä¹‰äº§å“çš„å…¬å…±æ–¹æ³•
- `ConcreteProductA/B`ï¼šå…·ä½“äº§å“å®ç°
- `Creator`ï¼šæŠ½è±¡å·¥å‚ç±»ï¼Œå£°æ˜å·¥å‚æ–¹æ³•
- `ConcreteCreatorA/B`ï¼šå…·ä½“å·¥å‚ç±»ï¼Œå®ç°å·¥å‚æ–¹æ³•åˆ›å»ºå…·ä½“äº§å“

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å®ç°

#### 1. äº§å“æ¥å£

```java
// äº§å“æ¥å£
public interface Product {
    void operation();
}
```

#### 2. å…·ä½“äº§å“

```java
// å…·ä½“äº§å“A
public class ConcreteProductA implements Product {
    @Override
    public void operation() {
        System.out.println("ConcreteProductA operation");
    }
}

// å…·ä½“äº§å“B
public class ConcreteProductB implements Product {
    @Override
    public void operation() {
        System.out.println("ConcreteProductB operation");
    }
}
```

#### 3. æŠ½è±¡å·¥å‚

```java
// æŠ½è±¡å·¥å‚ç±»
public abstract class Creator {
    // å·¥å‚æ–¹æ³•
    public abstract Product factoryMethod();
    
    // å…¶ä»–ä¸šåŠ¡æ–¹æ³•
    public void someOperation() {
        Product product = factoryMethod();
        product.operation();
    }
}
```

#### 4. å…·ä½“å·¥å‚

```java
// å…·ä½“å·¥å‚Aï¼Œåˆ›å»ºäº§å“A
public class ConcreteCreatorA extends Creator {
    @Override
    public Product factoryMethod() {
        return new ConcreteProductA();
    }
}

// å…·ä½“å·¥å‚Bï¼Œåˆ›å»ºäº§å“B
public class ConcreteCreatorB extends Creator {
    @Override
    public Product factoryMethod() {
        return new ConcreteProductB();
    }
}
```

#### 5. å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    public static void main(String[] args) {
        Creator creatorA = new ConcreteCreatorA();
        creatorA.someOperation(); // è¾“å‡º: ConcreteProductA operation
        
        Creator creatorB = new ConcreteCreatorB();
        creatorB.someOperation(); // è¾“å‡º: ConcreteProductB operation
    }
}
```

### å®é™…åº”ç”¨ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•å™¨

```java
// æ—¥å¿—äº§å“æ¥å£
public interface Logger {
    void log(String message);
}

// æ–‡ä»¶æ—¥å¿—
public class FileLogger implements Logger {
    @Override
    public void log(String message) {
        System.out.println("File logging: " + message);
    }
}

// æ§åˆ¶å°æ—¥å¿—
public class ConsoleLogger implements Logger {
    @Override
    public void log(String message) {
        System.out.println("Console logging: " + message);
    }
}

// æ—¥å¿—å·¥å‚æ¥å£
public abstract class LoggerFactory {
    public abstract Logger createLogger();
}

// æ–‡ä»¶æ—¥å¿—å·¥å‚
public class FileLoggerFactory extends LoggerFactory {
    @Override
    public Logger createLogger() {
        // å¯èƒ½åŒ…å«å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘
        return new FileLogger();
    }
}

// æ§åˆ¶å°æ—¥å¿—å·¥å‚
public class ConsoleLoggerFactory extends LoggerFactory {
    @Override
    public Logger createLogger() {
        // å¯èƒ½åŒ…å«å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘
        return new ConsoleLogger();
    }
}

// å®¢æˆ·ç«¯
public class LoggerClient {
    public static void main(String[] args) {
        LoggerFactory factory;
        Logger logger;
        
        // æ ¹æ®é…ç½®å†³å®šä½¿ç”¨å“ªä¸ªå·¥å‚
        String loggerType = "console"; // å¯ä»é…ç½®æ–‡ä»¶è¯»å–
        
        if ("file".equals(loggerType)) {
            factory = new FileLoggerFactory();
        } else {
            factory = new ConsoleLoggerFactory();
        }
        
        logger = factory.createLogger();
        logger.log("Application started");
    }
}
```

## ğŸ” æºç åº”ç”¨

### 1. Javaé›†åˆæ¡†æ¶

```java
// Collectionæ¥å£ä¸­çš„iterator()æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå·¥å‚æ–¹æ³•
List<String> list = new ArrayList<>();
Iterator<String> iterator = list.iterator(); // ArrayListå®ç°äº†iterator()å·¥å‚æ–¹æ³•
```

### 2. Springæ¡†æ¶

Springä¸­çš„BeanFactoryä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼åˆ›å»ºå’Œç®¡ç†Beanï¼š

```java
// ApplicationContextä½œä¸ºå·¥å‚
ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
// é€šè¿‡å·¥å‚æ–¹æ³•è·å–Bean
UserService userService = context.getBean(UserService.class);
```

### 3. Java EE

Servletä¸­çš„`ServletContext.getRequestDispatcher()`æ–¹æ³•ï¼š

```java
RequestDispatcher dispatcher = servletContext.getRequestDispatcher("/index.jsp");
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦è¿‡åº¦ä½¿ç”¨**ï¼šç®€å•å¯¹è±¡åˆ›å»ºä¸éœ€è¦ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼
2. **å¹³è¡¡å¤æ‚åº¦**ï¼šå¼•å…¥å·¥å‚æ–¹æ³•ä¼šå¢åŠ ç³»ç»Ÿçš„ç±»å’Œå¯¹è±¡æ•°é‡
3. **æŠ½è±¡å·¥å‚é€‰æ‹©**ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“è¦å®ä¾‹åŒ–å“ªä¸ªå…·ä½“å·¥å‚
4. **å·¥å‚èŒè´£å•ä¸€**ï¼šå·¥å‚ç±»åº”è¯¥åªè´Ÿè´£å¯¹è±¡åˆ›å»ºï¼Œä¸åº”è¯¥åŒ…å«å¤ªå¤šä¸šåŠ¡é€»è¾‘
5. **å‘½åè§„èŒƒ**ï¼šå·¥å‚æ–¹æ³•é€šå¸¸å‘½åä¸º`createXxx()`ã€`newXxx()`æˆ–`getXxx()`

## ğŸ“ æœ€ä½³å®è·µ

1. **å‚æ•°åŒ–å·¥å‚æ–¹æ³•**ï¼šå¯ä»¥é€šè¿‡å‚æ•°å†³å®šåˆ›å»ºå“ªç§äº§å“
   ```java
   public Product factoryMethod(String type) {
       if ("A".equals(type)) return new ConcreteProductA();
       else if ("B".equals(type)) return new ConcreteProductB();
       return null;
   }
   ```

2. **é»˜è®¤å·¥å‚æ–¹æ³•**ï¼šåœ¨æŠ½è±¡å·¥å‚ä¸­æä¾›é»˜è®¤å®ç°
   ```java
   public abstract class Creator {
       public Product factoryMethod() {
           return new DefaultProduct(); // é»˜è®¤äº§å“
       }
   }
   ```

3. **ç»“åˆä¾èµ–æ³¨å…¥**ï¼šå°†å…·ä½“å·¥å‚æ³¨å…¥åˆ°å®¢æˆ·ç«¯ï¼Œæé«˜çµæ´»æ€§

4. **ä½¿ç”¨æšä¸¾**ï¼šå¯¹äºç®€å•çš„å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æšä¸¾å®ç°

## ğŸ“š ç›¸å…³æ¨¡å¼

- **æŠ½è±¡å·¥å‚æ¨¡å¼**ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼åˆ›å»ºä¸€ç§äº§å“ï¼ŒæŠ½è±¡å·¥å‚åˆ›å»ºä¸€æ—äº§å“
- **å•ä¾‹æ¨¡å¼**ï¼šå¯ä»¥åœ¨å·¥å‚æ–¹æ³•ä¸­å®ç°å•ä¾‹
- **åŸå‹æ¨¡å¼**ï¼šå½“åˆ›å»ºå¯¹è±¡æˆæœ¬é«˜æ—¶ï¼Œå¯ä»¥ç»“åˆåŸå‹æ¨¡å¼ä½¿ç”¨
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼**ï¼šå·¥å‚æ–¹æ³•é€šå¸¸åœ¨æ¨¡æ¿æ–¹æ³•ä¸­è¢«è°ƒç”¨
- **ä¾èµ–æ³¨å…¥**ï¼šéƒ½ç”¨äºè§£è€¦å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨

