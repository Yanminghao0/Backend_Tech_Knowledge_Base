# å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰

> å°†å¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼ŒåŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: åˆ›å»ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­â­
- **å…³é”®è¯**: é“¾å¼è°ƒç”¨ã€åˆ†æ­¥æ„å»ºã€å‚æ•°è¿‡å¤š

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼æ—¶
- å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç¤ºæ—¶
- å½“å¯¹è±¡å…·æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„ä¸”éœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆæ„å»ºæ—¶

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸš— **å¯¹è±¡å…·æœ‰å¤æ‚ç»“æ„**ï¼šå¦‚æ±½è½¦ã€ç”µè„‘ç­‰åŒ…å«å¤šä¸ªç»„ä»¶çš„å¯¹è±¡
- ğŸ“ **åˆ†æ­¥æ„å»º**ï¼šéœ€è¦åˆ†æ­¥éª¤æ„å»ºå¯¹è±¡ï¼Œä¸”å…è®¸æ­¥éª¤é¡ºåºå˜åŒ–
- ğŸ¨ **å¤šç§è¡¨ç¤ºå½¢å¼**ï¼šåŒä¸€æ„å»ºè¿‡ç¨‹éœ€è¦åˆ›å»ºä¸åŒè¡¨ç¤ºçš„äº§å“
- âœ… **éªŒè¯æ„å»ºè¿‡ç¨‹**ï¼šéœ€è¦åœ¨å¯¹è±¡ä½¿ç”¨å‰éªŒè¯å…¶å®Œæ•´æ€§
- ğŸ“Š **ä¸å¯å˜å¯¹è±¡**ï¼šæ„å»ºä¸å¯å˜å¯¹è±¡ï¼Œç¡®ä¿å¯¹è±¡åˆ›å»ºåçŠ¶æ€ä¸è¢«ä¿®æ”¹

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Product {
        +parts: List<String>
        +showParts()
    }

    class Builder {
        <<interface>>
        +buildPartA()
        +buildPartB()
        +buildPartC()
        +getResult() Product
    }

    class ConcreteBuilder1 {
        -product: Product
        +buildPartA()
        +buildPartB()
        +buildPartC()
        +getResult() Product
    }

    class ConcreteBuilder2 {
        -product: Product
        +buildPartA()
        +buildPartB()
        +buildPartC()
        +getResult() Product
    }

    class Director {
        -builder: Builder
        +setBuilder(builder: Builder)
        +construct()
    }

    Director --> Builder : uses
    Builder <|-- ConcreteBuilder1
    Builder <|-- ConcreteBuilder2
    ConcreteBuilder1 --> Product : creates
    ConcreteBuilder2 --> Product : creates
```

**ç±»å›¾è¯´æ˜**ï¼š
- `Product`ï¼šäº§å“ç±»ï¼ŒåŒ…å«å¤šä¸ªç»„ä»¶
- `Builder`ï¼šæŠ½è±¡å»ºé€ è€…æ¥å£ï¼Œå®šä¹‰æ„å»ºæ­¥éª¤å’Œè·å–ç»“æœæ–¹æ³•
- `ConcreteBuilder1/2`ï¼šå…·ä½“å»ºé€ è€…ï¼Œå®ç°æ„å»ºæ­¥éª¤ï¼Œåˆ›å»ºå…·ä½“äº§å“
- `Director`ï¼šæŒ‡æŒ¥è€…ï¼Œè´Ÿè´£æ§åˆ¶æ„å»ºè¿‡ç¨‹

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å®ç°

#### 1. äº§å“ç±»

```java
import java.util.ArrayList;
import java.util.List;

// äº§å“ç±»
public class Product {
    private List<String> parts = new ArrayList<>();

    public void addPart(String part) {
        parts.add(part);
    }

    public void showParts() {
        System.out.println("Product Parts: ");
        for (String part : parts) {
            System.out.println("- " + part);
        }
    }
}
```

#### 2. æŠ½è±¡å»ºé€ è€…

```java
// æŠ½è±¡å»ºé€ è€…æ¥å£
public interface Builder {
    void buildPartA();
    void buildPartB();
    void buildPartC();
    Product getResult();
}
```

#### 3. å…·ä½“å»ºé€ è€…

```java
// å…·ä½“å»ºé€ è€…1
public class ConcreteBuilder1 implements Builder {
    private Product product = new Product();

    @Override
    public void buildPartA() {
        product.addPart("Part A1");
    }

    @Override
    public void buildPartB() {
        product.addPart("Part B1");
    }

    @Override
    public void buildPartC() {
        product.addPart("Part C1");
    }

    @Override
    public Product getResult() {
        return product;
    }
}

// å…·ä½“å»ºé€ è€…2
public class ConcreteBuilder2 implements Builder {
    private Product product = new Product();

    @Override
    public void buildPartA() {
        product.addPart("Part A2");
    }

    @Override
    public void buildPartB() {
        product.addPart("Part B2");
    }

    @Override
    public void buildPartC() {
        product.addPart("Part C2");
    }

    @Override
    public Product getResult() {
        return product;
    }
}
```

#### 4. æŒ‡æŒ¥è€…

```java
// æŒ‡æŒ¥è€…ç±»
public class Director {
    private Builder builder;

    public Director(Builder builder) {
        this.builder = builder;
    }

    public void setBuilder(Builder builder) {
        this.builder = builder;
    }

    // æ„å»ºä¸åŒäº§å“çš„æ–¹æ³•
    public void constructMinimalViableProduct() {
        builder.buildPartA();
    }

    public void constructFullFeaturedProduct() {
        builder.buildPartA();
        builder.buildPartB();
        builder.buildPartC();
    }
}
```

#### 5. å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºå…·ä½“å»ºé€ è€…
        Builder builder1 = new ConcreteBuilder1();
        Builder builder2 = new ConcreteBuilder2();

        // åˆ›å»ºæŒ‡æŒ¥è€…
        Director director = new Director(builder1);

        // æ„å»ºä¸åŒäº§å“
        director.constructMinimalViableProduct();
        Product product1 = builder1.getResult();
        System.out.println("Minimal Product from Builder1:");
        product1.showParts();

        director.setBuilder(builder2);
        director.constructFullFeaturedProduct();
        Product product2 = builder2.getResult();
        System.out.println("Full Product from Builder2:");
        product2.showParts();

        // ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æŒ‡æŒ¥è€…ï¼Œç›´æ¥ä½¿ç”¨å»ºé€ è€…
        Builder builder3 = new ConcreteBuilder1();
        builder3.buildPartA();
        builder3.buildPartB();
        Product product3 = builder3.getResult();
        System.out.println("Custom Product from Builder1:");
        product3.showParts();
    }
}
```

### å®é™…åº”ç”¨ç¤ºä¾‹ï¼šå¤æ‚å¯¹è±¡æ„å»º

#### 1. ç”µè„‘æ„å»ºå™¨

```java
// äº§å“ï¼šç”µè„‘
public class Computer {
    private String cpu;
    private String ram;
    private String storage;
    private String gpu;
    private String motherboard;

    // ç§æœ‰æ„é€ å‡½æ•°ï¼Œåªèƒ½é€šè¿‡Builderåˆ›å»º
    private Computer(Builder builder) {
        this.cpu = builder.cpu;
        this.ram = builder.ram;
        this.storage = builder.storage;
        this.gpu = builder.gpu;
        this.motherboard = builder.motherboard;
    }

    @Override
    public String toString() {
        return "Computer{" +
               "cpu='" + cpu + '\'' +
               ", ram='" + ram + '\'' +
               ", storage='" + storage + '\'' +
               ", gpu='" + gpu + '\'' +
               ", motherboard='" + motherboard + '\'' +
               '}';
    }

    // é™æ€å†…éƒ¨å»ºé€ è€…ç±»
    public static class Builder {
        private String cpu;  // å¿…é¡»å‚æ•°
        private String ram;  // å¿…é¡»å‚æ•°
        private String storage;  // å¯é€‰å‚æ•°
        private String gpu;  // å¯é€‰å‚æ•°
        private String motherboard;  // å¯é€‰å‚æ•°

        // æ„é€ å‡½æ•°æ¥æ”¶å¿…é¡»å‚æ•°
        public Builder(String cpu, String ram) {
            this.cpu = cpu;
            this.ram = ram;
        }

        // é“¾å¼è°ƒç”¨è®¾ç½®å¯é€‰å‚æ•°
        public Builder storage(String storage) {
            this.storage = storage;
            return this;
        }

        public Builder gpu(String gpu) {
            this.gpu = gpu;
            return this;
        }

        public Builder motherboard(String motherboard) {
            this.motherboard = motherboard;
            return this;
        }

        // æ„å»ºäº§å“
        public Computer build() {
            return new Computer(this);
        }
    }
}

// å®¢æˆ·ç«¯
public class ComputerClient {
    public static void main(String[] args) {
        // ä½¿ç”¨å»ºé€ è€…æ„å»ºç”µè„‘
        Computer gamingPc = new Computer.Builder("Intel i9", "32GB")
                .storage("1TB SSD")
                .gpu("NVIDIA RTX 3080")
                .motherboard("ASUS ROG")
                .build();

        Computer officePc = new Computer.Builder("AMD Ryzen 5", "16GB")
                .storage("512GB SSD")
                .build();

        System.out.println("Gaming PC: " + gamingPc);
        System.out.println("Office PC: " + officePc);
    }
}
```

## ğŸ” æºç åº”ç”¨

### 1. Lombokçš„@Builderæ³¨è§£

Lombokæä¾›äº†@Builderæ³¨è§£è‡ªåŠ¨ç”Ÿæˆå»ºé€ è€…æ¨¡å¼ä»£ç ï¼š

```java
import lombok.Builder;
import lombok.ToString;

@Builder
@ToString
public class User {
    private String name;
    private int age;
    private String email;
    private String address;
}

// ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„å»ºé€ è€…
User user = User.builder()
        .name("John Doe")
        .age(30)
        .email("john@example.com")
        .build();
```

### 2. MyBatisçš„SqlSessionBuilder

```java
SqlSession session = new SqlSessionBuilder().build(inputStream);
```

### 3. Javaçš„StringBuilder

```java
StringBuilder builder = new StringBuilder();
builder.append("Hello");
builder.append(" ");
builder.append("World");
String result = builder.toString();
```

### 4. Springçš„BeanDefinitionBuilder

```java
BeanDefinitionBuilder builder = BeanDefinitionBuilder.rootBeanDefinition(MyBean.class);
builder.addPropertyValue("name", "example");
builder.addPropertyValue("age", 25);
BeanDefinition beanDefinition = builder.getBeanDefinition();
```

### 5. Guavaçš„ImmutableList.Builder

```java
List<String> list = ImmutableList.<String>builder()
        .add("a")
        .add("b")
        .addAll(Arrays.asList("c", "d"))
        .build();
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¿å…è¿‡åº¦ä½¿ç”¨**ï¼šç®€å•å¯¹è±¡ä¸éœ€è¦ä½¿ç”¨å»ºé€ è€…æ¨¡å¼
2. **å»ºé€ è€…ä¸äº§å“å…³è”**ï¼šä¸€ä¸ªå»ºé€ è€…å®ä¾‹åªåº”åˆ›å»ºä¸€ä¸ªäº§å“å®ä¾‹
3. **çº¿ç¨‹å®‰å…¨**ï¼šå»ºé€ è€…é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒéœ€æ³¨æ„åŒæ­¥
4. **æŒ‡æŒ¥è€…è§’è‰²**ï¼šå¯æ ¹æ®å¤æ‚åº¦å†³å®šæ˜¯å¦ä½¿ç”¨æŒ‡æŒ¥è€…
5. **ä¸å¯å˜äº§å“**ï¼šæ¨èå°†äº§å“è®¾è®¡ä¸ºä¸å¯å˜å¯¹è±¡ï¼Œæ„å»ºå®Œæˆåä¸èƒ½ä¿®æ”¹
6. **å‚æ•°éªŒè¯**ï¼šåº”åœ¨build()æ–¹æ³•ä¸­è¿›è¡Œå‚æ•°éªŒè¯
7. **å‘½åè§„èŒƒ**ï¼šå»ºé€ è€…æ–¹æ³•é€šå¸¸ä½¿ç”¨é“¾å¼è°ƒç”¨ï¼Œè¿”å›thisæŒ‡é’ˆ

## ğŸ“ æœ€ä½³å®è·µ

1. **å†…éƒ¨å»ºé€ è€…**ï¼šå°†å»ºé€ è€…ä½œä¸ºäº§å“ç±»çš„é™æ€å†…éƒ¨ç±»
   ```java
   public class Product {
       private Product(Builder builder) { ... }
       
       public static class Builder { ... }
   }
   ```

2. **å¿…å¡«å‚æ•°éªŒè¯**ï¼šåœ¨å»ºé€ è€…æ„é€ å‡½æ•°ä¸­æ¥æ”¶å¿…å¡«å‚æ•°
   ```java
   public Builder(String requiredParam) {
       if (requiredParam == null) {
           throw new IllegalArgumentException("Required parameter cannot be null");
       }
       this.requiredParam = requiredParam;
   }
   ```

3. **é“¾å¼è°ƒç”¨**ï¼šæ‰€æœ‰è®¾ç½®æ–¹æ³•è¿”å›thisï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
   ```java
   public Builder setProperty(String value) {
       this.property = value;
       return this;
   }
   ```

4. **ä¸å¯å˜äº§å“**ï¼šäº§å“ç±»ä¸æä¾›setteræ–¹æ³•

5. **é»˜è®¤å€¼è®¾ç½®**ï¼šä¸ºå¯é€‰å‚æ•°æä¾›åˆç†çš„é»˜è®¤å€¼

6. **æ„å»ºå‰éªŒè¯**ï¼šåœ¨build()æ–¹æ³•ä¸­éªŒè¯å‚æ•°å®Œæ•´æ€§
   ```java
   public Product build() {
       if (someParam == null) {
           throw new IllegalStateException("Some parameter is not set");
       }
       return new Product(this);
   }
   ```

7. **å¤šä¸ªå»ºé€ è€…**ï¼šä¸ºå¤æ‚äº§å“æä¾›å¤šä¸ªå»ºé€ è€…ï¼Œæ¯ä¸ªè´Ÿè´£ä¸åŒé…ç½®

## ğŸ“š ç›¸å…³æ¨¡å¼

- **å·¥å‚æ–¹æ³•æ¨¡å¼**ï¼šå»ºé€ è€…æ¨¡å¼å¼ºè°ƒåˆ†æ­¥æ„å»ºå¤æ‚å¯¹è±¡ï¼Œå·¥å‚æ–¹æ³•å¼ºè°ƒå¯¹è±¡ç±»å‹é€‰æ‹©
- **æŠ½è±¡å·¥å‚æ¨¡å¼**ï¼šéƒ½åˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œä½†æŠ½è±¡å·¥å‚ä¾§é‡äºäº§å“æ—
- **åŸå‹æ¨¡å¼**ï¼šå½“åˆ›å»ºå¯¹è±¡æˆæœ¬é«˜æ—¶ï¼Œå¯ä»¥ç»“åˆåŸå‹æ¨¡å¼å¤åˆ¶å¯¹è±¡
- **å•ä¾‹æ¨¡å¼**ï¼šå»ºé€ è€…å¯ä»¥ç”¨äºæ„å»ºå•ä¾‹å¯¹è±¡
- **ç»„åˆæ¨¡å¼**ï¼šå»ºé€ è€…ç»å¸¸åˆ›å»ºä½¿ç”¨ç»„åˆæ¨¡å¼çš„å¤æ‚å¯¹è±¡å±‚æ¬¡ç»“æ„

