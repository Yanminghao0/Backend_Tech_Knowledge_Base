# åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰

> é€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œéé€šè¿‡new

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: åˆ›å»ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­
- **å…³é”®è¯**: å¯¹è±¡å…‹éš†ã€æ·±æ‹·è´ã€æµ…æ‹·è´

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å½“åˆ›å»ºæ–°å¯¹è±¡çš„æˆæœ¬è¿‡é«˜æ—¶ï¼ˆå¦‚åˆå§‹åŒ–éœ€è¦æ¶ˆè€—å¤§é‡èµ„æºæˆ–æ—¶é—´ï¼‰
- å½“éœ€è¦é¿å…åˆ›å»ºä¸äº§å“ç±»å±‚æ¬¡å¹³è¡Œçš„å·¥å‚ç±»å±‚æ¬¡æ—¶
- å½“ä¸€ä¸ªç±»çš„å®ä¾‹åªèƒ½æœ‰å‡ ä¸ªä¸åŒçŠ¶æ€ç»„åˆä¸­çš„ä¸€ç§æ—¶
- å½“å®ä¾‹åŒ–çš„ç±»åœ¨è¿è¡Œæ—¶æŒ‡å®šæ—¶

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ“„ **æ–‡æ¡£ç¼–è¾‘å™¨**ï¼šåˆ›å»ºæ–‡æ¡£å…ƒç´ ï¼ˆæ®µè½ã€å›¾ç‰‡ã€è¡¨æ ¼ï¼‰çš„å‰¯æœ¬
- ğŸ‘¥ **ç”¨æˆ·é…ç½®**ï¼šå¤åˆ¶åŸºç¡€ç”¨æˆ·é…ç½®åˆ›å»ºæ–°ç”¨æˆ·
- ğŸ® **æ¸¸æˆå¼€å‘**ï¼šå¤åˆ¶æ¸¸æˆè§’è‰²ã€é“å…·ç­‰å¯¹è±¡
- ğŸ§ª **å®éªŒæ¨¡æ‹Ÿ**ï¼šå¤åˆ¶åˆå§‹å®éªŒç¯å¢ƒè¿›è¡Œå¤šç»„å¯¹æ¯”å®éªŒ
- ğŸ“Š **å¤æ‚å¯¹è±¡**ï¼šå¤åˆ¶åŒ…å«å¤šä¸ªç»„ä»¶çš„å¤æ‚å¯¹è±¡

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class Client {
        +operation()
    }

    class Prototype {
        <<interface>>
        +clone() Prototype
    }

    class ConcretePrototypeA {
        -fieldA: String
        +clone() Prototype
    }

    class ConcretePrototypeB {
        -fieldB: int
        +clone() Prototype
    }

    Client --> Prototype : uses
    Prototype <|-- ConcretePrototypeA
    Prototype <|-- ConcretePrototypeB
```

**ç±»å›¾è¯´æ˜**ï¼š
- `Prototype`ï¼šå£°æ˜å…‹éš†æ–¹æ³•çš„æ¥å£
- `ConcretePrototype`ï¼šå®ç°å…‹éš†æ–¹æ³•çš„å…·ä½“åŸå‹ç±»
- `Client`ï¼šä½¿ç”¨åŸå‹å¯¹è±¡çš„å®¢æˆ·ç«¯

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å®ç°

#### 1. åŸå‹æ¥å£

```java
// åŸå‹æ¥å£
public interface Prototype {
    Prototype clone();
}
```

#### 2. å…·ä½“åŸå‹ç±»

```java
// å…·ä½“åŸå‹ç±»A
public class ConcretePrototypeA implements Prototype {
    private String fieldA;

    public ConcretePrototypeA(String fieldA) {
        this.fieldA = fieldA;
    }

    @Override
    public Prototype clone() {
        // æµ…æ‹·è´
        return new ConcretePrototypeA(this.fieldA);
    }

    public String getFieldA() {
        return fieldA;
    }

    public void setFieldA(String fieldA) {
        this.fieldA = fieldA;
    }

    @Override
    public String toString() {
        return "ConcretePrototypeA{fieldA='" + fieldA + "'}";
    }
}

// å…·ä½“åŸå‹ç±»B
public class ConcretePrototypeB implements Prototype {
    private int fieldB;

    public ConcretePrototypeB(int fieldB) {
        this.fieldB = fieldB;
    }

    @Override
    public Prototype clone() {
        // æµ…æ‹·è´
        return new ConcretePrototypeB(this.fieldB);
    }

    public int getFieldB() {
        return fieldB;
    }

    public void setFieldB(int fieldB) {
        this.fieldB = fieldB;
    }

    @Override
    public String toString() {
        return "ConcretePrototypeB{fieldB=" + fieldB + "}";
    }
}
```

#### 3. å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºåŸå‹å¯¹è±¡
        Prototype prototypeA = new ConcretePrototypeA("Initial Value A");
        Prototype prototypeB = new ConcretePrototypeB(100);

        // å…‹éš†å¯¹è±¡
        Prototype cloneA = prototypeA.clone();
        Prototype cloneB = prototypeB.clone();

        System.out.println("Original A: " + prototypeA);
        System.out.println("Cloned A: " + cloneA);
        System.out.println("Original B: " + prototypeB);
        System.out.println("Cloned B: " + cloneB);

        // ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å±æ€§
        ((ConcretePrototypeA) cloneA).setFieldA("Modified Value A");
        ((ConcretePrototypeB) cloneB).setFieldB(200);

        System.out.println("After modification:");
        System.out.println("Original A: " + prototypeA);
        System.out.println("Modified Cloned A: " + cloneA);
        System.out.println("Original B: " + prototypeB);
        System.out.println("Modified Cloned B: " + cloneB);
    }
}
```

### æ·±æ‹·è´ä¸æµ…æ‹·è´

#### 1. æµ…æ‹·è´ç¤ºä¾‹

```java
// åŒ…å«å¼•ç”¨ç±»å‹çš„åŸå‹ç±»
public class ShallowCopyPrototype implements Prototype {
    private String name;
    private List<String> tags;

    public ShallowCopyPrototype(String name, List<String> tags) {
        this.name = name;
        this.tags = tags;
    }

    @Override
    public Prototype clone() {
        // æµ…æ‹·è´ï¼šå¼•ç”¨ç±»å‹åªå¤åˆ¶å¼•ç”¨
        return new ShallowCopyPrototype(this.name, this.tags);
    }

    // Getters and setters
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public List<String> getTags() { return tags; }

    @Override
    public String toString() {
        return "ShallowCopyPrototype{name='" + name + "', tags=" + tags + "}";
    }
}
```

#### 2. æ·±æ‹·è´ç¤ºä¾‹

```java
import java.util.ArrayList;
import java.util.List;

// å®ç°æ·±æ‹·è´çš„åŸå‹ç±»
public class DeepCopyPrototype implements Prototype {
    private String name;
    private List<String> tags;

    public DeepCopyPrototype(String name, List<String> tags) {
        this.name = name;
        this.tags = tags;
    }

    @Override
    public Prototype clone() {
        // æ·±æ‹·è´ï¼šå¼•ç”¨ç±»å‹ä¹Ÿåˆ›å»ºæ–°çš„å®ä¾‹
        List<String> clonedTags = new ArrayList<>(this.tags);
        return new DeepCopyPrototype(this.name, clonedTags);
    }

    // Getters and setters
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public List<String> getTags() { return tags; }

    @Override
    public String toString() {
        return "DeepCopyPrototype{name='" + name + "', tags=" + tags + "}";
    }
}
```

#### 3. å®¢æˆ·ç«¯æµ‹è¯•æ‹·è´å·®å¼‚

```java
import java.util.ArrayList;
import java.util.List;

public class CopyTestClient {
    public static void main(String[] args) {
        // æµ‹è¯•æµ…æ‹·è´
        List<String> tags = new ArrayList<>();
        tags.add("java");
        tags.add("design-pattern");

        ShallowCopyPrototype shallowOriginal = new ShallowCopyPrototype("Shallow", tags);
        ShallowCopyPrototype shallowClone = (ShallowCopyPrototype) shallowOriginal.clone();

        // ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹å±æ€§
        shallowClone.getTags().add("shallow-copy");

        System.out.println("Shallow Copy Original: " + shallowOriginal);
        System.out.println("Shallow Copy Clone: " + shallowClone);
        System.out.println("Shallow Original == Clone? " + (shallowOriginal.getTags() == shallowClone.getTags()));

        // æµ‹è¯•æ·±æ‹·è´
        List<String> deepTags = new ArrayList<>();
        deepTags.add("java");
        deepTags.add("design-pattern");

        DeepCopyPrototype deepOriginal = new DeepCopyPrototype("Deep", deepTags);
        DeepCopyPrototype deepClone = (DeepCopyPrototype) deepOriginal.clone();

        // ä¿®æ”¹å…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹å±æ€§
        deepClone.getTags().add("deep-copy");

        System.out.println("Deep Copy Original: " + deepOriginal);
        System.out.println("Deep Copy Clone: " + deepClone);
        System.out.println("Deep Original == Clone? " + (deepOriginal.getTags() == deepClone.getTags()));
    }
}
```

### Javaä¸­çš„å…‹éš†å®ç°

Javaæä¾›äº†Cloneableæ¥å£å’ŒObject.clone()æ–¹æ³•ï¼š

```java
import java.util.ArrayList;
import java.util.List;

// ä½¿ç”¨Javaå†…ç½®æœºåˆ¶å®ç°å…‹éš†
public class JavaCloneablePrototype implements Cloneable {
    private String name;
    private List<String> attributes;

    public JavaCloneablePrototype(String name) {
        this.name = name;
        this.attributes = new ArrayList<>();
    }

    // æ·»åŠ å±æ€§
    public void addAttribute(String attribute) {
        this.attributes.add(attribute);
    }

    // é‡å†™cloneæ–¹æ³•
    @Override
    public JavaCloneablePrototype clone() {
        try {
            JavaCloneablePrototype clone = (JavaCloneablePrototype) super.clone();
            // æ·±æ‹·è´éœ€è¦æ‰‹åŠ¨å¤åˆ¶å¼•ç”¨ç±»å‹
            clone.attributes = new ArrayList<>(this.attributes);
            return clone;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }

    @Override
    public String toString() {
        return "JavaCloneablePrototype{name='" + name + "', attributes=" + attributes + "}";
    }
}
```

## ğŸ” æºç åº”ç”¨

### 1. Javaä¸­çš„Cloneableæ¥å£

```java
// Javaæ ‡å‡†åº“ä¸­çš„Cloneableæ¥å£
public interface Cloneable {
}

// Objectç±»ä¸­çš„cloneæ–¹æ³•
protected native Object clone() throws CloneNotSupportedException;
```

### 2. ArrayListçš„å…‹éš†å®ç°

```java
// ArrayListçš„cloneæ–¹æ³•å®ç°
public Object clone() {
    try {
        ArrayList<?> v = (ArrayList<?>) super.clone();
        v.elementData = Arrays.copyOf(elementData, size);
        v.modCount = 0;
        return v;
    } catch (CloneNotSupportedException e) {
        // è¿™åº”è¯¥æ°¸è¿œä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯Cloneableçš„
        throw new InternalError(e);
    }
}
```

### 3. Springä¸­çš„åŸå‹ä½œç”¨åŸŸ

Springæ¡†æ¶ä¸­çš„åŸå‹ä½œç”¨åŸŸbeanï¼š

```xml
<!-- Springé…ç½®æ–‡ä»¶ -->
<bean id="prototypeBean" class="com.example.PrototypeBean" scope="prototype">
    <!-- å±æ€§é…ç½® -->
</bean>
```

æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼š

```java
// Springä¸­è·å–åŸå‹bean
ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
PrototypeBean bean1 = context.getBean(PrototypeBean.class);
PrototypeBean bean2 = context.getBean(PrototypeBean.class);

System.out.println(bean1 == bean2); // falseï¼Œæ¯æ¬¡è·å–éƒ½æ˜¯æ–°å®ä¾‹
```

### 4. è®¾è®¡å·¥å…·ä¸­çš„åŸå‹æ¨¡å¼

è®¸å¤šè®¾è®¡å·¥å…·ï¼ˆå¦‚Figmaã€Sketchï¼‰ä½¿ç”¨åŸå‹æ¨¡å¼ï¼š
- åˆ›å»ºå…ƒç´ å‰¯æœ¬
- ä¿ç•™åŸå§‹å±æ€§
- ä¿®æ”¹å‰¯æœ¬ä¸å½±å“åŸå§‹

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ·±æ‹·è´vsæµ…æ‹·è´**ï¼š
   - æµ…æ‹·è´ï¼šåªå¤åˆ¶åŸºæœ¬ç±»å‹ï¼Œå¼•ç”¨ç±»å‹åªå¤åˆ¶å¼•ç”¨
   - æ·±æ‹·è´ï¼šæ‰€æœ‰ç±»å‹éƒ½åˆ›å»ºæ–°å®ä¾‹
   - æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ‹·è´æ–¹å¼

2. **Cloneableæ¥å£**ï¼š
   - Javaä¸­çš„Cloneableåªæ˜¯æ ‡è®°æ¥å£ï¼Œä¸åŒ…å«ä»»ä½•æ–¹æ³•
   - å¿…é¡»é‡å†™Object.clone()æ–¹æ³•æ‰èƒ½å®ç°å…‹éš†
   - æœªå®ç°Cloneableè°ƒç”¨clone()ä¼šæŠ›å‡ºå¼‚å¸¸

3. **æ„é€ å‡½æ•°ä¸æ‰§è¡Œ**ï¼š
   - é€šè¿‡clone()åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šæ‰§è¡Œæ„é€ å‡½æ•°
   - åˆå§‹åŒ–é€»è¾‘éœ€åœ¨ä¸“é—¨çš„åˆå§‹åŒ–æ–¹æ³•ä¸­å®ç°

4. **å¾ªç¯å¼•ç”¨**ï¼š
   - æ·±æ‹·è´å¤„ç†å¾ªç¯å¼•ç”¨æ—¶éœ€ç‰¹åˆ«å°å¿ƒ
   - å¯èƒ½å¯¼è‡´æ— é™é€’å½’æˆ–å†…å­˜æº¢å‡º

5. **æ€§èƒ½è€ƒé‡**ï¼š
   - å…‹éš†å¤æ‚å¯¹è±¡å¯èƒ½æ¯”æ–°å»ºå¯¹è±¡æ›´é«˜æ•ˆ
   - ä½†æ·±æ‹·è´å¯èƒ½æ¯”æµ…æ‹·è´æ€§èƒ½å¼€é”€å¤§

6. **ä¸å¯å˜å¯¹è±¡**ï¼š
   - ä¸å¯å˜å¯¹è±¡æ— éœ€å…‹éš†ï¼Œå¯å®‰å…¨å…±äº«
   - å¦‚Stringã€Integerç­‰åŒ…è£…ç±»

## ğŸ“ æœ€ä½³å®è·µ

1. **ä½¿ç”¨æ¥å£å®šä¹‰åŸå‹**ï¼š
   ```java
   public interface Prototype<T> {
       T clone();
   }
   ```

2. **æä¾›æ¸…æ™°çš„æ‹·è´è¯­ä¹‰**ï¼š
   - æ˜ç¡®è¯´æ˜æ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´
   - æä¾›ä¸¤ç§æ‹·è´æ–¹å¼çš„å®ç°ï¼ˆå¦‚éœ€è¦ï¼‰

3. **ä½¿ç”¨å·¥å‚ç®¡ç†åŸå‹**ï¼š
   ```java
   public class PrototypeFactory {
       private Map<String, Prototype> prototypes = new HashMap<>();

       public void registerPrototype(String key, Prototype prototype) {
           prototypes.put(key, prototype);
       }

       public Prototype createPrototype(String key) {
           return prototypes.get(key).clone();
       }
   }
   ```

4. **ç»“åˆåºåˆ—åŒ–å®ç°æ·±æ‹·è´**ï¼š
   ```java
   import java.io.*;

   public class SerializationUtils {
       @SuppressWarnings("unchecked")
       public static <T extends Serializable> T deepClone(T object) {
           try {
               ByteArrayOutputStream baos = new ByteArrayOutputStream();
               ObjectOutputStream oos = new ObjectOutputStream(baos);
               oos.writeObject(object);

               ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
               ObjectInputStream ois = new ObjectInputStream(bais);
               return (T) ois.readObject();
           } catch (Exception e) {
               throw new RuntimeException(e);
           }
       }
   }
   ```

5. **åŸå‹æ³¨å†Œè¡¨**ï¼š
   - ç»´æŠ¤å¸¸ç”¨åŸå‹å®ä¾‹
   - é€šè¿‡é”®å¿«é€Ÿè·å–å¹¶å…‹éš†

6. **é¿å…è¿‡åº¦ä½¿ç”¨**ï¼š
   - ç®€å•å¯¹è±¡ç›´æ¥ä½¿ç”¨æ„é€ å‡½æ•°æ›´æ¸…æ™°
   - è€ƒè™‘æ˜¯å¦çœŸçš„éœ€è¦å…‹éš†

## ğŸ“š ç›¸å…³æ¨¡å¼

- **å·¥å‚æ–¹æ³•æ¨¡å¼**ï¼šåŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡ä¸éœ€è¦çŸ¥é“å…·ä½“ç±»ï¼Œå·¥å‚æ–¹æ³•éœ€è¦
- **æŠ½è±¡å·¥å‚æ¨¡å¼**ï¼šéƒ½ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œä½†å®ç°æ–¹å¼ä¸åŒ
- **å•ä¾‹æ¨¡å¼**ï¼šåŸå‹æ¨¡å¼åˆ›å»ºå¤šä¸ªç›¸ä¼¼å¯¹è±¡ï¼Œå•ä¾‹ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹
- **å»ºé€ è€…æ¨¡å¼**ï¼šéƒ½ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œå»ºé€ è€…å¼ºè°ƒåˆ†æ­¥æ„å»º
- **å¤‡å¿˜å½•æ¨¡å¼**ï¼šéƒ½æ¶‰åŠå¯¹è±¡çŠ¶æ€çš„å¤åˆ¶ï¼Œå¤‡å¿˜å½•æ›´å…³æ³¨çŠ¶æ€ä¿å­˜ä¸æ¢å¤

åŸå‹æ¨¡å¼é€‚åˆåˆ›å»ºæˆæœ¬é«˜ã€ç»“æ„å¤æ‚æˆ–éœ€è¦é¢‘ç¹å¤åˆ¶çš„å¯¹è±¡ï¼Œè€Œå·¥å‚æ¨¡å¼æ›´é€‚åˆåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡æ—ã€‚

