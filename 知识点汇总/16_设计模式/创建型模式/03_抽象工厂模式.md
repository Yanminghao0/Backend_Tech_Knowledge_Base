# æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰

> æä¾›æ¥å£åˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œæ— éœ€æŒ‡å®šå…·ä½“ç±»

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: åˆ›å»ºå‹æ¨¡å¼
- **éš¾åº¦**: â­â­â­â­
- **ä½¿ç”¨é¢‘ç‡**: â­â­â­
- **å…³é”®è¯**: äº§å“æ—ã€å·¥å‚æ—ã€è·¨å¹³å°

---

## ğŸ¯ æ¨¡å¼æ„å›¾

**æ ¸å¿ƒæ€æƒ³**ï¼šæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚

**è§£å†³çš„é—®é¢˜**ï¼š
- å½“éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€ç³»åˆ—ç›¸äº’å…³è”æˆ–ç›¸äº’ä¾èµ–çš„äº§å“æ—æ—¶
- å½“ç³»ç»Ÿéœ€è¦ç‹¬ç«‹äºäº§å“çš„åˆ›å»ºã€ç»„åˆå’Œè¡¨ç¤ºæ—¶
- å½“å¼ºè°ƒä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡çš„è®¾è®¡ä»¥ä¾¿è¿›è¡Œè”åˆä½¿ç”¨æ—¶

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸŒ **è·¨å¹³å°åº”ç”¨**ï¼šéœ€è¦ä¸ºä¸åŒå¹³å°åˆ›å»ºä¸åŒå®ç°çš„ç»„ä»¶
- ğŸ¨ **UIç»„ä»¶åº“**ï¼šä¸ºä¸åŒé£æ ¼åˆ›å»ºé…å¥—çš„UIç»„ä»¶
- ğŸ—„ï¸ **æ•°æ®åº“è®¿é—®å±‚**ï¼šä¸ºä¸åŒæ•°æ®åº“æä¾›ç»Ÿä¸€æ¥å£
- ğŸ“± **è®¾å¤‡é©±åŠ¨ç¨‹åº**ï¼šä¸ºä¸åŒè®¾å¤‡æä¾›ç»Ÿä¸€çš„é©±åŠ¨æ¥å£
- ğŸ­ **äº§å“æ—ç”Ÿäº§**ï¼šéœ€è¦åŒæ—¶åˆ›å»ºå¤šä¸ªç›¸å…³äº§å“

## ğŸ—ï¸ UMLç±»å›¾

```mermaid
classDiagram
    class AbstractFactory {
        <<interface>>
        +createProductA() ProductA
        +createProductB() ProductB
    }

    class ConcreteFactory1 {
        +createProductA() ProductA
        +createProductB() ProductB
    }

    class ConcreteFactory2 {
        +createProductA() ProductA
        +createProductB() ProductB
    }

    class ProductA {
        <<interface>>
        +usefulFunctionA()
    }

    class ProductA1 {
        +usefulFunctionA()
    }

    class ProductA2 {
        +usefulFunctionA()
    }

    class ProductB {
        <<interface>>
        +usefulFunctionB()
        +anotherUsefulFunctionB(ProductA)
    }

    class ProductB1 {
        +usefulFunctionB()
        +anotherUsefulFunctionB(ProductA)
    }

    class ProductB2 {
        +usefulFunctionB()
        +anotherUsefulFunctionB(ProductA)
    }

    AbstractFactory <|-- ConcreteFactory1
    AbstractFactory <|-- ConcreteFactory2
    ConcreteFactory1 --> ProductA1 : creates
    ConcreteFactory1 --> ProductB1 : creates
    ConcreteFactory2 --> ProductA2 : creates
    ConcreteFactory2 --> ProductB2 : creates
    ProductA <|-- ProductA1
    ProductA <|-- ProductA2
    ProductB <|-- ProductB1
    ProductB <|-- ProductB2
    ProductB1 ..> ProductA1 : uses
    ProductB2 ..> ProductA2 : uses
```

**ç±»å›¾è¯´æ˜**ï¼š
- `AbstractFactory`ï¼šæŠ½è±¡å·¥å‚æ¥å£ï¼Œå£°æ˜åˆ›å»ºäº§å“çš„æ–¹æ³•
- `ConcreteFactory1/2`ï¼šå…·ä½“å·¥å‚ï¼Œå®ç°åˆ›å»ºäº§å“çš„æ–¹æ³•
- `ProductA/B`ï¼šäº§å“æ¥å£ï¼Œå®šä¹‰äº§å“åŠŸèƒ½
- `ProductA1/A2/B1/B2`ï¼šå…·ä½“äº§å“å®ç°
- åŒä¸€å·¥å‚åˆ›å»ºçš„äº§å“ï¼ˆå¦‚ProductA1å’ŒProductB1ï¼‰æ„æˆäº§å“æ—

## ğŸ’» ä»£ç å®ç°

### åŸºæœ¬å®ç°

#### 1. äº§å“æ¥å£

```java
// äº§å“Aæ¥å£
public interface ProductA {
    void usefulFunctionA();
}

// äº§å“Bæ¥å£
public interface ProductB {
    void usefulFunctionB();
    void anotherUsefulFunctionB(ProductA collaborator);
}
```

#### 2. å…·ä½“äº§å“

```java
// å…·ä½“äº§å“A1
public class ProductA1 implements ProductA {
    @Override
    public void usefulFunctionA() {
        System.out.println("Product A1 functionality");
    }
}

// å…·ä½“äº§å“A2
public class ProductA2 implements ProductA {
    @Override
    public void usefulFunctionA() {
        System.out.println("Product A2 functionality");
    }
}

// å…·ä½“äº§å“B1
public class ProductB1 implements ProductB {
    @Override
    public void usefulFunctionB() {
        System.out.println("Product B1 functionality");
    }

    @Override
    public void anotherUsefulFunctionB(ProductA collaborator) {
        collaborator.usefulFunctionA();
        System.out.println("Product B1 collaborating with " + collaborator.getClass().getSimpleName());
    }
}

// å…·ä½“äº§å“B2
public class ProductB2 implements ProductB {
    @Override
    public void usefulFunctionB() {
        System.out.println("Product B2 functionality");
    }

    @Override
    public void anotherUsefulFunctionB(ProductA collaborator) {
        collaborator.usefulFunctionA();
        System.out.println("Product B2 collaborating with " + collaborator.getClass().getSimpleName());
    }
}
```

#### 3. æŠ½è±¡å·¥å‚æ¥å£

```java
// æŠ½è±¡å·¥å‚æ¥å£
public interface AbstractFactory {
    ProductA createProductA();
    ProductB createProductB();
}
```

#### 4. å…·ä½“å·¥å‚

```java
// å…·ä½“å·¥å‚1ï¼šç”Ÿäº§äº§å“æ—1
public class ConcreteFactory1 implements AbstractFactory {
    @Override
    public ProductA createProductA() {
        return new ProductA1();
    }

    @Override
    public ProductB createProductB() {
        return new ProductB1();
    }
}

// å…·ä½“å·¥å‚2ï¼šç”Ÿäº§äº§å“æ—2
public class ConcreteFactory2 implements AbstractFactory {
    @Override
    public ProductA createProductA() {
        return new ProductA2();
    }

    @Override
    public ProductB createProductB() {
        return new ProductB2();
    }
}
```

#### 5. å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    private final ProductA productA;
    private final ProductB productB;

    // å®¢æˆ·ç«¯ä¾èµ–äºæŠ½è±¡å·¥å‚
    public Client(AbstractFactory factory) {
        productA = factory.createProductA();
        productB = factory.createProductB();
    }

    public void doSomething() {
        productB.usefulFunctionB();
        productB.anotherUsefulFunctionB(productA);
    }

    public static void main(String[] args) {
        // æ ¹æ®é…ç½®é€‰æ‹©å…·ä½“å·¥å‚
        AbstractFactory factory;
        String config = "factory1"; // å¯ä»é…ç½®æ–‡ä»¶è¯»å–

        if ("factory1".equals(config)) {
            factory = new ConcreteFactory1();
        } else {
            factory = new ConcreteFactory2();
        }

        Client client = new Client(factory);
        client.doSomething();
    }
}
```

### å®é™…åº”ç”¨ç¤ºä¾‹ï¼šUIç»„ä»¶åº“

```java
// æŒ‰é’®æ¥å£
public interface Button {
    void paint();
}

// å¤é€‰æ¡†æ¥å£
public interface Checkbox {
    void paint();
}

// WindowsæŒ‰é’®
public class WindowsButton implements Button {
    @Override
    public void paint() {
        System.out.println("Rendering Windows style button");
    }
}

// MacæŒ‰é’®
public class MacButton implements Button {
    @Override
    public void paint() {
        System.out.println("Rendering Mac style button");
    }
}

// Windowså¤é€‰æ¡†
public class WindowsCheckbox implements Checkbox {
    @Override
    public void paint() {
        System.out.println("Rendering Windows style checkbox");
    }
}

// Macå¤é€‰æ¡†
public class MacCheckbox implements Checkbox {
    @Override
    public void paint() {
        System.out.println("Rendering Mac style checkbox");
    }
}

// UIå·¥å‚æ¥å£
public interface GUIFactory {
    Button createButton();
    Checkbox createCheckbox();
}

// Windowså·¥å‚
public class WindowsFactory implements GUIFactory {
    @Override
    public Button createButton() {
        return new WindowsButton();
    }

    @Override
    public Checkbox createCheckbox() {
        return new WindowsCheckbox();
    }
}

// Macå·¥å‚
public class MacFactory implements GUIFactory {
    @Override
    public Button createButton() {
        return new MacButton();
    }

    @Override
    public Checkbox createCheckbox() {
        return new MacCheckbox();
    }
}

// åº”ç”¨ç¨‹åº
public class Application {
    private final Button button;
    private final Checkbox checkbox;

    public Application(GUIFactory factory) {
        button = factory.createButton();
        checkbox = factory.createCheckbox();
    }

    public void paint() {
        button.paint();
        checkbox.paint();
    }

    public static void main(String[] args) {
        GUIFactory factory;

        // æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©å·¥å‚
        String os = System.getProperty("os.name").toLowerCase();
        if (os.contains("win")) {
            factory = new WindowsFactory();
        } else {
            factory = new MacFactory();
        }

        Application app = new Application(factory);
        app.paint();
    }
}
```

## ğŸ” æºç åº”ç”¨

### 1. Java AWT

Javaçš„AWTå·¥å…·åŒ…ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼å¤„ç†ä¸åŒå¹³å°çš„UIç»„ä»¶ï¼š

```java
// Toolkitä½œä¸ºæŠ½è±¡å·¥å‚
Toolkit toolkit = Toolkit.getDefaultToolkit();
// åˆ›å»ºå¹³å°ç›¸å…³çš„ç»„ä»¶
Button button = new Button("Click me");
```

### 2. Springæ¡†æ¶

Springçš„`org.springframework.beans.factory.FactoryBean`æ¥å£ï¼š

```java
// æŠ½è±¡å·¥å‚
public interface FactoryBean<T> {
    T getObject() throws Exception;
    Class<?> getObjectType();
    boolean isSingleton();
}
```

### 3. MyBatis

MyBatisçš„`SqlSessionFactory`ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»º`SqlSession`ï¼š

```java
SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(inputStream);
SqlSession session = factory.openSession(); // åˆ›å»ºä¼šè¯
```

### 4. æ•°æ®åº“è¿æ¥

JDBCä¸­çš„æ•°æ®åº“è¿æ¥å·¥å‚ï¼š

```java
// ä¸åŒæ•°æ®åº“æœ‰ä¸åŒçš„Driverå®ç°
Connection connection = DriverManager.getConnection(url, username, password);
Statement statement = connection.createStatement(); // åˆ›å»ºè¯­å¥å¯¹è±¡
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¢åŠ æ–°äº§å“å›°éš¾**ï¼šæ·»åŠ æ–°äº§å“æ—å®¹æ˜“ï¼Œä½†æ·»åŠ æ–°ç§ç±»çš„äº§å“éœ€è¦ä¿®æ”¹æ‰€æœ‰å·¥å‚æ¥å£
2. **å¤æ‚æ€§è¾ƒé«˜**ï¼šä¼šå¯¼è‡´ç³»ç»Ÿä¸­ç±»çš„æ•°é‡æ€¥å‰§å¢åŠ ï¼Œå¢åŠ ç†è§£éš¾åº¦
3. **æŠ½è±¡å·¥å‚é€‰æ‹©**ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“å¹¶é€‰æ‹©å“ªä¸ªå·¥å‚å®ç°
4. **äº§å“æ—é™åˆ¶**ï¼šåªé€‚ç”¨äºç›¸å…³äº§å“ç»„æˆçš„äº§å“æ—
5. **é¿å…è¿‡åº¦è®¾è®¡**ï¼šç®€å•å¯¹è±¡åˆ›å»ºä¸éœ€è¦ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼

## ğŸ“ æœ€ä½³å®è·µ

1. **äº§å“æ—æ¸…æ™°**ï¼šç¡®ä¿äº§å“æ—ä¸­çš„äº§å“ç¡®å®å­˜åœ¨å…³è”
2. **å·¥å‚æ¥å£ç¨³å®š**ï¼šä¸€æ—¦ç¡®å®šï¼Œé¿å…é¢‘ç¹ä¿®æ”¹æŠ½è±¡å·¥å‚æ¥å£
3. **å‚æ•°åŒ–å·¥å‚**ï¼šå¯ä»¥é€šè¿‡å‚æ•°åŒ–åˆ›å»ºä¸åŒäº§å“æ—
   ```java
   public interface AbstractFactory {
       <T extends Product> T createProduct(Class<T> productClass);
   }
   ```

4. **å•ä¾‹å·¥å‚**ï¼šå·¥å‚å®ä¾‹é€šå¸¸è®¾è®¡ä¸ºå•ä¾‹

5. **é»˜è®¤å®ç°**ï¼šä¸ºæŠ½è±¡å·¥å‚æä¾›é»˜è®¤å®ç°

6. **ç»“åˆä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡DIå®¹å™¨ç®¡ç†å·¥å‚å’Œäº§å“

## ğŸ“š ç›¸å…³æ¨¡å¼

- **å·¥å‚æ–¹æ³•æ¨¡å¼**ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼åŒ…å«å¤šä¸ªå·¥å‚æ–¹æ³•
- **å»ºé€ è€…æ¨¡å¼**ï¼šå¼ºè°ƒå¯¹è±¡çš„åˆ†æ­¥æ„å»ºï¼ŒæŠ½è±¡å·¥å‚å¼ºè°ƒäº§å“æ—åˆ›å»º
- **åŸå‹æ¨¡å¼**ï¼šå½“äº§å“åˆ›å»ºæˆæœ¬é«˜æ—¶ï¼Œå¯ä»¥ç»“åˆåŸå‹æ¨¡å¼
- **å•ä¾‹æ¨¡å¼**ï¼šå·¥å‚ç±»é€šå¸¸å®ç°ä¸ºå•ä¾‹
- **æ¡¥æ¥æ¨¡å¼**ï¼šéƒ½å¤„ç†å¯¹è±¡çš„æŠ½è±¡ä¸å®ç°åˆ†ç¦»

