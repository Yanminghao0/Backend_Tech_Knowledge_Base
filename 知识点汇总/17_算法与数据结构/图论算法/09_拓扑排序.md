# æ‹“æ‰‘æŽ’åº

> æ‹“æ‰‘æŽ’åºæ˜¯ä¸€ç§å¯¹æœ‰å‘æ— çŽ¯å›¾(DAG)é¡¶ç‚¹è¿›è¡ŒæŽ’åºçš„ç®—æ³•ï¼Œä½¿å¾—å¯¹äºŽæ¯ä¸€æ¡æœ‰å‘è¾¹(u, v)ï¼Œé¡¶ç‚¹uéƒ½æŽ’åœ¨é¡¶ç‚¹vä¹‹å‰ã€‚æ‹“æ‰‘æŽ’åºå¹¿æ³›åº”ç”¨äºŽä»»åŠ¡è°ƒåº¦ã€ä¾èµ–å…³ç³»åˆ†æžç­‰åœºæ™¯ã€‚

---

## ðŸ“Š åŸºæœ¬ä¿¡æ¯

### å®šä¹‰
æ‹“æ‰‘æŽ’åºï¼ˆTopological Sortï¼‰æ˜¯å¯¹æœ‰å‘æ— çŽ¯å›¾ï¼ˆDAGï¼‰çš„é¡¶ç‚¹è¿›è¡ŒæŽ’åºçš„è¿‡ç¨‹ï¼Œä½¿å¾—å¯¹äºŽå›¾ä¸­ä»»æ„ä¸€æ¡æœ‰å‘è¾¹(u, v)ï¼Œé¡¶ç‚¹uåœ¨æŽ’åºç»“æžœä¸­éƒ½å‡ºçŽ°åœ¨é¡¶ç‚¹vä¹‹å‰ã€‚å¦‚æžœå›¾ä¸­å­˜åœ¨çŽ¯ï¼Œåˆ™æ— æ³•è¿›è¡Œæ‹“æ‰‘æŽ’åºã€‚

### æ ¸å¿ƒæ€æƒ³
æ‹“æ‰‘æŽ’åºçš„æ ¸å¿ƒæ€æƒ³åŸºäºŽä»¥ä¸‹è§‚å¯Ÿï¼š
1. æœ‰å‘æ— çŽ¯å›¾ä¸­å¿…å®šå­˜åœ¨è‡³å°‘ä¸€ä¸ªå…¥åº¦ä¸º0çš„é¡¶ç‚¹
2. å¯ä»¥é€šè¿‡åå¤é€‰æ‹©å…¥åº¦ä¸º0çš„é¡¶ç‚¹å¹¶ç§»é™¤å…¶æ‰€æœ‰å‡ºè¾¹æ¥ç”Ÿæˆæ‹“æ‰‘åºåˆ—
3. ä¸»è¦å®žçŽ°æ–¹æ³•æœ‰ä¸¤ç§ï¼š
   - Kahnç®—æ³•ï¼šåŸºäºŽå…¥åº¦è¡¨å’Œé˜Ÿåˆ—çš„è¿­ä»£æ–¹æ³•
   - DFS-basedç®—æ³•ï¼šåŸºäºŽæ·±åº¦ä¼˜å…ˆæœç´¢çš„åŽåºéåŽ†åè½¬

### ä¸Žå…¶ä»–æŽ’åºç®—æ³•çš„æ¯”è¾ƒ
| ç®—æ³• | é€‚ç”¨åœºæ™¯ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ç‰¹ç‚¹ |
|------|----------|------------|------------|------|
| æ‹“æ‰‘æŽ’åº | æœ‰å‘æ— çŽ¯å›¾ | O(V + E) | O(V) | ç»“æžœä¸å”¯ä¸€ï¼Œå¤„ç†ä¾èµ–å…³ç³» |
| å†’æ³¡æŽ’åº | çº¿æ€§åºåˆ— | O(nÂ²) | O(1) | ç¨³å®šæŽ’åºï¼Œç®€å•å®žçŽ° |
| å¿«é€ŸæŽ’åº | çº¿æ€§åºåˆ— | O(n log n) | O(log n) | ä¸ç¨³å®šæŽ’åºï¼Œå¹³å‡æ€§èƒ½å¥½ |
| å½’å¹¶æŽ’åº | çº¿æ€§åºåˆ— | O(n log n) | O(n) | ç¨³å®šæŽ’åºï¼Œé€‚åˆå¤§æ•°æ®é‡ |

---

## ðŸŽ¯ ç®—æ³•åŽŸç†

### Kahnç®—æ³•æ­¥éª¤
1. è®¡ç®—å›¾ä¸­æ‰€æœ‰é¡¶ç‚¹çš„å…¥åº¦
2. å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—
3. å½“é˜Ÿåˆ—éžç©ºæ—¶ï¼š
   a. å–å‡ºé˜Ÿé¦–é¡¶ç‚¹uï¼ŒåŠ å…¥æ‹“æ‰‘åºåˆ—
   b. å¯¹äºŽuçš„æ¯ä¸ªé‚»æŽ¥é¡¶ç‚¹vï¼Œå°†vçš„å…¥åº¦å‡1
   c. å¦‚æžœvçš„å…¥åº¦å˜ä¸º0ï¼Œå°†å…¶åŠ å…¥é˜Ÿåˆ—
4. å¦‚æžœæ‹“æ‰‘åºåˆ—çš„é•¿åº¦å°äºŽé¡¶ç‚¹æ•°ï¼Œåˆ™å›¾ä¸­å­˜åœ¨çŽ¯ï¼Œæ— æ³•è¿›è¡Œæ‹“æ‰‘æŽ’åº

### DFS-basedç®—æ³•æ­¥éª¤
1. å¯¹å›¾è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢
2. åœ¨å®Œæˆè®¿é—®ä¸€ä¸ªé¡¶ç‚¹ï¼ˆåŽåºéåŽ†ï¼‰æ—¶ï¼Œå°†å…¶åŠ å…¥æ ˆä¸­
3. æœç´¢å®ŒæˆåŽï¼Œå°†æ ˆä¸­é¡¶ç‚¹ä¾æ¬¡å¼¹å‡ºï¼Œå¾—åˆ°æ‹“æ‰‘åºåˆ—
4. å¦‚æžœæœç´¢è¿‡ç¨‹ä¸­å‘çŽ°å›žè¾¹ï¼ˆæŒ‡å‘å·²è®¿é—®ä½†æœªå®Œæˆçš„é¡¶ç‚¹ï¼‰ï¼Œåˆ™å›¾ä¸­å­˜åœ¨çŽ¯

### å›¾è§£è¯´æ˜Ž
![æ‹“æ‰‘æŽ’åºç¤ºä¾‹](https://upload.wikimedia.org/wikipedia/commons/thumb/0/03/Directed_acyclic_graph.svg/800px-Directed_acyclic_graph.svg.png)
*å›¾ï¼šæœ‰å‘æ— çŽ¯å›¾åŠå…¶ä¸€ç§æ‹“æ‰‘æŽ’åºç»“æžœï¼ˆ1, 2, 3, 4, 5, 6ï¼‰*

---

## ðŸ’» ä»£ç å®žçŽ°

### Kahnç®—æ³•å®žçŽ°
```python
from collections import deque

def kahn_topological_sort(graph):
    n = len(graph)
    in_degree = [0] * n
    
    # è®¡ç®—æ‰€æœ‰é¡¶ç‚¹çš„å…¥åº¦
    for u in range(n):
        for v in graph[u]:
            in_degree[v] += 1
    
    # å°†å…¥åº¦ä¸º0çš„é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—
    queue = deque()
    for i in range(n):
        if in_degree[i] == 0:
            queue.append(i)
    
    top_order = []
    count = 0
    
    while queue:
        u = queue.popleft()
        top_order.append(u)
        
        # å‡å°‘é‚»æŽ¥é¡¶ç‚¹çš„å…¥åº¦
        for v in graph[u]:
            in_degree[v] -= 1
            if in_degree[v] == 0:
                queue.append(v)
        
        count += 1
    
    # æ£€æŸ¥æ˜¯å¦å­˜åœ¨çŽ¯
    if count != n:
        return None  # å­˜åœ¨çŽ¯ï¼Œæ— æ³•æ‹“æ‰‘æŽ’åº
    
    return top_order

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    # é‚»æŽ¥è¡¨è¡¨ç¤ºçš„æœ‰å‘æ— çŽ¯å›¾
    graph = [
        [1, 2],    # 0
        [3],       # 1
        [3, 4],    # 2
        [5],       # 3
        [5],       # 4
        []         # 5
    ]
    
    top_order = kahn_topological_sort(graph)
    if top_order:
        print("Kahnç®—æ³•æ‹“æ‰‘æŽ’åºç»“æžœ:", top_order)
    else:
        print("å›¾ä¸­å­˜åœ¨çŽ¯ï¼Œæ— æ³•è¿›è¡Œæ‹“æ‰‘æŽ’åº")
```

### DFS-basedæ‹“æ‰‘æŽ’åºå®žçŽ°
```python
def dfs_topological_sort(graph):
    n = len(graph)
    visited = [False] * n
    temp = [False] * n  # ä¸´æ—¶æ ‡è®°ï¼Œç”¨äºŽæ£€æµ‹çŽ¯
    stack = []
    
    def dfs(u):
        if temp[u]:
            # å‘çŽ°çŽ¯
            return False
        if visited[u]:
            return True
        
        temp[u] = True
        for v in graph[u]:
            if not dfs(v):
                return False
        
        temp[u] = False
        visited[u] = True
        stack.append(u)
        return True
    
    # å¯¹æ‰€æœ‰æœªè®¿é—®çš„é¡¶ç‚¹æ‰§è¡ŒDFS
    for i in range(n):
        if not visited[i]:
            if not dfs(i):
                return None  # å­˜åœ¨çŽ¯
    
    # åè½¬æ ˆå¾—åˆ°æ‹“æ‰‘åºåˆ—
    return stack[::-1]

# å¸¦é¡¶ç‚¹æ ‡ç­¾çš„æ‹“æ‰‘æŽ’åº
def topological_sort_with_labels(labels_graph):
    # å°†æ ‡ç­¾æ˜ å°„åˆ°ID
    label_to_id = {label: i for i, label in enumerate(labels_graph.keys())}
    id_to_label = {i: label for label, i in label_to_id.items()}
    n = len(label_to_id)
    
    # æž„å»ºIDå›¾
    id_graph = [[] for _ in range(n)]
    for label, neighbors in labels_graph.items():
        u_id = label_to_id[label]
        for neighbor in neighbors:
            v_id = label_to_id[neighbor]
            id_graph[u_id].append(v_id)
    
    # æ‰§è¡Œæ‹“æ‰‘æŽ’åº
    top_order_ids = dfs_topological_sort(id_graph)
    if not top_order_ids:
        return None
    
    # è½¬æ¢å›žæ ‡ç­¾
    return [id_to_label[id] for id in top_order_ids]

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    # é¡¹ç›®ä¾èµ–å›¾
    project_dependencies = {
        'A': ['B', 'C'],
        'B': ['D'],
        'C': ['D'],
        'D': ['E'],
        'E': [],
        'F': ['G'],
        'G': []
    }
    
    top_order = topological_sort_with_labels(project_dependencies)
    if top_order:
        print("é¡¹ç›®ä¾èµ–æ‹“æ‰‘æŽ’åºç»“æžœ:", top_order)
    else:
        print("é¡¹ç›®ä¾èµ–ä¸­å­˜åœ¨å¾ªçŽ¯ä¾èµ–ï¼Œæ— æ³•è¿›è¡Œæ‹“æ‰‘æŽ’åº")
```

### æ‹“æ‰‘æŽ’åºåº”ç”¨ï¼šä»»åŠ¡è°ƒåº¦
```python
def task_scheduling(tasks, dependencies):
    # æž„å»ºä»»åŠ¡ä¾èµ–å›¾
    task_to_id = {task: i for i, task in enumerate(tasks)}
    id_to_task = {i: task for task, i in task_to_id.items()}
    n = len(tasks)
    graph = [[] for _ in range(n)]
    
    for u, v in dependencies:
        # uå¿…é¡»åœ¨vä¹‹å‰å®Œæˆ
        graph[task_to_id[u]].append(task_to_id[v])
    
    # æ‰§è¡Œæ‹“æ‰‘æŽ’åº
    top_order_ids = dfs_topological_sort(graph)
    if not top_order_ids:
        return None
    
    # è½¬æ¢å›žä»»åŠ¡åç§°
    return [id_to_task[id] for id in top_order_ids]

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    tasks = ['èµ·åºŠ', 'åˆ·ç‰™', 'æ´—è„¸', 'åƒæ—©é¤', 'æ¢è¡£æœ', 'å‡ºé—¨']
    dependencies = [
        ('èµ·åºŠ', 'åˆ·ç‰™'),
        ('èµ·åºŠ', 'æ´—è„¸'),
        ('åˆ·ç‰™', 'åƒæ—©é¤'),
        ('æ´—è„¸', 'åƒæ—©é¤'),
        ('æ¢è¡£æœ', 'å‡ºé—¨'),
        ('åƒæ—©é¤', 'å‡ºé—¨')
    ]
    
    schedule = task_scheduling(tasks, dependencies)
    if schedule:
        print("ä»»åŠ¡è°ƒåº¦é¡ºåº:")
        for i, task in enumerate(schedule):
            print(f"ç¬¬{i+1}æ­¥: {task}")
    else:
        print("ä»»åŠ¡ä¹‹é—´å­˜åœ¨å¾ªçŽ¯ä¾èµ–ï¼Œæ— æ³•è°ƒåº¦")
```

---

## ðŸ“Š å¤æ‚åº¦åˆ†æž

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|------------|------------|------|------|
| Kahnç®—æ³• | O(V + E) | O(V) | å¯å¤„ç†éƒ¨åˆ†æŽ’åºï¼Œèƒ½æ£€æµ‹çŽ¯ | éœ€è¦ç»´æŠ¤å…¥åº¦è¡¨ |
| DFS-based | O(V + E) | O(V) | å®žçŽ°ç®€æ´ï¼Œé€‚åˆæ·±åº¦ä¼˜å…ˆåœºæ™¯ | æ— æ³•å¤„ç†éƒ¨åˆ†æŽ’åº |

### å¤æ‚åº¦è¯´æ˜Ž
- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - ä¸¤ç§ç®—æ³•éƒ½éœ€è¦éåŽ†æ‰€æœ‰é¡¶ç‚¹å’Œè¾¹ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(V + E)
  - Kahnç®—æ³•ä¸­æ¯ä¸ªé¡¶ç‚¹å’Œè¾¹éƒ½åªå¤„ç†ä¸€æ¬¡
  - DFS-basedç®—æ³•ä¸­æ¯ä¸ªé¡¶ç‚¹å’Œè¾¹ä¹Ÿåªå¤„ç†ä¸€æ¬¡
- **ç©ºé—´å¤æ‚åº¦**ï¼š
  - ä¸»è¦æ¥è‡ªå­˜å‚¨å›¾ã€è®¿é—®æ ‡è®°å’Œç»“æžœæ ˆ/é˜Ÿåˆ—
  - Kahnç®—æ³•éœ€è¦é¢å¤–å­˜å‚¨å…¥åº¦è¡¨
  - DFS-basedç®—æ³•é€’å½’å®žçŽ°å¯èƒ½æœ‰é¢å¤–çš„æ ˆç©ºé—´å¼€é”€
- **å®žé™…æ€§èƒ½**ï¼š
  - å¯¹äºŽç¨€ç–å›¾ï¼Œä¸¤ç§ç®—æ³•æ€§èƒ½ç›¸è¿‘
  - Kahnç®—æ³•é€šå¸¸æ›´å®¹æ˜“å¹¶è¡ŒåŒ–
  - DFS-basedç®—æ³•åœ¨é€’å½’å®žçŽ°æ—¶å¯èƒ½å—æ ˆæ·±åº¦é™åˆ¶

---

## ðŸ” åº”ç”¨åœºæ™¯

1. **ä»»åŠ¡è°ƒåº¦**ï¼š
   - é¡¹ç›®ç®¡ç†ä¸­çš„ä»»åŠ¡æŽ’åº
   - æž„å»ºç³»ç»Ÿä¸­çš„ç¼–è¯‘é¡ºåº
   - è¯¾ç¨‹å®‰æŽ’ä¸­çš„å…ˆä¿®å…³ç³»

2. **ä¾èµ–å…³ç³»åˆ†æž**ï¼š
   - åŒ…ç®¡ç†å™¨ä¸­çš„ä¾èµ–è§£æž
   - æ¨¡å—åŠ è½½é¡ºåºç¡®å®š
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

3. **å›¾è®ºé—®é¢˜**ï¼š
   - æœ€é•¿è·¯å¾„é—®é¢˜æ±‚è§£
   - å…³é”®è·¯å¾„åˆ†æž
   - æœ‰å‘æ— çŽ¯å›¾çš„å¯è¾¾æ€§åˆ†æž

4. **å…¶ä»–é¢†åŸŸ**ï¼š
   - å®¶è°±å…³ç³»æ¢³ç†
   - ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿä¸­çš„å˜æ›´ä¼ æ’­
   - è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„å¥æ³•åˆ†æž

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å›¾çš„è¦æ±‚**ï¼š
   - æ‹“æ‰‘æŽ’åºä»…é€‚ç”¨äºŽæœ‰å‘æ— çŽ¯å›¾(DAG)
   - å¿…é¡»å…ˆæ£€æµ‹å›¾ä¸­æ˜¯å¦å­˜åœ¨çŽ¯
   - å¯¹äºŽéžè¿žé€šå›¾ï¼Œå°†å¯¹æ¯ä¸ªè¿žé€šåˆ†é‡åˆ†åˆ«è¿›è¡Œæ‹“æ‰‘æŽ’åº

2. **ç®—æ³•é€‰æ‹©**ï¼š
   - éœ€è¦éƒ¨åˆ†æŽ’åºç»“æžœæ—¶é€‰æ‹©Kahnç®—æ³•
   - å®žçŽ°ç®€æ´æ€§ä¼˜å…ˆæ—¶é€‰æ‹©DFS-basedç®—æ³•
   - å¤„ç†å¤§åž‹å›¾æ—¶ä¼˜å…ˆè€ƒè™‘Kahnç®—æ³•çš„è¿­ä»£å®žçŽ°

3. **å®žçŽ°ç»†èŠ‚**ï¼š
   - Kahnç®—æ³•ä¸­æ­£ç¡®ç»´æŠ¤å…¥åº¦è¡¨æ˜¯å…³é”®
   - DFS-basedç®—æ³•ä¸­æ­£ç¡®æ£€æµ‹çŽ¯éœ€è¦ä¸´æ—¶æ ‡è®°
   - æ‹“æ‰‘æŽ’åºç»“æžœé€šå¸¸ä¸å”¯ä¸€

4. **ç‰¹æ®Šæƒ…å†µå¤„ç†**ï¼š
   - ç©ºå›¾çš„æ‹“æ‰‘æŽ’åºä¸ºç©º
   - å•ä¸ªé¡¶ç‚¹çš„æ‹“æ‰‘æŽ’åºä¸ºå…¶æœ¬èº«
   - å­˜åœ¨å¤šä¸ªå…¥åº¦ä¸º0çš„é¡¶ç‚¹æ—¶ï¼Œé€‰æ‹©é¡ºåºä¼šå½±å“ç»“æžœ

---

## ðŸŽ“ æœ€ä½³å®žè·µ

1. **ç®—æ³•å®žçŽ°æŠ€å·§**ï¼š
   - ä¼˜å…ˆä½¿ç”¨Kahnç®—æ³•å¤„ç†å®žé™…é—®é¢˜ï¼Œæ›´ç›´è§‚ä¸”æ˜“äºŽç†è§£
   - å¯¹å¤§åž‹å›¾ä½¿ç”¨é‚»æŽ¥è¡¨è€Œéžé‚»æŽ¥çŸ©é˜µ
   - ä½¿ç”¨é˜Ÿåˆ—ï¼ˆFIFOï¼‰è€Œéžæ ˆæ¥å®žçŽ°Kahnç®—æ³•ï¼Œç¡®ä¿ç»“æžœä¸€è‡´æ€§

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å¯¹äºŽé¢‘ç¹å˜åŒ–çš„å›¾ï¼Œè€ƒè™‘ä½¿ç”¨åŠ¨æ€æ‹“æ‰‘æŽ’åºç®—æ³•
   - ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ä»£æ›¿æ™®é€šé˜Ÿåˆ—å®žçŽ°å¸¦æƒé‡çš„æ‹“æ‰‘æŽ’åº
   - å¹¶è¡Œå¤„ç†å¤šä¸ªå…¥åº¦ä¸º0çš„é¡¶ç‚¹ä»¥æé«˜æ•ˆçŽ‡

3. **åº”ç”¨å»ºè®®**ï¼š
   - ç»“åˆå…³é”®è·¯å¾„åˆ†æžè¿›è¡Œé¡¹ç›®è°ƒåº¦ä¼˜åŒ–
   - ä½¿ç”¨æ‹“æ‰‘æŽ’åºè§£å†³ä¾èµ–å†²çª
   - åœ¨ç»“æžœä¸å”¯ä¸€æ—¶ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ·»åŠ é¢å¤–æŽ’åºè§„åˆ™

4. **å¸¸è§é”™è¯¯é¿å…**ï¼š
   - å¿½ç•¥å›¾ä¸­å¯èƒ½å­˜åœ¨çš„çŽ¯
   - é”™è¯¯ç†è§£æœ‰å‘è¾¹çš„æ–¹å‘ï¼ˆuå¿…é¡»åœ¨vä¹‹å‰ï¼‰
   - æ··æ·†æ‹“æ‰‘æŽ’åºä¸Žå…¶ä»–æŽ’åºç®—æ³•

---

### ç›¸å…³é“¾æŽ¥
- [æ‹“æ‰‘æŽ’åº - Wikipedia](https://en.wikipedia.org/wiki/Topological_sorting)
- [Kahnç®—æ³• - Wikipedia](https://en.wikipedia.org/wiki/Topological_sorting#Kahn's_algorithm)
- [æ‹“æ‰‘æŽ’åºå¯è§†åŒ–](https://visualgo.net/en/toposort)
- [æœ‰å‘æ— çŽ¯å›¾ - Wikipedia](https://en.wikipedia.org/wiki/Directed_acyclic_graph)

> **æ›´æ–°æ—¥æœŸ**: 2023-11-15