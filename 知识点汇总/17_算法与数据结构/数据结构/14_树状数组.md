# æ ‘çŠ¶æ•°ç»„

> æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰ï¼Œä¹Ÿç§°ä¸ºäºŒå‰ç´¢å¼•æ ‘ï¼ˆBinary Indexed Treeï¼‰ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆè®¡ç®—å‰ç¼€å’Œä¸å•ç‚¹æ›´æ–°çš„æ•°æ®ç»“æ„ã€‚å®ƒé€šè¿‡å·§å¦™çš„ç´¢å¼•è®¾è®¡ï¼Œå°†å‰ç¼€å’ŒæŸ¥è¯¢å’Œå•ç‚¹æ›´æ–°æ“ä½œçš„æ—¶é—´å¤æ‚åº¦é™è‡³O(log n)ï¼ŒåŒæ—¶ä¿æŒO(n)çš„ç©ºé—´å¤æ‚åº¦ã€‚æ ‘çŠ¶æ•°ç»„ç»“æ„ç®€å•ã€å®ç°é«˜æ•ˆï¼Œå¹¿æ³›åº”ç”¨äºéœ€è¦é¢‘ç¹è¿›è¡Œå‰ç¼€å’Œè®¡ç®—å’Œç‚¹æ›´æ–°çš„åœºæ™¯ã€‚

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| å±æ€§ | è¯´æ˜ |
|------|------|
| æ•°æ®ç»“æ„ç±»å‹ | çº¿æ€§æ•°æ®ç»“æ„ |
| å­˜å‚¨ç»“æ„ | æ•°ç»„ |
| æ ¸å¿ƒæ“ä½œ | å‰ç¼€å’ŒæŸ¥è¯¢ã€å•ç‚¹æ›´æ–° |
| æ—¶é—´å¤æ‚åº¦ | æŸ¥è¯¢: O(log n)ï¼Œæ›´æ–°: O(log n) |
| ç©ºé—´å¤æ‚åº¦ | O(n) | ä¸åŸæ•°ç»„å¤§å°ç›¸åŒ |
| ç‰¹ç‚¹ | å®ç°ç®€å•ã€ç©ºé—´æ•ˆç‡é«˜ã€æŸ¥è¯¢æ›´æ–°é«˜æ•ˆ |

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. **é«˜æ•ˆå‰ç¼€å’Œ**ï¼šèƒ½å¤Ÿåœ¨O(log n)æ—¶é—´å†…è®¡ç®—ä»»æ„å‰ç¼€å’Œ
2. **å¿«é€Ÿå•ç‚¹æ›´æ–°**ï¼šæ”¯æŒåœ¨O(log n)æ—¶é—´å†…æ›´æ–°å•ä¸ªå…ƒç´ å€¼
3. **ç©ºé—´é«˜æ•ˆ**ï¼šä»…éœ€ä¸åŸæ•°ç»„ç›¸åŒå¤§å°çš„å­˜å‚¨ç©ºé—´
4. **å®ç°ç®€å•**ï¼šæ ¸å¿ƒæ“ä½œä»…éœ€å‡ è¡Œä»£ç å³å¯å®ç°
5. **ç´¢å¼•ç‰¹æ€§**ï¼šåˆ©ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºè¿›è¡Œåˆ†å±‚ç´¢å¼•ï¼Œé€šè¿‡lowbitæ“ä½œå®šä½ç›¸å…³èŠ‚ç‚¹
6. **åŠŸèƒ½å±€é™**ï¼šåŸç”Ÿä¸æ”¯æŒåŒºé—´æ›´æ–°å’ŒåŒºé—´æœ€å€¼æŸ¥è¯¢
7. **å‰ç¼€å’ŒåŸºç¡€**ï¼šæ‰€æœ‰æ“ä½œå‡åŸºäºå‰ç¼€å’Œè®¡ç®—ï¼Œæ‰©å±•æ€§å¼º

## ğŸ’» ä»£ç å®ç°

### åŸºç¡€æ ‘çŠ¶æ•°ç»„ï¼ˆå‰ç¼€å’Œä¸å•ç‚¹æ›´æ–°ï¼‰
```java
public class FenwickTree {
    private int[] tree;  // æ ‘çŠ¶æ•°ç»„
    private int n;       // æ•°ç»„å¤§å°

    // æ„é€ å‡½æ•°
    public FenwickTree(int size) {
        n = size;
        tree = new int[n + 1];  // æ ‘çŠ¶æ•°ç»„é€šå¸¸ä»1å¼€å§‹ç´¢å¼•
    }

    // æ ¹æ®åŸæ•°ç»„åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„
    public FenwickTree(int[] nums) {
        this(nums.length);
        for (int i = 0; i < nums.length; i++) {
            update(i + 1, nums[i]);  // æ³¨æ„ç´¢å¼•ä»1å¼€å§‹
        }
    }

    // è·å–xçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ€ä½ä½çš„1åŠå…¶åé¢çš„0ç»„æˆçš„æ•°å€¼
    private int lowbit(int x) {
        return x & -x;
    }

    // å•ç‚¹æ›´æ–°ï¼šåœ¨ç´¢å¼•iå¤„å¢åŠ valï¼ˆiä»1å¼€å§‹ï¼‰
    public void update(int i, int val) {
        while (i <= n) {
            tree[i] += val;
            i += lowbit(i);
        }
    }

    // æŸ¥è¯¢å‰ç¼€å’Œï¼šè·å–ä»1åˆ°içš„å’Œï¼ˆiä»1å¼€å§‹ï¼‰
    public int query(int i) {
        int sum = 0;
        while (i > 0) {
            sum += tree[i];
            i -= lowbit(i);
        }
        return sum;
    }

    // æŸ¥è¯¢åŒºé—´å’Œï¼šè·å–ä»låˆ°rçš„å’Œï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public int rangeQuery(int l, int r) {
        // è½¬æ¢ä¸ºæ ‘çŠ¶æ•°ç»„çš„1-basedç´¢å¼•
        return query(r + 1) - query(l);
    }

    // å•ç‚¹æ›´æ–°ï¼šæ›´æ–°åŸæ•°ç»„ç´¢å¼•iå¤„çš„å€¼ï¼ˆä»0å¼€å§‹ï¼‰
    public void pointUpdate(int i, int val) {
        // è½¬æ¢ä¸ºæ ‘çŠ¶æ•°ç»„çš„1-basedç´¢å¼•
        update(i + 1, val);
    }
}
```

### æ ‘çŠ¶æ•°ç»„ï¼ˆæ”¯æŒåŒºé—´æ›´æ–°å’Œå•ç‚¹æŸ¥è¯¢ï¼‰
```java
public class FenwickTreeRangeUpdate {
    private int[] tree;  // æ ‘çŠ¶æ•°ç»„
    private int n;       // æ•°ç»„å¤§å°

    // æ„é€ å‡½æ•°
    public FenwickTreeRangeUpdate(int size) {
        n = size;
        tree = new int[n + 1];
    }

    private int lowbit(int x) {
        return x & -x;
    }

    // å•ç‚¹æ›´æ–°ï¼šåœ¨ç´¢å¼•iå¤„å¢åŠ valï¼ˆiä»1å¼€å§‹ï¼‰
    private void updatePoint(int i, int val) {
        while (i <= n) {
            tree[i] += val;
            i += lowbit(i);
        }
    }

    // åŒºé—´æ›´æ–°ï¼šåœ¨[l, r]èŒƒå›´å†…å¢åŠ valï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public void rangeUpdate(int l, int r, int val) {
        // è½¬æ¢ä¸º1-basedç´¢å¼•
        updatePoint(l + 1, val);
        updatePoint(r + 2, -val);
    }

    // å•ç‚¹æŸ¥è¯¢ï¼šè·å–ç´¢å¼•iå¤„çš„å€¼ï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public int pointQuery(int i) {
        // è½¬æ¢ä¸º1-basedç´¢å¼•å¹¶æŸ¥è¯¢å‰ç¼€å’Œ
        int sum = 0;
        int idx = i + 1;
        while (idx > 0) {
            sum += tree[idx];
            idx -= lowbit(idx);
        }
        return sum;
    }
}
```

### äºŒç»´æ ‘çŠ¶æ•°ç»„
```java
public class TwoDimensionalFenwickTree {
    private int[][] tree;  // äºŒç»´æ ‘çŠ¶æ•°ç»„
    private int rows;      // è¡Œæ•°
    private int cols;      // åˆ—æ•°

    // æ„é€ å‡½æ•°
    public TwoDimensionalFenwickTree(int rows, int cols) {
        this.rows = rows;
        this.cols = cols;
        tree = new int[rows + 1][cols + 1];  // ç´¢å¼•ä»1å¼€å§‹
    }

    private int lowbit(int x) {
        return x & -x;
    }

    // å•ç‚¹æ›´æ–°ï¼šåœ¨(i,j)å¤„å¢åŠ valï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public void update(int i, int j, int val) {
        // è½¬æ¢ä¸º1-basedç´¢å¼•
        int x = i + 1;
        int y = j + 1;
        for (int xi = x; xi <= rows; xi += lowbit(xi)) {
            for (int yj = y; yj <= cols; yj += lowbit(yj)) {
                tree[xi][yj] += val;
            }
        }
    }

    // æŸ¥è¯¢å‰ç¼€å’Œï¼šè·å–(0,0)åˆ°(i,j)çš„çŸ©å½¢åŒºåŸŸå’Œï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public int query(int i, int j) {
        // è½¬æ¢ä¸º1-basedç´¢å¼•
        int x = i + 1;
        int y = j + 1;
        int sum = 0;
        for (int xi = x; xi > 0; xi -= lowbit(xi)) {
            for (int yj = y; yj > 0; yj -= lowbit(yj)) {
                sum += tree[xi][yj];
            }
        }
        return sum;
    }

    // æŸ¥è¯¢åŒºåŸŸå’Œï¼šè·å–(x1,y1)åˆ°(x2,y2)çš„çŸ©å½¢åŒºåŸŸå’Œï¼ˆåŸæ•°ç»„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰
    public int rangeQuery(int x1, int y1, int x2, int y2) {
        return query(x2, y2) - query(x1 - 1, y2) - query(x2, y1 - 1) + query(x1 - 1, y1 - 1);
    }
}
```

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|------------|------------|------|
| åˆå§‹åŒ– | O(n) | O(n) | åŸºäºåŸæ•°ç»„æ„å»ºæ ‘çŠ¶æ•°ç»„ |
| å‰ç¼€å’ŒæŸ¥è¯¢ | O(log n) | O(1) | éœ€è®¿é—®O(log n)ä¸ªèŠ‚ç‚¹ |
| å•ç‚¹æ›´æ–° | O(log n) | O(1) | éœ€æ›´æ–°O(log n)ä¸ªèŠ‚ç‚¹ |
| åŒºé—´æŸ¥è¯¢ | O(log n) | O(1) | ä¸¤ä¸ªå‰ç¼€å’Œä¹‹å·® |
| åŒºé—´æ›´æ–° | O(log n) | O(1) | ä½¿ç”¨å·®åˆ†æ€æƒ³å®ç° |
| äºŒç»´å•ç‚¹æ›´æ–° | O(log n log m) | O(1) | äºŒç»´æƒ…å†µä¸‹çš„å¤æ‚åº¦ |
| äºŒç»´å‰ç¼€å’ŒæŸ¥è¯¢ | O(log n log m) | O(1) | äºŒç»´æƒ…å†µä¸‹çš„å¤æ‚åº¦ |

## ğŸ” åº”ç”¨åœºæ™¯

1. **å‰ç¼€å’Œè®¡ç®—**ï¼šå¿«é€Ÿè®¡ç®—æ•°ç»„çš„å‰ç¼€å’Œã€åŒºé—´å’Œ
2. **é¢‘ç‡ç»Ÿè®¡**ï¼šå¦‚æ•°å­—å‡ºç°æ¬¡æ•°çš„å‰ç¼€å’Œç»Ÿè®¡
3. **é€†åºå¯¹è®¡æ•°**ï¼šåœ¨æ’åºç®—æ³•ä¸­ç»Ÿè®¡é€†åºå¯¹æ•°é‡
4. **èŒƒå›´æ›´æ–°**ï¼šéœ€è¦å¯¹æ•°ç»„æŸåŒºé—´è¿›è¡Œæ›´æ–°å¹¶æŸ¥è¯¢çš„åœºæ™¯
5. **å¤šç»´æ•°æ®å¤„ç†**ï¼šäºŒç»´æ ‘çŠ¶æ•°ç»„å¯ç”¨äºçŸ©é˜µåŒºåŸŸæŸ¥è¯¢
6. **åœ¨çº¿ç®—æ³•**ï¼šéœ€è¦å®æ—¶å¤„ç†åŠ¨æ€æ•°æ®å¹¶å›ç­”æŸ¥è¯¢
7. **è‚¡ç¥¨åˆ†æ**ï¼šè®¡ç®—æŸæ®µæ—¶é—´å†…çš„æ¶¨å¹…å’Œè·Œå¹…
8. **æ’åé—®é¢˜**ï¼šå¦‚è®¡ç®—å­¦ç”Ÿæˆç»©æ’åã€åˆ†æ•°æ®µç»Ÿè®¡
9. **å‹ç¼©ç®—æ³•**ï¼šåœ¨æŸäº›å‹ç¼©ç®—æ³•ä¸­ç”¨äºé¢‘ç‡ç»Ÿè®¡
10. **å›¾å½¢å¤„ç†**ï¼šäºŒç»´æ ‘çŠ¶æ•°ç»„ç”¨äºå›¾åƒå¤„ç†ä¸­çš„åŒºåŸŸè®¡ç®—

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç´¢å¼•ä»1å¼€å§‹**ï¼šæ ‘çŠ¶æ•°ç»„é€šå¸¸ä½¿ç”¨1-basedç´¢å¼•ï¼Œéœ€æ³¨æ„ä¸0-basedåŸæ•°ç»„çš„è½¬æ¢
2. **lowbitæ“ä½œ**ï¼šæ­£ç¡®å®ç°lowbitå‡½æ•°æ˜¯æ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒ
3. **åˆå§‹åŒ–é—®é¢˜**ï¼šæ„å»ºæ ‘çŠ¶æ•°ç»„æ—¶éœ€æ­£ç¡®åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹
4. **æ•°æ®ç±»å‹**ï¼šæ³¨æ„æ•°å€¼æº¢å‡ºé—®é¢˜ï¼Œå¿…è¦æ—¶ä½¿ç”¨longç±»å‹
5. **è¾¹ç•Œæ¡ä»¶**ï¼šå¤„ç†æŸ¥è¯¢å’Œæ›´æ–°æ—¶éœ€æ³¨æ„æ•°ç»„è¾¹ç•Œï¼Œé¿å…è¶Šç•Œ
6. **åŠŸèƒ½å±€é™**ï¼šåŸç”Ÿæ ‘çŠ¶æ•°ç»„ä¸æ”¯æŒåŒºé—´æœ€å€¼æŸ¥è¯¢ï¼Œæ­¤ç±»åœºæ™¯éœ€ä½¿ç”¨çº¿æ®µæ ‘
7. **å¤šç»´æ‰©å±•**ï¼šé«˜ç»´æ ‘çŠ¶æ•°ç»„å®ç°å¤æ‚ï¼Œä¸”æ€§èƒ½éšç»´åº¦å¢åŠ è€Œä¸‹é™
8. **åˆ é™¤æ“ä½œ**ï¼šæ ‘çŠ¶æ•°ç»„ä¸ç›´æ¥æ”¯æŒåˆ é™¤å…ƒç´ ï¼Œéœ€é€šè¿‡ç‰¹æ®Šå¤„ç†å®ç°

## ğŸ“ æœ€ä½³å®è·µ

1. **æ˜ç¡®ä½¿ç”¨åœºæ™¯**ï¼šå‰ç¼€å’Œä¸å•ç‚¹æ›´æ–°åœºæ™¯ä¼˜å…ˆé€‰æ‹©æ ‘çŠ¶æ•°ç»„ï¼ŒåŒºé—´æœ€å€¼åœºæ™¯é€‰æ‹©çº¿æ®µæ ‘
2. **ç´¢å¼•è½¬æ¢å°è£…**ï¼šå°è£…0-basedåˆ°1-basedç´¢å¼•çš„è½¬æ¢ï¼Œé¿å…ä½¿ç”¨é”™è¯¯
3. **æ“ä½œæ¥å£è®¾è®¡**ï¼šæä¾›æ¸…æ™°çš„APIï¼ŒåŒºåˆ†ç‚¹æ›´æ–°/åŒºé—´æ›´æ–°ã€ç‚¹æŸ¥è¯¢/åŒºé—´æŸ¥è¯¢
4. **ç»“åˆå·®åˆ†æ€æƒ³**ï¼šåˆ©ç”¨å·®åˆ†æ‰©å±•æ ‘çŠ¶æ•°ç»„åŠŸèƒ½ï¼Œå®ç°åŒºé—´æ›´æ–°
5. **å†…å­˜ä¼˜åŒ–**ï¼šå¯¹äºå¤§è§„æ¨¡æ•°æ®ï¼Œè€ƒè™‘ä½¿ç”¨ç¨€ç–æ ‘çŠ¶æ•°ç»„
6. **æ€§èƒ½å¯¹æ¯”**ï¼šå°è§„æ¨¡æ•°æ®æˆ–ç®€å•åœºæ™¯ï¼Œæ™®é€šæ•°ç»„å¯èƒ½æ›´é«˜æ•ˆ
7. **æµ‹è¯•è¾¹ç•Œæƒ…å†µ**ï¼šé‡ç‚¹æµ‹è¯•ç©ºæ•°ç»„ã€å•å…ƒç´ ã€å…¨åŒºé—´æ“ä½œç­‰è¾¹ç•Œæƒ…å†µ
8. **æ³¨é‡Šè¯´æ˜**ï¼šä¸ºlowbitæ“ä½œå’Œç´¢å¼•è½¬æ¢ç­‰å…³é”®éƒ¨åˆ†æ·»åŠ è¯¦ç»†æ³¨é‡Š

---

> **å·²å®Œæˆ**ï¼šæœ¬æ–‡æ¡£å·²å®Œå–„ï¼ŒåŒ…å«æ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒæ¦‚å¿µã€Javaå®ç°ä»£ç ï¼ˆåŸºç¡€å®ç°ã€åŒºé—´æ›´æ–°ã€äºŒç»´æ ‘çŠ¶æ•°ç»„ï¼‰ã€å¤æ‚åº¦åˆ†æã€åº”ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µï¼Œå¯ä½œä¸ºæ ‘çŠ¶æ•°ç»„å­¦ä¹ çš„å®Œæ•´å‚è€ƒèµ„æ–™