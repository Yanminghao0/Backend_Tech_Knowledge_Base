# æ ˆï¼ˆStackï¼‰

> åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„çº¿æ€§æ•°æ®ç»“æ„ï¼Œåªèƒ½åœ¨æ ˆé¡¶è¿›è¡Œæ“ä½œ

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **ç±»å‹**: çº¿æ€§æ•°æ®ç»“æ„
- **æ—¶é—´å¤æ‚åº¦**: 
  - å…¥æ ˆï¼ˆpushï¼‰ï¼šO(1)
  - å‡ºæ ˆï¼ˆpopï¼‰ï¼šO(1)
  - æŸ¥çœ‹æ ˆé¡¶ï¼ˆpeekï¼‰ï¼šO(1)
  - æœç´¢ï¼ˆsearchï¼‰ï¼šO(n)
- **ç©ºé—´å¤æ‚åº¦**: O(n)
- **ç‰¹ç‚¹**: 
  - âœ… åè¿›å…ˆå‡ºï¼ˆLIFO - Last In First Outï¼‰
  - âœ… åªèƒ½åœ¨æ ˆé¡¶æ“ä½œ
  - âœ… æ’å…¥åˆ é™¤O(1)
  - âŒ ä¸æ”¯æŒéšæœºè®¿é—®

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. LIFOåŸåˆ™
åè¿›å…ˆå‡ºï¼Œç±»ä¼¼å ç›˜å­ï¼Œæœ€åæ”¾ä¸Šå»çš„æœ€å…ˆæ‹¿ä¸‹æ¥

### 2. å—é™çš„çº¿æ€§è¡¨
åªèƒ½åœ¨æ ˆé¡¶è¿›è¡Œæ’å…¥ï¼ˆpushï¼‰å’Œåˆ é™¤ï¼ˆpopï¼‰æ“ä½œ

### 3. é€’å½’çš„å¤©ç„¶æ•°æ®ç»“æ„
å‡½æ•°è°ƒç”¨æ ˆå°±æ˜¯åŸºäºæ ˆå®ç°çš„

---

## ğŸ’» ä»£ç å®ç°

### 1. æ•°ç»„å®ç°æ ˆ

```java
/**
 * åŸºäºæ•°ç»„çš„æ ˆå®ç°
 */
class ArrayStack {
    private int[] data;
    private int top;      // æ ˆé¡¶æŒ‡é’ˆ
    private int capacity; // æ ˆå®¹é‡
    
    public ArrayStack(int capacity) {
        this.capacity = capacity;
        this.data = new int[capacity];
        this.top = -1; // ç©ºæ ˆæ—¶top=-1
    }
    
    // å…¥æ ˆ
    public void push(int value) {
        if (isFull()) {
            throw new RuntimeException("æ ˆå·²æ»¡");
        }
        data[++top] = value;
    }
    
    // å‡ºæ ˆ
    public int pop() {
        if (isEmpty()) {
            throw new RuntimeException("æ ˆä¸ºç©º");
        }
        return data[top--];
    }
    
    // æŸ¥çœ‹æ ˆé¡¶
    public int peek() {
        if (isEmpty()) {
            throw new RuntimeException("æ ˆä¸ºç©º");
        }
        return data[top];
    }
    
    // åˆ¤æ–­æ ˆç©º
    public boolean isEmpty() {
        return top == -1;
    }
    
    // åˆ¤æ–­æ ˆæ»¡
    public boolean isFull() {
        return top == capacity - 1;
    }
    
    // è·å–æ ˆå¤§å°
    public int size() {
        return top + 1;
    }
}
```

### 2. é“¾è¡¨å®ç°æ ˆ

```java
/**
 * åŸºäºé“¾è¡¨çš„æ ˆå®ç°
 */
class LinkedStack {
    private class Node {
        int val;
        Node next;
        Node(int val) {
            this.val = val;
        }
    }
    
    private Node top;  // æ ˆé¡¶
    private int size;
    
    public LinkedStack() {
        this.top = null;
        this.size = 0;
    }
    
    // å…¥æ ˆ
    public void push(int value) {
        Node newNode = new Node(value);
        newNode.next = top;
        top = newNode;
        size++;
    }
    
    // å‡ºæ ˆ
    public int pop() {
        if (isEmpty()) {
            throw new RuntimeException("æ ˆä¸ºç©º");
        }
        int value = top.val;
        top = top.next;
        size--;
        return value;
    }
    
    // æŸ¥çœ‹æ ˆé¡¶
    public int peek() {
        if (isEmpty()) {
            throw new RuntimeException("æ ˆä¸ºç©º");
        }
        return top.val;
    }
    
    // åˆ¤æ–­æ ˆç©º
    public boolean isEmpty() {
        return top == null;
    }
    
    // è·å–æ ˆå¤§å°
    public int size() {
        return size;
    }
}
```

### 3. Javaå†…ç½®Stack

```java
// Javaå†…ç½®Stackç±»ï¼ˆä¸æ¨èï¼Œå»ºè®®ç”¨Dequeï¼‰
Stack<Integer> stack = new Stack<>();
stack.push(1);
stack.push(2);
int top = stack.pop();  // 2

// âœ… æ¨èï¼šä½¿ç”¨Dequeæ¥å£
Deque<Integer> stack = new ArrayDeque<>();
stack.push(1);
stack.push(2);
int top = stack.pop();  // 2
```

---

## ğŸ“Š ç»å…¸é—®é¢˜

### 1. æ‹¬å·åŒ¹é…

```java
/**
 * LeetCode 20: æœ‰æ•ˆçš„æ‹¬å·
 * åˆ¤æ–­æ‹¬å·å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆ
 */
public boolean isValid(String s) {
    Deque<Character> stack = new ArrayDeque<>();
    
    for (char c : s.toCharArray()) {
        // å·¦æ‹¬å·å…¥æ ˆ
        if (c == '(' || c == '[' || c == '{') {
            stack.push(c);
        } else {
            // å³æ‹¬å·ï¼šæ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (stack.isEmpty()) {
                return false;
            }
            char top = stack.pop();
            if ((c == ')' && top != '(') ||
                (c == ']' && top != '[') ||
                (c == '}' && top != '{')) {
                return false;
            }
        }
    }
    
    return stack.isEmpty(); // æ ˆåº”ä¸ºç©º
}
```

### 2. æœ€å°æ ˆ

```java
/**
 * LeetCode 155: æœ€å°æ ˆ
 * æ”¯æŒO(1)æ—¶é—´è·å–æœ€å°å€¼çš„æ ˆ
 */
class MinStack {
    private Deque<Integer> dataStack;  // æ•°æ®æ ˆ
    private Deque<Integer> minStack;   // æœ€å°å€¼æ ˆ
    
    public MinStack() {
        dataStack = new ArrayDeque<>();
        minStack = new ArrayDeque<>();
    }
    
    public void push(int val) {
        dataStack.push(val);
        
        // æ›´æ–°æœ€å°å€¼æ ˆ
        if (minStack.isEmpty() || val <= minStack.peek()) {
            minStack.push(val);
        }
    }
    
    public void pop() {
        int val = dataStack.pop();
        
        // å¦‚æœå¼¹å‡ºçš„æ˜¯æœ€å°å€¼ï¼Œæœ€å°å€¼æ ˆä¹Ÿå¼¹å‡º
        if (!minStack.isEmpty() && val == minStack.peek()) {
            minStack.pop();
        }
    }
    
    public int top() {
        return dataStack.peek();
    }
    
    public int getMin() {
        return minStack.peek();
    }
}
```

### 3. å•è°ƒæ ˆ

#### (1) ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ 

```java
/**
 * LeetCode 496: ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I
 * æ‰¾åˆ°æ¯ä¸ªå…ƒç´ å³ä¾§ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ 
 */
public int[] nextGreaterElement(int[] nums) {
    int n = nums.length;
    int[] result = new int[n];
    Arrays.fill(result, -1);
    
    Deque<Integer> stack = new ArrayDeque<>(); // å•è°ƒé€’å‡æ ˆï¼ˆå­˜ç´¢å¼•ï¼‰
    
    for (int i = 0; i < n; i++) {
        // å½“å‰å…ƒç´ æ¯”æ ˆé¡¶å¤§ï¼Œæ ˆé¡¶å…ƒç´ æ‰¾åˆ°äº†ç­”æ¡ˆ
        while (!stack.isEmpty() && nums[i] > nums[stack.peek()]) {
            int idx = stack.pop();
            result[idx] = nums[i];
        }
        stack.push(i);
    }
    
    return result;
}
```

#### (2) æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢

```java
/**
 * LeetCode 84: æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢
 * å•è°ƒæ ˆç»å…¸åº”ç”¨
 */
public int largestRectangleArea(int[] heights) {
    int n = heights.length;
    Deque<Integer> stack = new ArrayDeque<>();
    int maxArea = 0;
    
    for (int i = 0; i <= n; i++) {
        int h = (i == n) ? 0 : heights[i];
        
        // å½“å‰é«˜åº¦å°äºæ ˆé¡¶ï¼Œè®¡ç®—æ ˆé¡¶èƒ½å½¢æˆçš„æœ€å¤§é¢ç§¯
        while (!stack.isEmpty() && h < heights[stack.peek()]) {
            int height = heights[stack.pop()];
            int width = stack.isEmpty() ? i : i - stack.peek() - 1;
            maxArea = Math.max(maxArea, height * width);
        }
        
        stack.push(i);
    }
    
    return maxArea;
}
```

### 4. è¡¨è¾¾å¼æ±‚å€¼

```java
/**
 * LeetCode 224: åŸºæœ¬è®¡ç®—å™¨
 * è®¡ç®—åŒ…å« +, -, (, ) çš„è¡¨è¾¾å¼
 */
public int calculate(String s) {
    Deque<Integer> stack = new ArrayDeque<>();
    int result = 0;
    int number = 0;
    int sign = 1;  // 1è¡¨ç¤ºæ­£å·ï¼Œ-1è¡¨ç¤ºè´Ÿå·
    
    for (char c : s.toCharArray()) {
        if (Character.isDigit(c)) {
            number = number * 10 + (c - '0');
        } else if (c == '+') {
            result += sign * number;
            number = 0;
            sign = 1;
        } else if (c == '-') {
            result += sign * number;
            number = 0;
            sign = -1;
        } else if (c == '(') {
            // é‡åˆ°å·¦æ‹¬å·ï¼Œä¿å­˜å½“å‰ç»“æœå’Œç¬¦å·
            stack.push(result);
            stack.push(sign);
            result = 0;
            sign = 1;
        } else if (c == ')') {
            // é‡åˆ°å³æ‹¬å·ï¼Œè®¡ç®—æ‹¬å·å†…ç»“æœ
            result += sign * number;
            number = 0;
            result *= stack.pop();  // å¼¹å‡ºæ‹¬å·å‰çš„ç¬¦å·
            result += stack.pop();  // åŠ ä¸Šæ‹¬å·å‰çš„ç»“æœ
        }
    }
    
    result += sign * number;
    return result;
}
```

### 5. æ¯æ—¥æ¸©åº¦

```java
/**
 * LeetCode 739: æ¯æ—¥æ¸©åº¦
 * æ‰¾åˆ°ä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦éœ€è¦ç­‰å¾…çš„å¤©æ•°
 */
public int[] dailyTemperatures(int[] temperatures) {
    int n = temperatures.length;
    int[] result = new int[n];
    Deque<Integer> stack = new ArrayDeque<>(); // å•è°ƒæ ˆå­˜å‚¨ç´¢å¼•
    
    for (int i = 0; i < n; i++) {
        // å½“å‰æ¸©åº¦é«˜äºæ ˆé¡¶æ¸©åº¦
        while (!stack.isEmpty() && temperatures[i] > temperatures[stack.peek()]) {
            int idx = stack.pop();
            result[idx] = i - idx; // ç­‰å¾…å¤©æ•°
        }
        stack.push(i);
    }
    
    return result;
}
```

---

## ğŸ” åº”ç”¨åœºæ™¯

### 1. ç¨‹åºæ‰§è¡Œ
- **å‡½æ•°è°ƒç”¨æ ˆ**: ä¿å­˜å‡½æ•°è°ƒç”¨å…³ç³»
- **é€’å½’å®ç°**: é€’å½’æœ¬è´¨æ˜¯æ ˆ
- **ä¸­æ–­å¤„ç†**: ä¿å­˜CPUçŠ¶æ€

### 2. è¡¨è¾¾å¼å¤„ç†
- **è¡¨è¾¾å¼æ±‚å€¼**: ä¸­ç¼€è½¬åç¼€
- **æ‹¬å·åŒ¹é…**: ç¼–è¯‘å™¨è¯­æ³•æ£€æŸ¥
- **è®¡ç®—å™¨å®ç°**: å››åˆ™è¿ç®—

### 3. æµè§ˆå™¨åŠŸèƒ½
- **å‰è¿›åé€€**: å†å²è®°å½•æ ˆ
- **æ’¤é”€é‡åš**: Undo/Redoæ ˆ

### 4. ç®—æ³•åº”ç”¨
- **æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰**: æ˜¾å¼æ ˆæˆ–é€’å½’
- **å•è°ƒæ ˆ**: è§£å†³åŒºé—´æœ€å€¼é—®é¢˜
- **å›æº¯ç®—æ³•**: ä¿å­˜çŠ¶æ€

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ ˆç©º/æ ˆæ»¡æ£€æŸ¥

```java
// âŒ é”™è¯¯ï¼šæœªæ£€æŸ¥æ ˆç©º
public int pop() {
    return stack.pop(); // å¯èƒ½æŠ›å¼‚å¸¸
}

// âœ… æ­£ç¡®ï¼šå…ˆæ£€æŸ¥
public int pop() {
    if (isEmpty()) {
        throw new EmptyStackException();
    }
    return stack.pop();
}
```

### 2. Java Stack vs Deque

```java
// âŒ ä¸æ¨èï¼šStackæ˜¯é—ç•™ç±»ï¼ŒåŸºäºVectorï¼ˆçº¿ç¨‹å®‰å…¨ä½†æ…¢ï¼‰
Stack<Integer> stack = new Stack<>();

// âœ… æ¨èï¼šä½¿ç”¨Dequeæ¥å£
Deque<Integer> stack = new ArrayDeque<>();
```

### 3. å•è°ƒæ ˆçš„ç»´æŠ¤

```java
// å•è°ƒé€’å¢æ ˆï¼šæ ˆåº•åˆ°æ ˆé¡¶é€’å¢
while (!stack.isEmpty() && nums[i] < nums[stack.peek()]) {
    stack.pop();
}
stack.push(i);

// å•è°ƒé€’å‡æ ˆï¼šæ ˆåº•åˆ°æ ˆé¡¶é€’å‡
while (!stack.isEmpty() && nums[i] > nums[stack.peek()]) {
    stack.pop();
}
stack.push(i);
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„å®ç°

```java
// å›ºå®šå¤§å° â†’ æ•°ç»„å®ç°
ArrayStack stack = new ArrayStack(100);

// åŠ¨æ€å¤§å° â†’ é“¾è¡¨å®ç°æˆ–ArrayDeque
Deque<Integer> stack = new ArrayDeque<>();
```

### 2. è¾…åŠ©æ ˆæŠ€å·§
ä½¿ç”¨è¾…åŠ©æ ˆä¿å­˜é¢å¤–ä¿¡æ¯ï¼ˆå¦‚æœ€å°æ ˆï¼‰

### 3. å•è°ƒæ ˆæ¨¡æ¿

```java
// å•è°ƒæ ˆé€šç”¨æ¨¡æ¿
Deque<Integer> stack = new ArrayDeque<>();
for (int i = 0; i < n; i++) {
    while (!stack.isEmpty() && compare(nums[i], nums[stack.peek()])) {
        int idx = stack.pop();
        // å¤„ç†é€»è¾‘ï¼šidxä½ç½®æ‰¾åˆ°äº†ç­”æ¡ˆ
    }
    stack.push(i);
}
```

### 4. è¡¨è¾¾å¼æ±‚å€¼æŠ€å·§
- ä¸­ç¼€è¡¨è¾¾å¼ â†’ åç¼€è¡¨è¾¾å¼ï¼ˆé€†æ³¢å…°è¡¨ç¤ºæ³•ï¼‰
- ä½¿ç”¨åŒæ ˆï¼šæ•°å­—æ ˆ + è¿ç®—ç¬¦æ ˆ

---

## ğŸ”— ç›¸å…³ä¸»é¢˜

- [é˜Ÿåˆ—](./04_é˜Ÿåˆ—.md) - å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„
- [æ•°ç»„](./01_æ•°ç»„.md) - æ ˆçš„åº•å±‚å®ç°
- [é“¾è¡¨](./02_é“¾è¡¨.md) - æ ˆçš„å¦ä¸€ç§å®ç°
- [æ·±åº¦ä¼˜å…ˆæœç´¢](../å›¾è®ºç®—æ³•/01_DFSæ·±åº¦ä¼˜å…ˆæœç´¢.md) - æ ˆçš„åº”ç”¨
- [å›æº¯ç®—æ³•](../å›æº¯ç®—æ³•/README.md) - åŸºäºæ ˆçš„ç®—æ³•

---

> **å­¦ä¹ å»ºè®®**ï¼šæ ˆæ˜¯éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼ŒåŠ¡å¿…æŒæ¡å•è°ƒæ ˆå’Œè¡¨è¾¾å¼æ±‚å€¼ä¸¤å¤§æ ¸å¿ƒåº”ç”¨
