# è·³è¡¨

è·³è¡¨ï¼ˆSkip Listï¼‰æ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œç”±William Pughäº1989å¹´æå‡ºï¼Œå®ƒé€šè¿‡åœ¨æœ‰åºé“¾è¡¨çš„åŸºç¡€ä¸Šå¢åŠ å¤šçº§ç´¢å¼•ï¼Œå®ç°äº†ç±»ä¼¼äºå¹³è¡¡æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡ï¼ŒåŒæ—¶å…·æœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ã€‚è·³è¡¨ç‰¹åˆ«é€‚åˆéœ€è¦å¿«é€Ÿè®¿é—®æœ‰åºå…ƒç´ çš„åœºæ™¯ï¼Œæ˜¯Redisæœ‰åºé›†åˆï¼ˆSorted Setï¼‰çš„æ ¸å¿ƒå®ç°ä¹‹ä¸€ã€‚

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| æ•°æ®ç»“æ„ç±»å‹ | æœ‰åºé“¾è¡¨çš„æ‰©å±•ï¼ŒéšæœºåŒ–æ•°æ®ç»“æ„ |
| å­˜å‚¨ç»“æ„ | é“¾è¡¨+å¤šçº§ç´¢å¼• |
| æ ¸å¿ƒæ“ä½œ | æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ã€èŒƒå›´æŸ¥è¯¢ |
| æ—¶é—´å¤æ‚åº¦ | å¹³å‡ï¼šO(log n)ï¼Œæœ€åï¼šO(n) |
| ç©ºé—´å¤æ‚åº¦ | O(n) |
| ç‰¹ç‚¹ | å®ç°ç®€å•ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒéšæœºåŒ–å¹³è¡¡æœºåˆ¶ |

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. **åˆ†å±‚ç´¢å¼•**ï¼šé€šè¿‡æ„å»ºå¤šå±‚ç´¢å¼•ç»“æ„ï¼Œå®ç°"è·³è·ƒå¼"æŸ¥æ‰¾ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡

2. **éšæœºåŒ–å¹³è¡¡**ï¼šæ’å…¥å…ƒç´ æ—¶éšæœºç”Ÿæˆå±‚æ•°ï¼Œé¿å…æ‰‹åŠ¨å¹³è¡¡æ“ä½œï¼Œç®€åŒ–å®ç°

3. **æœ‰åºæ€§**ï¼šåº•å±‚é“¾è¡¨ä¿æŒæœ‰åºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºæ“ä½œ

4. **åŠ¨æ€æ€§**ï¼šæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæ— éœ€åƒå¹³è¡¡æ ‘é‚£æ ·è¿›è¡Œå¤æ‚çš„æ—‹è½¬

5. **ç©ºé—´æ•ˆç‡**ï¼šå¹³å‡ç©ºé—´å¤æ‚åº¦ä¸ºO(n)ï¼Œè¿œä¼˜äºæŸäº›å¹³è¡¡æ ‘ç»“æ„

6. **å¹¶å‘å‹å¥½**ï¼šç›¸æ¯”å¹³è¡¡æ ‘ï¼Œæ›´å®¹æ˜“å®ç°å¹¶å‘æ“ä½œæ”¯æŒ

7. **èŒƒå›´æŸ¥è¯¢**ï¼šæ”¯æŒé«˜æ•ˆçš„åŒºé—´æŸ¥è¯¢ï¼Œå¦‚æŸ¥æ‰¾æŸä¸ªèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ 

## ğŸ’» ä»£ç å®ç°

### 1. è·³è¡¨èŠ‚ç‚¹å®šä¹‰
```java
public class SkipListNode<T> {
    int key;
    T value;
    SkipListNode<T>[] forward; // å‰è¿›æŒ‡é’ˆæ•°ç»„
    int level; // å½“å‰èŠ‚ç‚¹çš„å±‚æ•°

    @SuppressWarnings("unchecked")
    public SkipListNode(int key, T value, int level) {
        this.key = key;
        this.value = value;
        this.level = level;
        this.forward = new SkipListNode[level];
    }
}
```

### 2. è·³è¡¨æ ¸å¿ƒå®ç°
```java
import java.util.Random;

public class SkipList<T> {
    private static final int MAX_LEVEL = 16; // æœ€å¤§å±‚æ•°
    private static final double P = 0.5; // éšæœºå±‚æ•°æ¦‚ç‡
    private int level; // å½“å‰è·³è¡¨çš„æœ€é«˜å±‚æ•°
    private SkipListNode<T> header; // å¤´èŠ‚ç‚¹
    private Random random; // éšæœºæ•°ç”Ÿæˆå™¨

    @SuppressWarnings("unchecked")
    public SkipList() {
        level = 1;
        header = new SkipListNode<>(0, null, MAX_LEVEL);
        random = new Random();
    }

    // éšæœºç”ŸæˆèŠ‚ç‚¹å±‚æ•°
    private int randomLevel() {
        int l = 1;
        while (random.nextDouble() < P && l < MAX_LEVEL) {
            l++;
        }
        return l;
    }

    // æ’å…¥èŠ‚ç‚¹
    public void insert(int key, T value) {
        SkipListNode<T>[] update = new SkipListNode[MAX_LEVEL];
        SkipListNode<T> current = header;

        // ä»æœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾ï¼Œè®°å½•æ¯ä¸€å±‚çš„å‰é©±èŠ‚ç‚¹
        for (int i = level - 1; i >= 0; i--) {
            while (current.forward[i] != null && current.forward[i].key < key) {
                current = current.forward[i];
            }
            update[i] = current;
        }

        // ç”Ÿæˆæ–°èŠ‚ç‚¹çš„éšæœºå±‚æ•°
        int newLevel = randomLevel();

        // å¦‚æœæ–°èŠ‚ç‚¹çš„å±‚æ•°é«˜äºå½“å‰è·³è¡¨çš„å±‚æ•°
        if (newLevel > level) {
            for (int i = level; i < newLevel; i++) {
                update[i] = header;
            }
            level = newLevel;
        }

        // åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥
        SkipListNode<T> newNode = new SkipListNode<>(key, value, newLevel);
        for (int i = 0; i < newLevel; i++) {
            newNode.forward[i] = update[i].forward[i];
            update[i].forward[i] = newNode;
        }
    }

    // æŸ¥æ‰¾èŠ‚ç‚¹
    public T search(int key) {
        SkipListNode<T> current = header;

        // ä»æœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾
        for (int i = level - 1; i >= 0; i--) {
            while (current.forward[i] != null && current.forward[i].key < key) {
                current = current.forward[i];
            }
        }

        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ£€æŸ¥æ˜¯å¦æ‰¾åˆ°
        current = current.forward[0];
        if (current != null && current.key == key) {
            return current.value;
        }
        return null;
    }

    // åˆ é™¤èŠ‚ç‚¹
    public boolean delete(int key) {
        SkipListNode<T>[] update = new SkipListNode[MAX_LEVEL];
        SkipListNode<T> current = header;

        // ä»æœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾ï¼Œè®°å½•æ¯ä¸€å±‚çš„å‰é©±èŠ‚ç‚¹
        for (int i = level - 1; i >= 0; i--) {
            while (current.forward[i] != null && current.forward[i].key < key) {
                current = current.forward[i];
            }
            update[i] = current;
        }

        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥èŠ‚ç‚¹
        current = current.forward[0];
        if (current == null || current.key != key) {
            return false; // èŠ‚ç‚¹ä¸å­˜åœ¨
        }

        // åˆ é™¤èŠ‚ç‚¹åœ¨å„å±‚çš„å¼•ç”¨
        for (int i = 0; i < level; i++) {
            if (update[i].forward[i] != current) {
                break;
            }
            update[i].forward[i] = current.forward[i];
        }

        // æ›´æ–°è·³è¡¨çš„æœ€é«˜å±‚æ•°
        while (level > 1 && header.forward[level - 1] == null) {
            level--;
        }
        return true;
    }

    // èŒƒå›´æŸ¥è¯¢ [start, end]
    public void rangeQuery(int start, int end) {
        SkipListNode<T> current = header.forward[0];
        System.out.println("Range query [" + start + ", " + end + "] results:");

        while (current != null) {
            if (current.key >= start && current.key <= end) {
                System.out.println("Key: " + current.key + ", Value: " + current.value);
            } else if (current.key > end) {
                break;
            }
            current = current.forward[0];
        }
    }
}
```

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æ“ä½œ | å¹³å‡æ—¶é—´å¤æ‚åº¦ | æœ€åæ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ |
|------|--------------|--------------|------------|
| æ’å…¥ | O(log n)     | O(n)         | O(n)       |
| åˆ é™¤ | O(log n)     | O(n)         | O(n)       |
| æŸ¥æ‰¾ | O(log n)     | O(n)         | O(1)       |
| èŒƒå›´æŸ¥è¯¢ | O(log n + k) | O(n)         | O(k)       |
| æ„å»º | O(n log n)   | O(nÂ²)        | O(n log n) |

> æ³¨ï¼š
> - kè¡¨ç¤ºèŒƒå›´æŸ¥è¯¢ç»“æœä¸­çš„å…ƒç´ æ•°é‡
> - ç©ºé—´å¤æ‚åº¦ä¸»è¦æ¥è‡ªç´¢å¼•èŠ‚ç‚¹ï¼Œå¹³å‡ä¸ºO(n)ï¼Œæœ€åä¸ºO(n log n)
> - éšæœºåŒ–å±‚æ•°ä½¿å¾—å®é™…åº”ç”¨ä¸­æ¥è¿‘å¹³å‡å¤æ‚åº¦

## ğŸ” åº”ç”¨åœºæ™¯

1. **æ•°æ®åº“ç´¢å¼•**ï¼š
   - Redisçš„æœ‰åºé›†åˆ(Sorted Set)åº•å±‚å®ç°
   - LevelDBã€RocksDBç­‰å­˜å‚¨å¼•æ“ä½¿ç”¨è·³è¡¨ä½œä¸ºæ ¸å¿ƒç´¢å¼•ç»“æ„

2. **å†…å­˜æ•°æ®åº“**ï¼š
   - é€‚åˆæ„å»ºå†…å­˜ä¸­çš„æœ‰åºæ•°æ®ç»“æ„
   - æ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’ŒåŠ¨æ€æ›´æ–°

3. **å¹¶å‘æ•°æ®ç»“æ„**ï¼š
   - ç›¸æ¯”å¹³è¡¡æ ‘æ›´å®¹æ˜“å®ç°å¹¶å‘æ“ä½œ
   - å¯ç”¨äºå®ç°æ— é”æ•°æ®ç»“æ„

4. **è·¯ç”±è¡¨**ï¼š
   - ç½‘ç»œè·¯ç”±ä¸­çš„å‰ç¼€åŒ¹é…
   - IPè·¯ç”±è¡¨æŸ¥æ‰¾

5. **æœç´¢å¼•æ“**ï¼š
   - å€’æ’ç´¢å¼•ä¸­çš„æœ‰åºåˆ—è¡¨
   - æ–‡æ¡£è¯„åˆ†æ’åº

6. **å®æ—¶æ’è¡Œæ¦œ**ï¼š
   - æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œ
   - ç¤¾äº¤åª’ä½“çƒ­åº¦æ¦œå•

7. **åŒºé—´æŸ¥è¯¢ç³»ç»Ÿ**ï¼š
   - æ—¶é—´åºåˆ—æ•°æ®æŸ¥è¯¢
   - åœ°ç†ä½ç½®èŒƒå›´æœç´¢

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å±‚æ•°è®¾è®¡**ï¼š
   - æœ€å¤§å±‚æ•°å’Œæ¦‚ç‡Pçš„é€‰æ‹©ä¼šå½±å“æ€§èƒ½
   - é€šå¸¸æœ€å¤§å±‚æ•°è®¾ä¸º16ï¼Œæ¦‚ç‡Pè®¾ä¸º0.5

2. **éšæœºåŒ–é£é™©**ï¼š
   - è™½ç„¶æ¦‚ç‡æä½ï¼Œä½†ä»å¯èƒ½å‡ºç°æœ€åæƒ…å†µ
   - å®é™…åº”ç”¨ä¸­å¯è®¾ç½®æœ€å¤§å±‚æ•°ä¸Šé™é¿å…æç«¯æƒ…å†µ

3. **å®ç°å¤æ‚åº¦**ï¼š
   - ç›¸æ¯”æ™®é€šé“¾è¡¨å¤æ‚ï¼Œä½†è¿œä½äºå¹³è¡¡æ ‘
   - éœ€è¦æ³¨æ„å¤„ç†å„å±‚æŒ‡é’ˆçš„æ­£ç¡®ç»´æŠ¤

4. **å†…å­˜å ç”¨**ï¼š
   - ç´¢å¼•ä¼šå ç”¨é¢å¤–å†…å­˜ï¼Œå¹³å‡ä¸ºæ•°æ®é‡çš„1.5-2å€
   - ç©ºé—´æ•æ„Ÿåœºæ™¯éœ€è°¨æ…ä½¿ç”¨

5. **æœ‰åºæ€§è¦æ±‚**ï¼š
   - å¿…é¡»æ˜¯æœ‰åºæ•°æ®é›†åˆï¼Œä¸é€‚åˆæ— åºæ•°æ®
   - é”®éœ€è¦æ”¯æŒæ¯”è¾ƒæ“ä½œ

6. **åˆ é™¤æ“ä½œ**ï¼š
   - åˆ é™¤åéœ€æ›´æ–°è·³è¡¨çš„æœ€é«˜å±‚æ•°
   - é¿å…å‡ºç°"æ‚¬ç©ºæŒ‡é’ˆ"é—®é¢˜

7. **å¹¶å‘å¤„ç†**ï¼š
   - åŸºæœ¬å®ç°ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
   - å¤šçº¿ç¨‹ç¯å¢ƒéœ€æ·»åŠ åŒæ­¥æœºåˆ¶

8. **é€‚ç”¨åœºæ™¯**ï¼š
   - ä¸é€‚åˆé¢‘ç¹ä¿®æ”¹æœ€å¤§å±‚æ•°çš„åœºæ™¯
   - å°è§„æ¨¡æ•°æ®å¯èƒ½ä¸å¦‚æ™®é€šé“¾è¡¨é«˜æ•ˆ

## ğŸ“ æœ€ä½³å®è·µ

1. **å‚æ•°è°ƒä¼˜**ï¼š
   - æ ¹æ®æ•°æ®è§„æ¨¡è°ƒæ•´MAX_LEVELå’ŒPå€¼
   - æ•°æ®é‡å¤§æ—¶å¯é€‚å½“å¢å¤§MAX_LEVEL

2. **å†…å­˜ä¼˜åŒ–**ï¼š
   - å¯¹äºç©ºé—´æ•æ„Ÿåº”ç”¨ï¼Œå¯é™ä½På€¼å‡å°‘å±‚æ•°
   - è€ƒè™‘ä½¿ç”¨å‹ç¼©æŒ‡é’ˆæˆ–ç¨€ç–è¡¨ç¤º

3. **å®ç°æŠ€å·§**ï¼š
   - ä½¿ç”¨å¤´èŠ‚ç‚¹ç®€åŒ–è¾¹ç•Œæ¡ä»¶å¤„ç†
   - æå–å…¬å…±æ“ä½œï¼ˆå¦‚æŸ¥æ‰¾å‰é©±èŠ‚ç‚¹ï¼‰ä¸ºè¾…åŠ©æ–¹æ³•

4. **å¹¶å‘å®ç°**ï¼š
   - é‡‡ç”¨æ— é”è®¾è®¡æˆ–ç»†ç²’åº¦é”æé«˜å¹¶å‘æ€§
   - å‚è€ƒRedisçš„è·³è¡¨å¹¶å‘å®ç°

5. **æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - èŒƒå›´æŸ¥è¯¢æ—¶ä»åº•å±‚é“¾è¡¨éå†æ•ˆç‡æ›´é«˜
   - é¢‘ç¹æŸ¥è¯¢çš„çƒ­ç‚¹æ•°æ®å¯è€ƒè™‘ç¼“å­˜

6. **æ•°æ®ç±»å‹**ï¼š
   - é”®ç±»å‹åº”æ”¯æŒè‡ªç„¶æ’åº
   - å¤æ‚å¯¹è±¡å»ºè®®ä½¿ç”¨ä»£ç†é”®

7. **æµ‹è¯•ç­–ç•¥**ï¼š
   - æµ‹è¯•ä¸åŒæ•°æ®åˆ†å¸ƒä¸‹çš„æ€§èƒ½
   - éªŒè¯æç«¯æƒ…å†µä¸‹çš„ç¨³å®šæ€§

8. **æ›¿ä»£æ–¹æ¡ˆè¯„ä¼°**ï¼š
   - å¯¹æ¯”å¹³è¡¡æ ‘ã€Bæ ‘ç­‰ç»“æ„é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
   - è¯»å¤šå†™å°‘åœºæ™¯ä¼˜å…ˆè€ƒè™‘è·³è¡¨

---

> **å®ŒæˆçŠ¶æ€**ï¼šæœ¬æ–‡æ¡£å·²å®Œå–„è·³è¡¨çš„åŸºæœ¬æ¦‚å¿µã€Javaå®ç°ä»£ç ã€å¤æ‚åº¦åˆ†æã€åº”ç”¨åœºæ™¯ã€æ³¨æ„äº‹é¡¹åŠæœ€ä½³å®è·µï¼Œæ¶µç›–è·³è¡¨çš„æ ¸å¿ƒåŸç†å’Œå®ç°ç»†èŠ‚ï¼Œå¯ä½œä¸ºè·³è¡¨æ•°æ®ç»“æ„çš„å®Œæ•´å­¦ä¹ å‚è€ƒã€‚