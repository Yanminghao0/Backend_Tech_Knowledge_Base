# æ•°ä½DP

> æ•°ä½åŠ¨æ€è§„åˆ’æ˜¯ä¸“é—¨è§£å†³æ•°å­—è®¡æ•°é—®é¢˜çš„åŠ¨æ€è§„åˆ’æ–¹æ³•ï¼Œé€šè¿‡æŒ‰ä½å¤„ç†å¹¶è®°å½•çŠ¶æ€æ¥ç»Ÿè®¡æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ•°å­—æ•°é‡

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **å®šä¹‰**ï¼šé’ˆå¯¹æ•°å­—åºåˆ—ç‰¹æ€§è®¾è®¡çš„åŠ¨æ€è§„åˆ’æ–¹æ³•ï¼Œé€šè¿‡æŒ‰ä½å¤„ç†å¹¶è®°å½•çŠ¶æ€æ¥è§£å†³æ•°å­—è®¡æ•°é—®é¢˜
- **æ ¸å¿ƒç‰¹å¾**ï¼šå°†æ•°å­—æŒ‰ä½åˆ†è§£å¤„ç†ï¼Œè®°å½•å‰å‡ ä½çš„çŠ¶æ€ä¿¡æ¯ï¼Œé¿å…é‡å¤è®¡ç®—
- **é€‚ç”¨åœºæ™¯**ï¼šæ•°å­—èŒƒå›´è®¡æ•°ã€æ•°å­—ç‰¹å¾ç»Ÿè®¡ã€å¯†ç å­¦åˆ†æç­‰é¢†åŸŸ
- **æ—¶é—´å¤æ‚åº¦**ï¼šO(nÃ—kÃ—m)ï¼Œå…¶ä¸­nä¸ºæ•°å­—ä½æ•°ï¼Œkä¸ºçŠ¶æ€æ•°é‡ï¼Œmä¸ºçº¦æŸæ¡ä»¶æ•°é‡
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(nÃ—k)ï¼Œä¸»è¦ç”¨äºå­˜å‚¨å„ä½æ•°å­—çš„çŠ¶æ€

## ğŸ¯ é—®é¢˜åˆ†æ

### é€‚ç”¨åœºæ™¯
æ•°ä½DPé€‚ç”¨äºè§£å†³å…·æœ‰ä»¥ä¸‹ç‰¹å¾çš„é—®é¢˜ï¼š
1. **æ•°å­—è®¡æ•°é—®é¢˜**ï¼šå¦‚ç»Ÿè®¡[L,R]åŒºé—´å†…æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ•°å­—ä¸ªæ•°
2. **æ•°å­—ç‰¹å¾é—®é¢˜**ï¼šå¦‚ç»Ÿè®¡æ•°å­—ä¸­ä¸å«ç‰¹å®šæ•°ç ã€å„ä½ä¹‹å’Œç­‰äºç‰¹å®šå€¼çš„æ•°å­—
3. **æ•°å­—çº¦æŸé—®é¢˜**ï¼šå¦‚ç»Ÿè®¡ä¸åŒ…å«è¿ç»­ç›¸åŒæ•°å­—ã€ä¸¥æ ¼é€’å¢çš„æ•°å­—
4. **å¯†ç å­¦é—®é¢˜**ï¼šå¦‚å¼±å¯†ç æ£€æµ‹ã€æ•°å­—å¯†ç å¼ºåº¦åˆ†æ
5. **æ•°å€¼è®¡ç®—é—®é¢˜**ï¼šå¦‚è®¡ç®—æ•°å­—å„ä½ä¹˜ç§¯ã€æ•°å­—åè½¬ç­‰ç‰¹æ®Šè¿ç®—

### æ ¸å¿ƒæŠ€æœ¯
1. **æŒ‰ä½å¤„ç†**ï¼šå°†æ•°å­—åˆ†è§£ä¸ºä¸ªä½ã€åä½ã€ç™¾ä½ç­‰é€ä½å¤„ç†
2. **çŠ¶æ€è®°å¿†**ï¼šè®°å½•å‰å‡ ä½çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æ•°å­—å’Œã€å‰ä¸€ä½æ•°å­—ã€æ˜¯å¦å—é™ç­‰
3. **è¾¹ç•Œå¤„ç†**ï¼šå¤„ç†æ•°å­—çš„ä¸Šä¸‹è¾¹ç•Œçº¦æŸ
4. **å‰å¯¼é›¶å¤„ç†**ï¼šç‰¹æ®Šå¤„ç†æ•°å­—å‰çš„æ— æ•ˆé›¶
5. **è®°å¿†åŒ–æœç´¢**ï¼šä½¿ç”¨é€’å½’+è®°å¿†åŒ–å®ç°çŠ¶æ€è½¬ç§»

## ğŸ’» ä»£ç å®ç°

### 1. æ•°å­—1çš„ä¸ªæ•°
```java
public int countDigitOne(int n) {
    if (n <= 0) return 0;
    char[] digits = String.valueOf(n).toCharArray();
    int len = digits.length;
    // è®°å¿†åŒ–ç¼“å­˜: dp[pos][count][limit][leadingZero]
    Integer[][][][] dp = new Integer[len][len+1][2][2];
    return dfs(digits, 0, 0, 1, 1, dp);
}

// pos: å½“å‰å¤„ç†ä½
// count: 1çš„ä¸ªæ•°
// limit: æ˜¯å¦å—ä¸Šç•Œé™åˆ¶(0:ä¸å—é™, 1:å—é™)
// leadingZero: æ˜¯å¦æœ‰å‰å¯¼é›¶(0:æ— , 1:æœ‰)
private int dfs(char[] digits, int pos, int count, int limit, int leadingZero, Integer[][][][] dp) {
    if (pos == digits.length) {
        return leadingZero == 1 ? 0 : count;
    }
    if (dp[pos][count][limit][leadingZero] != null) {
        return dp[pos][count][limit][leadingZero];
    }
    
    int upper = limit == 1 ? digits[pos] - '0' : 9;
    int res = 0;
    
    for (int d = 0; d <= upper; d++) {
        int newLimit = (limit == 1 && d == upper) ? 1 : 0;
        int newLeadingZero = (leadingZero == 1 && d == 0) ? 1 : 0;
        int newCount = count;
        
        if (newLeadingZero == 0) {
            newCount += (d == 1) ? 1 : 0;
        }
        
        res += dfs(digits, pos+1, newCount, newLimit, newLeadingZero, dp);
    }
    
    dp[pos][count][limit][leadingZero] = res;
    return res;
}
```

### 2. ä¸å«è¿ç»­æ•°å­—çš„æ•°å­—ä¸ªæ•°
```java
public int countNumbersWithoutConsecutiveDigits(int n) {
    if (n < 0) return 0;
    char[] digits = String.valueOf(n).toCharArray();
    int len = digits.length;
    // dp[pos][prev][limit][leadingZero]
    Integer[][][][] dp = new Integer[len][10][2][2];
    return dfs(digits, 0, -1, 1, 1, dp);
}

private int dfs(char[] digits, int pos, int prev, int limit, int leadingZero, Integer[][][][] dp) {
    if (pos == digits.length) {
        return leadingZero == 1 ? 0 : 1;
    }
    // å¤„ç†prevä¸º-1çš„æƒ…å†µï¼ˆå‰å¯¼é›¶çŠ¶æ€ï¼‰
    int prevIdx = prev == -1 ? 9 : prev;
    if (dp[pos][prevIdx][limit][leadingZero] != null) {
        return dp[pos][prevIdx][limit][leadingZero];
    }
    
    int upper = limit == 1 ? digits[pos] - '0' : 9;
    int res = 0;
    
    for (int d = 0; d <= upper; d++) {
        int newLimit = (limit == 1 && d == upper) ? 1 : 0;
        int newLeadingZero = (leadingZero == 1 && d == 0) ? 1 : 0;
        
        if (newLeadingZero == 1) {
            // ä»ç„¶æ˜¯å‰å¯¼é›¶çŠ¶æ€ï¼Œprevä¿æŒ-1
            res += dfs(digits, pos+1, -1, newLimit, newLeadingZero, dp);
        } else {
            if (prev == -1) {
                // å‰å¯¼é›¶åˆšåˆšç»“æŸ
                res += dfs(digits, pos+1, d, newLimit, newLeadingZero, dp);
            } else {
                // æ£€æŸ¥æ˜¯å¦ä¸å‰ä¸€ä½ç›¸åŒ
                if (d != prev) {
                    res += dfs(digits, pos+1, d, newLimit, newLeadingZero, dp);
                }
            }
        }
    }
    
    dp[pos][prevIdx][limit][leadingZero] = res;
    return res;
}
```

### 3. æ•°å­—å„ä½ä¹‹å’Œç­‰äºç›®æ ‡å€¼
```java
public int countNumbersWithDigitSum(int target, int maxNum) {
    if (target < 0) return 0;
    char[] digits = String.valueOf(maxNum).toCharArray();
    int len = digits.length;
    // dp[pos][sum][limit][leadingZero]
    Integer[][][][] dp = new Integer[len][target+1][2][2];
    return dfs(digits, 0, 0, target, 1, 1, dp);
}

private int dfs(char[] digits, int pos, int currentSum, int target, int limit, int leadingZero, Integer[][][][] dp) {
    if (currentSum > target) return 0;
    if (pos == digits.length) {
        return (leadingZero == 1 || currentSum != target) ? 0 : 1;
    }
    if (dp[pos][currentSum][limit][leadingZero] != null) {
        return dp[pos][currentSum][limit][leadingZero];
    }
    
    int upper = limit == 1 ? digits[pos] - '0' : 9;
    int res = 0;
    
    for (int d = 0; d <= upper; d++) {
        int newLimit = (limit == 1 && d == upper) ? 1 : 0;
        int newLeadingZero = (leadingZero == 1 && d == 0) ? 1 : 0;
        int newSum = currentSum + (newLeadingZero == 1 ? 0 : d);
        
        if (newSum > target) continue;
        res += dfs(digits, pos+1, newSum, target, newLimit, newLeadingZero, dp);
    }
    
    dp[pos][currentSum][limit][leadingZero] = res;
    return res;
}
```

## ğŸ“Š çŠ¶æ€è½¬ç§»æ–¹ç¨‹

### 1. æ•°å­—è®¡æ•°åŸºæœ¬æ¨¡å‹
- **çŠ¶æ€å®šä¹‰**ï¼š`dp[pos][state][limit][leadingZero]`è¡¨ç¤ºå¤„ç†åˆ°ç¬¬posä½ï¼ŒçŠ¶æ€ä¸ºstateï¼Œæ˜¯å¦å—é™(limit)ï¼Œæ˜¯å¦æœ‰å‰å¯¼é›¶(leadingZero)æ—¶çš„æ•°å­—ä¸ªæ•°
- **æ ¸å¿ƒçŠ¶æ€å‚æ•°**ï¼š
  - pos: å½“å‰å¤„ç†çš„æ•°ä½ä½ç½®
  - state: è®°å½•éœ€è¦è·Ÿè¸ªçš„çŠ¶æ€ï¼ˆå¦‚æ•°å­—å’Œã€å‰ä¸€ä½æ•°å­—ç­‰ï¼‰
  - limit: æ˜¯å¦å—ä¸Šç•Œé™åˆ¶ï¼ˆ0è¡¨ç¤ºä¸å—é™ï¼Œ1è¡¨ç¤ºå—é™ï¼‰
  - leadingZero: æ˜¯å¦å­˜åœ¨å‰å¯¼é›¶ï¼ˆ0è¡¨ç¤ºæ— ï¼Œ1è¡¨ç¤ºæœ‰ï¼‰
- **è½¬ç§»æ–¹ç¨‹**ï¼š
  ```
  for d in 0..upper_bound:
      new_limit = limit && (d == upper_bound)
      new_leading_zero = leading_zero && (d == 0)
      new_state = update_state(state, d, new_leading_zero)
      dp[pos][state][limit][leading_zero] += dp[pos+1][new_state][new_limit][new_leading_zero]
  ```
- **è¾¹ç•Œæ¡ä»¶**ï¼šå½“pos == æ•°å­—é•¿åº¦æ—¶ï¼Œæ ¹æ®stateæ˜¯å¦æ»¡è¶³æ¡ä»¶è¿”å›1æˆ–0

### 2. æ•°å­—1çš„ä¸ªæ•°
- **çŠ¶æ€å®šä¹‰**ï¼š`dp[pos][count][limit][leadingZero]`è¡¨ç¤ºå¤„ç†åˆ°ç¬¬posä½ï¼Œå·²ç»Ÿè®¡countä¸ª1ï¼Œæ˜¯å¦å—é™ï¼Œæ˜¯å¦æœ‰å‰å¯¼é›¶
- **è½¬ç§»æ–¹ç¨‹**ï¼š
  ```
  new_count = count + (d == 1 && !new_leading_zero ? 1 : 0)
  dp[pos][count][limit][leadingZero] += dp[pos+1][new_count][new_limit][new_leading_zero]
  ```
- **æœ€ç»ˆç»“æœ**ï¼šç´¯åŠ æ‰€æœ‰ä½ç½®çš„countå€¼

### 3. ä¸å«è¿ç»­ç›¸åŒæ•°å­—
- **çŠ¶æ€å®šä¹‰**ï¼š`dp[pos][prev][limit][leadingZero]`è¡¨ç¤ºå¤„ç†åˆ°ç¬¬posä½ï¼Œå‰ä¸€ä½æ•°å­—ä¸ºprevï¼Œæ˜¯å¦å—é™ï¼Œæ˜¯å¦æœ‰å‰å¯¼é›¶
- **è½¬ç§»æ–¹ç¨‹**ï¼š
  ```
  if d != prev or new_leading_zero or prev == -1:
      dp[pos][prev][limit][leadingZero] += dp[pos+1][d][new_limit][new_leading_zero]
  ```

## ğŸ” ç»å…¸é¢˜ç›®

| é¢˜ç›® | éš¾åº¦ | è€ƒç‚¹ |
|------|------|------|
| [LeetCode 233. æ•°å­—1çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-digit-one/) | å›°éš¾ | åŸºç¡€æ•°ä½è®¡æ•° |
| [LeetCode 600. ä¸å«è¿ç»­1çš„éè´Ÿæ•´æ•°](https://leetcode-cn.com/problems/non-negative-integers-without-consecutive-ones/) | å›°éš¾ | äºŒè¿›åˆ¶æ•°ä½çº¦æŸ |
| [LeetCode 902. æœ€å¤§ä¸ºNçš„æ•°å­—ç»„åˆ](https://leetcode-cn.com/problems/numbers-at-most-n-given-digit-set/) | å›°éš¾ | æ•°å­—é›†åˆçº¦æŸ |
| [LeetCode 1012. è‡³å°‘æœ‰ 1 ä½é‡å¤çš„æ•°å­—](https://leetcode-cn.com/problems/numbers-with-repeated-digits/) | å›°éš¾ | æ•°å­—å»é‡è®¡æ•° |
| [LeetCode 1397. æ‰¾åˆ°æ‰€æœ‰å¥½å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/find-all-good-strings/) | å›°éš¾ | å­—ç¬¦ä¸²æ•°ä½DP |
| [LeetCode 2719. ç»Ÿè®¡æ•´æ•°æ•°ç›®](https://leetcode-cn.com/problems/count-of-integers/) | å›°éš¾ | æ•°å­—å’ŒèŒƒå›´è®¡æ•° |

## ğŸ“Š æ•°ä½DPé€šç”¨æ¨¡æ¿

```java
int digitDP(int n) {
    if (n < 0) return 0;
    char[] digits = String.valueOf(n).toCharArray();
    int len = digits.length;
    // æ ¹æ®éœ€è¦å®šä¹‰DPçŠ¶æ€æ•°ç»„
    memo = new Integer[len][...];
    return dfs(digits, 0, initialState, true, true);
}

int dfs(char[] digits, int pos, State state, boolean limit, boolean leadingZero) {
    if (pos == digits.length) {
        return isValid(state) ? 1 : 0;
    }
    if (memo[pos][state][limit][leadingZero] != null) {
        return memo[pos][state][limit][leadingZero];
    }
    
    int upper = limit ? digits[pos] - '0' : 9;
    int res = 0;
    
    for (int d = 0; d <= upper; d++) {
        boolean newLimit = limit && (d == upper);
        boolean newLeadingZero = leadingZero && (d == 0);
        State newState = updateState(state, d, newLeadingZero);
        
        if (isValidTransition(state, newState, d)) {
            res += dfs(digits, pos+1, newState, newLimit, newLeadingZero);
        }
    }
    
    memo[pos][state][limit][leadingZero] = res;
    return res;
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‰å¯¼é›¶å¤„ç†**ï¼šå‰å¯¼é›¶ä¸è§†ä¸ºæœ‰æ•ˆæ•°å­—ï¼Œéœ€ç‰¹æ®Šå¤„ç†é¿å…å½±å“çŠ¶æ€åˆ¤æ–­
2. **è¾¹ç•Œé™åˆ¶å¤„ç†**ï¼šlimitå‚æ•°æ§åˆ¶æ˜¯å¦å—åŸæ•°å­—çº¦æŸï¼Œç¡®ä¿ä¸è¶…è¿‡ä¸Šç•Œ
3. **çŠ¶æ€è®¾è®¡**ï¼šæ ¹æ®é—®é¢˜ç‰¹æ€§è®¾è®¡æœ€å°å®Œå¤‡çŠ¶æ€é›†ï¼Œé¿å…çŠ¶æ€çˆ†ç‚¸
4. **è®°å¿†åŒ–ç¼“å­˜**ï¼šåˆç†è®¾ç½®ç¼“å­˜ç»´åº¦ï¼Œé¿å…é‡å¤è®¡ç®—
5. **æ•°å­—èŒƒå›´å¤„ç†**ï¼šé€šå¸¸å°†[L, R]èŒƒå›´é—®é¢˜è½¬åŒ–ä¸ºcount(R) - count(L-1)è§£å†³
6. **é›¶å€¼å¤„ç†**ï¼šæ³¨æ„n=0çš„ç‰¹æ®Šæƒ…å†µï¼Œé¿å…å‡ºç°é€»è¾‘é”™è¯¯
7. **å¤šæ¡ä»¶çº¦æŸ**ï¼šå¤šä¸ªçº¦æŸæ¡ä»¶æ—¶ï¼ŒçŠ¶æ€éœ€åŒ…å«æ‰€æœ‰å¿…è¦çš„è·Ÿè¸ªä¿¡æ¯
8. **ä½è¿ç®—ä¼˜åŒ–**ï¼šå¯ä½¿ç”¨ä½è¿ç®—å‹ç¼©çŠ¶æ€è¡¨ç¤ºï¼Œå‡å°‘å†…å­˜å ç”¨

## ğŸ“ æœ€ä½³å®è·µ

1. **çŠ¶æ€è®¾è®¡åŸåˆ™**ï¼š
   - åªè®°å½•å¿…è¦çš„çŠ¶æ€ä¿¡æ¯
   - ä½¿ç”¨æœ€å°åŒ–çš„çŠ¶æ€è¡¨ç¤º
   - å°†çŠ¶æ€è¡¨ç¤ºä¸ºæ•´æ•°ä»¥ä¾¿æ•°ç»„ç´¢å¼•
   - åŒºåˆ†ä¸´æ—¶çŠ¶æ€å’Œç´¯ç§¯çŠ¶æ€

2. **é—®é¢˜è½¬åŒ–æŠ€å·§**ï¼š
   - å°†æ•°å­—èŒƒå›´æŸ¥è¯¢è½¬åŒ–ä¸º0åˆ°Nçš„è®¡æ•°é—®é¢˜
   - åˆ©ç”¨å®¹æ–¥åŸç†å¤„ç†å¤æ‚çº¦æŸæ¡ä»¶
   - å¤šæ¡ä»¶çº¦æŸæ—¶é‡‡ç”¨çŠ¶æ€ç»„åˆ

3. **æ•ˆç‡ä¼˜åŒ–æ–¹æ³•**ï¼š
   - é¢„å¤„ç†æ•°å­—æ•°ç»„é¿å…é‡å¤è½¬æ¢
   - ä½¿ç”¨è®°å¿†åŒ–é€’å½’ä»£æ›¿è¿­ä»£å®ç°
   - çŠ¶æ€å‹ç¼©å‡å°‘å†…å­˜å ç”¨
   - å‰ªææ— æ•ˆçŠ¶æ€è½¬ç§»

4. **å¸¸è§é”™è¯¯é¿å…**ï¼š
   - å¿½ç•¥å‰å¯¼é›¶å¯¹çŠ¶æ€çš„å½±å“
   - è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“
   - çŠ¶æ€æ›´æ–°é€»è¾‘é”™è¯¯
   - ç¼“å­˜ç»´åº¦è®¾ç½®é”™è¯¯

---

> **å·²å®Œæˆ**ï¼šæœ¬æ–‡æ¡£å·²åŒ…å«æ•°ä½DPçš„å®Œæ•´çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬æŒ‰ä½å¤„ç†æ–¹æ³•ã€çŠ¶æ€è®¾è®¡ã€å…¸å‹æ•°å­—çº¦æŸé—®é¢˜å®ç°åŠåº”ç”¨åœºæ™¯