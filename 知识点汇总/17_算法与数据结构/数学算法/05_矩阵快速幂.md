# çŸ©é˜µå¿«é€Ÿå¹‚

çŸ©é˜µå¿«é€Ÿå¹‚ï¼ˆMatrix Exponentiation by Squaringï¼‰æ˜¯ä¸€ç§é«˜æ•ˆè®¡ç®—çŸ©é˜µå¹‚çš„ç®—æ³•ï¼Œç»“åˆäº†çŸ©é˜µä¹˜æ³•å’Œå¿«é€Ÿå¹‚æ€æƒ³ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»O(n)é™ä½åˆ°O(log n)ã€‚è¯¥ç®—æ³•åœ¨æ±‚è§£çº¿æ€§é€’æ¨å…³ç³»ã€å›¾è®ºè·¯å¾„é—®é¢˜ã€åŠ¨æ€è§„åˆ’ä¼˜åŒ–ç­‰é¢†åŸŸæœ‰é‡è¦åº”ç”¨ã€‚

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯
- **å®šä¹‰**ï¼šé€šè¿‡å°†æŒ‡æ•°åˆ†è§£ä¸ºäºŒè¿›åˆ¶å½¢å¼ï¼Œå¿«é€Ÿè®¡ç®—çŸ©é˜µé«˜æ¬¡å¹‚çš„ç®—æ³•
- **æ ¸å¿ƒæ€æƒ³**ï¼šå°†çŸ©é˜µå¹‚è¿ç®—è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•å’Œå¹³æ–¹è¿ç®—ï¼Œåˆ©ç”¨æŒ‡æ•°çš„äºŒè¿›åˆ¶åˆ†è§£å‡å°‘è®¡ç®—æ¬¡æ•°
- **æ•°å­¦åŸºç¡€**ï¼šçŸ©é˜µä¹˜æ³•çš„ç»“åˆå¾‹ï¼Œå³A^(m+n) = A^m Ã— A^n
- **åº”ç”¨å‰æ**ï¼šçŸ©é˜µå¿…é¡»æ˜¯æ–¹é˜µï¼ˆè¡Œæ•°ç­‰äºåˆ—æ•°ï¼‰æ‰èƒ½è¿›è¡Œå¹‚è¿ç®—
- **å•ä½å…ƒ**ï¼šå•ä½çŸ©é˜µIï¼Œæ»¡è¶³A Ã— I = I Ã— A = A

## ğŸ¯ ç®—æ³•åŸç†

### 1. çŸ©é˜µä¹˜æ³•
- **å®šä¹‰**ï¼šè®¾Aæ˜¯mÃ—pçŸ©é˜µï¼ŒBæ˜¯pÃ—nçŸ©é˜µï¼Œåˆ™ä¹˜ç§¯C=AÃ—Bæ˜¯mÃ—nçŸ©é˜µï¼Œå…¶ä¸­C[i][j] = Î£(k=1 to p) A[i][k]Ã—B[k][j]
- **æ€§è´¨**ï¼š
  - ç»“åˆå¾‹ï¼š(AÃ—B)Ã—C = AÃ—(BÃ—C)
  - åˆ†é…å¾‹ï¼šAÃ—(B+C) = AÃ—B + AÃ—C
  - ä¸æ»¡è¶³äº¤æ¢å¾‹ï¼šä¸€èˆ¬æƒ…å†µä¸‹AÃ—B â‰  BÃ—A

### 2. çŸ©é˜µå¿«é€Ÿå¹‚æ ¸å¿ƒç®—æ³•
- **åŸºæœ¬æ€æƒ³**ï¼šä¸æ ‡é‡å¿«é€Ÿå¹‚ç±»ä¼¼ï¼Œé€šè¿‡æŒ‡æ•°çš„äºŒè¿›åˆ¶åˆ†è§£å‡å°‘çŸ©é˜µä¹˜æ³•æ¬¡æ•°
- **æ­¥éª¤**ï¼š
  1. åˆå§‹åŒ–ç»“æœçŸ©é˜µä¸ºå•ä½çŸ©é˜µ
  2. å°†æŒ‡æ•°è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶å½¢å¼
  3. éå†æŒ‡æ•°çš„æ¯ä¸€ä½ï¼Œè‹¥å½“å‰ä½ä¸º1ï¼Œåˆ™å°†ç»“æœçŸ©é˜µä¹˜ä»¥å½“å‰çŸ©é˜µ
  4. å°†å½“å‰çŸ©é˜µå¹³æ–¹ï¼Œå¹¶å°†æŒ‡æ•°å³ç§»ä¸€ä½
  5. é‡å¤æ­¥éª¤3-4ç›´åˆ°æŒ‡æ•°ä¸º0

### 3. çº¿æ€§é€’æ¨å…³ç³»çš„çŸ©é˜µè¡¨ç¤º
- **åŸºæœ¬æ€æƒ³**ï¼šå°†çº¿æ€§é€’æ¨å¼è½¬åŒ–ä¸ºçŸ©é˜µå½¢å¼ï¼Œé€šè¿‡çŸ©é˜µå¹‚è¿ç®—æ±‚è§£ç¬¬né¡¹
- **ç¤ºä¾‹**ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—F(n) = F(n-1) + F(n-2)å¯è¡¨ç¤ºä¸ºï¼š
  ```
  | F(n)   |   =   | 1 1 |^(n-1)  | F(1) |
  | F(n-1) |       | 1 0 |        | F(0) |
  ```

## ğŸ’» ä»£ç å®ç°

### 1. çŸ©é˜µä¹˜æ³•å®ç°
```python
def matrix_mult(a, b):
    """çŸ©é˜µä¹˜æ³•ï¼šè®¡ç®—ä¸¤ä¸ªæ–¹é˜µçš„ä¹˜ç§¯
    Args:
        a: ç¬¬ä¸€ä¸ªçŸ©é˜µ (nÃ—n)
        b: ç¬¬äºŒä¸ªçŸ©é˜µ (nÃ—n)
    Returns:
        nÃ—nçš„ä¹˜ç§¯çŸ©é˜µ
    """
    n = len(a)
    result = [[0] * n for _ in range(n)]
    for i in range(n):
        for k in range(n):
            if a[i][k] == 0:
                continue
            for j in range(n):
                result[i][j] += a[i][k] * b[k][j]
    return result
```

### 2. çŸ©é˜µå¿«é€Ÿå¹‚ï¼ˆè¿­ä»£å®ç°ï¼‰
```python
def matrix_pow(mat, power):
    """çŸ©é˜µå¿«é€Ÿå¹‚ï¼šè®¡ç®—çŸ©é˜µçš„poweræ¬¡å¹‚
    Args:
        mat: è¾“å…¥çŸ©é˜µ (nÃ—n)
        power: éè´Ÿæ•´æ•°æŒ‡æ•°
    Returns:
        mat^powerçš„ç»“æœçŸ©é˜µ
    """
    n = len(mat)
    # åˆå§‹åŒ–ç»“æœä¸ºå•ä½çŸ©é˜µ
    result = [[0] * n for _ in range(n)]
    for i in range(n):
        result[i][i] = 1
    
    current = [row[:] for row in mat]  # å½“å‰çŸ©é˜µ
    
    while power > 0:
        # å¦‚æœå½“å‰ä½ä¸º1ï¼Œåˆ™ä¹˜ä»¥å½“å‰çŸ©é˜µ
        if power % 2 == 1:
            result = matrix_mult(result, current)
        # å½“å‰çŸ©é˜µå¹³æ–¹
        current = matrix_mult(current, current)
        # æŒ‡æ•°å³ç§»ä¸€ä½
        power //= 2
    
    return result
```

### 3. æ–æ³¢é‚£å¥‘æ•°åˆ—æ±‚è§£ç¤ºä¾‹
```python
def fibonacci(n):
    """ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚æ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬né¡¹
    Args:
        n: éè´Ÿæ•´æ•°ï¼Œä»0å¼€å§‹è®¡æ•°
    Returns:
        æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬né¡¹
    """
    if n == 0:
        return 0
    # æ–æ³¢é‚£å¥‘é€’æ¨çŸ©é˜µ
    trans_mat = [[1, 1], [1, 0]]
    # è®¡ç®—çŸ©é˜µçš„(n-1)æ¬¡å¹‚
    power = n - 1
    result_mat = matrix_pow(trans_mat, power)
    # åˆå§‹å‘é‡ [F(1), F(0)] = [1, 0]
    return result_mat[0][0] * 1 + result_mat[0][1] * 0
```

### 4. å¸¦æ¨¡è¿ç®—çš„çŸ©é˜µå¿«é€Ÿå¹‚
```python
def matrix_mult_mod(a, b, mod):
    ""å¸¦æ¨¡è¿ç®—çš„çŸ©é˜µä¹˜æ³•"
    n = len(a)
    result = [[0] * n for _ in range(n)]
    for i in range(n):
        for k in range(n):
            if a[i][k] == 0:
                continue
            for j in range(n):
                result[i][j] = (result[i][j] + a[i][k] * b[k][j]) % mod
    return result

def matrix_pow_mod(mat, power, mod):
    ""å¸¦æ¨¡è¿ç®—çš„çŸ©é˜µå¿«é€Ÿå¹‚"
    n = len(mat)
    result = [[0] * n for _ in range(n)]
    for i in range(n):
        result[i][i] = 1
    
    current = [row[:] for row in mat]
    
    while power > 0:
        if power % 2 == 1:
            result = matrix_mult_mod(result, current, mod)
        current = matrix_mult_mod(current, current, mod)
        power //= 2
    
    return result
```

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|------------|------------|------|
| çŸ©é˜µä¹˜æ³• (nÃ—n) | O(nÂ³) | O(nÂ²) | nä¸ºçŸ©é˜µç»´åº¦ |
| çŸ©é˜µå¿«é€Ÿå¹‚ | O(nÂ³ log k) | O(nÂ²) | kä¸ºæŒ‡æ•°ï¼Œnä¸ºçŸ©é˜µç»´åº¦ |
| æ–æ³¢é‚£å¥‘æ±‚è§£ | O(log n) | O(1) | ä½¿ç”¨2Ã—2çŸ©é˜µï¼Œnä¸ºé¡¹æ•° |
| å¸¦æ¨¡çŸ©é˜µå¿«é€Ÿå¹‚ | O(nÂ³ log k) | O(nÂ²) | å¢åŠ æ¨¡è¿ç®—ä¸æ”¹å˜å¤æ‚åº¦é˜¶æ•° |

## ğŸ” åº”ç”¨åœºæ™¯
- **çº¿æ€§é€’æ¨å…³ç³»**ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—ã€å¢å¡æ–¯æ•°åˆ—ã€çº¿æ€§ recurrence relations çš„é«˜æ•ˆè®¡ç®—
- **å›¾è®º**ï¼šè®¡ç®—å›¾ä¸­é•¿åº¦ä¸ºkçš„è·¯å¾„æ•°é‡ï¼Œé‚»æ¥çŸ©é˜µçš„å¹‚è¿ç®—
- **åŠ¨æ€è§„åˆ’ä¼˜åŒ–**ï¼šå°†æŸäº›DPé—®é¢˜è½¬åŒ–ä¸ºçŸ©é˜µå½¢å¼ï¼Œåˆ©ç”¨çŸ©é˜µå¿«é€Ÿå¹‚é™ä½æ—¶é—´å¤æ‚åº¦
- **ç»„åˆæ•°å­¦**ï¼šæ±‚è§£ç»„åˆè®¡æ•°é—®é¢˜ï¼Œå¦‚ Catalan æ•°ã€Stirling æ•°
- **å¯†ç å­¦**ï¼šæŸäº›åŠ å¯†ç®—æ³•ä¸­çš„çŸ©é˜µå¹‚è¿ç®—
- **æ•°å€¼è®¡ç®—**ï¼šçŸ©é˜µæŒ‡æ•°å‡½æ•°çš„è¿‘ä¼¼è®¡ç®—

## âš ï¸ æ³¨æ„äº‹é¡¹
- **çŸ©é˜µç»´åº¦**ï¼šç¡®ä¿å‚ä¸è¿ç®—çš„çŸ©é˜µç»´åº¦åŒ¹é…ï¼Œä¹˜æ³•è¦æ±‚å‰çŸ©é˜µåˆ—æ•°ç­‰äºåçŸ©é˜µè¡Œæ•°
- **å•ä½çŸ©é˜µ**ï¼šæ­£ç¡®åˆå§‹åŒ–å•ä½çŸ©é˜µï¼Œå¯¹è§’çº¿å…ƒç´ ä¸º1ï¼Œå…¶ä½™ä¸º0
- **åˆå§‹çŠ¶æ€**ï¼šçº¿æ€§é€’æ¨é—®é¢˜ä¸­ï¼Œæ­£ç¡®è®¾ç½®åˆå§‹å‘é‡å’Œè½¬æ¢çŸ©é˜µ
- **æ•°æ®æº¢å‡º**ï¼šçŸ©é˜µå…ƒç´ å¿«é€Ÿå¢é•¿ï¼Œå¤§æŒ‡æ•°è¿ç®—éœ€é…åˆæ¨¡è¿ç®—é˜²æ­¢æº¢å‡º
- **éæ–¹é˜µå¤„ç†**ï¼šéæ–¹é˜µä¸èƒ½ç›´æ¥è¿›è¡Œå¹‚è¿ç®—ï¼Œéœ€ç‰¹æ®Šå¤„ç†
- **æµ®ç‚¹æ•°ç²¾åº¦**ï¼šä½¿ç”¨æµ®ç‚¹æ•°çŸ©é˜µæ—¶æ³¨æ„ç²¾åº¦æŸå¤±é—®é¢˜

## ğŸ“ æœ€ä½³å®è·µ
- **çŸ©é˜µç»´åº¦ä¼˜åŒ–**ï¼šå°½é‡ä½¿ç”¨æœ€å°ç»´åº¦çŸ©é˜µï¼Œ2Ã—2çŸ©é˜µæ¯”nÃ—nçŸ©é˜µæ•ˆç‡é«˜å¾—å¤š
- **æ¨¡è¿ç®—åº”ç”¨**ï¼šå¯¹ç»“æœæœ‰èŒƒå›´é™åˆ¶çš„é—®é¢˜ï¼Œå°½æ—©å¼•å…¥æ¨¡è¿ç®—
- **ç¼“å­˜ä¼˜åŒ–**ï¼šçŸ©é˜µä¹˜æ³•ä¸­åˆ©ç”¨å±€éƒ¨æ€§åŸç†ä¼˜åŒ–ç¼“å­˜ä½¿ç”¨
- **å¹¶è¡Œè®¡ç®—**ï¼šå¤§è§„æ¨¡çŸ©é˜µå¯è€ƒè™‘å¹¶è¡ŒåŒ–çŸ©é˜µä¹˜æ³•å®ç°
- **ç‰¹æ®ŠçŸ©é˜µå¤„ç†**ï¼šå¯¹è§’çŸ©é˜µã€ç¨€ç–çŸ©é˜µå¯é‡‡ç”¨ä¸“é—¨çš„ä¼˜åŒ–ç®—æ³•
- **è¿­ä»£ä¼˜å…ˆ**ï¼šä¼˜å…ˆé€‰æ‹©è¿­ä»£å®ç°ï¼Œé¿å…é€’å½’ç‰ˆæœ¬çš„æ ˆæº¢å‡ºé—®é¢˜

```python
# ä¼˜åŒ–ç¤ºä¾‹ï¼šä½¿ç”¨numpyåŠ é€ŸçŸ©é˜µè¿ç®—
import numpy as np

def numpy_matrix_pow(mat, power):
    ""ä½¿ç”¨numpyå®ç°çŸ©é˜µå¿«é€Ÿå¹‚"
    result = np.eye(len(mat), dtype=np.int64)
    current = np.array(mat, dtype=np.int64)
    
    while power > 0:
        if power % 2 == 1:
            result = np.dot(result, current)
        current = np.dot(current, current)
        power //= 2
    return result

def fast_fibonacci(n):
    if n == 0:
        return 0
    trans_mat = [[1, 1], [1, 0]]
    return numpy_matrix_pow(trans_mat, n-1)[0, 0]
```

---

> **ç›¸å…³é“¾æ¥**ï¼š
> - [çŸ©é˜µä¹˜æ³•](https://zh.wikipedia.org/wiki/çŸ©é˜µä¹˜æ³•)
> - [å¿«é€Ÿå¹‚](https://zh.wikipedia.org/wiki/å¿«é€Ÿå¹‚)
> - [çº¿æ€§é€’æ¨å…³ç³»](https://zh.wikipedia.org/wiki/çº¿æ€§é€’æ¨å…³ç³»)
> - [æ–æ³¢é‚£å¥‘æ•°åˆ—](https://zh.wikipedia.org/wiki/æ–æ³¢é‚£å¥‘æ•°åˆ—)