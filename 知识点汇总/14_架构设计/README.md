# 架构设计与技术选型

> 掌握架构设计核心方法论，做出正确的技术选型决策

---

## 📋 文档列表

### 1. 架构设计与技术选型方法论 ⭐ 新增
📄 [架构设计与技术选型方法论.md](./架构设计与技术选型方法论.md)

**核心内容**：
- ✅ **技术选型本质**：PCTS模型（性能、成本、团队、规模）
- ✅ **决策框架**：完整决策流程、评分卡、决策矩阵
- ✅ **核心组件选型**：数据库、缓存、MQ、注册中心、分库分表
- ✅ **架构设计原则**：SOLID、高内聚低耦合、CAP理论
- ✅ **架构演进路线**：从单体到微服务的5个阶段
- ✅ **实战案例**：秒杀系统、社交网络完整方案
- ✅ **常见误区**：过度设计、盲目追新、忽视成本
- ✅ **决策工具**：检查清单、决策模板

**核心特性**：
- 📊 **PCTS模型**：性能、成本、团队、规模四维评估
- 🎯 **决策流程**：从需求分析到方案选择的完整流程
- 💡 **实战导向**：2个完整案例，拿来即用
- 🔍 **避坑指南**：3大常见误区及正确做法
- 📈 **演进路线**：从日活1000到500万的架构演进

**适合场景**：
- 系统架构设计
- 技术选型决策
- 架构评审
- 团队技术分享

**学习路径**：
```
1. 理解技术选型的本质（第1章）
   → 避免3大误区
   → 掌握PCTS评估模型

2. 学习决策框架（第2章）
   → 掌握决策流程
   → 使用评分卡量化评估

3. 掌握组件选型（第3章）
   → 数据库：MySQL vs PostgreSQL vs MongoDB
   → 缓存：本地 vs Redis vs Memcached
   → MQ：RabbitMQ vs RocketMQ vs Kafka
   → 注册中心：Nacos vs Eureka vs Consul
   → 分库分表：ShardingSphere vs MyCAT

4. 学习架构原则（第4章）
   → SOLID原则
   → CAP理论
   → 服务拆分原则

5. 了解演进路线（第5章）
   → 阶段1：单体应用（0-10万日活）
   → 阶段2：单体+缓存（10-50万）
   → 阶段3：读写分离（50-100万）
   → 阶段4：微服务架构（100-500万）
   → 阶段5：分布式架构（500万+）

6. 实战案例学习（第6章）
   → 秒杀系统完整方案
   → 社交网络朋友圈设计

7. 避开误区（第7章）
   → 不要过度设计
   → 不要盲目追新
   → 不要忽视成本

8. 使用决策工具（第8章）
   → 技术选型检查清单
   → 技术选型决策模板
```

**核心技术选型对比**：

| 技术类型 | 选项 | 适用场景 |
|---------|------|---------|
| **数据库** | MySQL | 通用OLTP，团队熟悉 |
|  | PostgreSQL | 复杂查询，地理数据 |
|  | MongoDB | 文档存储，schema灵活 |
| **缓存** | 本地缓存（Caffeine） | 单机，小数据量 |
|  | Redis | 分布式，大数据量 |
|  | 多级缓存 | 超高QPS场景 |
| **消息队列** | RabbitMQ | 业务解耦，QPS < 1万 |
|  | RocketMQ | 高并发，事务消息 |
|  | Kafka | 日志收集，大数据 |
| **注册中心** | Nacos | Spring Cloud Alibaba |
|  | Consul | 多语言，K8s环境 |
|  | Eureka | ❌已停更 |
| **分库分表** | ShardingSphere | 自动分片，对应用透明 |
|  | MyCAT | MySQL协议代理 |
|  | 手动分表 | 简单场景，极致性能 |

**架构演进指标**：

| 阶段 | 日活 | QPS | 架构 |
|------|------|-----|------|
| **阶段1** | 0-10万 | < 1000 | 单体应用 |
| **阶段2** | 10-50万 | 1000-5000 | 单体+缓存 |
| **阶段3** | 50-100万 | 5000-1万 | 读写分离 |
| **阶段4** | 100-500万 | 1万-10万 | 微服务架构 |
| **阶段5** | 500万+ | 10万+ | 分布式架构 |

---

## 🎯 技术选型的5大黄金法则

### 1️⃣ 适合比先进更重要
```
不要追求最新最热的技术
选择最适合当前业务的技术

示例：
❌ 日活1000的系统使用K8s
✅ 日活1000的系统使用单体应用
```

### 2️⃣ 成本永远是第一考量
```
技术选型 = 解决问题 + 最小成本

成本包括：
- 开发成本（人力、时间）
- 运维成本（服务器、人力）
- 学习成本（培训、踩坑）
- 迁移成本（从旧技术迁移）
```

### 3️⃣ 团队能力是硬约束
```
再好的技术，团队用不好也是零

团队评估：
- 团队规模：1-5人 → 简单技术栈
- 技术能力：初级 → 成熟技术
- 学习意愿：低 → 不引入新技术
```

### 4️⃣ 业务驱动技术
```
先有业务需求，再选技术
不要为了用技术而用技术

正确流程：
1. 分析业务需求
2. 明确技术要求（QPS、数据量）
3. 列出候选技术
4. 综合评估选择
```

### 5️⃣ 渐进式演进
```
不要一步到位，根据业务增长逐步演进

演进路线：
单体 → 单体+缓存 → 读写分离 → 微服务 → 分布式

关键：在合适的时机做合适的架构升级
```

---

## 📊 PCTS评估模型

### Performance（性能）25%

**评估标准**：
```
5分：性能完全满足需求，还有余量
3分：性能基本满足需求
1分：性能不满足需求
```

**考量因素**：
- QPS（每秒请求数）
- 延迟（响应时间）
- 吞吐量（TPS）
- 并发数

### Cost（成本）30%

**评估标准**：
```
5分：成本很低（开源、简单运维）
3分：成本中等（需要服务器、监控）
1分：成本很高（商业软件、复杂运维）
```

**考量因素**：
- 开发成本
- 运维成本
- 学习成本
- 迁移成本

### Team（团队）30%

**评估标准**：
```
5分：团队很熟悉，上手即用
3分：团队了解，需要学习
1分：团队完全不会，学习曲线陡峭
```

**考量因素**：
- 团队规模
- 技术栈熟悉度
- 学习能力
- 运维能力

### Scale（扩展性）15%

**评估标准**：
```
5分：易扩展（水平扩展）
3分：可扩展（需要改造）
1分：难扩展（需要重构）
```

**考量因素**：
- 当前规模
- 预期增长
- 扩展方式
- 扩展成本

---

## 🔧 技术选型实战工具

### 工具1：技术选型评分卡

```markdown
| 技术 | 性能(25%) | 成本(30%) | 团队(30%) | 扩展性(15%) | 总分 |
|------|-----------|-----------|-----------|-------------|------|
| 方案A | 5×25%=1.25 | 4×30%=1.2 | 5×30%=1.5 | 3×15%=0.45 | 4.4 |
| 方案B | 4×25%=1.0  | 3×30%=0.9 | 4×30%=1.2 | 4×15%=0.6  | 3.7 |
| 方案C | 5×25%=1.25 | 2×30%=0.6 | 2×30%=0.6 | 5×15%=0.75 | 3.2 |

结论：选择方案A（总分最高）
```

### 工具2：决策检查清单

```markdown
## 技术选型前必问的20个问题

### 业务需求（5个问题）
- [ ] 核心功能是什么？
- [ ] QPS要求多少？
- [ ] 数据量级多大？
- [ ] 延迟要求多少？
- [ ] 可靠性要求？

### 团队情况（5个问题）
- [ ] 团队规模？
- [ ] 团队技术栈？
- [ ] 是否有学习时间？
- [ ] 是否有运维能力？
- [ ] 是否有技术专家？

### 成本约束（5个问题）
- [ ] 开发时间？
- [ ] 预算多少？
- [ ] 服务器成本？
- [ ] 人力成本？
- [ ] 是否可以商业采购？

### 风险评估（5个问题）
- [ ] 技术成熟度？
- [ ] 社区活跃度？
- [ ] 是否有商业支持？
- [ ] 是否有成功案例？
- [ ] 迁移回退成本？
```

### 工具3：决策文档模板

```markdown
# 技术选型文档：XXX系统

## 1. 背景
- 业务场景：...
- 当前痛点：...
- 预期目标：...

## 2. 候选方案

### 方案A：保守方案
...

### 方案B：平衡方案
...

### 方案C：激进方案
...

## 3. 评分对比

| 维度 | 方案A | 方案B | 方案C |
|------|-------|-------|-------|
| ... | ... | ... | ... |

## 4. 最终决策
- 选择：...
- 理由：...
- 风险：...
- 计划：...

## 5. 评审意见
- 技术负责人：...
- 架构师：...
```

---

## 🔗 相关文档

- 📄 [04_缓存/缓存架构设计与实战](../04_缓存/缓存架构设计与实战.md) - 缓存选型详解
- 📄 [03_数据库/MySQL核心机制详解](../03_数据库/MySQL核心机制详解.md) - 数据库选型
- 📄 [05_消息队列/RocketMQ核心机制详解](../05_消息队列/RocketMQ核心机制详解.md) - MQ选型
- 📄 [06_微服务/Nacos核心机制详解](../06_微服务/Nacos核心机制详解.md) - 注册中心选型

---

## 🔄 持续更新

- [ ] 性能压测方法论
- [ ] 容量规划与评估
- [ ] 架构评审Checklist
- [ ] 技术债务管理

---

*最后更新：2025-10-27*

