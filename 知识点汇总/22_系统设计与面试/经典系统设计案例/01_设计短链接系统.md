# è®¾è®¡çŸ­é“¾æ¥ç³»ç»Ÿ

> é«˜é¢‘é¢è¯•é¢˜ï¼šè®¾è®¡ä¸€ä¸ªç±»ä¼¼bit.lyçš„çŸ­é“¾æ¥æœåŠ¡

## ğŸ“‹ é¢è¯•é¢˜ç›®

```
è®¾è®¡ä¸€ä¸ªçŸ­é“¾æ¥ç³»ç»Ÿï¼Œå°†é•¿URLè½¬æ¢ä¸ºçŸ­é“¾æ¥ï¼Œå¹¶æ”¯æŒçŸ­é“¾æ¥è·³è½¬åˆ°åŸå§‹URLã€‚

è¦æ±‚ï¼š
1. ç”Ÿæˆå”¯ä¸€çš„çŸ­é“¾æ¥
2. æ”¯æŒçŸ­é“¾æ¥è·³è½¬
3. æ”¯æŒè‡ªå®šä¹‰çŸ­é“¾æ¥ï¼ˆå¯é€‰ï¼‰
4. ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°
5. é«˜å¯ç”¨ã€é«˜æ€§èƒ½
```

---

## ä¸€ã€éœ€æ±‚æ¾„æ¸…

### åŠŸèƒ½éœ€æ±‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- [x] é•¿URL â†’ çŸ­é“¾æ¥
- [x] çŸ­é“¾æ¥ â†’ é‡å®šå‘åˆ°é•¿URL
- [x] ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°
- [x] è¿‡æœŸæ—¶é—´è®¾ç½®
- [x] è‡ªå®šä¹‰çŸ­é“¾æ¥ï¼ˆå¯é€‰ï¼‰

**éåŠŸèƒ½éœ€æ±‚**ï¼š
- QPSï¼šè¯»10ä¸‡ï¼Œå†™1ä¸‡
- RTï¼šP99 < 100ms
- å¯ç”¨æ€§ï¼š99.9%
- æ•°æ®è§„æ¨¡ï¼š1äº¿æ¡URL
- çŸ­é“¾æ¥é•¿åº¦ï¼š6-8ä½å­—ç¬¦

---

## äºŒã€æ¦‚è¦è®¾è®¡

### 2.1 æ ¸å¿ƒæµç¨‹

**åˆ›å»ºçŸ­é“¾æ¥**ï¼š
```
1. ç”¨æˆ·è¾“å…¥é•¿URLï¼šhttps://example.com/very/long/url/path
2. ç³»ç»Ÿç”ŸæˆçŸ­é“¾æ¥ï¼šhttps://short.ly/abc123
3. å­˜å‚¨æ˜ å°„å…³ç³»
4. è¿”å›çŸ­é“¾æ¥ç»™ç”¨æˆ·
```

**è®¿é—®çŸ­é“¾æ¥**ï¼š
```
1. ç”¨æˆ·è®¿é—®ï¼šhttps://short.ly/abc123
2. ç³»ç»ŸæŸ¥è¯¢åŸå§‹URL
3. 302é‡å®šå‘åˆ°åŸå§‹URL
4. ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°+1
```

### 2.2 æ¶æ„è®¾è®¡

**ç®€åŒ–ç‰ˆæ¶æ„ï¼ˆV1ï¼‰**ï¼š
```
     ç”¨æˆ·
      â†“
   WebæœåŠ¡å™¨
      â†“
    æ•°æ®åº“
```

**ä¼˜åŒ–ç‰ˆæ¶æ„ï¼ˆV2æ¨èï¼‰**ï¼š
```
           ç”¨æˆ·
            â†“
         è´Ÿè½½å‡è¡¡
            â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
   æœåŠ¡å™¨1      æœåŠ¡å™¨2
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â†“
        Redisç¼“å­˜
            â†“
       MySQLä¸»ä»
```

---

## ä¸‰ã€è¯¦ç»†è®¾è®¡

### 3.1 æ•°æ®æ¨¡å‹

**MySQLè¡¨è®¾è®¡**ï¼š
```sql
CREATE TABLE short_url (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    short_key VARCHAR(10) UNIQUE NOT NULL COMMENT 'çŸ­é“¾æ¥key',
    original_url VARCHAR(2048) NOT NULL COMMENT 'åŸå§‹URL',
    user_id BIGINT COMMENT 'åˆ›å»ºç”¨æˆ·ID',
    click_count INT DEFAULT 0 COMMENT 'ç‚¹å‡»æ¬¡æ•°',
    expire_at TIMESTAMP COMMENT 'è¿‡æœŸæ—¶é—´',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1æœ‰æ•ˆ 0å¤±æ•ˆ',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_expire_at (expire_at),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**Redisç¼“å­˜ç»“æ„**ï¼š
```
key: short:abc123
value: {
  "original_url": "https://example.com/...",
  "expire_at": 1735660800,
  "status": 1
}
ttl: 3600  # 1å°æ—¶
```

### 3.2 çŸ­é“¾æ¥ç”Ÿæˆç®—æ³•

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| è‡ªå¢ID + Base62 | ç®€å•ã€å”¯ä¸€ | å¯é¢„æµ‹ã€å¯çˆ¬å– | â­â­â­â­ |
| Hash + å†²çªæ£€æµ‹ | ä¸å¯é¢„æµ‹ | å¯èƒ½å†²çª | â­â­â­ |
| é›ªèŠ±ç®—æ³• | åˆ†å¸ƒå¼ã€å”¯ä¸€ | è¾ƒé•¿ | â­â­â­â­â­ |
| UUID | ç»å¯¹å”¯ä¸€ | å¤ªé•¿(36ä½) | â­â­ |

**æ¨èæ–¹æ¡ˆï¼šè‡ªå¢ID + Base62ç¼–ç **

```java
public class ShortUrlGenerator {
    private static final String BASE62 = 
        "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    
    /**
     * å°†æ•°å­—IDè½¬ä¸ºBase62å­—ç¬¦ä¸²
     * @param id è‡ªå¢ID
     * @return Base62ç¼–ç çš„çŸ­é“¾æ¥key
     */
    public String toBase62(long id) {
        if (id == 0) return "0";
        
        StringBuilder sb = new StringBuilder();
        while (id > 0) {
            sb.append(BASE62.charAt((int)(id % 62)));
            id /= 62;
        }
        return sb.reverse().toString();
    }
    
    /**
     * å°†Base62å­—ç¬¦ä¸²è½¬å›æ•°å­—ID
     */
    public long fromBase62(String str) {
        long result = 0;
        for (char c : str.toCharArray()) {
            result = result * 62 + BASE62.indexOf(c);
        }
        return result;
    }
}

// ç¤ºä¾‹ï¼š
// id=1      â†’ Base62 â†’ "1"
// id=62     â†’ Base62 â†’ "10"
// id=12345  â†’ Base62 â†’ "3d7"
// id=1000000 â†’ Base62 â†’ "4c92"  (6ä½)
```

**ä¸ºä»€ä¹ˆé€‰Base62**ï¼š
```
Base62 = æ•°å­—(0-9) + å°å†™å­—æ¯(a-z) + å¤§å†™å­—æ¯(A-Z)
       = 10 + 26 + 26 = 62ä¸ªå­—ç¬¦

å®¹é‡è®¡ç®—ï¼š
  6ä½Base62 = 62^6 = 568äº¿æ¡
  7ä½Base62 = 62^7 = 3.5ä¸‡äº¿æ¡  âœ… è¶³å¤Ÿä½¿ç”¨

çŸ­URLç¤ºä¾‹ï¼š
  https://short.ly/abc123  (6ä½)
```

### 3.3 æ¥å£è®¾è®¡

**APIè®¾è®¡**ï¼š

**1. åˆ›å»ºçŸ­é“¾æ¥**ï¼š
```http
POST /api/v1/short-urls
Content-Type: application/json

{
  "original_url": "https://example.com/very/long/url",
  "expire_days": 30,
  "custom_key": "mylink"  // å¯é€‰ï¼Œè‡ªå®šä¹‰çŸ­é“¾æ¥
}

Response 200 OK:
{
  "code": 0,
  "message": "success",
  "data": {
    "short_key": "abc123",
    "short_url": "https://short.ly/abc123",
    "original_url": "https://example.com/very/long/url",
    "expire_at": "2025-11-28T00:00:00Z",
    "created_at": "2025-10-29T10:00:00Z"
  }
}
```

**2. çŸ­é“¾æ¥è·³è½¬**ï¼š
```http
GET /{shortKey}

Response 302 Found
Location: https://example.com/very/long/url
```

**3. æŸ¥è¯¢çŸ­é“¾æ¥è¯¦æƒ…**ï¼š
```http
GET /api/v1/short-urls/{shortKey}

Response 200 OK:
{
  "code": 0,
  "data": {
    "short_key": "abc123",
    "original_url": "https://example.com/...",
    "click_count": 1024,
    "created_at": "2025-10-29T10:00:00Z",
    "expire_at": "2025-11-28T00:00:00Z"
  }
}
```

### 3.4 æ ¸å¿ƒä»£ç å®ç°

**åˆ›å»ºçŸ­é“¾æ¥**ï¼š
```java
@Service
public class ShortUrlService {
    @Autowired
    private ShortUrlMapper mapper;
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private ShortUrlGenerator generator;
    
    @Transactional
    public ShortUrlDTO createShortUrl(String originalUrl, Integer expireDays) {
        // 1. æ£€æŸ¥URLæ˜¯å¦å·²å­˜åœ¨ï¼ˆå¯é€‰ï¼Œé¿å…é‡å¤ï¼‰
        ShortUrl existing = mapper.findByOriginalUrl(originalUrl);
        if (existing != null && existing.getStatus() == 1) {
            return convertToDTO(existing);
        }
        
        // 2. æ’å…¥æ•°æ®åº“è·å–è‡ªå¢ID
        ShortUrl shortUrl = new ShortUrl();
        shortUrl.setOriginalUrl(originalUrl);
        shortUrl.setStatus(1);
        if (expireDays != null) {
            shortUrl.setExpireAt(
                LocalDateTime.now().plusDays(expireDays)
            );
        }
        mapper.insert(shortUrl);  // è·å¾—è‡ªå¢ID
        
        // 3. ç”ŸæˆçŸ­é“¾æ¥keyï¼ˆBase62ç¼–ç IDï¼‰
        String shortKey = generator.toBase62(shortUrl.getId());
        shortUrl.setShortKey(shortKey);
        mapper.updateShortKey(shortUrl.getId(), shortKey);
        
        // 4. å†™å…¥Redisç¼“å­˜
        cacheShortUrl(shortKey, shortUrl);
        
        return convertToDTO(shortUrl);
    }
    
    private void cacheShortUrl(String shortKey, ShortUrl shortUrl) {
        String cacheKey = "short:" + shortKey;
        Map<String, Object> data = new HashMap<>();
        data.put("original_url", shortUrl.getOriginalUrl());
        data.put("expire_at", shortUrl.getExpireAt());
        data.put("status", shortUrl.getStatus());
        
        redisTemplate.opsForHash().putAll(cacheKey, data);
        redisTemplate.expire(cacheKey, 1, TimeUnit.HOURS);
    }
}
```

**çŸ­é“¾æ¥è·³è½¬**ï¼š
```java
@RestController
public class RedirectController {
    @Autowired
    private ShortUrlService service;
    
    @GetMapping("/{shortKey}")
    public void redirect(@PathVariable String shortKey, 
                         HttpServletResponse response) throws IOException {
        // 1. æŸ¥è¯¢åŸå§‹URL
        String originalUrl = service.getOriginalUrl(shortKey);
        
        if (originalUrl == null) {
            response.sendError(404, "çŸ­é“¾æ¥ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ");
            return;
        }
        
        // 2. å¼‚æ­¥ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°ï¼ˆä¸å½±å“è·³è½¬é€Ÿåº¦ï¼‰
        service.incrementClickCountAsync(shortKey);
        
        // 3. 302é‡å®šå‘
        response.sendRedirect(originalUrl);
    }
}

@Service
public class ShortUrlService {
    public String getOriginalUrl(String shortKey) {
        // 1. å…ˆæŸ¥Redisç¼“å­˜
        String cacheKey = "short:" + shortKey;
        String url = (String) redisTemplate.opsForHash()
            .get(cacheKey, "original_url");
        
        if (url != null) {
            return url;  // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        ShortUrl shortUrl = mapper.findByShortKey(shortKey);
        if (shortUrl == null || shortUrl.getStatus() == 0) {
            return null;
        }
        
        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if (shortUrl.getExpireAt() != null && 
            shortUrl.getExpireAt().isBefore(LocalDateTime.now())) {
            return null;
        }
        
        // 3. å†™å…¥ç¼“å­˜
        cacheShortUrl(shortKey, shortUrl);
        
        return shortUrl.getOriginalUrl();
    }
    
    @Async
    public void incrementClickCountAsync(String shortKey) {
        // 1. Redisè®¡æ•°ï¼ˆå¿«é€Ÿï¼‰
        String countKey = "short:count:" + shortKey;
        redisTemplate.opsForValue().increment(countKey);
        
        // 2. å®šæ—¶æ‰¹é‡åŒæ­¥åˆ°æ•°æ®åº“ï¼ˆå‡å°‘æ•°æ®åº“å‹åŠ›ï¼‰
        // ç”±å®šæ—¶ä»»åŠ¡å¤„ç†
    }
}
```

### 3.5 æ€§èƒ½ä¼˜åŒ–

**ç¼“å­˜ç­–ç•¥**ï¼š
```java
// å¤šçº§ç¼“å­˜
public String getOriginalUrl(String shortKey) {
    // L1: æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰- è¶…å¿«
    String url = localCache.getIfPresent(shortKey);
    if (url != null) return url;
    
    // L2: Redisç¼“å­˜ - å¿«
    url = redisCache.get(shortKey);
    if (url != null) {
        localCache.put(shortKey, url);
        return url;
    }
    
    // L3: æ•°æ®åº“ - æ…¢
    url = database.query(shortKey);
    if (url != null) {
        redisCache.set(shortKey, url);
        localCache.put(shortKey, url);
    }
    return url;
}
```

**ç»Ÿè®¡ä¼˜åŒ–**ï¼š
```java
// é—®é¢˜ï¼šæ¯æ¬¡è·³è½¬éƒ½æ›´æ–°æ•°æ®åº“ï¼Œæ€§èƒ½å·®
// âŒ åŒæ­¥æ›´æ–°
public void incrementClickCount(String shortKey) {
    mapper.incrementClickCount(shortKey);  // æ•°æ®åº“å‹åŠ›å¤§
}

// âœ… å¼‚æ­¥æ‰¹é‡æ›´æ–°
@Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œ
public void syncClickCounts() {
    // 1. ä»Redisè·å–æ‰€æœ‰è®¡æ•°
    Set<String> keys = redisTemplate.keys("short:count:*");
    
    // 2. æ‰¹é‡æ›´æ–°æ•°æ®åº“
    for (String key : keys) {
        String shortKey = key.replace("short:count:", "");
        Long count = redisTemplate.opsForValue().get(key);
        if (count != null && count > 0) {
            mapper.incrementClickCount(shortKey, count.intValue());
            redisTemplate.delete(key);  // æ¸…ç©ºRedisè®¡æ•°
        }
    }
}
```

---

## å››ã€æ‰©å±•ä¼˜åŒ–

### 4.1 è‡ªå®šä¹‰çŸ­é“¾æ¥

```java
public ShortUrlDTO createCustomShortUrl(String originalUrl, String customKey) {
    // 1. æ£€æŸ¥è‡ªå®šä¹‰keyæ˜¯å¦å·²è¢«ä½¿ç”¨
    if (mapper.existsByShortKey(customKey)) {
        throw new BusinessException("è‡ªå®šä¹‰çŸ­é“¾æ¥å·²è¢«ä½¿ç”¨");
    }
    
    // 2. æ ¡éªŒè‡ªå®šä¹‰keyæ ¼å¼
    if (!customKey.matches("^[a-zA-Z0-9_-]{4,10}$")) {
        throw new BusinessException("è‡ªå®šä¹‰çŸ­é“¾æ¥æ ¼å¼ä¸æ­£ç¡®");
    }
    
    // 3. åˆ›å»ºçŸ­é“¾æ¥
    ShortUrl shortUrl = new ShortUrl();
    shortUrl.setShortKey(customKey);  // ä½¿ç”¨è‡ªå®šä¹‰key
    shortUrl.setOriginalUrl(originalUrl);
    mapper.insert(shortUrl);
    
    return convertToDTO(shortUrl);
}
```

### 4.2 é˜²åˆ·ç­–ç•¥

```java
@Component
public class RateLimitInterceptor {
    @Autowired
    private RedisTemplate redisTemplate;
    
    public boolean checkRateLimit(String userId, String api) {
        String key = "rate_limit:" + api + ":" + userId;
        Long count = redisTemplate.opsForValue().increment(key);
        
        if (count == 1) {
            // ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
            redisTemplate.expire(key, 1, TimeUnit.MINUTES);
        }
        
        // æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡
        return count <= 10;
    }
}
```

### 4.3 åˆ†åº“åˆ†è¡¨

**å½“æ•°æ®é‡è¾¾åˆ°äº¿çº§æ—¶**ï¼š

```java
// æŒ‰çŸ­é“¾æ¥keyçš„hashåˆ†åº“åˆ†è¡¨
public class ShardingStrategy {
    private static final int DB_COUNT = 4;     // 4ä¸ªåº“
    private static final int TABLE_COUNT = 8;  // æ¯åº“8å¼ è¡¨
    
    public String getDataSource(String shortKey) {
        int hash = Math.abs(shortKey.hashCode());
        int dbIndex = hash % DB_COUNT;
        return "db" + dbIndex;
    }
    
    public String getTableName(String shortKey) {
        int hash = Math.abs(shortKey.hashCode());
        int tableIndex = hash % TABLE_COUNT;
        return "short_url_" + tableIndex;
    }
}
```

### 4.4 å®‰å…¨é˜²æŠ¤

**é˜²æ­¢æ¶æ„URL**ï¼š
```java
public void validateUrl(String url) {
    // 1. URLæ ¼å¼æ ¡éªŒ
    if (!url.matches("^https?://.*")) {
        throw new BusinessException("URLæ ¼å¼ä¸æ­£ç¡®");
    }
    
    // 2. é»‘åå•æ£€æŸ¥
    if (urlBlacklist.contains(url)) {
        throw new BusinessException("è¯¥URLå·²è¢«ç¦æ­¢");
    }
    
    // 3. é•¿åº¦é™åˆ¶
    if (url.length() > 2048) {
        throw new BusinessException("URLè¿‡é•¿");
    }
}
```

---

## äº”ã€å®¹é‡ä¼°ç®—

### 5.1 å­˜å‚¨å®¹é‡

```
å‡è®¾ï¼š
  - æ¯å¤©æ–°å¢ 100ä¸‡æ¡çŸ­é“¾æ¥
  - æ¯æ¡è®°å½• 260å­—èŠ‚ï¼ˆURL 200B + å­—æ®µ 60Bï¼‰
  - ä¿å­˜ 5å¹´

æ€»å­˜å‚¨ = 100ä¸‡/å¤© Ã— 260B Ã— 365å¤© Ã— 5å¹´
       = 100ä¸‡ Ã— 260 Ã— 1825
       â‰ˆ 475GB Ã— 5
       â‰ˆ 2.4TB
       
åˆ†åº“åˆ†è¡¨ï¼š16ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡ 150GB âœ…
```

### 5.2 QPSä¼°ç®—

```
å‡è®¾ï¼š
  - 1äº¿æ¡çŸ­é“¾æ¥
  - å¹³å‡æ¯æ¡æ¯å¤©è¢«è®¿é—® 10æ¬¡
  - è¯»å†™æ¯” 100:1

æ—¥å‡è¯·æ±‚ = 1äº¿ Ã— 10 = 10äº¿æ¬¡/å¤©
å¹³å‡QPS = 10äº¿ / 86400 â‰ˆ 11,574
å³°å€¼QPSï¼ˆÃ—3ï¼‰â‰ˆ 35,000

å†™å…¥QPS = 35000 / 101 â‰ˆ 350
è¯»å–QPS = 35000 - 350 â‰ˆ 34,650

ç»“è®ºï¼šå…¸å‹çš„è¯»å¤šå†™å°‘åœºæ™¯ï¼Œé‡ç‚¹ä¼˜åŒ–è¯»æ€§èƒ½ âœ…
```

---

## å…­ã€å¸¸è§è¿½é—®

### Q1: å¦‚ä½•ä¿è¯ç”Ÿæˆçš„çŸ­é“¾æ¥å”¯ä¸€ï¼Ÿ

**å›ç­”**ï¼š
```
æ–¹æ¡ˆ1ï¼šæ•°æ®åº“è‡ªå¢ID + Base62
  - MySQLè‡ªå¢IDå¤©ç„¶å”¯ä¸€
  - Base62ç¼–ç ä¿æŒå”¯ä¸€æ€§
  - æ¨èæ–¹æ¡ˆ âœ…

æ–¹æ¡ˆ2ï¼šåˆ†å¸ƒå¼IDç”Ÿæˆå™¨
  - é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰
  - ç¾å›¢Leaf
  - é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼åœºæ™¯

æ–¹æ¡ˆ3ï¼šHash + å†²çªæ£€æµ‹
  - MD5/SHA256 hash
  - å†²çªåˆ™é‡æ–°ç”Ÿæˆ
  - æ€§èƒ½ç¨å·®
```

### Q2: ä¸ºä»€ä¹ˆç”¨302é‡å®šå‘è€Œä¸æ˜¯301ï¼Ÿ

**å›ç­”**ï¼š
```
301 (Permanent Redirect - æ°¸ä¹…é‡å®šå‘):
  âŒ æµè§ˆå™¨ä¼šç¼“å­˜ï¼Œåç»­ç›´æ¥è®¿é—®åŸURL
  âŒ æ— æ³•ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°
  âŒ æ— æ³•ä¿®æ”¹è·³è½¬ç›®æ ‡

302 (Temporary Redirect - ä¸´æ—¶é‡å®šå‘):
  âœ… æ¯æ¬¡éƒ½ç»è¿‡æœåŠ¡å™¨
  âœ… å¯ä»¥ç»Ÿè®¡ç‚¹å‡»æ¬¡æ•°
  âœ… å¯ä»¥ä¿®æ”¹è·³è½¬ç›®æ ‡
  âœ… æ¨èæ–¹æ¡ˆ

ç»“è®ºï¼šçŸ­é“¾æ¥åœºæ™¯ç”¨302 âœ…
```

### Q3: å¦‚ä½•å¤„ç†çƒ­ç‚¹çŸ­é“¾æ¥ï¼Ÿ

**å›ç­”**ï¼š
```
é—®é¢˜ï¼šæŸä¸ªçŸ­é“¾æ¥è¢«å¤§é‡è®¿é—®ï¼Œå•ç‚¹å‹åŠ›å¤§

è§£å†³æ–¹æ¡ˆï¼š
1. å¤šçº§ç¼“å­˜ï¼š
   - æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
   - Redisç¼“å­˜
   - CDNç¼“å­˜

2. è¯»å†™åˆ†ç¦»ï¼š
   - ä¸»åº“å†™å…¥
   - ä»åº“è¯»å–ï¼ˆå¤šä¸ªä»åº“åˆ†æ‹…å‹åŠ›ï¼‰

3. é™æµä¿æŠ¤ï¼š
   - å•ä¸ªçŸ­é“¾æ¥è®¿é—®é¢‘ç‡é™åˆ¶
   - æ•´ä½“ç³»ç»Ÿé™æµ

4. é¢„çƒ­ç¼“å­˜ï¼š
   - çƒ­ç‚¹çŸ­é“¾æ¥æå‰åŠ è½½åˆ°ç¼“å­˜
```

### Q4: çŸ­é“¾æ¥æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ

**å›ç­”**ï¼š
```
é«˜å¯ç”¨æ–¹æ¡ˆï¼š

1. åº”ç”¨å±‚ï¼š
   - å¤šå®ä¾‹éƒ¨ç½²ï¼ˆè‡³å°‘3ä¸ªï¼‰
   - è´Ÿè½½å‡è¡¡ï¼ˆNginx/LVSï¼‰
   - å¥åº·æ£€æŸ¥è‡ªåŠ¨æ‘˜é™¤æ•…éšœèŠ‚ç‚¹

2. ç¼“å­˜å±‚ï¼š
   - Redis Clusterï¼ˆä¸»ä» + å“¨å…µï¼‰
   - å®¢æˆ·ç«¯å®¹é”™

3. æ•°æ®åº“å±‚ï¼š
   - MySQLä¸»ä»å¤åˆ¶
   - è‡ªåŠ¨æ•…éšœè½¬ç§»

4. è·¨åœ°åŸŸï¼š
   - å¤šæœºæˆ¿éƒ¨ç½²
   - GeoDNSå°±è¿‘è®¿é—®

ç›®æ ‡ï¿½ï¿½99.9%å¯ç”¨æ€§ï¼ˆå¹´æ•…éšœæ—¶é—´ < 9å°æ—¶ï¼‰âœ…
```

### Q5: å¦‚ä½•é˜²æ­¢çŸ­é“¾æ¥è¢«æ¶æ„çˆ¬å–ï¼Ÿ

**å›ç­”**ï¼š
```
é˜²æŠ¤æªæ–½ï¼š

1. è®¿é—®é¢‘ç‡é™åˆ¶ï¼š
   - IPé™æµï¼šå•IPæ¯ç§’æœ€å¤š10æ¬¡
   - ç”¨æˆ·é™æµï¼šå•ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š100æ¬¡

2. éªŒè¯ç ï¼š
   - é«˜é¢‘è®¿é—®è§¦å‘éªŒè¯ç 
   - æ»‘åŠ¨éªŒè¯ã€å›¾å½¢éªŒè¯

3. é»‘åå•ï¼š
   - æ¶æ„IPåŠ å…¥é»‘åå•
   - å®šæœŸæ¸…ç†

4. éšæœºåŒ–ï¼š
   - çŸ­é“¾æ¥keyéšæœºï¼Œä¸è¿ç»­
   - å¢åŠ çˆ¬å–éš¾åº¦
```

---

## ä¸ƒã€æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

```
1. æ•°æ®æ¨¡å‹ï¼š
   - MySQLå­˜å‚¨æ˜ å°„å…³ç³»
   - Redisç¼“å­˜çƒ­ç‚¹æ•°æ®

2. ç®—æ³•é€‰æ‹©ï¼š
   - è‡ªå¢ID + Base62ç¼–ç 
   - ç®€å•ã€é«˜æ•ˆã€å”¯ä¸€

3. æ€§èƒ½ä¼˜åŒ–ï¼š
   - å¤šçº§ç¼“å­˜ï¼ˆå‘½ä¸­ç‡>99%ï¼‰
   - å¼‚æ­¥ç»Ÿè®¡ï¼ˆå‡å°‘æ•°æ®åº“å‹åŠ›ï¼‰
   - è¯»å†™åˆ†ç¦»ï¼ˆåº”å¯¹è¯»å¤šå†™å°‘ï¼‰

4. å¯æ‰©å±•æ€§ï¼š
   - æ— çŠ¶æ€æœåŠ¡ï¼ˆæ°´å¹³æ‰©å±•ï¼‰
   - åˆ†åº“åˆ†è¡¨ï¼ˆæ•°æ®åˆ†ç‰‡ï¼‰
   - å¾®æœåŠ¡æ‹†åˆ†ï¼ˆç‹¬ç«‹æ¼”è¿›ï¼‰
```

### é¢è¯•æŠ€å·§

```
1. å…ˆé—®éœ€æ±‚ï¼š
   - QPSå¤šå°‘ï¼Ÿ
   - æ•°æ®è§„æ¨¡ï¼Ÿ
   - è¯»å†™æ¯”ä¾‹ï¼Ÿ

2. ä»ç®€åˆ°ç¹ï¼š
   - V1ï¼šå•æœºç‰ˆ
   - V2ï¼šç¼“å­˜ + ä¸»ä»
   - V3ï¼šåˆ†åº“åˆ†è¡¨ + é›†ç¾¤

3. æƒè¡¡å–èˆï¼š
   - ä¸ºä»€ä¹ˆé€‰Base62ï¼Ÿï¼ˆç®€å•ã€å¤Ÿç”¨ï¼‰
   - ä¸ºä»€ä¹ˆç”¨302ï¼Ÿï¼ˆå¯ç»Ÿè®¡ï¼‰
   - ä¸ºä»€ä¹ˆå¼‚æ­¥ç»Ÿè®¡ï¼Ÿï¼ˆæ€§èƒ½ï¼‰

4. å®æˆ˜ç»éªŒï¼š
   - ç»“åˆè‡ªå·±é¡¹ç›®ç»éªŒ
   - è¯´æ˜é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿè®¾è®¡æ–¹æ³•è®º](../ç³»ç»Ÿè®¾è®¡æ–¹æ³•è®º.md)
- [é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡](../é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡.md)
- [05_è®¾è®¡åˆ†å¸ƒå¼ID](./05_è®¾è®¡åˆ†å¸ƒå¼ID.md)

---

**æœ€åæ›´æ–°**: 2025-10-29  
**éš¾åº¦ç­‰çº§**: â­â­â­â­ (ä¸­ç­‰)  
**é¢è¯•é¢‘ç‡**: â­â­â­â­â­ (æé«˜)

ğŸ’¡ **æ€»ç»“**: çŸ­é“¾æ¥ç³»ç»Ÿæ˜¯ç»å…¸çš„ç³»ç»Ÿè®¾è®¡é¢˜ï¼Œè€ƒå¯Ÿè¯»å¤šå†™å°‘ã€ç¼“å­˜ã€ç®—æ³•ã€æ‰©å±•æ€§ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼
