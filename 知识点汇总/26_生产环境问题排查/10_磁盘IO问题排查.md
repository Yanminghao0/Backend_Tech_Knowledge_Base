# ç£ç›˜IOé—®é¢˜æ’æŸ¥

> å®æˆ˜æŒ‡å—ï¼šå¦‚ä½•æ’æŸ¥ç£ç›˜æ»¡ã€IOç­‰å¾…ã€æ–‡ä»¶å¥æŸ„æ³„éœ²ç­‰ç£ç›˜é—®é¢˜

## ğŸ“‹ ç›®å½•
- [å¸¸è§é—®é¢˜ç±»å‹](#å¸¸è§é—®é¢˜ç±»å‹)
- [ç£ç›˜ç©ºé—´é—®é¢˜](#ç£ç›˜ç©ºé—´é—®é¢˜)
- [IOç­‰å¾…é—®é¢˜](#ioç­‰å¾…é—®é¢˜)
- [æ–‡ä»¶å¥æŸ„æ³„éœ²](#æ–‡ä»¶å¥æŸ„æ³„éœ²)
- [æ’æŸ¥å·¥å…·](#æ’æŸ¥å·¥å…·)

---

## å¸¸è§é—®é¢˜ç±»å‹

### 1. ç£ç›˜ç©ºé—´ä¸è¶³

**ç—‡çŠ¶**ï¼š
```
âœ… ç£ç›˜ä½¿ç”¨ç‡>90%
âœ… æ— æ³•å†™å…¥æ–‡ä»¶
âœ… åº”ç”¨å¼‚å¸¸
```

### 2. IOç­‰å¾…é«˜

**ç—‡çŠ¶**ï¼š
```
âœ… IOç­‰å¾…æ—¶é—´é•¿
âœ… åº”ç”¨å“åº”å˜æ…¢
âœ… ç³»ç»Ÿè´Ÿè½½é«˜
```

### 3. æ–‡ä»¶å¥æŸ„æ³„éœ²

**ç—‡çŠ¶**ï¼š
```
âœ… æ–‡ä»¶å¥æŸ„æ•°æŒç»­å¢é•¿
âœ… æ— æ³•æ‰“å¼€æ–°æ–‡ä»¶
âœ… åº”ç”¨å¼‚å¸¸
```

---

## ç£ç›˜ç©ºé—´é—®é¢˜

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ**

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
df -i  # æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ

# æŸ¥çœ‹ç›®å½•å¤§å°
du -sh /*
du -h --max-depth=1 /

# æŸ¥æ‰¾å¤§æ–‡ä»¶
find / -type f -size +100M -exec ls -lh {} \; | sort -k5 -hr | head -20
```

**2. æŸ¥æ‰¾å¤§æ–‡ä»¶**

```bash
# æŸ¥æ‰¾å¤§äº100Mçš„æ–‡ä»¶
find / -type f -size +100M -exec ls -lh {} \;

# æŸ¥æ‰¾æœ€è¿‘ä¿®æ”¹çš„å¤§æ–‡ä»¶
find / -type f -size +100M -mtime -7 -exec ls -lh {} \;
```

### å¸¸è§åŸå› 

**1. æ—¥å¿—æ–‡ä»¶è¿‡å¤§**

```bash
# æŸ¥æ‰¾æ—¥å¿—æ–‡ä»¶
find /var/log -type f -size +100M

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
# 1. åˆ é™¤æ—§æ—¥å¿—
# 2. å‹ç¼©æ—¥å¿—
# 3. é…ç½®æ—¥å¿—è½®è½¬
```

**2. ä¸´æ—¶æ–‡ä»¶æœªæ¸…ç†**

```bash
# æŸ¥æ‰¾ä¸´æ—¶æ–‡ä»¶
find /tmp -type f -mtime +7

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
find /tmp -type f -mtime +7 -delete
```

**3. å †è½¬å‚¨æ–‡ä»¶**

```bash
# æŸ¥æ‰¾å †è½¬å‚¨æ–‡ä»¶
find / -name "*.hprof" -type f

# æ¸…ç†å †è½¬å‚¨æ–‡ä»¶
find / -name "*.hprof" -type f -mtime +7 -delete
```

### è§£å†³æ–¹æ¡ˆ

**1. æ¸…ç†å¤§æ–‡ä»¶**

```bash
# åˆ é™¤æ—§æ—¥å¿—
find /var/log -type f -mtime +30 -delete

# å‹ç¼©æ—¥å¿—
find /var/log -type f -name "*.log" -mtime +7 -exec gzip {} \;

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
find /tmp -type f -mtime +7 -delete
```

**2. é…ç½®æ—¥å¿—è½®è½¬**

```bash
# é…ç½®logrotate
cat /etc/logrotate.d/application
/var/log/application.log {
    daily
    rotate 7
    compress
    missingok
    notifempty
}
```

**3. ç›‘æ§ç£ç›˜ä½¿ç”¨ç‡**

```bash
# è®¾ç½®å‘Šè­¦
# ç£ç›˜ä½¿ç”¨ç‡>80%æ—¶å‘Šè­¦
```

---

## IOç­‰å¾…é—®é¢˜

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹IOç»Ÿè®¡**

```bash
# æŸ¥çœ‹IOç»Ÿè®¡
iostat -x 1

# æŸ¥çœ‹IOç­‰å¾…
top
vmstat 1

# æŸ¥çœ‹ç£ç›˜IO
iotop
```

**2. æŸ¥çœ‹IOç­‰å¾…è¿›ç¨‹**

```bash
# æŸ¥çœ‹IOç­‰å¾…çš„è¿›ç¨‹
iotop -o

# æŸ¥çœ‹è¿›ç¨‹IOç»Ÿè®¡
pidstat -d 1
```

### å¸¸è§åŸå› 

**1. é¢‘ç¹IOæ“ä½œ**

```java
// âŒ é¢‘ç¹IOæ“ä½œ
for (int i = 0; i < 1000; i++) {
    File file = new File("file" + i);
    file.createNewFile();  // é¢‘ç¹IO
}

// âœ… æ‰¹é‡æ“ä½œ
// 1. æ‰¹é‡å¤„ç†
// 2. ä½¿ç”¨ç¼“å†²
// 3. å¼‚æ­¥IO
```

**2. å¤§æ–‡ä»¶æ“ä½œ**

```java
// âŒ å¤§æ–‡ä»¶æ“ä½œ
byte[] data = Files.readAllBytes(Paths.get("large_file.txt"));  // å¤§æ–‡ä»¶

// âœ… æµå¼å¤„ç†
try (BufferedReader reader = Files.newBufferedReader(Paths.get("large_file.txt"))) {
    String line;
    while ((line = reader.readLine()) != null) {
        // å¤„ç†è¡Œ
    }
}
```

**3. æ•°æ®åº“æ…¢æŸ¥è¯¢**

```sql
-- æ…¢æŸ¥è¯¢å¯¼è‡´IOç­‰å¾…
-- ä¼˜åŒ–SQLï¼Œå‡å°‘IO
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¼˜åŒ–IOæ“ä½œ**

```java
// 1. ä½¿ç”¨ç¼“å†²
// 2. æ‰¹é‡å¤„ç†
// 3. å¼‚æ­¥IO
// 4. æµå¼å¤„ç†
```

**2. ä¼˜åŒ–æ•°æ®åº“**

```sql
-- 1. ä¼˜åŒ–SQL
-- 2. æ·»åŠ ç´¢å¼•
-- 3. åˆ†åº“åˆ†è¡¨
```

**3. ä½¿ç”¨SSD**

```
- ä½¿ç”¨SSDç£ç›˜
- æé«˜IOæ€§èƒ½
```

---

## æ–‡ä»¶å¥æŸ„æ³„éœ²

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°**

```bash
# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°
lsof | wc -l
lsof -p <pid> | wc -l

# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n
cat /proc/sys/fs/file-max
```

**2. æŸ¥çœ‹è¿›ç¨‹æ–‡ä»¶å¥æŸ„**

```bash
# æŸ¥çœ‹è¿›ç¨‹æ–‡ä»¶å¥æŸ„
lsof -p <pid>
ls -l /proc/<pid>/fd | wc -l
```

### å¸¸è§åŸå› 

**1. æ–‡ä»¶æœªå…³é—­**

```java
// âŒ æ–‡ä»¶æœªå…³é—­
FileInputStream fis = new FileInputStream("file.txt");
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // ä½¿ç”¨æ–‡ä»¶
}  // è‡ªåŠ¨å…³é—­
```

**2. è¿æ¥æœªå…³é—­**

```java
// âŒ è¿æ¥æœªå…³é—­
Connection conn = dataSource.getConnection();
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (Connection conn = dataSource.getConnection()) {
    // ä½¿ç”¨è¿æ¥
}  // è‡ªåŠ¨å…³é—­
```

**3. Socketæœªå…³é—­**

```java
// âŒ Socketæœªå…³é—­
Socket socket = new Socket("host", 8080);
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (Socket socket = new Socket("host", 8080)) {
    // ä½¿ç”¨Socket
}  // è‡ªåŠ¨å…³é—­
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¿®å¤èµ„æºæ³„æ¼**

```java
// ä½¿ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æº
try (Resource resource = getResource()) {
    // ä½¿ç”¨èµ„æº
}  // è‡ªåŠ¨å…³é—­
```

**2. å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶**

```bash
# å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n 65535

# æ°¸ä¹…ç”Ÿæ•ˆï¼ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼‰
echo "* soft nofile 65535" >> /etc/security/limits.conf
echo "* hard nofile 65535" >> /etc/security/limits.conf
```

**3. ç›‘æ§æ–‡ä»¶å¥æŸ„**

```bash
# ç›‘æ§æ–‡ä»¶å¥æŸ„æ•°
# è®¾ç½®å‘Šè­¦
```

---

## æ’æŸ¥å·¥å…·

### 1. ç£ç›˜å·¥å…·

```bash
# df - æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
df -i

# du - æŸ¥çœ‹ç›®å½•å¤§å°
du -sh *
du -h --max-depth=1 /

# find - æŸ¥æ‰¾å¤§æ–‡ä»¶
find / -type f -size +100M
```

### 2. IOå·¥å…·

```bash
# iostat - IOç»Ÿè®¡
iostat -x 1

# iotop - IOç›‘æ§
iotop

# pidstat - è¿›ç¨‹IOç»Ÿè®¡
pidstat -d 1
```

### 3. æ–‡ä»¶å¥æŸ„å·¥å…·

```bash
# lsof - æŸ¥çœ‹æ–‡ä»¶å¥æŸ„
lsof
lsof -p <pid>

# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°
lsof | wc -l
ls -l /proc/<pid>/fd | wc -l
```

## ç£ç›˜IOå…·ä½“æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ä¸€ï¼šæ—¥å¿—è½®è½¬å¤±è´¥å¯¼è‡´ç£ç›˜ç©ºé—´è€—å°½

**é—®é¢˜æè¿°**ï¼šåº”ç”¨æœåŠ¡å™¨ç£ç›˜ç©ºé—´åœ¨24å°æ—¶å†…ä»50%é£™å‡è‡³100%ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚

**æ’æŸ¥è¿‡ç¨‹**ï¼š
1. ä½¿ç”¨dfå’Œduå®šä½å¤§æ–‡ä»¶ï¼š
```bash
df -h
cd /var/log/application
du -sh *
```
2. å‘ç°application.logæ–‡ä»¶å¤§å°è¶…è¿‡50GB
3. æ£€æŸ¥logrotateé…ç½®å‘ç°è„šæœ¬æ‰§è¡Œå¤±è´¥

**å…³é”®é…ç½®åˆ†æ**ï¼š
```bash
# âŒ æœ‰é—®é¢˜çš„logrotateé…ç½®
/var/log/application/*.log {
    daily
    rotate 7
    compress
    missingok
    notifempty
    postrotate
        /bin/kill -HUP `cat /var/run/application.pid 2>/dev/null` 2>/dev/null || true
    endscript
}
```

**é—®é¢˜åŸå› **ï¼šåº”ç”¨pidæ–‡ä»¶è·¯å¾„å˜æ›´å¯¼è‡´postrotateè„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œæ—¥å¿—æ— æ³•è½®è½¬ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# âœ… ä¿®å¤åçš„logrotateé…ç½®
/var/log/application/*.log {
    daily
    rotate 7
    compress
    missingok
    notifempty
    # ä½¿ç”¨systemdæ–¹å¼é‡å¯æ—¥å¿—
    postrotate
        systemctl kill -s HUP application.service
    endscript
    # æ·»åŠ æ—¥å¿—å¤§å°é™åˆ¶
    size 100M
}

# æ‰‹åŠ¨è½®è½¬æ—¥å¿—
logrotate -f /etc/logrotate.d/application

# æ¸…ç†è¶…å¤§æ—¥å¿—æ–‡ä»¶
cat /dev/null > /var/log/application/application.log
```

### æ¡ˆä¾‹äºŒï¼šæ•°æ®åº“è¿æ¥æ± é…ç½®ä¸å½“å¯¼è‡´IOç­‰å¾…é«˜

**é—®é¢˜æè¿°**ï¼šæ•°æ®åº“æœåŠ¡å™¨IOç­‰å¾…æŒç»­è¶…è¿‡30%ï¼Œåº”ç”¨æŸ¥è¯¢å“åº”æ—¶é—´å»¶é•¿ã€‚

**æ’æŸ¥è¿‡ç¨‹**ï¼š
1. ä½¿ç”¨iostatæŸ¥çœ‹ç£ç›˜IOæƒ…å†µï¼š
```bash
iostat -x 1
```
2. å‘ç°%iowaité«˜è¾¾35%
3. ä½¿ç”¨pidstatå®šä½åˆ°æ•°æ®åº“è¿›ç¨‹
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ± é…ç½®

**å…³é”®ä»£ç åˆ†æ**ï¼š
```java
// âŒ é—®é¢˜è¿æ¥æ± é…ç½®
@Bean
public DataSource dataSource() {
    HikariConfig config = new HikariConfig();
    config.setJdbcUrl("jdbc:mysql://localhost:3306/db");
    config.setUsername("user");
    config.setPassword("password");
    config.setMaximumPoolSize(50); // è¿æ¥æ± è¿‡å¤§
    config.setConnectionTimeout(3000);
    return new HikariDataSource(config);
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// âœ… ä¼˜åŒ–åçš„è¿æ¥æ± é…ç½®
@Bean
public DataSource dataSource() {
    HikariConfig config = new HikariConfig();
    config.setJdbcUrl("jdbc:mysql://localhost:3306/db");
    config.setUsername("user");
    config.setPassword("password");
    config.setMaximumPoolSize(15); // å‡å°‘è¿æ¥æ•°
    config.setMinimumIdle(5);
    config.setConnectionTimeout(3000);
    config.setIdleTimeout(600000); // 10åˆ†é’Ÿ
    config.setMaxLifetime(1800000); // 30åˆ†é’Ÿ
    // æ·»åŠ è¿æ¥æµ‹è¯•
    config.setConnectionTestQuery("SELECT 1");
    return new HikariDataSource(config);
}
```

### å¸¸è§åŸå› 

**1. é¢‘ç¹IOæ“ä½œ**

```java
// âŒ é¢‘ç¹IOæ“ä½œ
for (int i = 0; i < 1000; i++) {
    File file = new File("file" + i);
    file.createNewFile();  // é¢‘ç¹IO
}

// âœ… æ‰¹é‡æ“ä½œ
// 1. æ‰¹é‡å¤„ç†
// 2. ä½¿ç”¨ç¼“å†²
// 3. å¼‚æ­¥IO
```

**2. å¤§æ–‡ä»¶æ“ä½œ**

```java
// âŒ å¤§æ–‡ä»¶æ“ä½œ
byte[] data = Files.readAllBytes(Paths.get("large_file.txt"));  // å¤§æ–‡ä»¶

// âœ… æµå¼å¤„ç†
try (BufferedReader reader = Files.newBufferedReader(Paths.get("large_file.txt"))) {
    String line;
    while ((line = reader.readLine()) != null) {
        // å¤„ç†è¡Œ
    }
}
```

**3. æ•°æ®åº“æ…¢æŸ¥è¯¢**

```sql
-- æ…¢æŸ¥è¯¢å¯¼è‡´IOç­‰å¾…
-- ä¼˜åŒ–SQLï¼Œå‡å°‘IO
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¼˜åŒ–IOæ“ä½œ**

```java
// 1. ä½¿ç”¨ç¼“å†²
// 2. æ‰¹é‡å¤„ç†
// 3. å¼‚æ­¥IO
// 4. æµå¼å¤„ç†
```

**2. ä¼˜åŒ–æ•°æ®åº“**

```sql
-- 1. ä¼˜åŒ–SQL
-- 2. æ·»åŠ ç´¢å¼•
-- 3. åˆ†åº“åˆ†è¡¨
```

**3. ä½¿ç”¨SSD**

```
- ä½¿ç”¨SSDç£ç›˜
- æé«˜IOæ€§èƒ½
```

---

## æ–‡ä»¶å¥æŸ„æ³„éœ²

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°**

```bash
# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°
lsof | wc -l
lsof -p <pid> | wc -l

# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n
cat /proc/sys/fs/file-max
```

**2. æŸ¥çœ‹è¿›ç¨‹æ–‡ä»¶å¥æŸ„**

```bash
# æŸ¥çœ‹è¿›ç¨‹æ–‡ä»¶å¥æŸ„
lsof -p <pid>
ls -l /proc/<pid>/fd | wc -l
```

### å¸¸è§åŸå› 

**1. æ–‡ä»¶æœªå…³é—­**

```java
// âŒ æ–‡ä»¶æœªå…³é—­
FileInputStream fis = new FileInputStream("file.txt");
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // ä½¿ç”¨æ–‡ä»¶
}  // è‡ªåŠ¨å…³é—­
```

**2. è¿æ¥æœªå…³é—­**

```java
// âŒ è¿æ¥æœªå…³é—­
Connection conn = dataSource.getConnection();
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (Connection conn = dataSource.getConnection()) {
    // ä½¿ç”¨è¿æ¥
}  // è‡ªåŠ¨å…³é—­
```

**3. Socketæœªå…³é—­**

```java
// âŒ Socketæœªå…³é—­
Socket socket = new Socket("host", 8080);
// å¿˜è®°å…³é—­

// âœ… ä½¿ç”¨try-with-resources
try (Socket socket = new Socket("host", 8080)) {
    // ä½¿ç”¨Socket
}  // è‡ªåŠ¨å…³é—­
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¿®å¤èµ„æºæ³„æ¼**

```java
// ä½¿ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æº
try (Resource resource = getResource()) {
    // ä½¿ç”¨èµ„æº
}  // è‡ªåŠ¨å…³é—­
```

**2. å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶**

```bash
# å¢åŠ æ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n 65535

# æ°¸ä¹…ç”Ÿæ•ˆï¼ˆä¿®æ”¹é…ç½®æ–‡ä»¶ï¼‰
echo "* soft nofile 65535" >> /etc/security/limits.conf
echo "* hard nofile 65535" >> /etc/security/limits.conf
```

**3. ç›‘æ§æ–‡ä»¶å¥æŸ„**

```bash
# ç›‘æ§æ–‡ä»¶å¥æŸ„æ•°
# è®¾ç½®å‘Šè­¦
```

---

## æ’æŸ¥å·¥å…·

### 1. ç£ç›˜å·¥å…·

```bash
# df - æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
df -i

# du - æŸ¥çœ‹ç›®å½•å¤§å°
du -sh *
du -h --max-depth=1 /

# find - æŸ¥æ‰¾å¤§æ–‡ä»¶
find / -type f -size +100M
```

### 2. IOå·¥å…·

```bash
# iostat - IOç»Ÿè®¡
iostat -x 1

# iotop - IOç›‘æ§
iotop

# pidstat - è¿›ç¨‹IOç»Ÿè®¡
pidstat -d 1
```

### 3. æ–‡ä»¶å¥æŸ„å·¥å…·

```bash
# lsof - æŸ¥çœ‹æ–‡ä»¶å¥æŸ„
lsof
lsof -p <pid>

# æŸ¥çœ‹æ–‡ä»¶å¥æŸ„æ•°
lsof | wc -l
ls -l /proc/<pid>/fd | wc -l
```

### é«˜çº§æ’æŸ¥æŠ€æœ¯

### ä½¿ç”¨dstatè¿›è¡Œå…¨é¢IOç›‘æ§

**1. å®‰è£…dstat**
```bash
# Ubuntu/Debian
sudo apt-get install dstat

# CentOS/RHEL
sudo yum install dstat
```

**2. ç›‘æ§ç£ç›˜IO**
```bash
# å…¨é¢ç›‘æ§CPUã€å†…å­˜ã€ç£ç›˜IO
dstat -cdngy 1

# è¯¦ç»†ç£ç›˜ç»Ÿè®¡
dstat -D sda,sdb --disk-util --disk-tps

# æŸ¥çœ‹IOç­‰å¾…åˆ†å¸ƒ
dstat --top-io --top-bio
```

### ä½¿ç”¨blktraceåˆ†æå—è®¾å¤‡IO

**1. å®‰è£…blktrace**
```bash
sudo apt-get install blktrace  # Ubuntu/Debian
sudo yum install blktrace      # CentOS/RHEL
```

**2. è·Ÿè¸ªç£ç›˜IO**
```bash
# è·Ÿè¸ªsdaè®¾å¤‡ï¼Œè¾“å‡ºåˆ°å½“å‰ç›®å½•
blktrace -d /dev/sda -o - | blkparse -i -

# ç”ŸæˆæŠ¥å‘Š
blktrace -d /dev/sda -o sda_trace
trace-cmd report sda_trace
```

**3. åˆ†æç»“æœ**
- è¯†åˆ«IOå¯†é›†çš„è¿›ç¨‹å’Œæ“ä½œç±»å‹
- æŸ¥çœ‹éšæœºIOä¸é¡ºåºIOæ¯”ä¾‹
- å®šä½IOç“¶é¢ˆè®¾å¤‡

### iostaté«˜çº§ç”¨æ³•

```bash
# æ˜¾ç¤ºæ‰©å±•ç»Ÿè®¡ï¼Œæ¯ç§’æ›´æ–°ä¸€æ¬¡
iostat -x 1

# æŒ‰è®¾å¤‡å’Œåˆ†åŒºæ˜¾ç¤º
iostat -xmd 1

# æŸ¥çœ‹ç‰¹å®šè®¾å¤‡
iostat -x /dev/sda 1
```

**å…³é”®æŒ‡æ ‡è¯´æ˜**ï¼š
- %iowait: CPUç­‰å¾…IOçš„æ—¶é—´ç™¾åˆ†æ¯”
- %util: è®¾å¤‡åˆ©ç”¨ç‡ï¼Œæ¥è¿‘100%è¡¨ç¤ºé¥±å’Œ
- r/s/w/s: æ¯ç§’è¯»å†™è¯·æ±‚æ•°
- rkB/s/wkB/s: æ¯ç§’è¯»å†™æ•°æ®é‡
- avgqu-sz: å¹³å‡è¯·æ±‚é˜Ÿåˆ—é•¿åº¦
- await: å¹³å‡IOç­‰å¾…æ—¶é—´(æ¯«ç§’)

### ç›‘æ§å‘Šè­¦é…ç½®

### Prometheus + Grafanaç›‘æ§ç£ç›˜æŒ‡æ ‡

**1. èŠ‚ç‚¹å¯¼å‡ºå™¨é…ç½®**
```yaml
# prometheus.ymlé…ç½®
scrape_configs:
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
```

**2. å…³é”®ç›‘æ§æŒ‡æ ‡**
- `node_filesystem_free_bytes`: æ–‡ä»¶ç³»ç»Ÿç©ºé—²ç©ºé—´
- `node_filesystem_size_bytes`: æ–‡ä»¶ç³»ç»Ÿæ€»ç©ºé—´
- `node_filesystem_avail_bytes`: æ–‡ä»¶ç³»ç»Ÿå¯ç”¨ç©ºé—´
- `node_disk_io_time_seconds_total`: ç£ç›˜IOæ—¶é—´
- `node_disk_io_utilization`: ç£ç›˜IOåˆ©ç”¨ç‡
- `node_filefd_allocated`: å·²åˆ†é…æ–‡ä»¶å¥æŸ„æ•°
- `node_filefd_maximum`: æ–‡ä»¶å¥æŸ„æœ€å¤§é™åˆ¶

**3. Prometheuså‘Šè­¦è§„åˆ™**
```yaml
groups:
- name: disk_alerts
  rules:
  - alert: HighDiskUsage
    expr: 1 - (node_filesystem_free_bytes{fstype!~"tmpfs|devtmpfs"} / node_filesystem_size_bytes{fstype!~"tmpfs|devtmpfs"}) > 0.85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High disk usage"
      description: "Disk usage is above 85% for 5 minutes ({{ $value | humanizePercentage }})"

  - alert: HighIoWait
    expr: avg_over_time(node_disk_io_time_seconds_total[5m]) > 0.5
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "High IO wait time"
      description: "IO wait time is above 50% for 5 minutes"

  - alert: FileHandleLimitReached
    expr: node_filefd_allocated / node_filefd_maximum > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "File handle limit reached"
      description: "File handles are above 80% of limit ({{ $value | humanizePercentage }})"
```

**4. Grafanaé¢æ¿é…ç½®**
æ¨èå¯¼å…¥Grafanaé¢æ¿IDï¼š893 (Node Exporter Full)ï¼ŒåŒ…å«å®Œæ•´çš„ç£ç›˜IOç›‘æ§è§†å›¾ã€‚

**æœ€åæ›´æ–°**: 2025-10-29  
**æ–‡æ¡£çŠ¶æ€**: âœ… æ¡†æ¶å·²æ­å»ºï¼Œå†…å®¹æŒç»­å®Œå–„ä¸­

