# æ€§èƒ½é—®é¢˜æ’æŸ¥

> å®æˆ˜æŒ‡å—ï¼šå¦‚ä½•æ’æŸ¥æ¥å£æ…¢ã€å“åº”æ—¶é—´é•¿ã€QPSä½ç­‰æ€§èƒ½é—®é¢˜

## ğŸ“‹ ç›®å½•
- [é—®é¢˜ç°è±¡è¯†åˆ«](#é—®é¢˜ç°è±¡è¯†åˆ«)
- [æ’æŸ¥æ€è·¯](#æ’æŸ¥æ€è·¯)
- [å¸¸è§åŸå› åˆ†æ](#å¸¸è§åŸå› åˆ†æ)
- [æ’æŸ¥å·¥å…·ä¸æ–¹æ³•](#æ’æŸ¥å·¥å…·ä¸æ–¹æ³•)
- [å…¸å‹æ¡ˆä¾‹](#å…¸å‹æ¡ˆä¾‹)

---

## é—®é¢˜ç°è±¡è¯†åˆ«

### å…¸å‹ç—‡çŠ¶

```
âœ… æ¥å£å“åº”æ—¶é—´ï¼ˆRTï¼‰æ˜æ˜¾å¢åŠ 
   - P50 RTï¼šæ­£å¸¸ < 50msï¼Œå¼‚å¸¸ > 200ms
   - P99 RTï¼šæ­£å¸¸ < 200msï¼Œå¼‚å¸¸ > 1000ms

âœ… QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰ä¸‹é™
   - æ­£å¸¸ï¼š10000 QPS
   - å¼‚å¸¸ï¼š5000 QPSï¼ˆä¸‹é™50%ï¼‰

âœ… ååé‡ä¸‹é™
   - TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰ä¸‹é™
   - å¹¶å‘å¤„ç†èƒ½åŠ›ä¸‹é™

âœ… ç”¨æˆ·åé¦ˆ
   - é¡µé¢åŠ è½½æ…¢
   - æ¥å£è¶…æ—¶
   - æ“ä½œå¡é¡¿
```

### ç›‘æ§æŒ‡æ ‡

```
1. åº”ç”¨å±‚æŒ‡æ ‡ï¼š
   - RTï¼ˆå“åº”æ—¶é—´ï¼‰ï¼šP50ã€P90ã€P99
   - QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
   - é”™è¯¯ç‡
   - æˆåŠŸç‡

2. ç³»ç»Ÿå±‚æŒ‡æ ‡ï¼š
   - CPUä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - çº¿ç¨‹æ•°
   - è¿æ¥æ•°

3. ä¸­é—´ä»¶æŒ‡æ ‡ï¼š
   - æ•°æ®åº“æ…¢æŸ¥è¯¢
   - Rediså“åº”æ—¶é—´
   - æ¶ˆæ¯é˜Ÿåˆ—ç§¯å‹
```

---

## æ’æŸ¥æ€è·¯

### æ’æŸ¥æµç¨‹

```
1. ç¡®è®¤é—®é¢˜ç°è±¡
   â†“
2. æŸ¥çœ‹ç›‘æ§å¤§ç›˜ï¼ˆQPSã€RTã€é”™è¯¯ç‡ï¼‰
   â†“
3. å®šä½é—®é¢˜æ¥å£ï¼ˆå“ªä¸ªæ¥å£æ…¢ï¼Ÿï¼‰
   â†“
4. åˆ†æè°ƒç”¨é“¾ï¼ˆæ…¢åœ¨å“ªé‡Œï¼Ÿï¼‰
   â†“
5. æ·±å…¥æ’æŸ¥ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€ç½‘ç»œï¼‰
   â†“
6. ä¼˜åŒ–è§£å†³
```

### æ’æŸ¥æ­¥éª¤

**ç¬¬ä¸€æ­¥ï¼šç¡®è®¤é—®é¢˜èŒƒå›´**
```
- æ˜¯å•ä¸ªæ¥å£æ…¢ï¼Œè¿˜æ˜¯æ‰€æœ‰æ¥å£éƒ½æ…¢ï¼Ÿ
- æ˜¯ç‰¹å®šç”¨æˆ·æ…¢ï¼Œè¿˜æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æ…¢ï¼Ÿ
- æ˜¯ç‰¹å®šæ—¶é—´æ®µæ…¢ï¼Œè¿˜æ˜¯æŒç»­æ…¢ï¼Ÿ
```

**ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹ç›‘æ§æ•°æ®**
```
- APMç›‘æ§ï¼ˆSkyWalkingã€Pinpointï¼‰
- åº”ç”¨ç›‘æ§ï¼ˆPrometheusã€Grafanaï¼‰
- ç³»ç»Ÿç›‘æ§ï¼ˆCPUã€å†…å­˜ã€IOï¼‰
```

**ç¬¬ä¸‰æ­¥ï¼šåˆ†æè°ƒç”¨é“¾**
```
- æ¥å£æ€»è€—æ—¶
- å„ç»„ä»¶è€—æ—¶ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€RPCï¼‰
- æ…¢è°ƒç”¨è¯¦æƒ…
```

**ç¬¬å››æ­¥ï¼šæ·±å…¥æ’æŸ¥**
```
- æ•°æ®åº“æ…¢SQL
- ç¼“å­˜å‘½ä¸­ç‡
- ç½‘ç»œå»¶è¿Ÿ
- çº¿ç¨‹æ± çŠ¶æ€
```

---

## å¸¸è§åŸå› åˆ†æ

### 1. æ•°æ®åº“æ…¢æŸ¥è¯¢

**ç—‡çŠ¶**ï¼š
```
- æ¥å£RTçªç„¶å¢åŠ 
- æ•°æ®åº“CPUä½¿ç”¨ç‡ä¸Šå‡
- æ…¢æŸ¥è¯¢æ—¥å¿—å¢åŠ 
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SHOW VARIABLES LIKE 'slow_query%';
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;

-- æŸ¥çœ‹å½“å‰æ‰§è¡Œä¸­çš„SQL
SHOW PROCESSLIST;

-- åˆ†ææ…¢SQL
EXPLAIN SELECT ...;

-- æŸ¥çœ‹é”ç­‰å¾…
SELECT * FROM information_schema.innodb_lock_waits;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. æ·»åŠ ç´¢å¼•
2. ä¼˜åŒ–SQLï¼ˆé¿å…SELECT *ã€é¿å…å‡½æ•°è®¡ç®—ï¼‰
3. åˆ†åº“åˆ†è¡¨
4. è¯»å†™åˆ†ç¦»
```

### 2. ç¼“å­˜å‘½ä¸­ç‡ä½

**ç—‡çŠ¶**ï¼š
```
- Rediså‘½ä¸­ç‡ < 80%
- å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“
- æ•°æ®åº“å‹åŠ›å¢å¤§
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```bash
# Rediså‘½ä¸­ç‡
redis-cli INFO stats | grep keyspace_hits
redis-cli INFO stats | grep keyspace_misses

# å‘½ä¸­ç‡è®¡ç®—
å‘½ä¸­ç‡ = keyspace_hits / (keyspace_hits + keyspace_misses)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. å¢åŠ ç¼“å­˜é¢„çƒ­
2. è°ƒæ•´ç¼“å­˜è¿‡æœŸæ—¶é—´
3. ä¼˜åŒ–ç¼“å­˜keyè®¾è®¡
4. å¢åŠ å¤šçº§ç¼“å­˜
```

### 3. çº¿ç¨‹æ± æ»¡

**ç—‡çŠ¶**ï¼š
```
- æ¥å£å“åº”å˜æ…¢
- çº¿ç¨‹æ± é˜Ÿåˆ—ç§¯å‹
- å‡ºç°çº¿ç¨‹æ± æ‹’ç»å¼‚å¸¸
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```java
// ä½¿ç”¨ArthasæŸ¥çœ‹çº¿ç¨‹æ± çŠ¶æ€
threadpool

// æŸ¥çœ‹çº¿ç¨‹æ•°
jstack <pid> | grep "pool-"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. å¢åŠ çº¿ç¨‹æ± å¤§å°
2. ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼ˆå‡å°‘çº¿ç¨‹å ç”¨æ—¶é—´ï¼‰
3. ä½¿ç”¨å¼‚æ­¥å¤„ç†
4. å¢åŠ å®ä¾‹æ•°
```

### 4. è¿æ¥æ± æ»¡

**ç—‡çŠ¶**ï¼š
```
- æ•°æ®åº“è¿æ¥æ± æ»¡
- Redisè¿æ¥æ± æ»¡
- å‡ºç°è¿æ¥è¶…æ—¶å¼‚å¸¸
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```java
// æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
HikariCP: active connections, idle connections

// æŸ¥çœ‹Redisè¿æ¥æ•°
redis-cli CLIENT LIST | wc -l
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. å¢åŠ è¿æ¥æ± å¤§å°
2. æ£€æŸ¥è¿æ¥æ³„æ¼ï¼ˆè¿æ¥æœªå…³é—­ï¼‰
3. ä¼˜åŒ–è¿æ¥ä½¿ç”¨ï¼ˆå‡å°‘è¿æ¥æŒæœ‰æ—¶é—´ï¼‰
4. ä½¿ç”¨è¿æ¥æ± ç›‘æ§
```

### 5. ç½‘ç»œå»¶è¿Ÿ

**ç—‡çŠ¶**ï¼š
```
- è·¨æœåŠ¡è°ƒç”¨å˜æ…¢
- ç½‘ç»œå»¶è¿Ÿå¢åŠ 
- å‡ºç°è¶…æ—¶å¼‚å¸¸
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ
ping <host>
traceroute <host>

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -antp | grep <port>
ss -antp | grep <port>
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. æ£€æŸ¥ç½‘ç»œè®¾å¤‡
2. ä¼˜åŒ–æœåŠ¡éƒ¨ç½²ï¼ˆåŒæœºæˆ¿ï¼‰
3. ä½¿ç”¨CDNåŠ é€Ÿ
4. ä¼˜åŒ–ç½‘ç»œé…ç½®
```

---

## æ’æŸ¥å·¥å…·ä¸æ–¹æ³•

### 1. APMç›‘æ§å·¥å…·

**SkyWalking**ï¼š
```
- æŸ¥çœ‹è°ƒç”¨é“¾
- åˆ†ææ…¢æ¥å£
- æŸ¥çœ‹å„ç»„ä»¶è€—æ—¶
```

**Pinpoint**ï¼š
```
- å®æ—¶ç›‘æ§
- è°ƒç”¨é“¾åˆ†æ
- æ€§èƒ½åˆ†æ
```

### 2. Javaåº”ç”¨æ’æŸ¥

**Arthas**ï¼š
```bash
# å®‰è£…Arthas
curl -O https://arthas.aliyun.com/arthas-boot.jar

# å¯åŠ¨
java -jar arthas-boot.jar

# æŸ¥çœ‹æ¥å£è€—æ—¶
trace com.example.service.UserService getUserById

# æŸ¥çœ‹æ–¹æ³•è°ƒç”¨ç»Ÿè®¡
monitor com.example.service.UserService getUserById

# æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
thread

# æŸ¥çœ‹çº¿ç¨‹æ± çŠ¶æ€
threadpool
```

**JProfiler**ï¼š
```
- CPUæ€§èƒ½åˆ†æ
- å†…å­˜åˆ†æ
- çº¿ç¨‹åˆ†æ
```

### 3. æ•°æ®åº“æ’æŸ¥

**æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼š
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;  -- 1ç§’

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;
```

**EXPLAINåˆ†æ**ï¼š
```sql
EXPLAIN SELECT * FROM orders WHERE user_id = 123;

-- é‡ç‚¹å…³æ³¨ï¼š
-- type: è®¿é—®ç±»å‹ï¼ˆALLæœ€å·®ï¼Œconstæœ€å¥½ï¼‰
-- key: ä½¿ç”¨çš„ç´¢å¼•
-- rows: æ‰«æè¡Œæ•°
-- Extra: é¢å¤–ä¿¡æ¯
```

### 4. ç¼“å­˜æ’æŸ¥

**Redisæ€§èƒ½åˆ†æ**ï¼š
```bash
# æŸ¥çœ‹æ…¢æŸ¥è¯¢
redis-cli SLOWLOG GET 10

# æŸ¥çœ‹å¤§key
redis-cli --bigkeys

# æŸ¥çœ‹çƒ­key
redis-cli --hotkeys

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
redis-cli INFO memory
```

---

## å…¸å‹æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šæ¥å£çªç„¶å˜æ…¢

**ç°è±¡**ï¼š
```
- è®¢å•æŸ¥è¯¢æ¥å£RTä»50mså¢åŠ åˆ°2000ms
- QPSä»10000ä¸‹é™åˆ°5000
- ç”¨æˆ·åé¦ˆé¡µé¢åŠ è½½æ…¢
```

**æ’æŸ¥è¿‡ç¨‹**ï¼š
```
1. æŸ¥çœ‹APMç›‘æ§ â†’ è®¢å•æŸ¥è¯¢æ¥å£RTå¼‚å¸¸
2. åˆ†æè°ƒç”¨é“¾ â†’ æ•°æ®åº“æŸ¥è¯¢è€—æ—¶1800ms
3. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿— â†’ å‘ç°å…¨è¡¨æ‰«æ
4. åˆ†æSQL â†’ ç¼ºå°‘ç´¢å¼•
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_id_status ON orders(user_id, status);
```

### æ¡ˆä¾‹2ï¼šé«˜å³°æœŸQPSä¸‹é™

**ç°è±¡**ï¼š
```
- é«˜å³°æœŸQPSä»20000ä¸‹é™åˆ°10000
- æ¥å£RTå¢åŠ åˆ°500ms
- çº¿ç¨‹æ± é˜Ÿåˆ—ç§¯å‹
```

**æ’æŸ¥è¿‡ç¨‹**ï¼š
```
1. æŸ¥çœ‹ç›‘æ§ â†’ çº¿ç¨‹æ± ä½¿ç”¨ç‡100%
2. æŸ¥çœ‹çº¿ç¨‹å †æ ˆ â†’ å¤§é‡çº¿ç¨‹ç­‰å¾…æ•°æ®åº“è¿æ¥
3. æŸ¥çœ‹è¿æ¥æ±  â†’ æ•°æ®åº“è¿æ¥æ± æ»¡
4. æ£€æŸ¥ä»£ç  â†’ å‘ç°è¿æ¥æ³„æ¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. ä¿®å¤è¿æ¥æ³„æ¼
2. å¢åŠ è¿æ¥æ± å¤§å°
3. ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼ˆå‡å°‘è¿æ¥æŒæœ‰æ—¶é—´ï¼‰
```

### æ¡ˆä¾‹3ï¼šç¼“å­˜å‘½ä¸­ç‡ä½

**ç°è±¡**ï¼š
```
- Rediså‘½ä¸­ç‡ä»90%ä¸‹é™åˆ°50%
- æ•°æ®åº“å‹åŠ›å¢å¤§
- æ¥å£RTå¢åŠ 
```

**æ’æŸ¥è¿‡ç¨‹**ï¼š
```
1. æŸ¥çœ‹ç¼“å­˜ç›‘æ§ â†’ å‘½ä¸­ç‡ä¸‹é™
2. åˆ†æç¼“å­˜key â†’ å‘ç°å¤§é‡keyè¿‡æœŸ
3. æŸ¥çœ‹ä»£ç  â†’ ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®ä¸åˆç†
4. æ£€æŸ¥Redisé…ç½® â†’ maxmemory-policyè®¾ç½®ä¸ºvolatile-lru
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
1. è°ƒæ•´ç¼“å­˜è¿‡æœŸæ—¶é—´
   ```java
   // ä¸åŒç±»å‹æ•°æ®è®¾ç½®å·®å¼‚åŒ–è¿‡æœŸæ—¶é—´
   if (isHotData(key)) {
       redis.setex(key, 86400, value); // çƒ­ç‚¹æ•°æ®24å°æ—¶
   } else if (isNormalData(key)) {
       redis.setex(key, 3600, value);  // æ™®é€šæ•°æ®1å°æ—¶
   } else {
       redis.setex(key, 600, value);   // ä¸´æ—¶æ•°æ®10åˆ†é’Ÿ
   }
   ```

2. ä¼˜åŒ–Rediså†…å­˜æ·˜æ±°ç­–ç•¥
   ```bash
   # ä¿®æ”¹redis.conf
   maxmemory-policy allkeys-lru
   maxmemory-samples 10
   ```

3. çƒ­ç‚¹æ•°æ®é¢„çƒ­
   ```java
   // å®šæ—¶ä»»åŠ¡é¢„çƒ­çƒ­ç‚¹æ•°æ®
   @Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
   public void preloadHotData() {
       List<HotData> hotDataList = hotDataService.getTopNHotData(1000);
       for (HotData data : hotDataList) {
           redis.setex(data.getKey(), 86400, JSON.toJSONString(data.getValue()));
       }
   }
   ```

4. å¢åŠ äºŒçº§ç¼“å­˜
   ```java
   // Caffeineæœ¬åœ°ç¼“å­˜ + Redisåˆ†å¸ƒå¼ç¼“å­˜
   LoadingCache<String, String> localCache = Caffeine.newBuilder()
       .maximumSize(5000)
       .expireAfterWrite(5, TimeUnit.MINUTES)
       .build(key -> redis.get(key));
   ```

5. ä¼˜åŒ–ç¼“å­˜keyè®¾è®¡
   ```java
   // é¿å…ç¼“å­˜keyç¢ç‰‡åŒ–
   // âŒ åŸå§‹key: user:{id}:{type}:{date}
   // âœ… ä¼˜åŒ–å: user:{id}:{type} (æŒ‰ç±»å‹èšåˆ)
   ```

## æ€§èƒ½ç“¶é¢ˆå…·ä½“æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ä¸€ï¼šæ•°æ®åº“è¿æ¥æ± é…ç½®ä¸å½“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆ

**é—®é¢˜æè¿°**ï¼šåº”ç”¨åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å“åº”æ—¶é—´ä»50msé£™å‡è‡³2sï¼ŒCPUåˆ©ç”¨ç‡ä»…ä¸º40%ï¼Œå†…å­˜ä½¿ç”¨ç‡æ­£å¸¸ã€‚

**æ’æŸ¥è¿‡ç¨‹**ï¼š
1. ä½¿ç”¨Arthasç›‘æ§åº”ç”¨æ€§èƒ½ï¼š
```bash
# å¯åŠ¨Arthas
docker run -it --rm --name arthas --link app-container:target -v /var/run/docker.sock:/var/run/docker.sock arthas/arthas

# ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´
monitor -c 5 com.example.service.OrderService createOrder

# æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
thread -n 3
```
2. å‘ç°å¤§é‡çº¿ç¨‹å¤„äºWAITINGçŠ¶æ€ï¼Œé˜»å¡åœ¨è·å–æ•°æ®åº“è¿æ¥
3. æ£€æŸ¥è¿æ¥æ± é…ç½®å‘ç°æœ€å¤§è¿æ¥æ•°è®¾ç½®è¿‡å°

**å…³é”®é…ç½®åˆ†æ**ï¼š
```yaml
# âŒ é—®é¢˜é…ç½®
spring:
  datasource:
    hikari:
      maximum-pool-size: 10  # è¿æ¥æ± è¿‡å°
      minimum-idle: 5
      connection-timeout: 3000
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# âœ… ä¼˜åŒ–é…ç½®
spring:
  datasource:
    hikari:
      maximum-pool-size: 30  # æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´
      minimum-idle: 10
      connection-timeout: 5000
      idle-timeout: 600000
      max-lifetime: 1800000

# å¢åŠ ç›‘æ§æŒ‡æ ‡
management:
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
```

### æ¡ˆä¾‹äºŒï¼šJVMå‚æ•°é…ç½®ä¸åˆç†å¯¼è‡´é¢‘ç¹GC

**é—®é¢˜æè¿°**ï¼šåº”ç”¨æ¯30ç§’å‘ç”Ÿä¸€æ¬¡Full GCï¼Œæ¯æ¬¡GCæš‚åœæ—¶é—´è¶…è¿‡500msï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒã€‚

**æ’æŸ¥è¿‡ç¨‹**ï¼š
1. åˆ†æGCæ—¥å¿—ï¼š
```bash
# å¯ç”¨GCæ—¥å¿—
java -Xlog:gc*:file=/var/log/gc.log:time,level,tags -jar app.jar

# ä½¿ç”¨GCVieweråˆ†ææ—¥å¿—
java -jar gcviewer-1.37.jar /var/log/gc.log /tmp/gc-report.html
```
2. å‘ç°æ–°ç”Ÿä»£ç©ºé—´è¿‡å°ï¼Œè€å¹´ä»£å¢é•¿è¿‡å¿«
3. SurvivoråŒºè®¾ç½®ä¸åˆç†å¯¼è‡´å¯¹è±¡è¿‡æ—©è¿›å…¥è€å¹´ä»£

**å…³é”®JVMå‚æ•°ä¼˜åŒ–**ï¼š
```bash
# âŒ é—®é¢˜é…ç½®
java -Xms2g -Xmx2g -XX:+UseParallelGC -jar app.jar

# âœ… ä¼˜åŒ–é…ç½®
java -Xms4g -Xmx4g \
  -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 \
  -XX:G1HeapRegionSize=16m \
  -XX:G1ReservePercent=20 \
  -XX:InitiatingHeapOccupancyPercent=35 \
  -Xlog:gc*:file=/var/log/gc.log:time,level,tags \
  -jar app.jar
```

## é«˜çº§æ€§èƒ½æµ‹è¯•æ–¹æ³•

### JMeterå‹åŠ›æµ‹è¯•å®æˆ˜

**1. å®‰è£…ä¸é…ç½®**
```bash
# ä¸‹è½½JMeter
wget https://dlcdn.apache.org/jmeter/binaries/apache-jmeter-5.6.tgz
tar -zxvf apache-jmeter-5.6.tgz
cd apache-jmeter-5.6/bin
chmod +x jmeter

# å¯åŠ¨JMeterå›¾å½¢ç•Œé¢
./jmeter &
```

**2. ç¼–å†™REST APIæµ‹è¯•è„šæœ¬**
```xml
<!-- ä¿å­˜ä¸ºorder-test.jmx -->
<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.6">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="è®¢å•æœåŠ¡æ€§èƒ½æµ‹è¯•" enabled="true">
      <stringProp name="TestPlan.comments"></stringProp>
      <boolProp name="TestPlan.functional_mode">false</boolProp>
      <boolProp name="TestPlan.tearDown_on_shutdown">true</boolProp>
      <boolProp name="TestPlan.serialize_threadgroups">false</boolProp>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" testname="ç”¨æˆ·å®šä¹‰çš„å˜é‡" enabled="true">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
      <stringProp name="TestPlan.user_define_classpath"></stringProp>
    </TestPlan>
    <hashTree>
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="çº¿ç¨‹ç»„" enabled="true">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="å¾ªç¯æ§åˆ¶å™¨" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <stringProp name="LoopController.loops">100</stringProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">100</stringProp>
        <stringProp name="ThreadGroup.ramp_time">10</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration">300</stringProp>
        <stringProp name="ThreadGroup.delay">0</stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="åˆ›å»ºè®¢å•" enabled="true">
          <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="" elementType="HTTPArgument">
                <boolProp name="HTTPArgument.always_encode">false</boolProp>
                <stringProp name="Argument.value">{"productId":123,"quantity":2,"userId":${userId}}</stringProp>
                <stringProp name="Argument.metadata">=</stringProp>
              </elementProp>
            </collectionProp>
          </elementProp>
          <stringProp name="HTTPSampler.domain">api.example.com</stringProp>
          <stringProp name="HTTPSampler.port">8080</stringProp>
          <stringProp name="HTTPSampler.protocol">http</stringProp>
          <stringProp name="HTTPSampler.contentEncoding"></stringProp>
          <stringProp name="HTTPSampler.path">/api/v1/orders</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
          <boolProp name="HTTPSampler.follow_redirects">true</boolProp>
          <boolProp name="HTTPSampler.auto_redirects">false</boolProp>
          <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
          <boolProp name="HTTPSampler.DO_MULTIPART_POST">false</boolProp>
          <stringProp name="HTTPSampler.embedded_url_re"></stringProp>
          <stringProp name="HTTPSampler.connect_timeout">5000</stringProp>
          <stringProp name="HTTPSampler.response_timeout">30000</stringProp>
        </HTTPSamplerProxy>
        <hashTree>
          <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTPä¿¡æ¯å¤´ç®¡ç†å™¨" enabled="true">
            <collectionProp name="HeaderManager.headers">
              <elementProp name="Content-Type" elementType="Header">
                <stringProp name="Header.name">Content-Type</stringProp>
                <stringProp name="Header.value">application/json</stringProp>
              </elementProp>
              <elementProp name="Authorization" elementType="Header">
                <stringProp name="Header.name">Authorization</stringProp>
                <stringProp name="Header.value">Bearer ${token}</stringProp>
              </elementProp>
            </collectionProp>
          </HeaderManager>
          <hashTree/>
          <JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="JSONæå–å™¨" enabled="true">
            <stringProp name="JSONPostProcessor.referenceNames">orderId</stringProp>
            <stringProp name="JSONPostProcessor.jsonPathExprs">$.data.id</stringProp>
            <stringProp name="JSONPostProcessor.match_numbers">1</stringProp>
          </JSONPostProcessor>
          <hashTree/>
        </hashTree>
        <ResultCollector guiclass="ViewResultsFullVisualizer" testclass="ResultCollector" testname="æŸ¥çœ‹ç»“æœæ ‘" enabled="true">
          <boolProp name="ResultCollector.error_logging">false</boolProp>
          <objProp>
            <name>saveConfig</name>
            <value class="SampleSaveConfiguration">
              <time>true</time>
              <latency>true</latency>
              <timestamp>true</timestamp>
              <success>true</success>
              <label>true</label>
              <code>true</code>
              <message>true</message>
              <threadName>true</threadName>
              <dataType>true</dataType>
              <encoding>false</encoding>
              <assertions>true</assertions>
              <subresults>true</subresults>
              <responseData>false</responseData>
              <samplerData>false</samplerData>
              <xml>false</xml>
              <fieldNames>true</fieldNames>
              <responseHeaders>false</responseHeaders>
              <requestHeaders>false</requestHeaders>
              <responseDataOnError>false</responseDataOnError>
              <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
              <assertionsResultsToSave>0</assertionsResultsToSave>
              <bytes>true</bytes>
              <sentBytes>true</sentBytes>
              <url>true</url>
              <threadCounts>true</threadCounts>
              <idleTime>true</idleTime>
              <connectTime>true</connectTime>
            </value>
          </objProp>
          <stringProp name="filename"></stringProp>
        </ResultCollector>
        <hashTree/>
        <SummaryReport guiclass="SummaryReport" testclass="ResultCollector" testname="æ±‡æ€»æŠ¥å‘Š" enabled="true">
          <boolProp name="ResultCollector.error_logging">false</boolProp>
          <objProp>
            <name>saveConfig</name>
            <value class="SampleSaveConfiguration">
              <time>true</time>
              <latency>true</latency>
              <timestamp>true</timestamp>
              <success>true</success>
              <label>true</label>
              <code>true</code>
              <message>true</message>
              <threadName>true</threadName>
              <dataType>true</dataType>
              <encoding>false</encoding>
              <assertions>true</assertions>
              <subresults>true</subresults>
              <responseData>false</responseData>
              <samplerData>false</samplerData>
              <xml>false</xml>
              <fieldNames>true</fieldNames>
              <responseHeaders>false</responseHeaders>
              <requestHeaders>false</requestHeaders>
              <responseDataOnError>false</responseDataOnError>
              <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
              <assertionsResultsToSave>0</assertionsResultsToSave>
              <bytes>true</bytes>
              <sentBytes>true</sentBytes>
              <url>true</url>
              <threadCounts>true</threadCounts>
              <idleTime>true</idleTime>
              <connectTime>true</connectTime>
            </value>
          </objProp>
          <stringProp name="filename"></stringProp>
        </SummaryReport>
        <hashTree/>
      </hashTree>
    </hashTree>
  </hashTree>
</jmeterTestPlan>
```

**3. å‘½ä»¤è¡Œæ‰§è¡Œæµ‹è¯•**
```bash
# æ‰§è¡Œæµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Š
./jmeter -n -t order-test.jmx -l results.jtl -e -o report/

# æŸ¥çœ‹æŠ¥å‘Š
open report/index.html
```

### Gatlingæ€§èƒ½æµ‹è¯•è„šæœ¬

**1. åˆ›å»ºMavené¡¹ç›®**
```xml
<!-- pom.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>gatling-performance-test</artifactId>
    <version>1.0-SNAPSHOT</version>

    <properties>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <gatling.version>3.9.5</gatling.version>
        <gatling-maven-plugin.version>4.2.6</gatling-maven-plugin.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>io.gatling.highcharts</groupId>
            <artifactId>gatling-charts-highcharts</artifactId>
            <version>${gatling.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>io.gatling</groupId>
                <artifactId>gatling-maven-plugin</artifactId>
                <version>${gatling-maven-plugin.version}</version>
            </plugin>
        </plugins>
    </build>
</project>
```

**2. ç¼–å†™æµ‹è¯•è„šæœ¬**
```scala
// src/test/scala/com/example/OrderSimulation.scala
package com.example

import io.gatling.core.Predef._
import io.gatling.http.Predef._
import scala.concurrent.duration._

class OrderSimulation extends Simulation {
  // é…ç½®HTTPåè®®
  val httpProtocol = http
    .baseUrl("http://api.example.com:8080")
    .acceptHeader("application/json")
    .contentTypeHeader("application/json")
    .authorizationHeader("Bearer ${token}")

  // å®šä¹‰è¯·æ±‚
  val createOrder = exec(http("åˆ›å»ºè®¢å•")
    .post("/api/v1/orders")
    .body(StringBody("""
      {
        "productId": 123,
        "quantity": 2,
        "userId": ${userId}
      }
    """))
    .check(status.is(200))
    .check(jsonPath("$.data.id").saveAs("orderId")))

  // å®šä¹‰åœºæ™¯
  val scn = scenario("è®¢å•æœåŠ¡æ€§èƒ½æµ‹è¯•")
    .exec(session => session.set("userId", scala.util.Random.nextInt(100000))) // éšæœºç”Ÿæˆç”¨æˆ·ID
    .exec(session => session.set("token", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...")) // è®¾ç½®è®¤è¯token
    .exec(createOrder)
    .pause(1)
    .exec(http("æŸ¥è¯¢è®¢å•")
      .get("/api/v1/orders/${orderId}")
      .check(status.is(200)))

  // é…ç½®è´Ÿè½½
  setUp(
    scn.inject(
      rampUsers(1000).during(60.seconds), // 60ç§’å†…é€æ¸å¢åŠ åˆ°1000ç”¨æˆ·
      constantUsersPerSec(200).during(180.seconds).randomized // ç¨³å®š200ç”¨æˆ·/ç§’æŒç»­3åˆ†é’Ÿ
    )
  ).protocols(httpProtocol)
}

## å…¨é“¾è·¯æ€§èƒ½ç›‘æ§é…ç½®

### SkyWalkingåˆ†å¸ƒå¼è¿½è¸ªé…ç½®

**1. æœåŠ¡ç«¯éƒ¨ç½²**
```bash
# ä¸‹è½½SkyWalking
wget https://archive.apache.org/dist/skywalking/9.4.0/apache-skywalking-apm-9.4.0.tar.gz

tar -zxvf apache-skywalking-apm-9.4.0.tar.gz
cd apache-skywalking-apm-bin

# å¯åŠ¨æœåŠ¡ç«¯
bin/startup.sh
```

**2. Agenté…ç½®**
```bash
# åœ¨åº”ç”¨å¯åŠ¨å‚æ•°ä¸­æ·»åŠ 
-javaagent:/path/to/skywalking-agent/skywalking-agent.jar
-Dskywalking.agent.service_name=order-service
-Dskywalking.collector.backend_service=127.0.0.1:11800
-Dskywalking.trace.sampler=1
```

**3. è‡ªå®šä¹‰é“¾è·¯è¿½è¸ª**
```java
import org.apache.skywalking.apm.toolkit.trace.Trace;
import org.apache.skywalking.apm.toolkit.trace.TraceContext;

@Service
public class OrderServiceImpl implements OrderService {
    
    @Trace // è¿½è¸ªæ–¹æ³•è°ƒç”¨
    @Override
    public OrderDTO createOrder(OrderCreateRequest request) {
        // è·å–å½“å‰è¿½è¸ªID
        String traceId = TraceContext.traceId();
        log.info("Create order with traceId: {}", traceId);
        
        // ä¸šåŠ¡é€»è¾‘...
        return orderDTO;
    }
}
```

### Prometheusæ€§èƒ½ç›‘æ§é…ç½®

**1. åº”ç”¨æŒ‡æ ‡æš´éœ²**
```xml
<!-- pom.xml æ·»åŠ ä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**2. é…ç½®æ–‡ä»¶**
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  metrics:
    tags:
      application: ${spring.application.name}
    export:
      prometheus:
        enabled: true
  endpoint:
    metrics:
      enabled: true
    prometheus:
      enabled: true

# è‡ªå®šä¹‰æŒ‡æ ‡
metrics:
  export:
    prometheus:
      step: 1m
      descriptions: true
```

**3. Prometheusç›‘æ§è§„åˆ™**
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'spring-actuator'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 5s
    static_configs:
      - targets: ['localhost:8080']
        labels:
          application: 'order-service'

rule_files:
  - 'alert.rules.yml'

# alert.rules.yml
groups:
- name: æ€§èƒ½å‘Šè­¦è§„åˆ™
  rules:
  - alert: æ¥å£å“åº”æ—¶é—´è¿‡é•¿
    expr: http_server_requests_seconds_sum{quantile="0.95"} > 0.5
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "æ¥å£å“åº”æ—¶é—´è¶…è¿‡500ms"
      description: "æ¥å£ {{ $labels.uri }} 95%å“åº”æ—¶é—´è¶…è¿‡500msï¼Œå½“å‰å€¼: {{ $value }}s"

  - alert: è¯·æ±‚é”™è¯¯ç‡è¿‡é«˜
    expr: sum(rate(http_server_requests_seconds_count{status=~"5.."}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) > 0.01
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "è¯·æ±‚é”™è¯¯ç‡è¶…è¿‡1%"
      description: "é”™è¯¯ç‡ {{ $value | humanizePercentage }}ï¼ŒæŒç»­1åˆ†é’Ÿ"

  - alert: JVMå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
    expr: jvm_memory_used_bytes{area="heap"} / jvm_memory_max_bytes{area="heap"} > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "JVMå †å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å½“å‰ä½¿ç”¨ç‡: {{ $value | humanizePercentage }}"
```

### Grafanaæ€§èƒ½ç›‘æ§é¢æ¿

**1. æ¨èé¢æ¿é…ç½®**
- å¯¼å…¥é¢æ¿ID: 4701 (Spring Boot 2.1 Statistics)
- å¯¼å…¥é¢æ¿ID: 12900 (JVM (Micrometer)ç›‘æ§é¢æ¿)
- å¯¼å…¥é¢æ¿ID: 13332 (HTTPè¯·æ±‚ç›‘æ§é¢æ¿)

**2. è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§é¢æ¿**
```json
{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": 1,
  "iteration": 1635678901234,
  "links": [],
  "panels": [
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "links": []
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "hiddenSeries": false,
      "id": 2,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null",
      "options": {
        "alertThreshold": true
      },
      "percentage": false,
      "pluginVersion": "8.2.2",
      "pointradius": 2,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count[5m])) by (status)",
          "interval": "",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "è¯·æ±‚é‡(QPS)",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "short",
          "label": "QPS",
          "logBase": 1,
          "max": null,
          "min": "0",
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    }
  ],
  "refresh": "5s",
  "schemaVersion": 30,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "",
  "title": "åº”ç”¨æ€§èƒ½ç›‘æ§",
  "uid": "app-performance",
  "version": 1
}
```

## æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

**1. ç´¢å¼•ä¼˜åŒ–åŸåˆ™**
- ä¼˜å…ˆä¸ºWHEREã€JOINã€ORDER BYå­—æ®µåˆ›å»ºç´¢å¼•
- é¿å…è¿‡åº¦ç´¢å¼•ï¼ˆç»´æŠ¤æˆæœ¬é«˜ï¼‰
- ä½¿ç”¨å¤åˆç´¢å¼•æ—¶éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
- å®šæœŸåˆ†ææ…¢æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•

**2. SQLä¼˜åŒ–æŠ€å·§**
```sql
-- âŒ é¿å…SELECT *
SELECT * FROM orders WHERE user_id = 123;

-- âœ… åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
SELECT id, order_no, status FROM orders WHERE user_id = 123;

-- âŒ é¿å…åœ¨WHEREå­å¥ä¸­ä½¿ç”¨å‡½æ•°
SELECT * FROM orders WHERE DATE(create_time) = '2023-01-01';

-- âœ… æ”¹ä¸ºèŒƒå›´æŸ¥è¯¢
SELECT * FROM orders WHERE create_time >= '2023-01-01 00:00:00' AND create_time < '2023-01-02 00:00:00';

-- ä½¿ç”¨æ‰¹é‡æ“ä½œ
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1001, 2),
(1, 1002, 1),
(1, 1003, 3);
```

### ç¼“å­˜ä¼˜åŒ–ç­–ç•¥

**1. ç¼“å­˜æ›´æ–°ç­–ç•¥**
- è¯»å¤šå†™å°‘ï¼šCache-Aside Patternï¼ˆå…ˆæ›´æ•°æ®åº“ï¼Œååˆ ç¼“å­˜ï¼‰
- å†™å¤šè¯»å°‘ï¼šWrite-Through Patternï¼ˆå…ˆæ›´ç¼“å­˜ï¼Œåæ›´æ•°æ®åº“ï¼‰
- é«˜ä¸€è‡´æ€§ï¼šWrite-Behind Patternï¼ˆå¼‚æ­¥æ›´æ–°æ•°æ®åº“ï¼‰

**2. ç¼“å­˜ç©¿é€é˜²æŠ¤**
```java
// ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨
@Service
public class ProductServiceImpl implements ProductService {
    
    @Autowired
    private BloomFilter<Long> productIdBloomFilter;
    
    @Autowired
    private ProductMapper productMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Override
    public ProductDTO getProductById(Long productId) {
        // 1. å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­IDæ˜¯å¦å­˜åœ¨
        if (!productIdBloomFilter.mightContain(productId)) {
            return null;
        }
        
        // 2. æŸ¥è¯¢ç¼“å­˜
        String key = "product:" + productId;
        ProductDTO productDTO = (ProductDTO) redisTemplate.opsForValue().get(key);
        if (productDTO != null) {
            return productDTO;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        productDTO = productMapper.selectById(productId);
        if (productDTO != null) {
            // 4. ç¼“å­˜ç»“æœ
            redisTemplate.opsForValue().set(key, productDTO, 30, TimeUnit.MINUTES);
        } else {
            // 5. ç¼“å­˜ç©ºå€¼
            redisTemplate.opsForValue().set(key, NULL_OBJECT, 5, TimeUnit.MINUTES);
        }
        
        return productDTO;
    }
}
```

### JVMä¼˜åŒ–å»ºè®®

**1. å†…å­˜é…ç½®ä¼˜åŒ–**
- æ–°ç”Ÿä»£å¤§å°ï¼šå»ºè®®å †å†…å­˜çš„30%-40%
- è€å¹´ä»£å¤§å°ï¼šå»ºè®®å †å†…å­˜çš„60%-70%
- é¿å…è®¾ç½®-Xmså°äº-Xmxï¼ˆå»ºè®®è®¾ç½®ä¸ºç›¸åŒå€¼ï¼‰

**2. GCç®—æ³•é€‰æ‹©**
- ååé‡ä¼˜å…ˆï¼šParallel GC
- ä½å»¶è¿Ÿä¼˜å…ˆï¼šG1 GC
- è¶…ä½å»¶è¿Ÿï¼šZGCï¼ˆJDK 11+ï¼‰æˆ–Shenandoah GC

**3. çº¿ç¨‹æ± ä¼˜åŒ–**
```java
@Configuration
public class ThreadPoolConfig {
    
    @Bean
    public ExecutorService orderExecutor() {
        // CPUæ ¸å¿ƒæ•°
        int corePoolSize = Runtime.getRuntime().availableProcessors();
        
        return new ThreadPoolExecutor(
            corePoolSize, // æ ¸å¿ƒçº¿ç¨‹æ•°
            corePoolSize * 2, // æœ€å¤§çº¿ç¨‹æ•°
            60L, // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´
            TimeUnit.SECONDS,
            new LinkedBlockingQueue<>(1000), // é˜Ÿåˆ—å®¹é‡
            new ThreadFactoryBuilder().setNameFormat("order-pool-%d").build(), // çº¿ç¨‹å‘½å
            new ThreadPoolExecutor.CallerRunsPolicy() // æ‹’ç»ç­–ç•¥
        );
    }
}
```

## æ€§èƒ½é—®é¢˜é¢„é˜²æªæ–½

### 1. æ€§èƒ½æµ‹è¯•è§„èŒƒ
- è¦æ±‚ï¼šæ‰€æœ‰æ¥å£P99å“åº”æ—¶é—´<500ms
- å‹æµ‹ç¯å¢ƒï¼šä¸ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸€è‡´
- æµ‹è¯•æ•°æ®é‡ï¼šæ¥è¿‘ç”Ÿäº§æ•°æ®é‡çº§
- æµ‹è¯•åœºæ™¯ï¼šè¦†ç›–æ­£å¸¸ã€å³°å€¼ã€å¼‚å¸¸åœºæ™¯

### 2. ä»£ç è´¨é‡ç®¡æ§
- ä»£ç è¯„å®¡ï¼šå…³æ³¨æ€§èƒ½ç›¸å…³æŒ‡æ ‡
- é™æ€æ‰«æï¼šé›†æˆSonarQubeæ£€æŸ¥æ€§èƒ½é—®é¢˜
- å•å…ƒæµ‹è¯•ï¼šæ ¸å¿ƒæ¥å£è¦†ç›–ç‡>80%
- åŸºå‡†æµ‹è¯•ï¼šå…³é”®ç®—æ³•æ€§èƒ½åŸºå‡†

### 3. ç›‘æ§å‘Šè­¦ä½“ç³»
- å®æ—¶ç›‘æ§ï¼šæ¥å£RTã€QPSã€é”™è¯¯ç‡
- è¶‹åŠ¿åˆ†æï¼šæ€§èƒ½æŒ‡æ ‡å˜åŒ–è¶‹åŠ¿
- æ™ºèƒ½å‘Šè­¦ï¼šå¼‚å¸¸æ£€æµ‹ç®—æ³•è¯†åˆ«æ€§èƒ½è¡°é€€
- æ ¹å› å®šä½ï¼šè‡ªåŠ¨å…³è”æ€§èƒ½æŒ‡æ ‡ä¸ä»£ç å˜æ›´