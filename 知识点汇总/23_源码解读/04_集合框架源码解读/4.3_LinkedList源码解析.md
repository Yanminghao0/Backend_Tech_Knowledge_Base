# LinkedListæºç è§£æ

> åŒå‘é“¾è¡¨å®ç°åŸç†æ·±åº¦è§£æ

## ğŸ“‹ ç›®å½•
- [æ•´ä½“ç»“æ„](#æ•´ä½“ç»“æ„)
- [æ ¸å¿ƒå±æ€§](#æ ¸å¿ƒå±æ€§)
- [æ·»åŠ å…ƒç´ ](#æ·»åŠ å…ƒç´ )
- [åˆ é™¤å…ƒç´ ](#åˆ é™¤å…ƒç´ )
- [æŸ¥è¯¢å…ƒç´ ](#æŸ¥è¯¢å…ƒç´ )
- [é˜Ÿåˆ—æ“ä½œ](#é˜Ÿåˆ—æ“ä½œ)
- [é¢è¯•è¦ç‚¹](#é¢è¯•è¦ç‚¹)

---

## æ•´ä½“ç»“æ„

### ç±»å®šä¹‰

```java
public class LinkedList<E>
    extends AbstractSequentialList<E>
    implements List<E>, Deque<E>, Cloneable, java.io.Serializable {
    
    // å…ƒç´ æ•°é‡
    transient int size = 0;
    
    // å¤´èŠ‚ç‚¹
    transient Node<E> first;
    
    // å°¾èŠ‚ç‚¹
    transient Node<E> last;
}

/**
 * å…³é”®æ¥å£ï¼š
 * - Listï¼šåˆ—è¡¨æ“ä½œ
 * - Dequeï¼šåŒç«¯é˜Ÿåˆ—ï¼ˆå¯ä½œä¸ºæ ˆã€é˜Ÿåˆ—ä½¿ç”¨ï¼‰
 * - Cloneableï¼šå¯å…‹éš†
 * - Serializableï¼šå¯åºåˆ—åŒ–
 */
```

### èŠ‚ç‚¹ç»“æ„

```java
/**
 * åŒå‘é“¾è¡¨èŠ‚ç‚¹
 */
private static class Node<E> {
    E item;        // å…ƒç´ å€¼
    Node<E> next;  // åç»§èŠ‚ç‚¹
    Node<E> prev;  // å‰é©±èŠ‚ç‚¹
    
    Node(Node<E> prev, E element, Node<E> next) {
        this.item = element;
        this.next = next;
        this.prev = prev;
    }
}

// ç»“æ„ç¤ºæ„å›¾
// null â† [first] â†” [node1] â†” [node2] â†” [last] â†’ null
//          â†‘                              â†‘
//        first                          last
```

### ç‰¹ç‚¹

```
LinkedListç‰¹ç‚¹ï¼š
1. åº•å±‚æ˜¯åŒå‘é“¾è¡¨
2. ä¸æ”¯æŒéšæœºè®¿é—®ï¼ˆO(n)ï¼‰
3. å¤´å°¾æ“ä½œO(1)
4. ä¸­é—´æ’å…¥åˆ é™¤O(n)ï¼ˆéœ€è¦å…ˆå®šä½ï¼‰
5. éçº¿ç¨‹å®‰å…¨
6. å…è®¸nullå…ƒç´ 
7. å¯ä½œä¸ºæ ˆã€é˜Ÿåˆ—ã€åŒç«¯é˜Ÿåˆ—ä½¿ç”¨
```

---

## æ ¸å¿ƒå±æ€§

```java
// å…ƒç´ æ•°é‡
transient int size = 0;

// å¤´èŠ‚ç‚¹ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰
transient Node<E> first;

// å°¾èŠ‚ç‚¹ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰
transient Node<E> last;

// ä¿®æ”¹æ¬¡æ•°ï¼ˆfail-fastï¼‰
protected transient int modCount = 0;
```

---

## æ·»åŠ å…ƒç´ 

### add(E e) - å°¾éƒ¨æ·»åŠ 

```java
/**
 * æ·»åŠ å…ƒç´ åˆ°æœ«å°¾
 */
public boolean add(E e) {
    linkLast(e);
    return true;
}

/**
 * é“¾æ¥åˆ°æœ«å°¾
 */
void linkLast(E e) {
    final Node<E> l = last;
    final Node<E> newNode = new Node<>(l, e, null);
    last = newNode;
    
    if (l == null)
        first = newNode;  // ç©ºé“¾è¡¨ï¼Œfirstä¹ŸæŒ‡å‘æ–°èŠ‚ç‚¹
    else
        l.next = newNode;  // åŸå°¾èŠ‚ç‚¹çš„nextæŒ‡å‘æ–°èŠ‚ç‚¹
    
    size++;
    modCount++;
}

// ç¤ºæ„å›¾ï¼š
// æ·»åŠ å‰ï¼š[A] â†” [B] â†” [C](last)
// æ·»åŠ åï¼š[A] â†” [B] â†” [C] â†” [D](last)
```

### addFirst(E e) - å¤´éƒ¨æ·»åŠ 

```java
/**
 * æ·»åŠ å…ƒç´ åˆ°å¤´éƒ¨
 */
public void addFirst(E e) {
    linkFirst(e);
}

/**
 * é“¾æ¥åˆ°å¤´éƒ¨
 */
private void linkFirst(E e) {
    final Node<E> f = first;
    final Node<E> newNode = new Node<>(null, e, f);
    first = newNode;
    
    if (f == null)
        last = newNode;  // ç©ºé“¾è¡¨ï¼Œlastä¹ŸæŒ‡å‘æ–°èŠ‚ç‚¹
    else
        f.prev = newNode;  // åŸå¤´èŠ‚ç‚¹çš„prevæŒ‡å‘æ–°èŠ‚ç‚¹
    
    size++;
    modCount++;
}

// ç¤ºæ„å›¾ï¼š
// æ·»åŠ å‰ï¼š(first)[A] â†” [B] â†” [C]
// æ·»åŠ åï¼š(first)[D] â†” [A] â†” [B] â†” [C]
```

### add(int index, E element) - æŒ‡å®šä½ç½®æ·»åŠ 

```java
/**
 * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ 
 */
public void add(int index, E element) {
    checkPositionIndex(index);
    
    if (index == size)
        linkLast(element);  // å°¾éƒ¨æ’å…¥
    else
        linkBefore(element, node(index));  // åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ’å…¥
}

/**
 * åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ’å…¥
 */
void linkBefore(E e, Node<E> succ) {
    final Node<E> pred = succ.prev;
    final Node<E> newNode = new Node<>(pred, e, succ);
    succ.prev = newNode;
    
    if (pred == null)
        first = newNode;
    else
        pred.next = newNode;
    
    size++;
    modCount++;
}

/**
 * è·å–æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ï¼ˆäºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
 */
Node<E> node(int index) {
    // æ ¹æ®indexä½ç½®å†³å®šä»å¤´è¿˜æ˜¯ä»å°¾å¼€å§‹éå†
    if (index < (size >> 1)) {
        // å‰åŠéƒ¨åˆ†ï¼Œä»å¤´å¼€å§‹
        Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    } else {
        // ååŠéƒ¨åˆ†ï¼Œä»å°¾å¼€å§‹
        Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}
```

---

## åˆ é™¤å…ƒç´ 

### remove() - åˆ é™¤å¤´éƒ¨

```java
/**
 * åˆ é™¤å¹¶è¿”å›å¤´éƒ¨å…ƒç´ 
 */
public E remove() {
    return removeFirst();
}

public E removeFirst() {
    final Node<E> f = first;
    if (f == null)
        throw new NoSuchElementException();
    return unlinkFirst(f);
}

/**
 * æ–­å¼€å¤´èŠ‚ç‚¹
 */
private E unlinkFirst(Node<E> f) {
    final E element = f.item;
    final Node<E> next = f.next;
    
    f.item = null;
    f.next = null;  // help GC
    
    first = next;
    if (next == null)
        last = null;  // é“¾è¡¨å˜ç©º
    else
        next.prev = null;
    
    size--;
    modCount++;
    return element;
}
```

### removeLast() - åˆ é™¤å°¾éƒ¨

```java
/**
 * åˆ é™¤å¹¶è¿”å›å°¾éƒ¨å…ƒç´ 
 */
public E removeLast() {
    final Node<E> l = last;
    if (l == null)
        throw new NoSuchElementException();
    return unlinkLast(l);
}

/**
 * æ–­å¼€å°¾èŠ‚ç‚¹
 */
private E unlinkLast(Node<E> l) {
    final E element = l.item;
    final Node<E> prev = l.prev;
    
    l.item = null;
    l.prev = null;  // help GC
    
    last = prev;
    if (prev == null)
        first = null;  // é“¾è¡¨å˜ç©º
    else
        prev.next = null;
    
    size--;
    modCount++;
    return element;
}
```

### remove(int index) - åˆ é™¤æŒ‡å®šä½ç½®

```java
/**
 * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
 */
public E remove(int index) {
    checkElementIndex(index);
    return unlink(node(index));
}

/**
 * æ–­å¼€æŒ‡å®šèŠ‚ç‚¹
 */
E unlink(Node<E> x) {
    final E element = x.item;
    final Node<E> next = x.next;
    final Node<E> prev = x.prev;
    
    // å¤„ç†å‰é©±
    if (prev == null) {
        first = next;
    } else {
        prev.next = next;
        x.prev = null;
    }
    
    // å¤„ç†åç»§
    if (next == null) {
        last = prev;
    } else {
        next.prev = prev;
        x.next = null;
    }
    
    x.item = null;  // help GC
    size--;
    modCount++;
    return element;
}

// ç¤ºæ„å›¾ï¼šåˆ é™¤B
// åˆ é™¤å‰ï¼š[A] â†” [B] â†” [C]
// åˆ é™¤åï¼š[A] â†” [C]
```

### remove(Object o) - åˆ é™¤æŒ‡å®šå…ƒç´ 

```java
/**
 * åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ 
 */
public boolean remove(Object o) {
    if (o == null) {
        for (Node<E> x = first; x != null; x = x.next) {
            if (x.item == null) {
                unlink(x);
                return true;
            }
        }
    } else {
        for (Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item)) {
                unlink(x);
                return true;
            }
        }
    }
    return false;
}
```

---

## æŸ¥è¯¢å…ƒç´ 

### get(int index)

```java
/**
 * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ 
 * æ—¶é—´å¤æ‚åº¦ï¼šO(n)
 */
public E get(int index) {
    checkElementIndex(index);
    return node(index).item;
}

// node(index)æ–¹æ³•ä½¿ç”¨äºŒåˆ†ä¼˜åŒ–
// å‰åŠéƒ¨åˆ†ä»å¤´éå†ï¼ŒååŠéƒ¨åˆ†ä»å°¾éå†
```

### getFirst() / getLast()

```java
/**
 * è·å–å¤´éƒ¨å…ƒç´  O(1)
 */
public E getFirst() {
    final Node<E> f = first;
    if (f == null)
        throw new NoSuchElementException();
    return f.item;
}

/**
 * è·å–å°¾éƒ¨å…ƒç´  O(1)
 */
public E getLast() {
    final Node<E> l = last;
    if (l == null)
        throw new NoSuchElementException();
    return l.item;
}
```

### indexOf(Object o)

```java
/**
 * æŸ¥æ‰¾å…ƒç´ ä½ç½®ï¼ˆä»å¤´å¼€å§‹ï¼‰
 */
public int indexOf(Object o) {
    int index = 0;
    if (o == null) {
        for (Node<E> x = first; x != null; x = x.next) {
            if (x.item == null)
                return index;
            index++;
        }
    } else {
        for (Node<E> x = first; x != null; x = x.next) {
            if (o.equals(x.item))
                return index;
            index++;
        }
    }
    return -1;
}

/**
 * æŸ¥æ‰¾å…ƒç´ ä½ç½®ï¼ˆä»å°¾å¼€å§‹ï¼‰
 */
public int lastIndexOf(Object o) {
    int index = size;
    if (o == null) {
        for (Node<E> x = last; x != null; x = x.prev) {
            index--;
            if (x.item == null)
                return index;
        }
    } else {
        for (Node<E> x = last; x != null; x = x.prev) {
            index--;
            if (o.equals(x.item))
                return index;
        }
    }
    return -1;
}
```

---

## é˜Ÿåˆ—æ“ä½œ

### ä½œä¸ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰

```java
// å…¥é˜Ÿï¼ˆå°¾éƒ¨æ·»åŠ ï¼‰
public boolean offer(E e) {
    return add(e);
}

// å‡ºé˜Ÿï¼ˆå¤´éƒ¨åˆ é™¤ï¼‰
public E poll() {
    final Node<E> f = first;
    return (f == null) ? null : unlinkFirst(f);
}

// æŸ¥çœ‹é˜Ÿå¤´
public E peek() {
    final Node<E> f = first;
    return (f == null) ? null : f.item;
}
```

### ä½œä¸ºæ ˆï¼ˆLIFOï¼‰

```java
// å…¥æ ˆï¼ˆå¤´éƒ¨æ·»åŠ ï¼‰
public void push(E e) {
    addFirst(e);
}

// å‡ºæ ˆï¼ˆå¤´éƒ¨åˆ é™¤ï¼‰
public E pop() {
    return removeFirst();
}
```

### ä½œä¸ºåŒç«¯é˜Ÿåˆ—

```java
// å¤´éƒ¨æ“ä½œ
public boolean offerFirst(E e) {
    addFirst(e);
    return true;
}

public E pollFirst() {
    final Node<E> f = first;
    return (f == null) ? null : unlinkFirst(f);
}

public E peekFirst() {
    final Node<E> f = first;
    return (f == null) ? null : f.item;
}

// å°¾éƒ¨æ“ä½œ
public boolean offerLast(E e) {
    addLast(e);
    return true;
}

public E pollLast() {
    final Node<E> l = last;
    return (l == null) ? null : unlinkLast(l);
}

public E peekLast() {
    final Node<E> l = last;
    return (l == null) ? null : l.item;
}
```

---

## é¢è¯•è¦ç‚¹

### 1. LinkedList vs ArrayList

```
Q: LinkedListå’ŒArrayListçš„åŒºåˆ«ï¼Ÿ

A:
| å¯¹æ¯”é¡¹ | ArrayList | LinkedList |
|--------|-----------|------------|
| åº•å±‚ç»“æ„ | æ•°ç»„ | åŒå‘é“¾è¡¨ |
| éšæœºè®¿é—® | O(1) | O(n) |
| å¤´éƒ¨æ’å…¥ | O(n) | O(1) |
| å°¾éƒ¨æ’å…¥ | O(1)å‡æ‘Š | O(1) |
| ä¸­é—´æ’å…¥ | O(n) | O(n) |
| å†…å­˜å ç”¨ | è¿ç»­ï¼Œè¾ƒå°‘ | ä¸è¿ç»­ï¼Œè¾ƒå¤šï¼ˆprev+nextï¼‰ |
| ç¼“å­˜å‹å¥½ | æ˜¯ | å¦ |
| å®ç°æ¥å£ | List, RandomAccess | List, Deque |

ä½¿ç”¨å»ºè®®ï¼š
- å¤§å¤šæ•°åœºæ™¯ï¼šArrayListï¼ˆç¼“å­˜å‹å¥½ï¼Œæ€§èƒ½æ›´å¥½ï¼‰
- é¢‘ç¹å¤´éƒ¨æ“ä½œï¼šLinkedList
- éœ€è¦é˜Ÿåˆ—/æ ˆåŠŸèƒ½ï¼šLinkedList
```

### 2. ä¸ºä»€ä¹ˆnode()æ–¹æ³•è¦äºŒåˆ†

```
Q: LinkedListçš„node()æ–¹æ³•ä¸ºä»€ä¹ˆè¦åˆ¤æ–­indexä½ç½®ï¼Ÿ

A:
ä¼˜åŒ–éå†æ¬¡æ•°ï¼š
  - index < size/2ï¼šä»å¤´å¼€å§‹éå†
  - index >= size/2ï¼šä»å°¾å¼€å§‹éå†

ç¤ºä¾‹ï¼šsize=100ï¼ŒæŸ¥æ‰¾index=80
  - ä»å¤´éå†ï¼šéœ€è¦80æ¬¡
  - ä»å°¾éå†ï¼šéœ€è¦20æ¬¡

è™½ç„¶æ—¶é—´å¤æ‚åº¦ä»æ˜¯O(n)ï¼Œä½†å®é™…éå†æ¬¡æ•°å‡åŠ
```

### 3. LinkedListèƒ½ä½œä¸ºæ ˆå’Œé˜Ÿåˆ—å—

```
Q: LinkedListèƒ½ä½œä¸ºæ ˆå’Œé˜Ÿåˆ—ä½¿ç”¨å—ï¼Ÿ

A:
å¯ä»¥ï¼ŒLinkedListå®ç°äº†Dequeæ¥å£

ä½œä¸ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰ï¼š
  - offer(e)ï¼šå°¾éƒ¨å…¥é˜Ÿ
  - poll()ï¼šå¤´éƒ¨å‡ºé˜Ÿ
  - peek()ï¼šæŸ¥çœ‹é˜Ÿå¤´

ä½œä¸ºæ ˆï¼ˆLIFOï¼‰ï¼š
  - push(e)ï¼šå¤´éƒ¨å…¥æ ˆ
  - pop()ï¼šå¤´éƒ¨å‡ºæ ˆ
  - peek()ï¼šæŸ¥çœ‹æ ˆé¡¶

ä½œä¸ºåŒç«¯é˜Ÿåˆ—ï¼š
  - offerFirst/offerLast
  - pollFirst/pollLast
  - peekFirst/peekLast
```

### 4. LinkedListçº¿ç¨‹å®‰å…¨å—

```
Q: LinkedListçº¿ç¨‹å®‰å…¨å—ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ

A:
LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

è§£å†³æ–¹æ¡ˆï¼š
1. Collections.synchronizedList()
   List<String> list = Collections.synchronizedList(new LinkedList<>());

2. ConcurrentLinkedDequeï¼ˆæ¨èï¼‰
   Deque<String> deque = new ConcurrentLinkedDeque<>();

3. æ‰‹åŠ¨åŠ é”
   synchronized (list) {
       list.add("A");
   }
```

### 5. ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨LinkedList

```
Q: ä¸ºä»€ä¹ˆå¾ˆå¤šåœºæ™¯ä¸æ¨èä½¿ç”¨LinkedListï¼Ÿ

A:
1. ç¼“å­˜ä¸å‹å¥½ï¼š
   - å†…å­˜ä¸è¿ç»­
   - CPUç¼“å­˜å‘½ä¸­ç‡ä½

2. å†…å­˜å¼€é”€å¤§ï¼š
   - æ¯ä¸ªèŠ‚ç‚¹é¢å¤–å­˜å‚¨prevå’Œnext
   - å¯¹è±¡å¤´å¼€é”€

3. éšæœºè®¿é—®æ…¢ï¼š
   - get(index)éœ€è¦éå†

4. å®é™…æ€§èƒ½ï¼š
   - å³ä½¿æ˜¯å¤´éƒ¨æ’å…¥ï¼ŒArrayListåœ¨å°æ•°æ®é‡ä¸‹å¯èƒ½æ›´å¿«
   - å› ä¸ºæ•°ç»„çš„ç¼“å­˜å‹å¥½æ€§

æ¨èï¼š
  - å¤§å¤šæ•°åœºæ™¯ä½¿ç”¨ArrayList
  - éœ€è¦é˜Ÿåˆ—åŠŸèƒ½ä½¿ç”¨ArrayDeque
  - åªæœ‰é¢‘ç¹å¤´éƒ¨æ“ä½œä¸”æ•°æ®é‡å¤§æ—¶è€ƒè™‘LinkedList
```

---

## ğŸ’¡ æ€»ç»“

```
LinkedListæ ¸å¿ƒè¦ç‚¹ï¼š

1. åº•å±‚ç»“æ„ï¼š
   - åŒå‘é“¾è¡¨
   - NodeåŒ…å«itemã€prevã€next

2. æ—¶é—´å¤æ‚åº¦ï¼š
   - å¤´å°¾æ“ä½œï¼šO(1)
   - éšæœºè®¿é—®ï¼šO(n)
   - ä¸­é—´æ’å…¥åˆ é™¤ï¼šO(n)

3. å¤šåŠŸèƒ½ï¼š
   - Listï¼šåˆ—è¡¨
   - Dequeï¼šåŒç«¯é˜Ÿåˆ—
   - å¯ä½œä¸ºæ ˆã€é˜Ÿåˆ—ä½¿ç”¨

4. æ³¨æ„äº‹é¡¹ï¼š
   - éçº¿ç¨‹å®‰å…¨
   - å†…å­˜å¼€é”€å¤§
   - ç¼“å­˜ä¸å‹å¥½
   - å¤§å¤šæ•°åœºæ™¯ä¸å¦‚ArrayList
```

---

*æœ€åæ›´æ–°ï¼š2025-12-28*
