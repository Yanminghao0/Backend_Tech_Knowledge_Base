# DubboæœåŠ¡æš´éœ²æºç è§£æ

> ğŸ’¡ æ·±å…¥ç†è§£DubboæœåŠ¡ç«¯å¦‚ä½•å°†æœåŠ¡æš´éœ²ç»™æ¶ˆè´¹è€…è°ƒç”¨

---

## ğŸ“š ç›®å½•

1. [æœåŠ¡æš´éœ²æ¦‚è¿°](#1-æœåŠ¡æš´éœ²æ¦‚è¿°)
2. [ServiceBeanå¤„ç†](#2-servicebeanå¤„ç†)
3. [æœåŠ¡æš´éœ²æµç¨‹](#3-æœåŠ¡æš´éœ²æµç¨‹)
4. [Protocolå±‚å®ç°](#4-protocolå±‚å®ç°)
5. [Registryæ³¨å†Œ](#5-registryæ³¨å†Œ)
6. [å®æˆ˜åº”ç”¨](#6-å®æˆ˜åº”ç”¨)
7. [é¢è¯•è¦ç‚¹](#7-é¢è¯•è¦ç‚¹)

---

## 1. æœåŠ¡æš´éœ²æ¦‚è¿°

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DubboæœåŠ¡æš´éœ²æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æœåŠ¡æä¾›è€…                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ServiceBean                                         â”‚   â”‚
â”‚  â”‚      â”‚                                               â”‚   â”‚
â”‚  â”‚      â–¼                                               â”‚   â”‚
â”‚  â”‚  ServiceConfig.export()                              â”‚   â”‚
â”‚  â”‚      â”‚                                               â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ æœ¬åœ°æš´éœ² (injvm)                            â”‚   â”‚
â”‚  â”‚      â”‚     â””â”€â”€ InjvmProtocol.export()               â”‚   â”‚
â”‚  â”‚      â”‚                                               â”‚   â”‚
â”‚  â”‚      â””â”€â”€ è¿œç¨‹æš´éœ²                                    â”‚   â”‚
â”‚  â”‚            â”œâ”€â”€ Protocol.export() (Dubbo/HTTPç­‰)     â”‚   â”‚
â”‚  â”‚            â”‚     â””â”€â”€ å¯åŠ¨Serverï¼Œç›‘å¬ç«¯å£            â”‚   â”‚
â”‚  â”‚            â”‚                                         â”‚   â”‚
â”‚  â”‚            â””â”€â”€ Registry.register()                   â”‚   â”‚
â”‚  â”‚                  â””â”€â”€ æ³¨å†ŒæœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒ              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

```java
/**
 * æœåŠ¡æš´éœ²æ¶‰åŠçš„æ ¸å¿ƒæ¦‚å¿µ
 */
public class ServiceExportConcepts {
    
    // 1. Invoker - æœåŠ¡è°ƒç”¨çš„æŠ½è±¡
    // å°è£…äº†æœåŠ¡å®ç°ç±»ï¼Œæä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£
    Invoker<T> invoker;
    
    // 2. Exporter - æœåŠ¡æš´éœ²çš„æŠ½è±¡
    // æŒæœ‰Invokerï¼Œè´Ÿè´£æœåŠ¡çš„æš´éœ²å’Œå–æ¶ˆæš´éœ²
    Exporter<T> exporter;
    
    // 3. Protocol - åè®®å±‚
    // è´Ÿè´£æœåŠ¡çš„æš´éœ²å’Œå¼•ç”¨
    Protocol protocol;
    
    // 4. Registry - æ³¨å†Œä¸­å¿ƒ
    // è´Ÿè´£æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°
    Registry registry;
    
    // 5. URL - ç»Ÿä¸€èµ„æºå®šä½
    // è´¯ç©¿æ•´ä¸ªæš´éœ²æµç¨‹ï¼Œæºå¸¦æ‰€æœ‰é…ç½®ä¿¡æ¯
    URL url;
}
```

### 1.3 æš´éœ²æµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æœåŠ¡æš´éœ²æµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Springå®¹å™¨å¯åŠ¨                                          â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚  2. ServiceBeanåˆå§‹åŒ–                                       â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚  3. ç›‘å¬ContextRefreshedEvent                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚  4. è°ƒç”¨export()æ–¹æ³•                                        â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”œâ”€â”€ 4.1 æ£€æŸ¥é…ç½®                                        â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”œâ”€â”€ 4.2 ç»„è£…URL                                         â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”œâ”€â”€ 4.3 æœ¬åœ°æš´éœ²                                        â”‚
â”‚     â”‚     â””â”€â”€ exportLocal()                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     â””â”€â”€ 4.4 è¿œç¨‹æš´éœ²                                        â”‚
â”‚           â”œâ”€â”€ Protocol.export()                             â”‚
â”‚           â””â”€â”€ Registry.register()                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ServiceBeanå¤„ç†

### 2.1 ServiceBeanç±»ç»“æ„

```java
/**
 * ServiceBean - æœåŠ¡æš´éœ²çš„å…¥å£
 * ç»§æ‰¿ServiceConfigï¼Œå®ç°å¤šä¸ªSpringæ¥å£
 */
public class ServiceBean<T> extends ServiceConfig<T> 
        implements InitializingBean, DisposableBean,
        ApplicationContextAware, BeanNameAware,
        ApplicationEventPublisherAware {
    
    private transient ApplicationContext applicationContext;
    private transient String beanName;
    private transient ApplicationEventPublisher applicationEventPublisher;
    
    // æ˜¯å¦æ”¯æŒäº‹ä»¶ç›‘å¬
    private transient boolean supportedApplicationListener;
    
    public ServiceBean() {
        super();
    }
    
    public ServiceBean(Service service) {
        super(service);
    }
}
```

### 2.2 åˆå§‹åŒ–è¿‡ç¨‹

```java
/**
 * Spring Beanåˆå§‹åŒ–å®Œæˆåè°ƒç”¨
 */
@Override
public void afterPropertiesSet() throws Exception {
    // 1. æ£€æŸ¥Provideré…ç½®
    if (getProvider() == null) {
        // ä»Springå®¹å™¨è·å–ProviderConfig
        Map<String, ProviderConfig> providerConfigMap = 
            applicationContext.getBeansOfType(ProviderConfig.class, false, false);
        if (!providerConfigMap.isEmpty()) {
            // è®¾ç½®Provideré…ç½®
        }
    }
    
    // 2. æ£€æŸ¥Applicationé…ç½®
    if (getApplication() == null && (getProvider() == null || 
            getProvider().getApplication() == null)) {
        Map<String, ApplicationConfig> applicationConfigMap = 
            applicationContext.getBeansOfType(ApplicationConfig.class, false, false);
        if (!applicationConfigMap.isEmpty()) {
            // è®¾ç½®Applicationé…ç½®
        }
    }
    
    // 3. æ£€æŸ¥Moduleé…ç½®
    // 4. æ£€æŸ¥Registryé…ç½®
    // 5. æ£€æŸ¥Monitoré…ç½®
    // 6. æ£€æŸ¥Protocolé…ç½®
    
    // 7. ğŸ”¥ å¦‚æœä¸æ˜¯å»¶è¿Ÿæš´éœ²ï¼Œç«‹å³æš´éœ²æœåŠ¡
    if (!supportedApplicationListener) {
        export();
    }
}
```

### 2.3 äº‹ä»¶ç›‘å¬æš´éœ²

```java
/**
 * ç›‘å¬Springå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶
 */
@Override
public void onApplicationEvent(ContextRefreshedEvent event) {
    // ğŸ”¥ å®¹å™¨åˆ·æ–°å®Œæˆåæš´éœ²æœåŠ¡
    if (!isExported() && !isUnexported()) {
        if (logger.isInfoEnabled()) {
            logger.info("The service ready on spring started. " +
                "service: " + getInterface());
        }
        export();
    }
}

/**
 * è®¾ç½®ApplicationContext
 */
@Override
public void setApplicationContext(ApplicationContext applicationContext) {
    this.applicationContext = applicationContext;
    
    // æ³¨å†Œå…³é—­é’©å­
    SpringExtensionFactory.addApplicationContext(applicationContext);
    
    // æ£€æŸ¥æ˜¯å¦æ”¯æŒäº‹ä»¶ç›‘å¬
    supportedApplicationListener = addApplicationListener(applicationContext, this);
}
```

---

## 3. æœåŠ¡æš´éœ²æµç¨‹

### 3.1 export()å…¥å£

```java
/**
 * ServiceConfig.export() - æœåŠ¡æš´éœ²å…¥å£
 */
public synchronized void export() {
    // 1. æ£€æŸ¥æ˜¯å¦éœ€è¦æš´éœ²
    if (!shouldExport()) {
        return;
    }
    
    // 2. æ£€æŸ¥æ˜¯å¦å»¶è¿Ÿæš´éœ²
    if (shouldDelay()) {
        // å»¶è¿Ÿæš´éœ²
        DELAY_EXPORT_EXECUTOR.schedule(this::doExport, getDelay(), TimeUnit.MILLISECONDS);
    } else {
        // ğŸ”¥ ç«‹å³æš´éœ²
        doExport();
    }
}

/**
 * æ‰§è¡Œæš´éœ²
 */
protected synchronized void doExport() {
    if (unexported) {
        throw new IllegalStateException("The service " + interfaceClass.getName() + 
            " has already unexported!");
    }
    if (exported) {
        return;
    }
    exported = true;
    
    // æ£€æŸ¥æ¥å£å
    if (StringUtils.isEmpty(path)) {
        path = interfaceName;
    }
    
    // ğŸ”¥ æ‰§è¡Œæš´éœ²URL
    doExportUrls();
}
```

### 3.2 doExportUrls()

```java
/**
 * æš´éœ²æœåŠ¡URL
 */
private void doExportUrls() {
    // 1. è·å–æœåŠ¡ä»“åº“
    ServiceRepository repository = ApplicationModel.getServiceRepository();
    ServiceDescriptor serviceDescriptor = repository.registerService(getInterfaceClass());
    repository.registerProvider(getUniqueServiceName(), ref, serviceDescriptor, this, null);
    
    // 2. ğŸ”¥ åŠ è½½æ³¨å†Œä¸­å¿ƒURLåˆ—è¡¨
    List<URL> registryURLs = ConfigValidationUtils.loadRegistries(this, true);
    
    // 3. ğŸ”¥ éå†åè®®ï¼Œé€ä¸ªæš´éœ²
    for (ProtocolConfig protocolConfig : protocols) {
        String pathKey = URL.buildKey(getContextPath(protocolConfig)
            .map(p -> p + "/" + path).orElse(path), group, version);
        
        repository.registerService(pathKey, interfaceClass);
        
        // ğŸ”¥ æŒ‰åè®®æš´éœ²æœåŠ¡
        doExportUrlsFor1Protocol(protocolConfig, registryURLs);
    }
}
```

### 3.3 doExportUrlsFor1Protocol()

```java
/**
 * æŒ‰å•ä¸ªåè®®æš´éœ²æœåŠ¡
 */
private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, 
        List<URL> registryURLs) {
    
    String name = protocolConfig.getName();
    if (StringUtils.isEmpty(name)) {
        name = DUBBO;
    }
    
    // 1. ğŸ”¥ æ„å»ºå‚æ•°Map
    Map<String, String> map = new HashMap<>();
    map.put(SIDE_KEY, PROVIDER_SIDE);
    
    // æ·»åŠ è¿è¡Œæ—¶å‚æ•°
    ServiceConfig.appendRuntimeParameters(map);
    
    // æ·»åŠ å„ç§é…ç½®å‚æ•°
    AbstractConfig.appendParameters(map, getMetrics());
    AbstractConfig.appendParameters(map, getApplication());
    AbstractConfig.appendParameters(map, getModule());
    AbstractConfig.appendParameters(map, provider);
    AbstractConfig.appendParameters(map, protocolConfig);
    AbstractConfig.appendParameters(map, this);
    
    // æ·»åŠ æ–¹æ³•çº§é…ç½®
    if (CollectionUtils.isNotEmpty(getMethods())) {
        for (MethodConfig method : getMethods()) {
            AbstractConfig.appendParameters(map, method, method.getName());
            // ... å¤„ç†æ–¹æ³•å‚æ•°
        }
    }
    
    // 2. ğŸ”¥ æ„å»ºæœåŠ¡URL
    String host = findConfigedHosts(protocolConfig, registryURLs, map);
    Integer port = findConfigedPorts(protocolConfig, name, map);
    
    URL url = new URL(name, host, port, getContextPath(protocolConfig)
        .map(p -> p + "/" + path).orElse(path), map);
    
    // 3. ğŸ”¥ è·å–Invoker
    Invoker<?> invoker = PROXY_FACTORY.getInvoker(ref, (Class) interfaceClass, 
        registryURL.addParameterAndEncoded(EXPORT_KEY, url.toFullString()));
    
    // 4. ğŸ”¥ åŒ…è£…Invoker
    DelegateProviderMetaDataInvoker wrapperInvoker = 
        new DelegateProviderMetaDataInvoker(invoker, this);
    
    // 5. ğŸ”¥ æš´éœ²æœåŠ¡
    Exporter<?> exporter = PROTOCOL.export(wrapperInvoker);
    exporters.add(exporter);
}
```

### 3.4 æœ¬åœ°æš´éœ²

```java
/**
 * æœ¬åœ°æš´éœ²ï¼ˆinjvmåè®®ï¼‰
 */
private void exportLocal(URL url) {
    // æ„å»ºæœ¬åœ°URL
    URL local = URLBuilder.from(url)
        .setProtocol(LOCAL_PROTOCOL)  // injvm
        .setHost(LOCALHOST_VALUE)      // 127.0.0.1
        .setPort(0)
        .build();
    
    // ğŸ”¥ ä½¿ç”¨InjvmProtocolæš´éœ²
    Exporter<?> exporter = PROTOCOL.export(
        PROXY_FACTORY.getInvoker(ref, (Class) interfaceClass, local));
    
    exporters.add(exporter);
    logger.info("Export dubbo service " + interfaceClass.getName() + 
        " to local registry url : " + local);
}
```

---

## 4. Protocolå±‚å®ç°

### 4.1 Protocolæ¥å£

```java
/**
 * Protocol - åè®®å±‚æ¥å£
 */
@SPI("dubbo")
public interface Protocol {
    
    /**
     * è·å–é»˜è®¤ç«¯å£
     */
    int getDefaultPort();
    
    /**
     * ğŸ”¥ æš´éœ²æœåŠ¡
     * @param invoker æœåŠ¡è°ƒç”¨è€…
     * @return æœåŠ¡æš´éœ²è€…
     */
    @Adaptive
    <T> Exporter<T> export(Invoker<T> invoker) throws RpcException;
    
    /**
     * å¼•ç”¨æœåŠ¡
     */
    @Adaptive
    <T> Invoker<T> refer(Class<T> type, URL url) throws RpcException;
    
    /**
     * é”€æ¯
     */
    void destroy();
}
```

### 4.2 DubboProtocolå®ç°

```java
/**
 * DubboProtocol - Dubboåè®®å®ç°
 */
public class DubboProtocol extends AbstractProtocol {
    
    public static final String NAME = "dubbo";
    public static final int DEFAULT_PORT = 20880;
    
    // æœåŠ¡ç«¯Serverç¼“å­˜
    private final Map<String, ExchangeServer> serverMap = new ConcurrentHashMap<>();
    
    // å¼•ç”¨è®¡æ•°
    private final Map<String, ReferenceCountExchangeClient> referenceClientMap = 
        new ConcurrentHashMap<>();

    /**
     * ğŸ”¥ æš´éœ²æœåŠ¡
     */
    @Override
    public <T> Exporter<T> export(Invoker<T> invoker) throws RpcException {
        URL url = invoker.getUrl();
        
        // 1. è·å–æœåŠ¡æ ‡è¯†
        String key = serviceKey(url);
        
        // 2. ğŸ”¥ åˆ›å»ºDubboExporter
        DubboExporter<T> exporter = new DubboExporter<T>(invoker, key, exporterMap);
        exporterMap.put(key, exporter);
        
        // 3. æœ¬åœ°å­˜æ ¹ç›¸å…³å¤„ç†
        Boolean isStubSupportEvent = url.getParameter(STUB_EVENT_KEY, DEFAULT_STUB_EVENT);
        Boolean isCallbackservice = url.getParameter(IS_CALLBACK_SERVICE, false);
        if (isStubSupportEvent && !isCallbackservice) {
            String stubServiceMethods = url.getParameter(STUB_EVENT_METHODS_KEY);
            if (stubServiceMethods == null || stubServiceMethods.length() == 0) {
                // ...
            }
        }
        
        // 4. ğŸ”¥ å¯åŠ¨æœåŠ¡ç«¯Server
        openServer(url);
        
        // 5. ä¼˜åŒ–åºåˆ—åŒ–
        optimizeSerialization(url);
        
        return exporter;
    }
    
    /**
     * ğŸ”¥ å¯åŠ¨Server
     */
    private void openServer(URL url) {
        String key = url.getAddress();
        boolean isServer = url.getParameter(IS_SERVER_KEY, true);
        
        if (isServer) {
            // åŒé‡æ£€æŸ¥é”
            ExchangeServer server = serverMap.get(key);
            if (server == null) {
                synchronized (this) {
                    server = serverMap.get(key);
                    if (server == null) {
                        // ğŸ”¥ åˆ›å»ºServer
                        serverMap.put(key, createServer(url));
                    }
                }
            } else {
                // é‡ç½®Serveré…ç½®
                server.reset(url);
            }
        }
    }
    
    /**
     * ğŸ”¥ åˆ›å»ºServer
     */
    private ExchangeServer createServer(URL url) {
        // æ·»åŠ é»˜è®¤å‚æ•°
        url = URLBuilder.from(url)
            .addParameterIfAbsent(CHANNEL_READONLYEVENT_SENT_KEY, Boolean.TRUE.toString())
            .addParameterIfAbsent(HEARTBEAT_KEY, String.valueOf(DEFAULT_HEARTBEAT))
            .addParameter(CODEC_KEY, DubboCodec.NAME)
            .build();
        
        // è·å–Serverç±»å‹ï¼Œé»˜è®¤netty
        String str = url.getParameter(SERVER_KEY, DEFAULT_REMOTING_SERVER);
        
        if (str != null && str.length() > 0 && 
                !ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str)) {
            throw new RpcException("Unsupported server type: " + str);
        }
        
        ExchangeServer server;
        try {
            // ğŸ”¥ ç»‘å®šç«¯å£ï¼Œå¯åŠ¨Server
            server = Exchangers.bind(url, requestHandler);
        } catch (RemotingException e) {
            throw new RpcException("Fail to start server...");
        }
        
        // æ£€æŸ¥å®¢æˆ·ç«¯ç±»å‹
        str = url.getParameter(CLIENT_KEY);
        if (str != null && str.length() > 0) {
            Set<String> supportedTypes = ExtensionLoader
                .getExtensionLoader(Transporter.class).getSupportedExtensions();
            if (!supportedTypes.contains(str)) {
                throw new RpcException("Unsupported client type: " + str);
            }
        }
        
        return server;
    }
}
```

### 4.3 è¯·æ±‚å¤„ç†å™¨

```java
/**
 * è¯·æ±‚å¤„ç†å™¨ - å¤„ç†æ¶ˆè´¹è€…è¯·æ±‚
 */
private ExchangeHandler requestHandler = new ExchangeHandlerAdapter() {
    
    @Override
    public CompletableFuture<Object> reply(ExchangeChannel channel, Object message) 
            throws RemotingException {
        
        if (!(message instanceof Invocation)) {
            throw new RemotingException(channel, "...");
        }
        
        Invocation inv = (Invocation) message;
        
        // ğŸ”¥ è·å–Invoker
        Invoker<?> invoker = getInvoker(channel, inv);
        
        // å›è°ƒå¤„ç†
        if (Boolean.TRUE.toString().equals(
                inv.getObjectAttachments().get(IS_CALLBACK_SERVICE_INVOKE))) {
            // ...
        }
        
        RpcContext.getContext().setRemoteAddress(channel.getRemoteAddress());
        
        // ğŸ”¥ è°ƒç”¨æœåŠ¡
        Result result = invoker.invoke(inv);
        
        return result.thenApply(Function.identity());
    }
    
    /**
     * è·å–Invoker
     */
    Invoker<?> getInvoker(Channel channel, Invocation inv) throws RemotingException {
        // æ„å»ºæœåŠ¡Key
        int port = channel.getLocalAddress().getPort();
        String path = (String) inv.getObjectAttachments().get(PATH_KEY);
        
        String serviceKey = serviceKey(
            port,
            path,
            (String) inv.getObjectAttachments().get(VERSION_KEY),
            (String) inv.getObjectAttachments().get(GROUP_KEY)
        );
        
        // ğŸ”¥ ä»exporterMapè·å–Exporter
        DubboExporter<?> exporter = (DubboExporter<?>) exporterMap.get(serviceKey);
        
        if (exporter == null) {
            throw new RemotingException(channel, "Not found exported service: " + serviceKey);
        }
        
        return exporter.getInvoker();
    }
};
```

### 4.4 Exporterå®ç°

```java
/**
 * DubboExporter - Dubboåè®®çš„Exporterå®ç°
 */
public class DubboExporter<T> extends AbstractExporter<T> {
    
    private final String key;
    private final Map<String, Exporter<?>> exporterMap;
    
    public DubboExporter(Invoker<T> invoker, String key, 
            Map<String, Exporter<?>> exporterMap) {
        super(invoker);
        this.key = key;
        this.exporterMap = exporterMap;
    }
    
    @Override
    public void unexport() {
        super.unexport();
        // ä»Mapä¸­ç§»é™¤
        exporterMap.remove(key);
    }
}

/**
 * AbstractExporter - ExporteræŠ½è±¡å®ç°
 */
public abstract class AbstractExporter<T> implements Exporter<T> {
    
    protected final Logger logger = LoggerFactory.getLogger(getClass());
    
    private final Invoker<T> invoker;
    private volatile boolean unexported = false;
    
    public AbstractExporter(Invoker<T> invoker) {
        if (invoker == null) {
            throw new IllegalStateException("service invoker == null");
        }
        if (invoker.getInterface() == null) {
            throw new IllegalStateException("service type == null");
        }
        if (invoker.getUrl() == null) {
            throw new IllegalStateException("service url == null");
        }
        this.invoker = invoker;
    }
    
    @Override
    public Invoker<T> getInvoker() {
        return invoker;
    }
    
    @Override
    public void unexport() {
        if (unexported) {
            return;
        }
        unexported = true;
        getInvoker().destroy();
    }
}
```

---

## 5. Registryæ³¨å†Œ

### 5.1 RegistryProtocol

```java
/**
 * RegistryProtocol - æ³¨å†Œä¸­å¿ƒåè®®
 * è´Ÿè´£æœåŠ¡æ³¨å†Œå’Œè®¢é˜…
 */
public class RegistryProtocol implements Protocol {
    
    private final Map<URL, NotifyListener> overrideListeners = 
        new ConcurrentHashMap<>();
    
    private final Map<String, ExporterChangeableWrapper<?>> bounds = 
        new ConcurrentHashMap<>();
    
    private Protocol protocol;
    private RegistryFactory registryFactory;
    
    /**
     * ğŸ”¥ æš´éœ²æœåŠ¡ï¼ˆå¸¦æ³¨å†Œï¼‰
     */
    @Override
    public <T> Exporter<T> export(final Invoker<T> originInvoker) throws RpcException {
        // 1. è·å–æ³¨å†Œä¸­å¿ƒURL
        URL registryUrl = getRegistryUrl(originInvoker);
        
        // 2. è·å–æœåŠ¡æä¾›è€…URL
        URL providerUrl = getProviderUrl(originInvoker);
        
        // 3. è·å–è®¢é˜…URLï¼ˆç”¨äºé…ç½®è¦†ç›–ï¼‰
        final URL overrideSubscribeUrl = getSubscribedOverrideUrl(providerUrl);
        
        // 4. åˆ›å»ºè¦†ç›–ç›‘å¬å™¨
        final OverrideListener overrideSubscribeListener = 
            new OverrideListener(overrideSubscribeUrl, originInvoker);
        overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);
        
        // 5. åº”ç”¨é…ç½®è¦†ç›–
        providerUrl = overrideUrlWithConfig(providerUrl, overrideSubscribeListener);
        
        // 6. ğŸ”¥ æ‰§è¡Œæœ¬åœ°æš´éœ²
        final ExporterChangeableWrapper<T> exporter = doLocalExport(originInvoker, providerUrl);
        
        // 7. ğŸ”¥ è·å–æ³¨å†Œä¸­å¿ƒ
        final Registry registry = getRegistry(originInvoker);
        
        // 8. è·å–æ³¨å†ŒURL
        final URL registeredProviderUrl = getUrlToRegistry(providerUrl, registryUrl);
        
        // 9. åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨å†Œ
        boolean register = providerUrl.getParameter(REGISTER_KEY, true);
        if (register) {
            // ğŸ”¥ æ³¨å†ŒæœåŠ¡
            register(registryUrl, registeredProviderUrl);
        }
        
        // 10. æ³¨å†ŒæœåŠ¡æä¾›è€…
        registerStatedUrl(registryUrl, registeredProviderUrl, register);
        
        // 11. è®¢é˜…é…ç½®è¦†ç›–
        registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);
        
        // 12. è®¾ç½®æ³¨å†ŒURL
        exporter.setRegisterUrl(registeredProviderUrl);
        exporter.setSubscribeUrl(overrideSubscribeUrl);
        
        // 13. å‘å¸ƒæœåŠ¡æš´éœ²äº‹ä»¶
        notifyExport(exporter);
        
        return new DestroyableExporter<>(exporter);
    }
}
```

### 5.2 æœ¬åœ°æš´éœ²

```java
/**
 * æ‰§è¡Œæœ¬åœ°æš´éœ²
 */
private <T> ExporterChangeableWrapper<T> doLocalExport(final Invoker<T> originInvoker, 
        URL providerUrl) {
    
    String key = getCacheKey(originInvoker);
    
    return (ExporterChangeableWrapper<T>) bounds.computeIfAbsent(key, s -> {
        // åˆ›å»ºInvokerDelegate
        Invoker<?> invokerDelegate = new InvokerDelegate<>(originInvoker, providerUrl);
        
        // ğŸ”¥ ä½¿ç”¨å…·ä½“åè®®æš´éœ²ï¼ˆå¦‚DubboProtocolï¼‰
        return new ExporterChangeableWrapper<>(
            (Exporter<T>) protocol.export(invokerDelegate), originInvoker);
    });
}
```

### 5.3 æœåŠ¡æ³¨å†Œ

```java
/**
 * æ³¨å†ŒæœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒ
 */
public void register(URL registryUrl, URL registeredProviderUrl) {
    // è·å–æ³¨å†Œä¸­å¿ƒ
    Registry registry = registryFactory.getRegistry(registryUrl);
    
    // ğŸ”¥ æ³¨å†ŒæœåŠ¡
    registry.register(registeredProviderUrl);
}

/**
 * ZookeeperRegistry - Zookeeperæ³¨å†Œä¸­å¿ƒå®ç°
 */
public class ZookeeperRegistry extends FailbackRegistry {
    
    private final ZookeeperClient zkClient;
    
    @Override
    public void doRegister(URL url) {
        try {
            // ğŸ”¥ åˆ›å»ºZookeeperèŠ‚ç‚¹
            zkClient.create(toUrlPath(url), url.getParameter(DYNAMIC_KEY, true));
        } catch (Throwable e) {
            throw new RpcException("Failed to register " + url + " to zookeeper...");
        }
    }
    
    /**
     * æ„å»ºURLè·¯å¾„
     * æ ¼å¼ï¼š/dubbo/æ¥å£å/providers/URLç¼–ç 
     */
    private String toUrlPath(URL url) {
        return toCategoryPath(url) + PATH_SEPARATOR + URL.encode(url.toFullString());
    }
    
    private String toCategoryPath(URL url) {
        return toServicePath(url) + PATH_SEPARATOR + 
            url.getParameter(CATEGORY_KEY, DEFAULT_CATEGORY);
    }
    
    private String toServicePath(URL url) {
        String name = url.getServiceInterface();
        if (ANY_VALUE.equals(name)) {
            return toRootPath();
        }
        return toRootDir() + URL.encode(name);
    }
}
```

### 5.4 æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Zookeeperæ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹ç»“æ„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  /dubbo                                                     â”‚
â”‚  â””â”€â”€ com.example.UserService                                â”‚
â”‚      â”œâ”€â”€ providers                                          â”‚
â”‚      â”‚   â”œâ”€â”€ dubbo://192.168.1.1:20880/...                 â”‚
â”‚      â”‚   â””â”€â”€ dubbo://192.168.1.2:20880/...                 â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€ consumers                                          â”‚
â”‚      â”‚   â””â”€â”€ consumer://192.168.1.3/...                    â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€ routers                                            â”‚
â”‚      â”‚   â””â”€â”€ route://0.0.0.0/...                           â”‚
â”‚      â”‚                                                      â”‚
â”‚      â””â”€â”€ configurators                                      â”‚
â”‚          â””â”€â”€ override://0.0.0.0/...                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å®æˆ˜åº”ç”¨

### 6.1 æœåŠ¡æš´éœ²é…ç½®

```xml
<!-- XMLé…ç½®æ–¹å¼ -->
<dubbo:application name="demo-provider"/>

<dubbo:registry address="zookeeper://127.0.0.1:2181"/>

<dubbo:protocol name="dubbo" port="20880"/>

<!-- æš´éœ²æœåŠ¡ -->
<dubbo:service interface="com.example.UserService" ref="userService">
    <dubbo:method name="getUser" timeout="3000"/>
</dubbo:service>

<bean id="userService" class="com.example.UserServiceImpl"/>
```

```java
/**
 * æ³¨è§£é…ç½®æ–¹å¼
 */
@DubboService(version = "1.0.0", timeout = 3000)
public class UserServiceImpl implements UserService {
    
    @Override
    public User getUser(Long id) {
        return new User(id, "test");
    }
}
```

### 6.2 è‡ªå®šä¹‰æš´éœ²é€»è¾‘

```java
/**
 * è‡ªå®šä¹‰æœåŠ¡æš´éœ²ç›‘å¬å™¨
 */
@Activate(group = CommonConstants.PROVIDER)
public class CustomExporterListener implements ExporterListener {
    
    @Override
    public void exported(Exporter<?> exporter) throws RpcException {
        URL url = exporter.getInvoker().getUrl();
        System.out.println("Service exported: " + url.getServiceInterface());
        
        // è‡ªå®šä¹‰é€»è¾‘ï¼šè®°å½•æš´éœ²çš„æœåŠ¡
        // å‘é€é€šçŸ¥ã€æ›´æ–°ç›‘æ§ç­‰
    }
    
    @Override
    public void unexported(Exporter<?> exporter) {
        URL url = exporter.getInvoker().getUrl();
        System.out.println("Service unexported: " + url.getServiceInterface());
    }
}
```

### 6.3 å»¶è¿Ÿæš´éœ²

```java
/**
 * å»¶è¿Ÿæš´éœ²é…ç½®
 */
@DubboService(delay = 5000)  // å»¶è¿Ÿ5ç§’æš´éœ²
public class DelayedServiceImpl implements DelayedService {
    // ...
}

// æˆ–è€…å…¨å±€é…ç½®
// dubbo.provider.delay=5000
```

### 6.4 å¤šåè®®æš´éœ²

```java
/**
 * åŒæ—¶ä½¿ç”¨å¤šä¸ªåè®®æš´éœ²æœåŠ¡
 */
@DubboService(protocol = {"dubbo", "rest"})
public class MultiProtocolServiceImpl implements MultiProtocolService {
    // åŒæ—¶æ”¯æŒDubboåè®®å’ŒRESTåè®®
}
```

---

## 7. é¢è¯•è¦ç‚¹

### 7.1 é«˜é¢‘é¢è¯•é¢˜

#### Q1: DubboæœåŠ¡æš´éœ²çš„æ•´ä½“æµç¨‹ï¼Ÿ

```
æœåŠ¡æš´éœ²æµç¨‹ï¼š

1. Springå®¹å™¨å¯åŠ¨
   - è§£æDubboé…ç½®
   - åˆ›å»ºServiceBean

2. ServiceBeanåˆå§‹åŒ–
   - afterPropertiesSet()æ£€æŸ¥é…ç½®
   - ç›‘å¬ContextRefreshedEvent

3. è°ƒç”¨export()æ–¹æ³•
   - æ£€æŸ¥é…ç½®å‚æ•°
   - ç»„è£…æœåŠ¡URL

4. æœ¬åœ°æš´éœ²ï¼ˆå¯é€‰ï¼‰
   - InjvmProtocol.export()
   - ç”¨äºåŒJVMå†…è°ƒç”¨

5. è¿œç¨‹æš´éœ²
   - Protocol.export()å¯åŠ¨Server
   - Registry.register()æ³¨å†ŒæœåŠ¡

6. å®Œæˆæš´éœ²
   - ç¼“å­˜Exporter
   - å‘å¸ƒæš´éœ²äº‹ä»¶
```

#### Q2: ServiceBeanå’ŒServiceConfigçš„å…³ç³»ï¼Ÿ

```java
/**
 * ServiceBeanç»§æ‰¿ServiceConfig
 * 
 * ServiceConfigï¼š
 * - æœåŠ¡é…ç½®ç±»
 * - åŒ…å«æœåŠ¡æš´éœ²çš„æ ¸å¿ƒé€»è¾‘
 * - export()ã€doExport()ç­‰æ–¹æ³•
 * 
 * ServiceBeanï¼š
 * - Springé›†æˆç±»
 * - å®ç°InitializingBeanã€ApplicationListenerç­‰æ¥å£
 * - è´Ÿè´£ä¸Springå®¹å™¨äº¤äº’
 * - åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨export()
 */
public class ServiceBean<T> extends ServiceConfig<T> 
        implements InitializingBean, DisposableBean,
        ApplicationContextAware, ApplicationEventPublisherAware {
    // ...
}
```

#### Q3: æœ¬åœ°æš´éœ²å’Œè¿œç¨‹æš´éœ²çš„åŒºåˆ«ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœ¬åœ°æš´éœ² vs è¿œç¨‹æš´éœ²                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç‰¹æ€§          â”‚ æœ¬åœ°æš´éœ²        â”‚ è¿œç¨‹æš´éœ²                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åè®®          â”‚ injvm           â”‚ dubbo/httpç­‰            â”‚
â”‚  ç½‘ç»œé€šä¿¡      â”‚ ä¸éœ€è¦          â”‚ éœ€è¦                     â”‚
â”‚  åºåˆ—åŒ–        â”‚ ä¸éœ€è¦          â”‚ éœ€è¦                     â”‚
â”‚  ä½¿ç”¨åœºæ™¯      â”‚ åŒJVMè°ƒç”¨       â”‚ è·¨JVMè°ƒç”¨               â”‚
â”‚  æ€§èƒ½          â”‚ é«˜              â”‚ ç›¸å¯¹è¾ƒä½                 â”‚
â”‚  æ³¨å†Œä¸­å¿ƒ      â”‚ ä¸æ³¨å†Œ          â”‚ éœ€è¦æ³¨å†Œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Q4: Exporterå’ŒInvokerçš„å…³ç³»ï¼Ÿ

```java
/**
 * Invokerï¼šæœåŠ¡è°ƒç”¨çš„æŠ½è±¡
 * - å°è£…æœåŠ¡å®ç°ç±»
 * - æä¾›invoke()æ–¹æ³•æ‰§è¡Œè°ƒç”¨
 * 
 * Exporterï¼šæœåŠ¡æš´éœ²çš„æŠ½è±¡
 * - æŒæœ‰Invokerå¼•ç”¨
 * - è´Ÿè´£æœåŠ¡çš„æš´éœ²å’Œå–æ¶ˆæš´éœ²
 * - unexport()æ—¶é”€æ¯Invoker
 */
public interface Exporter<T> {
    Invoker<T> getInvoker();
    void unexport();
}

public interface Invoker<T> extends Node {
    Class<T> getInterface();
    Result invoke(Invocation invocation) throws RpcException;
}
```

### 7.2 æºç é˜…è¯»è¦ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æœåŠ¡æš´éœ²æºç é˜…è¯»è·¯çº¿                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å…¥å£ï¼šServiceBean.onApplicationEvent()                     â”‚
â”‚    â”‚                                                        â”‚
â”‚    â–¼                                                        â”‚
â”‚  ServiceConfig.export()                                     â”‚
â”‚    â”‚                                                        â”‚
â”‚    â”œâ”€â”€ doExport()                                           â”‚
â”‚    â”‚     â””â”€â”€ doExportUrls()                                 â”‚
â”‚    â”‚           â””â”€â”€ doExportUrlsFor1Protocol()               â”‚
â”‚    â”‚                 â”‚                                      â”‚
â”‚    â”‚                 â”œâ”€â”€ æ„å»ºURL                            â”‚
â”‚    â”‚                 â”œâ”€â”€ è·å–Invoker                        â”‚
â”‚    â”‚                 â””â”€â”€ Protocol.export()                  â”‚
â”‚    â”‚                                                        â”‚
â”‚    â””â”€â”€ RegistryProtocol.export()                            â”‚
â”‚          â”œâ”€â”€ doLocalExport() // æœ¬åœ°æš´éœ²                    â”‚
â”‚          â”‚     â””â”€â”€ DubboProtocol.export()                   â”‚
â”‚          â”‚           â””â”€â”€ openServer()                       â”‚
â”‚          â”‚                                                  â”‚
â”‚          â””â”€â”€ register() // æ³¨å†ŒæœåŠ¡                         â”‚
â”‚                â””â”€â”€ ZookeeperRegistry.doRegister()           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å…³é”®ç±»æ€»ç»“

```
æœåŠ¡æš´éœ²æ¶‰åŠçš„å…³é”®ç±»ï¼š

1. é…ç½®å±‚
   - ServiceConfigï¼šæœåŠ¡é…ç½®
   - ServiceBeanï¼šSpringé›†æˆ

2. ä»£ç†å±‚
   - ProxyFactoryï¼šåˆ›å»ºInvoker
   - JavassistProxyFactoryï¼šé»˜è®¤å®ç°

3. åè®®å±‚
   - Protocolï¼šåè®®æ¥å£
   - DubboProtocolï¼šDubboåè®®
   - RegistryProtocolï¼šæ³¨å†Œåè®®

4. æ³¨å†Œå±‚
   - Registryï¼šæ³¨å†Œä¸­å¿ƒæ¥å£
   - ZookeeperRegistryï¼šZKå®ç°
   - RegistryFactoryï¼šæ³¨å†Œä¸­å¿ƒå·¥å‚

5. ä¼ è¾“å±‚
   - Transporterï¼šä¼ è¾“æ¥å£
   - NettyTransporterï¼šNettyå®ç°
   - ExchangeServerï¼šäº¤æ¢æœåŠ¡å™¨
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

```
1. æœåŠ¡æš´éœ²ç”±ServiceBeanè§¦å‘
   - ç›‘å¬Springå®¹å™¨åˆ·æ–°äº‹ä»¶
   - è°ƒç”¨ServiceConfig.export()

2. æš´éœ²æµç¨‹åˆ†ä¸ºæœ¬åœ°å’Œè¿œç¨‹
   - æœ¬åœ°æš´éœ²ä½¿ç”¨InjvmProtocol
   - è¿œç¨‹æš´éœ²ä½¿ç”¨DubboProtocolç­‰

3. Protocolè´Ÿè´£å¯åŠ¨Server
   - ç»‘å®šç«¯å£ï¼Œç›‘å¬è¯·æ±‚
   - åˆ›å»ºExporterç¼“å­˜Invoker

4. Registryè´Ÿè´£æœåŠ¡æ³¨å†Œ
   - å°†æœåŠ¡URLæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ
   - æ”¯æŒZookeeperã€Nacosç­‰

5. URLè´¯ç©¿æ•´ä¸ªæµç¨‹
   - æºå¸¦æ‰€æœ‰é…ç½®ä¿¡æ¯
   - ä½œä¸ºæœåŠ¡çš„å”¯ä¸€æ ‡è¯†
```

---

**ç›¸å…³æ–‡æ¡£**ï¼š
- [SPIæœºåˆ¶æºç è§£æ](./SPIæœºåˆ¶æºç è§£æ.md)
- [æœåŠ¡å¼•ç”¨æºç è§£æ](./æœåŠ¡å¼•ç”¨æºç è§£æ.md)
- [è´Ÿè½½å‡è¡¡æºç è§£æ](./è´Ÿè½½å‡è¡¡æºç è§£æ.md)
