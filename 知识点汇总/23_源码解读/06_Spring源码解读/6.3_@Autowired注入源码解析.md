# @Autowiredæ³¨å…¥æºç è§£æ

> æ·±å…¥åˆ†æSpringä¾èµ–æ³¨å…¥å®ç°åŸç†ï¼ŒæŒæ¡è‡ªåŠ¨è£…é…æ ¸å¿ƒæœºåˆ¶

---

## ğŸ“š ç›®å½•

1. [æ•´ä½“æ¶æ„](#1-æ•´ä½“æ¶æ„)
2. [æ ¸å¿ƒç»„ä»¶](#2-æ ¸å¿ƒç»„ä»¶)
3. [æ³¨å…¥æµç¨‹æºç ](#3-æ³¨å…¥æµç¨‹æºç )
4. [ä¾èµ–æŸ¥æ‰¾ç­–ç•¥](#4-ä¾èµ–æŸ¥æ‰¾ç­–ç•¥)
5. [@Qualifieræ³¨è§£](#5-qualifieræ³¨è§£)
6. [æ³¨å…¥å¤±æ•ˆåœºæ™¯](#6-æ³¨å…¥å¤±æ•ˆåœºæ™¯)
7. [æµç¨‹å›¾è§£](#7-æµç¨‹å›¾è§£)
8. [é¢è¯•è¦ç‚¹](#8-é¢è¯•è¦ç‚¹)

---

## 1. æ•´ä½“æ¶æ„

### 1.1 @Autowiredå¤„ç†å™¨ç»§æ‰¿ç»“æ„

```
AutowiredAnnotationBeanPostProcessor
â”œâ”€â”€ extends InstantiationAwareBeanPostProcessorAdapter
â”‚   â””â”€â”€ implements SmartInstantiationAwareBeanPostProcessor
â”‚       â””â”€â”€ extends InstantiationAwareBeanPostProcessor
â”‚           â””â”€â”€ extends BeanPostProcessor
â”œâ”€â”€ implements MergedBeanDefinitionPostProcessor
â”œâ”€â”€ implements PriorityOrdered
â””â”€â”€ implements BeanFactoryAware
```

### 1.2 æ ¸å¿ƒè®¾è®¡æ€æƒ³

```java
/**
 * AutowiredAnnotationBeanPostProcessor
 * 
 * æ ¸å¿ƒèŒè´£ï¼š
 * 1. è§£æ@Autowiredã€@Valueã€@Injectæ³¨è§£
 * 2. æ”¶é›†éœ€è¦æ³¨å…¥çš„å­—æ®µå’Œæ–¹æ³•
 * 3. æ‰§è¡Œä¾èµ–æ³¨å…¥
 */
public class AutowiredAnnotationBeanPostProcessor 
        extends InstantiationAwareBeanPostProcessorAdapter
        implements MergedBeanDefinitionPostProcessor, PriorityOrdered, BeanFactoryAware {
    
    // æ”¯æŒçš„æ³¨è§£ç±»å‹
    private final Set<Class<? extends Annotation>> autowiredAnnotationTypes = 
        new LinkedHashSet<>(4);
    
    // æ³¨å…¥å…ƒæ•°æ®ç¼“å­˜
    private final Map<String, InjectionMetadata> injectionMetadataCache = 
        new ConcurrentHashMap<>(256);
    
    public AutowiredAnnotationBeanPostProcessor() {
        // æ·»åŠ æ”¯æŒçš„æ³¨è§£
        this.autowiredAnnotationTypes.add(Autowired.class);
        this.autowiredAnnotationTypes.add(Value.class);
        // JSR-330æ³¨è§£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        try {
            this.autowiredAnnotationTypes.add((Class<? extends Annotation>)
                ClassUtils.forName("javax.inject.Inject", 
                    AutowiredAnnotationBeanPostProcessor.class.getClassLoader()));
        } catch (ClassNotFoundException ex) {
            // JSR-330 API not available
        }
    }
}
```


---

## 2. æ ¸å¿ƒç»„ä»¶

### 2.1 InjectionMetadata - æ³¨å…¥å…ƒæ•°æ®

```java
/**
 * æ³¨å…¥å…ƒæ•°æ®ï¼šå°è£…ä¸€ä¸ªç±»ä¸­æ‰€æœ‰éœ€è¦æ³¨å…¥çš„å…ƒç´ 
 */
public class InjectionMetadata {
    
    // ç›®æ ‡ç±»
    private final Class<?> targetClass;
    
    // éœ€è¦æ³¨å…¥çš„å…ƒç´ é›†åˆï¼ˆå­—æ®µæˆ–æ–¹æ³•ï¼‰
    private final Collection<InjectedElement> injectedElements;
    
    // å·²æ£€æŸ¥çš„å…ƒç´ ï¼ˆé¿å…é‡å¤æ³¨å…¥ï¼‰
    private volatile Set<InjectedElement> checkedElements;
    
    /**
     * æ‰§è¡Œæ³¨å…¥
     */
    public void inject(Object target, String beanName, PropertyValues pvs) 
            throws Throwable {
        Collection<InjectedElement> checkedElements = this.checkedElements;
        Collection<InjectedElement> elementsToIterate =
            (checkedElements != null ? checkedElements : this.injectedElements);
        if (!elementsToIterate.isEmpty()) {
            for (InjectedElement element : elementsToIterate) {
                element.inject(target, beanName, pvs);
            }
        }
    }
}
```

### 2.2 InjectedElement - æ³¨å…¥å…ƒç´ 

```java
/**
 * æ³¨å…¥å…ƒç´ åŸºç±»
 */
public abstract static class InjectedElement {
    
    protected final Member member;  // å­—æ®µæˆ–æ–¹æ³•
    protected final boolean isField;
    protected volatile Boolean skip;
    
    /**
     * æ‰§è¡Œæ³¨å…¥ï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰
     */
    protected void inject(Object target, String requestingBeanName, 
            PropertyValues pvs) throws Throwable {
        if (this.isField) {
            Field field = (Field) this.member;
            ReflectionUtils.makeAccessible(field);
            field.set(target, getResourceToInject(target, requestingBeanName));
        } else {
            // æ–¹æ³•æ³¨å…¥
            Method method = (Method) this.member;
            ReflectionUtils.makeAccessible(method);
            method.invoke(target, getResourceToInject(target, requestingBeanName));
        }
    }
    
    protected Object getResourceToInject(Object target, String requestingBeanName) {
        return null;  // å­ç±»å®ç°
    }
}
```

### 2.3 AutowiredFieldElement - å­—æ®µæ³¨å…¥

```java
/**
 * å­—æ®µæ³¨å…¥å…ƒç´ 
 */
private class AutowiredFieldElement extends InjectionMetadata.InjectedElement {
    
    private final boolean required;
    private volatile boolean cached = false;
    private volatile Object cachedFieldValue;
    
    @Override
    protected void inject(Object bean, String beanName, PropertyValues pvs) 
            throws Throwable {
        Field field = (Field) this.member;
        Object value;
        if (this.cached) {
            // ä½¿ç”¨ç¼“å­˜çš„å€¼
            value = resolvedCachedArgument(beanName, this.cachedFieldValue);
        } else {
            // è§£æä¾èµ–
            DependencyDescriptor desc = new DependencyDescriptor(field, this.required);
            desc.setContainingClass(bean.getClass());
            Set<String> autowiredBeanNames = new LinkedHashSet<>(1);
            TypeConverter typeConverter = beanFactory.getTypeConverter();
            try {
                // æ ¸å¿ƒï¼šä»å®¹å™¨ä¸­è§£æä¾èµ–
                value = beanFactory.resolveDependency(desc, beanName, 
                    autowiredBeanNames, typeConverter);
            } catch (BeansException ex) {
                throw new UnsatisfiedDependencyException(null, beanName, 
                    new InjectionPoint(field), ex);
            }
            // ç¼“å­˜
            synchronized (this) {
                if (!this.cached) {
                    if (value != null || this.required) {
                        this.cachedFieldValue = desc;
                        registerDependentBeans(beanName, autowiredBeanNames);
                        if (autowiredBeanNames.size() == 1) {
                            String autowiredBeanName = autowiredBeanNames.iterator().next();
                            if (beanFactory.containsBean(autowiredBeanName) &&
                                beanFactory.isTypeMatch(autowiredBeanName, field.getType())) {
                                this.cachedFieldValue = new ShortcutDependencyDescriptor(
                                    desc, autowiredBeanName, field.getType());
                            }
                        }
                    } else {
                        this.cachedFieldValue = null;
                    }
                    this.cached = true;
                }
            }
        }
        if (value != null) {
            ReflectionUtils.makeAccessible(field);
            field.set(bean, value);
        }
    }
}
```

### 2.4 AutowiredMethodElement - æ–¹æ³•æ³¨å…¥

```java
/**
 * æ–¹æ³•æ³¨å…¥å…ƒç´ ï¼ˆSetteræ³¨å…¥ï¼‰
 */
private class AutowiredMethodElement extends InjectionMetadata.InjectedElement {
    
    private final boolean required;
    private volatile boolean cached = false;
    private volatile Object[] cachedMethodArguments;
    
    @Override
    protected void inject(Object bean, String beanName, PropertyValues pvs) 
            throws Throwable {
        Method method = (Method) this.member;
        Object[] arguments;
        if (this.cached) {
            arguments = resolveCachedArguments(beanName);
        } else {
            // è§£ææ–¹æ³•å‚æ•°
            Class<?>[] paramTypes = method.getParameterTypes();
            arguments = new Object[paramTypes.length];
            DependencyDescriptor[] descriptors = new DependencyDescriptor[paramTypes.length];
            Set<String> autowiredBeans = new LinkedHashSet<>(paramTypes.length);
            TypeConverter typeConverter = beanFactory.getTypeConverter();
            
            for (int i = 0; i < arguments.length; i++) {
                MethodParameter methodParam = new MethodParameter(method, i);
                DependencyDescriptor currDesc = new DependencyDescriptor(
                    methodParam, this.required);
                currDesc.setContainingClass(bean.getClass());
                descriptors[i] = currDesc;
                // è§£ææ¯ä¸ªå‚æ•°
                arguments[i] = beanFactory.resolveDependency(currDesc, beanName, 
                    autowiredBeans, typeConverter);
            }
            // ç¼“å­˜
            synchronized (this) {
                if (!this.cached) {
                    if (arguments != null) {
                        this.cachedMethodArguments = descriptors;
                        registerDependentBeans(beanName, autowiredBeans);
                    }
                    this.cached = true;
                }
            }
        }
        if (arguments != null) {
            ReflectionUtils.makeAccessible(method);
            method.invoke(bean, arguments);
        }
    }
}
```

---

## 3. æ³¨å…¥æµç¨‹æºç 

### 3.1 postProcessMergedBeanDefinition - æ”¶é›†æ³¨å…¥ç‚¹

```java
/**
 * åœ¨Beanå®ä¾‹åŒ–åã€å±æ€§å¡«å……å‰è°ƒç”¨
 * æ”¶é›†æ‰€æœ‰éœ€è¦æ³¨å…¥çš„å­—æ®µå’Œæ–¹æ³•
 */
@Override
public void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, 
        Class<?> beanType, String beanName) {
    // æŸ¥æ‰¾æ³¨å…¥å…ƒæ•°æ®
    InjectionMetadata metadata = findAutowiringMetadata(beanName, beanType, null);
    metadata.checkConfigMembers(beanDefinition);
}

/**
 * æŸ¥æ‰¾æ³¨å…¥å…ƒæ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰
 */
private InjectionMetadata findAutowiringMetadata(String beanName, Class<?> clazz, 
        PropertyValues pvs) {
    String cacheKey = (StringUtils.hasLength(beanName) ? beanName : clazz.getName());
    // å…ˆä»ç¼“å­˜è·å–
    InjectionMetadata metadata = this.injectionMetadataCache.get(cacheKey);
    if (InjectionMetadata.needsRefresh(metadata, clazz)) {
        synchronized (this.injectionMetadataCache) {
            metadata = this.injectionMetadataCache.get(cacheKey);
            if (InjectionMetadata.needsRefresh(metadata, clazz)) {
                if (metadata != null) {
                    metadata.clear(pvs);
                }
                // æ„å»ºæ³¨å…¥å…ƒæ•°æ®
                metadata = buildAutowiringMetadata(clazz);
                this.injectionMetadataCache.put(cacheKey, metadata);
            }
        }
    }
    return metadata;
}
```

### 3.2 buildAutowiringMetadata - æ„å»ºæ³¨å…¥å…ƒæ•°æ®

```java
/**
 * æ„å»ºæ³¨å…¥å…ƒæ•°æ®
 * æ‰«æç±»çš„æ‰€æœ‰å­—æ®µå’Œæ–¹æ³•ï¼Œæ‰¾å‡ºå¸¦@Autowiredæ³¨è§£çš„
 */
private InjectionMetadata buildAutowiringMetadata(final Class<?> clazz) {
    List<InjectionMetadata.InjectedElement> elements = new ArrayList<>();
    Class<?> targetClass = clazz;
    
    do {
        final List<InjectionMetadata.InjectedElement> currElements = new ArrayList<>();
        
        // 1. å¤„ç†å­—æ®µ
        ReflectionUtils.doWithLocalFields(targetClass, field -> {
            AnnotationAttributes ann = findAutowiredAnnotation(field);
            if (ann != null) {
                // é™æ€å­—æ®µä¸æ”¯æŒæ³¨å…¥
                if (Modifier.isStatic(field.getModifiers())) {
                    if (logger.isInfoEnabled()) {
                        logger.info("Autowired annotation is not supported on static fields: " 
                            + field);
                    }
                    return;
                }
                boolean required = determineRequiredStatus(ann);
                currElements.add(new AutowiredFieldElement(field, required));
            }
        });
        
        // 2. å¤„ç†æ–¹æ³•
        ReflectionUtils.doWithLocalMethods(targetClass, method -> {
            Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(method);
            if (!BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) {
                return;
            }
            AnnotationAttributes ann = findAutowiredAnnotation(bridgedMethod);
            if (ann != null && method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) {
                // é™æ€æ–¹æ³•ä¸æ”¯æŒæ³¨å…¥
                if (Modifier.isStatic(method.getModifiers())) {
                    if (logger.isInfoEnabled()) {
                        logger.info("Autowired annotation is not supported on static methods: " 
                            + method);
                    }
                    return;
                }
                // æ— å‚æ–¹æ³•è­¦å‘Š
                if (method.getParameterCount() == 0) {
                    if (logger.isInfoEnabled()) {
                        logger.info("Autowired annotation should only be used on methods with " +
                            "parameters: " + method);
                    }
                }
                boolean required = determineRequiredStatus(ann);
                currElements.add(new AutowiredMethodElement(method, required));
            }
        });
        
        elements.addAll(0, currElements);
        targetClass = targetClass.getSuperclass();  // å¤„ç†çˆ¶ç±»
    } while (targetClass != null && targetClass != Object.class);
    
    return new InjectionMetadata(clazz, elements);
}
```

### 3.3 postProcessProperties - æ‰§è¡Œæ³¨å…¥

```java
/**
 * å±æ€§å¡«å……é˜¶æ®µæ‰§è¡Œæ³¨å…¥
 */
@Override
public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, 
        String beanName) {
    // è·å–æ³¨å…¥å…ƒæ•°æ®
    InjectionMetadata metadata = findAutowiringMetadata(beanName, bean.getClass(), pvs);
    try {
        // æ‰§è¡Œæ³¨å…¥
        metadata.inject(bean, beanName, pvs);
    } catch (BeanCreationException ex) {
        throw ex;
    } catch (Throwable ex) {
        throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", ex);
    }
    return pvs;
}
```


---

## 4. ä¾èµ–æŸ¥æ‰¾ç­–ç•¥

### 4.1 resolveDependency - æ ¸å¿ƒè§£ææ–¹æ³•

```java
/**
 * DefaultListableBeanFactory.resolveDependency
 * ä¾èµ–è§£æçš„æ ¸å¿ƒæ–¹æ³•
 */
@Override
public Object resolveDependency(DependencyDescriptor descriptor, String requestingBeanName,
        Set<String> autowiredBeanNames, TypeConverter typeConverter) throws BeansException {
    
    descriptor.initParameterNameDiscovery(getParameterNameDiscoverer());
    
    // 1. å¤„ç†Optionalç±»å‹
    if (Optional.class == descriptor.getDependencyType()) {
        return createOptionalDependency(descriptor, requestingBeanName);
    }
    // 2. å¤„ç†ObjectFactory/ObjectProviderç±»å‹
    else if (ObjectFactory.class == descriptor.getDependencyType() ||
             ObjectProvider.class == descriptor.getDependencyType()) {
        return new DependencyObjectProvider(descriptor, requestingBeanName);
    }
    // 3. å¤„ç†javax.inject.Providerç±»å‹
    else if (javaxInjectProviderClass == descriptor.getDependencyType()) {
        return new Jsr330Factory().createDependencyProvider(descriptor, requestingBeanName);
    }
    // 4. å¤„ç†å»¶è¿Ÿæ³¨å…¥
    else {
        Object result = getAutowireCandidateResolver().getLazyResolutionProxyIfNecessary(
            descriptor, requestingBeanName);
        if (result == null) {
            // 5. å¸¸è§„è§£æ
            result = doResolveDependency(descriptor, requestingBeanName, 
                autowiredBeanNames, typeConverter);
        }
        return result;
    }
}
```

### 4.2 doResolveDependency - å®é™…è§£æé€»è¾‘

```java
/**
 * å®é™…çš„ä¾èµ–è§£æé€»è¾‘
 */
public Object doResolveDependency(DependencyDescriptor descriptor, String beanName,
        Set<String> autowiredBeanNames, TypeConverter typeConverter) throws BeansException {
    
    InjectionPoint previousInjectionPoint = ConstructorResolver.setCurrentInjectionPoint(descriptor);
    try {
        // 1. å¿«æ·æ–¹å¼ï¼šå¦‚æœæœ‰ç¼“å­˜çš„beanåç§°ï¼Œç›´æ¥è·å–
        Object shortcut = descriptor.resolveShortcut(this);
        if (shortcut != null) {
            return shortcut;
        }
        
        Class<?> type = descriptor.getDependencyType();
        
        // 2. å¤„ç†@Valueæ³¨è§£
        Object value = getAutowireCandidateResolver().getSuggestedValue(descriptor);
        if (value != null) {
            if (value instanceof String) {
                // è§£æå ä½ç¬¦ ${...}
                String strVal = resolveEmbeddedValue((String) value);
                BeanDefinition bd = (beanName != null && containsBean(beanName) ?
                    getMergedBeanDefinition(beanName) : null);
                // è§£æSpELè¡¨è¾¾å¼ #{...}
                value = evaluateBeanDefinitionString(strVal, bd);
            }
            TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());
            return converter.convertIfNecessary(value, type, descriptor.getTypeDescriptor());
        }
        
        // 3. å¤„ç†é›†åˆç±»å‹ï¼ˆArrayã€Collectionã€Mapï¼‰
        Object multipleBeans = resolveMultipleBeans(descriptor, beanName, 
            autowiredBeanNames, typeConverter);
        if (multipleBeans != null) {
            return multipleBeans;
        }
        
        // 4. æŸ¥æ‰¾å€™é€‰Bean
        Map<String, Object> matchingBeans = findAutowireCandidates(beanName, type, descriptor);
        if (matchingBeans.isEmpty()) {
            if (isRequired(descriptor)) {
                raiseNoMatchingBeanFound(type, descriptor.getResolvableType(), descriptor);
            }
            return null;
        }
        
        String autowiredBeanName;
        Object instanceCandidate;
        
        // 5. å¤šä¸ªå€™é€‰è€…æ—¶çš„å¤„ç†
        if (matchingBeans.size() > 1) {
            // ç¡®å®šä¸»è¦å€™é€‰è€…
            autowiredBeanName = determineAutowireCandidate(matchingBeans, descriptor);
            if (autowiredBeanName == null) {
                if (isRequired(descriptor) || !indicatesMultipleBeans(type)) {
                    return descriptor.resolveNotUnique(descriptor.getResolvableType(), matchingBeans);
                } else {
                    return null;
                }
            }
            instanceCandidate = matchingBeans.get(autowiredBeanName);
        } else {
            // 6. åªæœ‰ä¸€ä¸ªå€™é€‰è€…
            Map.Entry<String, Object> entry = matchingBeans.entrySet().iterator().next();
            autowiredBeanName = entry.getKey();
            instanceCandidate = entry.getValue();
        }
        
        if (autowiredBeanNames != null) {
            autowiredBeanNames.add(autowiredBeanName);
        }
        if (instanceCandidate instanceof Class) {
            instanceCandidate = descriptor.resolveCandidate(autowiredBeanName, type, this);
        }
        Object result = instanceCandidate;
        if (result instanceof NullBean) {
            if (isRequired(descriptor)) {
                raiseNoMatchingBeanFound(type, descriptor.getResolvableType(), descriptor);
            }
            result = null;
        }
        if (!ClassUtils.isAssignableValue(type, result)) {
            throw new BeanNotOfRequiredTypeException(autowiredBeanName, type, 
                instanceCandidate.getClass());
        }
        return result;
    } finally {
        ConstructorResolver.setCurrentInjectionPoint(previousInjectionPoint);
    }
}
```

### 4.3 determineAutowireCandidate - ç¡®å®šå€™é€‰è€…

```java
/**
 * å¤šä¸ªå€™é€‰è€…æ—¶ç¡®å®šæœ€ç»ˆçš„æ³¨å…¥å¯¹è±¡
 * 
 * ä¼˜å…ˆçº§ï¼š
 * 1. @Primaryæ ‡æ³¨çš„Bean
 * 2. @Priorityä¼˜å…ˆçº§æœ€é«˜çš„Bean
 * 3. åç§°åŒ¹é…çš„Bean
 */
protected String determineAutowireCandidate(Map<String, Object> candidates, 
        DependencyDescriptor descriptor) {
    Class<?> requiredType = descriptor.getDependencyType();
    
    // 1. æŸ¥æ‰¾@Primaryæ ‡æ³¨çš„Bean
    String primaryCandidate = determinePrimaryCandidate(candidates, requiredType);
    if (primaryCandidate != null) {
        return primaryCandidate;
    }
    
    // 2. æŸ¥æ‰¾@Priorityä¼˜å…ˆçº§æœ€é«˜çš„Bean
    String priorityCandidate = determineHighestPriorityCandidate(candidates, requiredType);
    if (priorityCandidate != null) {
        return priorityCandidate;
    }
    
    // 3. æŒ‰åç§°åŒ¹é…
    for (Map.Entry<String, Object> entry : candidates.entrySet()) {
        String candidateName = entry.getKey();
        Object beanInstance = entry.getValue();
        if ((beanInstance != null && 
             this.resolvableDependencies.containsValue(beanInstance)) ||
            matchesBeanName(candidateName, descriptor.getDependencyName())) {
            return candidateName;
        }
    }
    return null;
}

/**
 * æŸ¥æ‰¾@Primaryæ ‡æ³¨çš„Bean
 */
protected String determinePrimaryCandidate(Map<String, Object> candidates, Class<?> requiredType) {
    String primaryBeanName = null;
    for (Map.Entry<String, Object> entry : candidates.entrySet()) {
        String candidateBeanName = entry.getKey();
        Object beanInstance = entry.getValue();
        if (isPrimary(candidateBeanName, beanInstance)) {
            if (primaryBeanName != null) {
                boolean candidateLocal = containsBeanDefinition(candidateBeanName);
                boolean primaryLocal = containsBeanDefinition(primaryBeanName);
                if (candidateLocal && primaryLocal) {
                    throw new NoUniqueBeanDefinitionException(requiredType, candidates.size(),
                        "more than one 'primary' bean found among candidates: " + 
                        candidates.keySet());
                } else if (candidateLocal) {
                    primaryBeanName = candidateBeanName;
                }
            } else {
                primaryBeanName = candidateBeanName;
            }
        }
    }
    return primaryBeanName;
}
```

---

## 5. @Qualifieræ³¨è§£

### 5.1 @Qualifierå¤„ç†æµç¨‹

```java
/**
 * QualifierAnnotationAutowireCandidateResolver
 * å¤„ç†@Qualifieræ³¨è§£
 */
public class QualifierAnnotationAutowireCandidateResolver 
        extends GenericTypeAwareAutowireCandidateResolver {
    
    private final Set<Class<? extends Annotation>> qualifierTypes = new LinkedHashSet<>(2);
    
    public QualifierAnnotationAutowireCandidateResolver() {
        this.qualifierTypes.add(Qualifier.class);
    }
    
    /**
     * åˆ¤æ–­å€™é€‰Beanæ˜¯å¦åŒ¹é…
     */
    @Override
    public boolean isAutowireCandidate(BeanDefinitionHolder bdHolder, 
            DependencyDescriptor descriptor) {
        // 1. å…ˆæ£€æŸ¥åŸºæœ¬æ¡ä»¶
        boolean match = super.isAutowireCandidate(bdHolder, descriptor);
        if (match) {
            // 2. æ£€æŸ¥@Qualifier
            match = checkQualifiers(bdHolder, descriptor.getAnnotations());
            if (match) {
                MethodParameter methodParam = descriptor.getMethodParameter();
                if (methodParam != null) {
                    Method method = methodParam.getMethod();
                    if (method == null || void.class == method.getReturnType()) {
                        match = checkQualifiers(bdHolder, methodParam.getMethodAnnotations());
                    }
                }
            }
        }
        return match;
    }
    
    /**
     * æ£€æŸ¥@Qualifieræ˜¯å¦åŒ¹é…
     */
    protected boolean checkQualifiers(BeanDefinitionHolder bdHolder, Annotation[] annotationsToSearch) {
        if (ObjectUtils.isEmpty(annotationsToSearch)) {
            return true;
        }
        SimpleTypeConverter typeConverter = new SimpleTypeConverter();
        for (Annotation annotation : annotationsToSearch) {
            Class<? extends Annotation> type = annotation.annotationType();
            boolean checkMeta = true;
            boolean fallbackToMeta = false;
            if (isQualifier(type)) {
                if (!checkQualifier(bdHolder, annotation, typeConverter)) {
                    fallbackToMeta = true;
                } else {
                    checkMeta = false;
                }
            }
            if (checkMeta) {
                boolean foundMeta = false;
                for (Annotation metaAnn : type.getAnnotations()) {
                    Class<? extends Annotation> metaType = metaAnn.annotationType();
                    if (isQualifier(metaType)) {
                        foundMeta = true;
                        if ((fallbackToMeta && StringUtils.isEmpty(
                                AnnotationUtils.getValue(metaAnn))) ||
                            !checkQualifier(bdHolder, metaAnn, typeConverter)) {
                            return false;
                        }
                    }
                }
                if (fallbackToMeta && !foundMeta) {
                    return false;
                }
            }
        }
        return true;
    }
}
```

### 5.2 @Qualifierä½¿ç”¨ç¤ºä¾‹

```java
/**
 * @Qualifierä½¿ç”¨ç¤ºä¾‹
 */
// å®šä¹‰å¤šä¸ªå®ç°
@Service("mysqlUserService")
public class MysqlUserService implements UserService { }

@Service("mongoUserService")
public class MongoUserService implements UserService { }

// ä½¿ç”¨@QualifieræŒ‡å®šæ³¨å…¥
@Service
public class OrderService {
    
    // æ–¹å¼1ï¼šå­—æ®µæ³¨å…¥
    @Autowired
    @Qualifier("mysqlUserService")
    private UserService userService;
    
    // æ–¹å¼2ï¼šæ„é€ å™¨æ³¨å…¥
    private final UserService userService;
    
    @Autowired
    public OrderService(@Qualifier("mysqlUserService") UserService userService) {
        this.userService = userService;
    }
    
    // æ–¹å¼3ï¼šSetteræ³¨å…¥
    @Autowired
    public void setUserService(@Qualifier("mysqlUserService") UserService userService) {
        this.userService = userService;
    }
}

// è‡ªå®šä¹‰Qualifieræ³¨è§£
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier
public @interface MySQL { }

@Service
@MySQL
public class MysqlUserService implements UserService { }

@Service
public class OrderService {
    @Autowired
    @MySQL
    private UserService userService;
}
```


---

## 6. æ³¨å…¥å¤±æ•ˆåœºæ™¯

### 6.1 å¸¸è§å¤±æ•ˆåœºæ™¯

```java
/**
 * @Autowiredæ³¨å…¥å¤±æ•ˆçš„å¸¸è§åœºæ™¯
 */
public class AutowiredFailureCases {
    
    // âŒ åœºæ™¯1ï¼šé™æ€å­—æ®µä¸æ”¯æŒæ³¨å…¥
    @Autowired
    private static UserService userService;  // ä¸ä¼šæ³¨å…¥
    
    // âŒ åœºæ™¯2ï¼šnewåˆ›å»ºçš„å¯¹è±¡ä¸å—Springç®¡ç†
    public void test() {
        OrderService orderService = new OrderService();
        // orderServiceä¸­çš„@Autowiredå­—æ®µä¸ä¼šè¢«æ³¨å…¥
    }
    
    // âŒ åœºæ™¯3ï¼šå¾ªç¯ä¾èµ–ï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰
    @Service
    public class ServiceA {
        @Autowired
        public ServiceA(ServiceB serviceB) { }  // å¾ªç¯ä¾èµ–ä¼šå¤±è´¥
    }
    
    @Service
    public class ServiceB {
        @Autowired
        public ServiceB(ServiceA serviceA) { }
    }
    
    // âŒ åœºæ™¯4ï¼š@Autowiredåœ¨çˆ¶ç±»ï¼Œå­ç±»æ²¡æœ‰è¢«Springç®¡ç†
    public class BaseService {
        @Autowired
        protected UserService userService;
    }
    
    public class ChildService extends BaseService {
        // å¦‚æœChildServiceä¸æ˜¯Spring Beanï¼ŒuserServiceä¸ä¼šè¢«æ³¨å…¥
    }
    
    // âŒ åœºæ™¯5ï¼šåœ¨æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨æ³¨å…¥çš„å­—æ®µ
    @Service
    public class OrderService {
        @Autowired
        private UserService userService;
        
        public OrderService() {
            // userServiceæ­¤æ—¶ä¸ºnullï¼Œå› ä¸ºæ³¨å…¥å‘ç”Ÿåœ¨æ„é€ ä¹‹å
            userService.doSomething();  // NullPointerException
        }
    }
}
```

### 6.2 è§£å†³æ–¹æ¡ˆ

```java
/**
 * æ³¨å…¥å¤±æ•ˆçš„è§£å†³æ–¹æ¡ˆ
 */
public class AutowiredSolutions {
    
    // âœ… è§£å†³æ–¹æ¡ˆ1ï¼šé™æ€å­—æ®µä½¿ç”¨Setteræ³¨å…¥
    private static UserService userService;
    
    @Autowired
    public void setUserService(UserService userService) {
        AutowiredSolutions.userService = userService;
    }
    
    // âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ApplicationContextè·å–Bean
    @Autowired
    private ApplicationContext applicationContext;
    
    public void test() {
        UserService userService = applicationContext.getBean(UserService.class);
    }
    
    // âœ… è§£å†³æ–¹æ¡ˆ3ï¼šå¾ªç¯ä¾èµ–ä½¿ç”¨@Lazy
    @Service
    public class ServiceA {
        @Autowired
        public ServiceA(@Lazy ServiceB serviceB) { }
    }
    
    // âœ… è§£å†³æ–¹æ¡ˆ4ï¼šä½¿ç”¨@PostConstruct
    @Service
    public class OrderService {
        @Autowired
        private UserService userService;
        
        @PostConstruct
        public void init() {
            // æ­¤æ—¶userServiceå·²ç»æ³¨å…¥å®Œæˆ
            userService.doSomething();
        }
    }
    
    // âœ… è§£å†³æ–¹æ¡ˆ5ï¼šä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
    @Service
    public class OrderService {
        private final UserService userService;
        
        @Autowired  // Spring 4.3+å¯çœç•¥
        public OrderService(UserService userService) {
            this.userService = userService;
            // æ­¤æ—¶userServiceå·²ç»å¯ç”¨
        }
    }
}
```

### 6.3 æ³¨å…¥æ–¹å¼å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ³¨å…¥æ–¹å¼å¯¹æ¯”                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ–¹å¼      â”‚     ä¼˜ç‚¹        â”‚        ç¼ºç‚¹               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­—æ®µæ³¨å…¥    â”‚ ä»£ç ç®€æ´        â”‚ æ— æ³•æ³¨å…¥finalå­—æ®µ         â”‚
â”‚             â”‚ ä½¿ç”¨æ–¹ä¾¿        â”‚ éšè—ä¾èµ–å…³ç³»              â”‚
â”‚             â”‚                 â”‚ ä¸åˆ©äºæµ‹è¯•                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Setteræ³¨å…¥  â”‚ å¯é€‰ä¾èµ–        â”‚ å¯¹è±¡å¯èƒ½å¤„äºä¸å®Œæ•´çŠ¶æ€    â”‚
â”‚             â”‚ å¯ä»¥é‡æ–°æ³¨å…¥    â”‚ ä¾èµ–å¯èƒ½è¢«ä¿®æ”¹            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„é€ å™¨æ³¨å…¥  â”‚ ä¾èµ–ä¸å¯å˜      â”‚ å‚æ•°å¤šæ—¶ä»£ç å†—é•¿          â”‚
â”‚  (æ¨è)     â”‚ å®Œå…¨åˆå§‹åŒ–      â”‚ å¾ªç¯ä¾èµ–éœ€è¦ç‰¹æ®Šå¤„ç†      â”‚
â”‚             â”‚ åˆ©äºæµ‹è¯•        â”‚                           â”‚
â”‚             â”‚ æ˜ç¡®ä¾èµ–å…³ç³»    â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. æµç¨‹å›¾è§£

### 7.1 @Autowiredæ³¨å…¥å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                @Autowired æ³¨å…¥å®Œæ•´æµç¨‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Beanåˆ›å»ºæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  createBean()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®ä¾‹åŒ–Bean       â”‚
â”‚ (æ„é€ æ–¹æ³•)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ postProcessMergedBeanDefinition()                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. æ‰«æç±»çš„æ‰€æœ‰å­—æ®µå’Œæ–¹æ³•                                â”‚ â”‚
â”‚ â”‚ 2. æ‰¾å‡ºå¸¦@Autowired/@Value/@Injectçš„å…ƒç´                â”‚ â”‚
â”‚ â”‚ 3. æ„å»ºInjectionMetadataå¹¶ç¼“å­˜                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ postProcessProperties() - å±æ€§å¡«å……                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. è·å–InjectionMetadata                              â”‚ â”‚
â”‚ â”‚ 2. éå†æ‰€æœ‰InjectedElement                             â”‚ â”‚
â”‚ â”‚ 3. è°ƒç”¨beanFactory.resolveDependency()è§£æä¾èµ–          â”‚ â”‚
â”‚ â”‚ 4. é€šè¿‡åå°„æ³¨å…¥å­—æ®µæˆ–è°ƒç”¨æ–¹æ³•                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹åŒ–Bean        â”‚
â”‚ (initæ–¹æ³•)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ä¾èµ–è§£ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¾èµ–è§£ææµç¨‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚resolveDependencyâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Optional â”‚       â”‚ObjectFactoryâ”‚   â”‚ å¸¸è§„ç±»å‹ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ObjectProviderâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                            â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚doResolveDependencyâ”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚                â”‚                â”‚
                           â–¼                â–¼                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ @Value   â”‚     â”‚ é›†åˆç±»å‹ â”‚     â”‚ å•ä¸ªBean â”‚
                    â”‚ å¤„ç†     â”‚     â”‚ å¤„ç†     â”‚     â”‚ å¤„ç†     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚findAutowireCandidatesâ”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚                           â”‚
                                              â–¼                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ 1ä¸ªå€™é€‰  â”‚                â”‚ å¤šä¸ªå€™é€‰ â”‚
                                       â”‚ ç›´æ¥è¿”å› â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                                                             â–¼
                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                              â”‚determineAutowire â”‚
                                                              â”‚   Candidate      â”‚
                                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                         â”‚
                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                         â”‚               â”‚               â”‚
                                                         â–¼               â–¼               â–¼
                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”‚@Primary â”‚    â”‚@Priorityâ”‚    â”‚åç§°åŒ¹é… â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. é¢è¯•è¦ç‚¹

### 8.1 é«˜é¢‘é¢è¯•é¢˜

```
Q1: @Autowiredçš„å®ç°åŸç†ï¼Ÿ
A: ç”±AutowiredAnnotonBeanPostProcessorå¤„ç†ï¼š
   1. postProcessMergedBeanDefinitionï¼šæ‰«ææ”¶é›†@Autowiredæ³¨è§£çš„å­—æ®µå’Œæ–¹æ³•
   2. postProcessPropertiesï¼šæ‰§è¡Œä¾èµ–æ³¨å…¥
   3. é€šè¿‡beanFactory.resolveDependency()è§£æä¾èµ–
   4. ä½¿ç”¨åå°„æ³¨å…¥å­—æ®µæˆ–è°ƒç”¨æ–¹æ³•

Q2: @Autowiredå’Œ@Resourceçš„åŒºåˆ«ï¼Ÿ
A: - @Autowiredï¼šSpringæ³¨è§£ï¼Œé»˜è®¤byTypeï¼Œå¯é…åˆ@Qualifierä½¿ç”¨
   - @Resourceï¼šJSR-250æ³¨è§£ï¼Œé»˜è®¤byNameï¼Œå¯æŒ‡å®šnameå±æ€§
   - @Autowiredç”±AutowiredAnnotaanPostProcessorå¤„ç†
   - @Resourceç”±CommonAnnotationBeanPostProcessorå¤„ç†

Q3: @Autowiredæ³¨å…¥çš„æŸ¥æ‰¾é¡ºåºï¼Ÿ
A: 1. æŒ‰ç±»å‹æŸ¥æ‰¾å€™é€‰Bean
   2. å¦‚æœæœ‰å¤šä¸ªå€™é€‰ï¼š
      - ä¼˜å…ˆ@Primaryæ ‡æ³¨çš„Bean
      - å…¶æ¬¡@Priorityä¼˜å…ˆçº§æœ€é«˜  - æœ€åæŒ‰åç§°åŒ¹é…

Q4: @Autowired(required=false)çš„ä½œç”¨ï¼Ÿ
A: å½“æ‰¾ä¸åˆ°åŒ¹é…çš„Beanæ—¶ä¸æŠ›å¼‚å¸¸ï¼Œæ³¨å…¥nullã€‚
   é»˜è®¤required=trueï¼Œæ‰¾ä¸åˆ°ä¼šæŠ›NoSuchBeanDefinitionExceptionã€‚

Q5: ä¸ºä»€ä¹ˆæ¨èæ„é€ å™¨æ³¨å…¥ï¼Ÿ
A: - ä¾èµ–ä¸å¯å˜ï¼ˆfinalå­—æ®µï¼‰
   - å¯¹è±¡å®Œå…¨åˆå§‹åŒ–åæ‰å¯ç”¨
   - æ˜ç¡®ä¾èµ–å…³ç³»
   - ä¾¿äºå•å…ƒæµ‹è¯•
   - é¿å…å¾ªç¯ä¾èµ–ï¼ˆç¼–è¯‘æœŸå‘ç°ï¼‰
```

### 8.2 ä½¿ç”¨æœ€ä½³å®è·µ

```java
/**
 * @Autowired æœ€ä½³å®è·µ
 */
@Service
public class OrderService {
    
    // âœ… æ¨èï¼šæ„é€ å™¨æ³¨å…¥
    private final UserService userService;
    private final ProductService productService;
    
    // Spring 4.3+ å•æ„é€ å™¨å¯çœç•¥@Autowired
    public OrderService(UserService userService, ProductService productService) {
        this.userService = userService;
        this.productService = productService;
    }
    
    // âœ… å¯é€‰ä¾èµ–ä½¿ç”¨Optional
    private final Optional<NotificationService> notificationService;
    
    public OrderService(UserService userService, 
                       Optional<NotificationService> notificationService) {
        this.userService = userService;
        this.notificationService = notificationService;
    }
    
    // âœ… é›†åˆæ³¨å…¥
    private final List<PaymentStrategy> paymentStrategies;
    
    public OrderService(List<PaymentStrategy> paymentStrategies) {
        this.paymentStrategies = paymentStrategies;
    }
}
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å¤„ç†å™¨**ï¼šAutowiredAnnotationBeanPostProcessor
2. **æ³¨å…¥æ—¶æœº**ï¼šBeanå®ä¾‹åŒ–åã€åˆå§‹åŒ–å‰
3. **æŸ¥æ‰¾ç­–ç•¥**ï¼šbyType â†’ @Primary â†’ @Priority â†’ byName
4. **æ”¯æŒæ³¨è§£**ï¼š@Autowiredã€@Valueã€@Inject
5. **æ¨èæ–¹å¼**ï¼šæ„é€ å™¨æ³¨å…¥
# æ³¨å…¥æ–¹å¼é€‰æ‹©

| åœºæ™¯ | æ¨èæ–¹å¼ |
|------|----------|
| å¿…éœ€ä¾èµ– | æ„é€ å™¨æ³¨å…¥ |
| å¯é€‰ä¾èµ– | Setteræ³¨å…¥ + Optional |
| é›†åˆä¾èµ– | æ„é€ å™¨æ³¨å…¥ + List/Map |
| é…ç½®å€¼ | @Value + æ„é€ å™¨ |

---

*æœ€åæ›´æ–°ï¼š2025-12-28*
