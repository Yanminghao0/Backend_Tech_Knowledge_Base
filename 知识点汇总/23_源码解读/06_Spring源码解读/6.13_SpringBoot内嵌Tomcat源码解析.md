# SpringBootå†…åµŒTomcatæºç è§£æ

> ğŸ’¡ æ·±å…¥ç†è§£SpringBootå†…åµŒWebå®¹å™¨çš„å®ç°åŸç†ï¼ŒæŒæ¡å®¹å™¨å¯åŠ¨æµç¨‹

---

## ğŸ“š ç›®å½•

1. [å†…åµŒå®¹å™¨æ¦‚è¿°](#1-å†…åµŒå®¹å™¨æ¦‚è¿°)
2. [è‡ªåŠ¨é…ç½®æœºåˆ¶](#2-è‡ªåŠ¨é…ç½®æœºåˆ¶)
3. [å®¹å™¨å¯åŠ¨æµç¨‹](#3-å®¹å™¨å¯åŠ¨æµç¨‹)
4. [WebServeråˆ›å»º](#4-webserveråˆ›å»º)
5. [Servletæ³¨å†Œæœºåˆ¶](#5-servletæ³¨å†Œæœºåˆ¶)
6. [å®¹å™¨å®šåˆ¶åŒ–](#6-å®¹å™¨å®šåˆ¶åŒ–)
7. [é¢è¯•è¦ç‚¹](#7-é¢è¯•è¦ç‚¹)

---

## 1. å†…åµŒå®¹å™¨æ¦‚è¿°

### 1.1 ä¼ ç»Ÿéƒ¨ç½² vs å†…åµŒå®¹å™¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  éƒ¨ç½²æ–¹å¼å¯¹æ¯”                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ä¼ ç»Ÿéƒ¨ç½²ï¼š                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚           å¤–éƒ¨Tomcatå®¹å™¨                 â”‚               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
â”‚  â”‚  â”‚         WARåŒ…                    â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â”‚     Springåº”ç”¨            â”‚  â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚               â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  å†…åµŒå®¹å™¨ï¼š                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚           JARåŒ…ï¼ˆå¯æ‰§è¡Œï¼‰                â”‚               â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚               â”‚
â”‚  â”‚  â”‚     Springåº”ç”¨                   â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â”‚    å†…åµŒTomcat             â”‚  â”‚   â”‚               â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚               â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ”¯æŒçš„å†…åµŒå®¹å™¨

```java
// SpringBootæ”¯æŒçš„å†…åµŒWebå®¹å™¨
// 1. Tomcatï¼ˆé»˜è®¤ï¼‰
// 2. Jetty
// 3. Undertow
// 4. Nettyï¼ˆWebFluxï¼‰

// åˆ‡æ¢å®¹å™¨åªéœ€ä¿®æ”¹ä¾èµ–
// æ’é™¤Tomcatï¼Œå¼•å…¥Jetty
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
</dependency>
```

### 1.3 æ ¸å¿ƒç±»å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å†…åµŒå®¹å™¨æ ¸å¿ƒç±»                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  WebServer (æ¥å£)                                          â”‚
â”‚  â”œâ”€â”€ TomcatWebServer                                       â”‚
â”‚  â”œâ”€â”€ JettyWebServer                                        â”‚
â”‚  â””â”€â”€ UndertowWebServer                                     â”‚
â”‚                                                             â”‚
â”‚  ServletWebServerFactory (æ¥å£)                            â”‚
â”‚  â”œâ”€â”€ TomcatServletWebServerFactory                         â”‚
â”‚  â”œâ”€â”€ JettyServletWebServerFactory                          â”‚
â”‚  â””â”€â”€ UndertowServletWebServerFactory                       â”‚
â”‚                                                             â”‚
â”‚  WebServerFactoryCustomizer (æ¥å£)                         â”‚
â”‚  â””â”€â”€ ç”¨äºå®šåˆ¶WebServeré…ç½®                                 â”‚
â”‚                                                             â”‚
â”‚  ServletWebServerApplicationContext                        â”‚
â”‚  â””â”€â”€ Webåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç†WebServer                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

## 2. è‡ªåŠ¨é…ç½®æœºåˆ¶

### 2.1 ServletWebServerFactoryAutoConfiguration

```java
/**
 * Servlet WebæœåŠ¡å™¨å·¥å‚è‡ªåŠ¨é…ç½®
 */
@AutoConfiguration
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)
@ConditionalOnClass(ServletRequest.class)
@ConditionalOnWebApplication(type = Type.SERVLET)
@EnableConfigurationProperties(ServerProperties.class)
@Import({
    ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,
    ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,
    ServletWebServerFactoryConfiguration.EmbeddedJetty.class,
    ServletWebServerFactoryConfiguration.EmbeddedUndertow.class
})
public class ServletWebServerFactoryAutoConfiguration {
    
    @Bean
    public ServletWebServerFactoryCustomizer servletWebServerFactoryCustomizer(
            ServerProperties serverProperties,
            ObjectProvider<WebListenerRegistrar> webListenerRegistrars,
            ObjectProvider<CookieSameSiteSupplier> cookieSameSiteSuppliers) {
        return new ServletWebServerFactoryCustomizer(serverProperties,
            webListenerRegistrars.orderedStream().toList(),
            cookieSameSiteSuppliers.orderedStream().toList());
    }
    
    @Bean
    @ConditionalOnClass(name = "org.apache.catalina.startup.Tomcat")
    public TomcatServletWebServerFactoryCustomizer tomcatServletWebServerFactoryCustomizer(
            ServerProperties serverProperties) {
        return new TomcatServletWebServerFactoryCustomizer(serverProperties);
    }
    
    /**
     * æ³¨å†ŒBeanPostProcessor
     */
    public static class BeanPostProcessorsRegistrar 
            implements ImportBeanDefinitionRegistrar, BeanFactoryAware {
        
        private ConfigurableListableBeanFactory beanFactory;
        
        @Override
        public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata,
                BeanDefinitionRegistry registry) {
            if (this.beanFactory == null) {
                return;
            }
            // æ³¨å†ŒWebServerFactoryCustomizerBeanPostProcessor
            registerSyntheticBeanIfMissing(registry,
                "webServerFactoryCustomizerBeanPostProcessor",
                WebServerFactoryCustomizerBeanPostProcessor.class);
            // æ³¨å†ŒErrorPageRegistrarBeanPostProcessor
            registerSyntheticBeanIfMissing(registry,
                "errorPageRegistrarBeanPostProcessor",
                ErrorPageRegistrarBeanPostProcessor.class);
        }
    }
}
```

### 2.2 EmbeddedTomcaté…ç½®

```java
/**
 * å†…åµŒTomcaté…ç½®
 */
@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({Servlet.class, Tomcat.class, UpgradeProtocol.class})
@ConditionalOnMissingBean(value = ServletWebServerFactory.class, search = SearchStrategy.CURRENT)
static class EmbeddedTomcat {
    
    @Bean
    TomcatServletWebServerFactory tomcatServletWebServerFactory(
            ObjectProvider<TomcatConnectorCustomizer> connectorCustomizers,
            ObjectProvider<TomcatContextCustomizer> contextCustomizers,
            ObjectProvider<TomcatProtocolHandlerCustomizer<?>> protocolHandlerCustomizers) {
        
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        
        // åº”ç”¨å®šåˆ¶å™¨
        factory.getTomcatConnectorCustomizers()
            .addAll(connectorCustomizers.orderedStream().toList());
        factory.getTomcatContextCustomizers()
            .addAll(contextCustomizers.orderedStream().toList());
        factory.getTomcatProtocolHandlerCustomizers()
            .addAll(protocolHandlerCustomizers.orderedStream().toList());
        
        return factory;
    }
}
```

### 2.3 ServerPropertiesé…ç½®å±æ€§

```java
@ConfigurationProperties(prefix = "server", ignoreUnknownFields = true)
public class ServerProperties {
    
    private Integer port;
    private InetAddress address;
    private String contextPath;
    private String displayName = "application";
    
    private final Servlet servlet = new Servlet();
    private final Tomcat tomcat = new Tomcat();
    private final Jetty jetty = new Jetty();
    private final Undertow undertow = new Undertow();
    
    /**
     * Tomcatç‰¹å®šé…ç½®
     */
    public static class Tomcat {
        private Charset uriEncoding = StandardCharsets.UTF_8;
        private int maxConnections = 8192;
        private int acceptCount = 100;
        private int processorCache = 200;
        private int maxHttpHeaderSize = DataSize.ofKilobytes(8);
        private Duration connectionTimeout;
        private int maxThreads = 200;
        private int minSpareThreads = 10;
        private final Accesslog accesslog = new Accesslog();
        private final Threads threads = new Threads();
        // getters and setters
    }
    
    // getters and setters
}
```

---

## 3. å®¹å™¨å¯åŠ¨æµç¨‹

### 3.1 æ•´ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å†…åµŒTomcatå¯åŠ¨æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. SpringApplication.run()                                â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  2. createApplicationContext()                             â”‚
â”‚     â””â”€â”€ åˆ›å»ºServletWebServerApplicationContext             â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  3. refreshContext()                                       â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  4. AbstractApplicationContext.refresh()                   â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  5. onRefresh()                                            â”‚
â”‚     â””â”€â”€ ServletWebServerApplicationContext.onRefresh()     â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  6. createWebServer()                                      â”‚
â”‚     â”œâ”€â”€ è·å–ServletWebServerFactory                        â”‚
â”‚     â””â”€â”€ factory.getWebServer()                             â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  7. TomcatServletWebServerFactory.getWebServer()           â”‚
â”‚     â”œâ”€â”€ åˆ›å»ºTomcatå®ä¾‹                                     â”‚
â”‚     â”œâ”€â”€ é…ç½®Connector                                      â”‚
â”‚     â”œâ”€â”€ é…ç½®Engine/Host/Context                            â”‚
â”‚     â””â”€â”€ è¿”å›TomcatWebServer                                â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  8. finishRefresh()                                        â”‚
â”‚     â””â”€â”€ WebServer.start()                                  â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  9. Tomcatå¯åŠ¨å®Œæˆï¼Œç›‘å¬ç«¯å£                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ServletWebServerApplicationContext

```java
/**
 * Servlet WebæœåŠ¡å™¨åº”ç”¨ä¸Šä¸‹æ–‡
 */
public class ServletWebServerApplicationContext 
        extends GenericWebApplicationContext
        implements ConfigurableWebServerApplicationContext {
    
    private volatile WebServer webServer;
    
    private ServletConfig servletConfig;
    
    /**
     * ğŸ”¥ onRefresh - åˆ›å»ºWebServer
     */
    @Override
    protected void onRefresh() {
        super.onRefresh();
        try {
            // åˆ›å»ºWebæœåŠ¡å™¨
            createWebServer();
        } catch (Throwable ex) {
            throw new ApplicationContextException("Unable to start web server", ex);
        }
    }
    
    /**
     * åˆ›å»ºWebæœåŠ¡å™¨
     */
    private void createWebServer() {
        WebServer webServer = this.webServer;
        ServletContext servletContext = getServletContext();
        
        if (webServer == null && servletContext == null) {
            // ğŸ”¥ è·å–ServletWebServerFactory
            ServletWebServerFactory factory = getWebServerFactory();
            
            // åˆ›å»ºServletä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨
            this.webServer = factory.getWebServer(getSelfInitializer());
            
            // æ³¨å†Œä¼˜é›…å…³é—­å›è°ƒ
            getBeanFactory().registerSingleton("webServerGracefulShutdown",
                new WebServerGracefulShutdownLifecycle(this.webServer));
            getBeanFactory().registerSingleton("webServerStartStop",
                new WebServerStartStopLifecycle(this, this.webServer));
        }
        else if (servletContext != null) {
            try {
                getSelfInitializer().onStartup(servletContext);
            } catch (ServletException ex) {
                throw new ApplicationContextException("Cannot initialize servlet context", ex);
            }
        }
        
        initPropertySources();
    }
    
    /**
     * è·å–WebServerFactory
     */
    protected ServletWebServerFactory getWebServerFactory() {
        // ä»å®¹å™¨è·å–ServletWebServerFactory Bean
        String[] beanNames = getBeanFactory()
            .getBeanNamesForType(ServletWebServerFactory.class);
        
        if (beanNames.length == 0) {
            throw new ApplicationContextException(
                "Unable to start ServletWebServerApplicationContext due to missing " +
                "ServletWebServerFactory bean.");
        }
        if (beanNames.length > 1) {
            throw new ApplicationContextException(
                "Unable to start ServletWebServerApplicationContext due to multiple " +
                "ServletWebServerFactory beans : " + StringUtils.arrayToCommaDelimitedString(beanNames));
        }
        
        return getBeanFactory().getBean(beanNames[0], ServletWebServerFactory.class);
    }
    
    /**
     * è·å–Servletä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨
     */
    private org.springframework.boot.web.servlet.ServletContextInitializer getSelfInitializer() {
        return this::selfInitialize;
    }
    
    /**
     * è‡ªåˆå§‹åŒ–
     */
    private void selfInitialize(ServletContext servletContext) throws ServletException {
        prepareWebApplicationContext(servletContext);
        registerApplicationScope(servletContext);
        WebApplicationContextUtils.registerEnvironmentBeans(getBeanFactory(), servletContext);
        
        // ğŸ”¥ æ³¨å†ŒServletã€Filterã€Listener
        for (ServletContextInitializer beans : getServletContextInitializerBeans()) {
            beans.onStartup(servletContext);
        }
    }
    
    /**
     * finishRefresh - å¯åŠ¨WebServer
     */
    @Override
    protected void finishRefresh() {
        super.finishRefresh();
        // ğŸ”¥ å¯åŠ¨WebæœåŠ¡å™¨
        WebServer webServer = startWebServer();
        if (webServer != null) {
            publishEvent(new ServletWebServerInitializedEvent(webServer, this));
        }
    }
    
    private WebServer startWebServer() {
        WebServer webServer = this.webServer;
        if (webServer != null) {
            webServer.start();
        }
        return webServer;
    }
}
```


---

## 4. WebServeråˆ›å»º

### 4.1 TomcatServletWebServerFactory

```java
/**
 * Tomcat Servlet WebæœåŠ¡å™¨å·¥å‚
 */
public class TomcatServletWebServerFactory 
        extends AbstractServletWebServerFactory
        implements ConfigurableTomcatWebServerFactory {
    
    private static final Charset DEFAULT_CHARSET = StandardCharsets.UTF_8;
    
    private String protocol = DEFAULT_PROTOCOL;
    private File baseDirectory;
    private final List<Valve> engineValves = new ArrayList<>();
    private final List<Valve> contextValves = new ArrayList<>();
    private final List<LifecycleListener> contextLifecycleListeners = new ArrayList<>();
    private final List<TomcatContextCustomizer> tomcatContextCustomizers = new ArrayList<>();
    private final List<TomcatConnectorCustomizer> tomcatConnectorCustomizers = new ArrayList<>();
    private final List<TomcatProtocolHandlerCustomizer<?>> tomcatProtocolHandlerCustomizers = new ArrayList<>();
    
    /**
     * ğŸ”¥ åˆ›å»ºWebServeræ ¸å¿ƒæ–¹æ³•
     */
    @Override
    public WebServer getWebServer(ServletContextInitializer... initializers) {
        if (this.disableMBeanRegistry) {
            Registry.disableRegistry();
        }
        
        // 1. åˆ›å»ºTomcatå®ä¾‹
        Tomcat tomcat = new Tomcat();
        
        // 2. è®¾ç½®åŸºç¡€ç›®å½•
        File baseDir = (this.baseDirectory != null) ? this.baseDirectory : createTempDir("tomcat");
        tomcat.setBaseDir(baseDir.getAbsolutePath());
        
        // 3. ğŸ”¥ åˆ›å»ºConnector
        Connector connector = new Connector(this.protocol);
        connector.setThrowOnFailure(true);
        tomcat.getService().addConnector(connector);
        
        // 4. å®šåˆ¶Connector
        customizeConnector(connector);
        tomcat.setConnector(connector);
        
        // 5. é…ç½®Host
        tomcat.getHost().setAutoDeploy(false);
        
        // 6. é…ç½®Engine
        configureEngine(tomcat.getEngine());
        
        // 7. æ·»åŠ é¢å¤–çš„Connector
        for (Connector additionalConnector : this.additionalTomcatConnectors) {
            tomcat.getService().addConnector(additionalConnector);
        }
        
        // 8. ğŸ”¥ å‡†å¤‡Context
        prepareContext(tomcat.getHost(), initializers);
        
        // 9. ğŸ”¥ åˆ›å»ºTomcatWebServer
        return getTomcatWebServer(tomcat);
    }
    
    /**
     * å®šåˆ¶Connector
     */
    protected void customizeConnector(Connector connector) {
        int port = Math.max(getPort(), 0);
        connector.setPort(port);
        
        if (StringUtils.hasText(getServerHeader())) {
            connector.setProperty("server", getServerHeader());
        }
        
        if (connector.getProtocolHandler() instanceof AbstractProtocol) {
            customizeProtocol((AbstractProtocol<?>) connector.getProtocolHandler());
        }
        
        invokeProtocolHandlerCustomizers(connector.getProtocolHandler());
        
        if (getUriEncoding() != null) {
            connector.setURIEncoding(getUriEncoding().name());
        }
        
        // è®¾ç½®è¿æ¥å™¨å±æ€§
        connector.setProperty("bindOnInit", "false");
        
        // SSLé…ç½®
        if (getSsl() != null && getSsl().isEnabled()) {
            customizeSsl(connector);
        }
        
        // å‹ç¼©é…ç½®
        TomcatConnectorCustomizer compression = new CompressionConnectorCustomizer(getCompression());
        compression.customize(connector);
        
        // åº”ç”¨è‡ªå®šä¹‰å®šåˆ¶å™¨
        for (TomcatConnectorCustomizer customizer : this.tomcatConnectorCustomizers) {
            customizer.customize(connector);
        }
    }
    
    /**
     * å‡†å¤‡Context
     */
    protected void prepareContext(Host host, ServletContextInitializer[] initializers) {
        File documentRoot = getValidDocumentRoot();
        
        // åˆ›å»ºTomcatEmbeddedContext
        TomcatEmbeddedContext context = new TomcatEmbeddedContext();
        
        if (documentRoot != null) {
            context.setResources(new LoaderHidingResourceRoot(context));
        }
        
        context.setName(getContextPath());
        context.setDisplayName(getDisplayName());
        context.setPath(getContextPath());
        
        // è®¾ç½®æ–‡æ¡£æ ¹ç›®å½•
        File docBase = (documentRoot != null) ? documentRoot : createTempDir("tomcat-docbase");
        context.setDocBase(docBase.getAbsolutePath());
        
        // æ·»åŠ ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨
        context.addLifecycleListener(new FixContextListener());
        context.setParentClassLoader((this.resourceLoader != null) ? 
            this.resourceLoader.getClassLoader() : ClassUtils.getDefaultClassLoader());
        
        // é‡ç½®é»˜è®¤çš„æœ¬åœ°åŒ–æ˜ å°„
        resetDefaultLocaleMapping(context);
        addDefaultServlet(context);
        addJspServlet(context);
        
        // æ·»åŠ æ¬¢è¿æ–‡ä»¶
        context.addWelcomeFile("index.html");
        context.addWelcomeFile("index.htm");
        context.addWelcomeFile("index.jsp");
        
        // è®¾ç½®é”™è¯¯é¡µé¢
        configureErrorPages(context);
        
        // è®¾ç½®MIMEç±»å‹
        configureMimeMappings(context);
        
        // ğŸ”¥ é…ç½®Servletä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨
        configureContext(context, initializers);
        
        // æ·»åŠ åˆ°Host
        host.addChild(context);
    }
    
    /**
     * é…ç½®Context
     */
    protected void configureContext(Context context, ServletContextInitializer[] initializers) {
        // åˆ›å»ºTomcatStarter
        TomcatStarter starter = new TomcatStarter(initializers);
        
        if (context instanceof TomcatEmbeddedContext) {
            TomcatEmbeddedContext embeddedContext = (TomcatEmbeddedContext) context;
            embeddedContext.setStarter(starter);
            embeddedContext.setFailCtxIfServletStartFails(true);
        }
        
        // æ·»åŠ ServletContainerInitializer
        context.addServletContainerInitializer(starter, NO_CLASSES);
        
        // åº”ç”¨Contextå®šåˆ¶å™¨
        for (TomcatContextCustomizer customizer : this.tomcatContextCustomizers) {
            customizer.customize(context);
        }
    }
    
    /**
     * è·å–TomcatWebServer
     */
    protected TomcatWebServer getTomcatWebServer(Tomcat tomcat) {
        return new TomcatWebServer(tomcat, getPort() >= 0, getShutdown());
    }
}
```

### 4.2 TomcatWebServer

```java
/**
 * Tomcat WebæœåŠ¡å™¨
 */
public class TomcatWebServer implements WebServer {
    
    private static final Log logger = LogFactory.getLog(TomcatWebServer.class);
    
    private static final AtomicInteger containerCounter = new AtomicInteger(-1);
    
    private final Object monitor = new Object();
    
    private final Map<Service, Connector[]> serviceConnectors = new HashMap<>();
    
    private final Tomcat tomcat;
    
    private final boolean autoStart;
    
    private final GracefulShutdown gracefulShutdown;
    
    private volatile boolean started;
    
    public TomcatWebServer(Tomcat tomcat, boolean autoStart, Shutdown shutdown) {
        Assert.notNull(tomcat, "Tomcat Server must not be null");
        this.tomcat = tomcat;
        this.autoStart = autoStart;
        this.gracefulShutdown = (shutdown == Shutdown.GRACEFUL) ? 
            new GracefulShutdown(tomcat) : null;
        
        // ğŸ”¥ åˆå§‹åŒ–
        initialize();
    }
    
    /**
     * åˆå§‹åŒ–Tomcat
     */
    private void initialize() throws WebServerException {
        logger.info("Tomcat initialized with port(s): " + getPortsDescription(false));
        
        synchronized (this.monitor) {
            try {
                // æ·»åŠ å®ä¾‹IDåˆ°Engineåç§°
                addInstanceIdToEngineName();
                
                // è·å–Context
                Context context = findContext();
                
                // æ·»åŠ ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨
                context.addLifecycleListener((event) -> {
                    if (context.equals(event.getSource()) && 
                            Lifecycle.START_EVENT.equals(event.getType())) {
                        // ç§»é™¤Connectorï¼Œå»¶è¿Ÿç»‘å®šç«¯å£
                        removeServiceConnectors();
                    }
                });
                
                // ğŸ”¥ å¯åŠ¨Tomcatï¼ˆä½†ä¸ç»‘å®šç«¯å£ï¼‰
                this.tomcat.start();
                
                // é‡æ–°æŠ›å‡ºå¯åŠ¨å¤±è´¥å¼‚å¸¸
                rethrowDeferredStartupExceptions();
                
                try {
                    // ç»‘å®šå‘½åä¸Šä¸‹æ–‡
                    ContextBindings.bindClassLoader(context, context.getNamingToken(),
                        getClass().getClassLoader());
                } catch (NamingException ex) {
                    // å¿½ç•¥
                }
                
                // å¯åŠ¨å®ˆæŠ¤çº¿ç¨‹ï¼Œé˜²æ­¢ä¸»çº¿ç¨‹é€€å‡º
                startDaemonAwaitThread();
            } catch (Exception ex) {
                stopSilently();
                destroySilently();
                throw new WebServerException("Unable to start embedded Tomcat", ex);
            }
        }
    }
    
    /**
     * ğŸ”¥ å¯åŠ¨WebæœåŠ¡å™¨
     */
    @Override
    public void start() throws WebServerException {
        synchronized (this.monitor) {
            if (this.started) {
                return;
            }
            try {
                // æ·»åŠ Connectorï¼Œç»‘å®šç«¯å£
                addPreviouslyRemovedConnectors();
                
                Connector connector = this.tomcat.getConnector();
                if (connector != null && this.autoStart) {
                    // å»¶è¿Ÿå¯åŠ¨
                    performDeferredLoadOnStartup();
                }
                
                // æ£€æŸ¥ConnectorçŠ¶æ€
                checkThatConnectorsHaveStarted();
                
                this.started = true;
                
                logger.info("Tomcat started on port(s): " + getPortsDescription(true) +
                    " with context path '" + getContextPath() + "'");
            } catch (ConnectorStartFailedException ex) {
                stopSilently();
                throw ex;
            } catch (Exception ex) {
                PortInUseException.throwIfPortBindingException(ex, () -> this.tomcat.getConnector().getPort());
                throw new WebServerException("Unable to start embedded Tomcat server", ex);
            } finally {
                Context context = findContext();
                ContextBindings.unbindClassLoader(context, context.getNamingToken(),
                    getClass().getClassLoader());
            }
        }
    }
    
    /**
     * åœæ­¢WebæœåŠ¡å™¨
     */
    @Override
    public void stop() throws WebServerException {
        synchronized (this.monitor) {
            boolean wasStarted = this.started;
            try {
                this.started = false;
                try {
                    if (this.gracefulShutdown != null) {
                        this.gracefulShutdown.abort();
                    }
                    stopTomcat();
                    this.tomcat.destroy();
                } catch (LifecycleException ex) {
                    // å¿½ç•¥
                }
            } catch (Exception ex) {
                throw new WebServerException("Unable to stop embedded Tomcat", ex);
            } finally {
                if (wasStarted) {
                    containerCounter.decrementAndGet();
                }
            }
        }
    }
    
    /**
     * è·å–ç«¯å£
     */
    @Override
    public int getPort() {
        Connector connector = this.tomcat.getConnector();
        if (connector != null) {
            return connector.getLocalPort();
        }
        return -1;
    }
}
```

---

## 5. Servletæ³¨å†Œæœºåˆ¶

### 5.1 ServletContextInitializer

```java
/**
 * Servletä¸Šä¸‹æ–‡åˆå§‹åŒ–å™¨æ¥å£
 */
@FunctionalInterface
public interface ServletContextInitializer {
    
    /**
     * é…ç½®ServletContext
     */
    void onStartup(ServletContext servletContext) throws ServletException;
}

/**
 * Servletæ³¨å†ŒBean
 */
public class ServletRegistrationBean<T extends Servlet> 
        extends DynamicRegistrationBean<ServletRegistration.Dynamic> {
    
    private static final String[] DEFAULT_MAPPINGS = {"/*"};
    
    private T servlet;
    private Set<String> urlMappings = new LinkedHashSet<>();
    private boolean alwaysMapUrl = true;
    private int loadOnStartup = -1;
    private MultipartConfigElement multipartConfig;
    
    @Override
    protected ServletRegistration.Dynamic addRegistration(String description, 
            ServletContext servletContext) {
        String name = getServletName();
        // ğŸ”¥ æ³¨å†ŒServlet
        return servletContext.addServlet(name, this.servlet);
    }
    
    @Override
    protected void configure(ServletRegistration.Dynamic registration) {
        super.configure(registration);
        
        // è®¾ç½®URLæ˜ å°„
        String[] urlMapping = StringUtils.toStringArray(this.urlMappings);
        if (urlMapping.length == 0 && this.alwaysMapUrl) {
            urlMapping = DEFAULT_MAPPINGS;
        }
        if (!ObjectUtils.isEmpty(urlMapping)) {
            registration.addMapping(urlMapping);
        }
        
        // è®¾ç½®å¯åŠ¨é¡ºåº
        registration.setLoadOnStartup(this.loadOnStartup);
        
        // è®¾ç½®Multiparté…ç½®
        if (this.multipartConfig != null) {
            registration.setMultipartConfig(this.multipartConfig);
        }
    }
}
```

### 5.2 DispatcherServletæ³¨å†Œ

```java
/**
 * DispatcherServletè‡ªåŠ¨é…ç½®
 */
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)
@AutoConfiguration(after = ServletWebServerFactoryAutoConfiguration.class)
@ConditionalOnWebApplication(type = Type.SERVLET)
@ConditionalOnClass(DispatcherServlet.class)
public class DispatcherServletAutoConfiguration {
    
    public static final String DEFAULT_DISPATCHER_SERVLET_BEAN_NAME = "dispatcherServlet";
    public static final String DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME = 
        "dispatcherServletRegistration";
    
    @Configuration(proxyBeanMethods = false)
    @Conditional(DefaultDispatcherServletCondition.class)
    @ConditionalOnClass(ServletRegistration.class)
    @EnableConfigurationProperties(WebMvcProperties.class)
    protected static class DispatcherServletConfiguration {
        
        @Bean(name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)
        public DispatcherServlet dispatcherServlet(WebMvcProperties webMvcProperties) {
            DispatcherServlet dispatcherServlet = new DispatcherServlet();
            dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());
            dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest());
            dispatcherServlet.setThrowExceptionIfNoHandlerFound(
                webMvcProperties.isThrowExceptionIfNoHandlerFound());
            dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents());
            dispatcherServlet.setEnableLoggingRequestDetails(
                webMvcProperties.isLogRequestDetails());
            return dispatcherServlet;
        }
    }
    
    @Configuration(proxyBeanMethods = false)
    @Conditional(DispatcherServletRegistrationCondition.class)
    @ConditionalOnClass(ServletRegistration.class)
    @EnableConfigurationProperties(WebMvcProperties.class)
    protected static class DispatcherServletRegistrationConfiguration {
        
        @Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)
        @ConditionalOnBean(value = DispatcherServlet.class, 
            name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)
        public DispatcherServletRegistrationBean dispatcherServletRegistration(
                DispatcherServlet dispatcherServlet, WebMvcProperties webMvcProperties,
                ObjectProvider<MultipartConfigElement> multipartConfig) {
            
            // ğŸ”¥ åˆ›å»ºæ³¨å†ŒBean
            DispatcherServletRegistrationBean registration = 
                new DispatcherServletRegistrationBean(dispatcherServlet, 
                    webMvcProperties.getServlet().getPath());
            
            registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);
            registration.setLoadOnStartup(webMvcProperties.getServlet().getLoadOnStartup());
            multipartConfig.ifAvailable(registration::setMultipartConfig);
            
            return registration;
        }
    }
}
```

---

## 6. å®¹å™¨å®šåˆ¶åŒ–

### 6.1 WebServerFactoryCustomizer

```java
/**
 * WebæœåŠ¡å™¨å·¥å‚å®šåˆ¶å™¨
 */
@FunctionalInterface
public interface WebServerFactoryCustomizer<T extends WebServerFactory> {
    
    /**
     * å®šåˆ¶WebæœåŠ¡å™¨å·¥å‚
     */
    void customize(T factory);
}

/**
 * è‡ªå®šä¹‰Tomcatå®šåˆ¶å™¨
 */
@Component
public class MyTomcatCustomizer 
        implements WebServerFactoryCustomizer<TomcatServletWebServerFactory> {
    
    @Override
    public void customize(TomcatServletWebServerFactory factory) {
        // è®¾ç½®ç«¯å£
        factory.setPort(8888);
        
        // è®¾ç½®ä¸Šä¸‹æ–‡è·¯å¾„
        factory.setContextPath("/myapp");
        
        // æ·»åŠ Connectorå®šåˆ¶å™¨
        factory.addConnectorCustomizers(connector -> {
            connector.setProperty("maxThreads", "500");
            connector.setProperty("minSpareThreads", "50");
        });
        
        // æ·»åŠ Contextå®šåˆ¶å™¨
        factory.addContextCustomizers(context -> {
            context.setReloadable(false);
        });
    }
}
```

### 6.2 é€šè¿‡é…ç½®æ–‡ä»¶å®šåˆ¶

```yaml
# application.yml
server:
  port: 8080
  servlet:
    context-path: /myapp
    session:
      timeout: 30m
  
  tomcat:
    # çº¿ç¨‹é…ç½®
    threads:
      max: 200
      min-spare: 10
    
    # è¿æ¥é…ç½®
    max-connections: 8192
    accept-count: 100
    
    # URIç¼–ç 
    uri-encoding: UTF-8
    
    # è¿æ¥è¶…æ—¶
    connection-timeout: 20000
    
    # è®¿é—®æ—¥å¿—
    accesslog:
      enabled: true
      directory: logs
      pattern: "%h %l %u %t \"%r\" %s %b %D"
    
    # å…¶ä»–é…ç½®
    max-http-header-size: 8KB
    max-swallow-size: 2MB
```

### 6.3 ç¼–ç¨‹å¼é…ç½®

```java
@Configuration
public class TomcatConfig {
    
    @Bean
    public TomcatServletWebServerFactory tomcatFactory() {
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        
        // åŸºç¡€é…ç½®
        factory.setPort(8080);
        factory.setContextPath("/api");
        
        // æ·»åŠ é¢å¤–çš„Connectorï¼ˆå¦‚HTTPSï¼‰
        factory.addAdditionalTomcatConnectors(createHttpsConnector());
        
        // æ·»åŠ Valve
        factory.addEngineValves(new AccessLogValve());
        
        return factory;
    }
    
    private Connector createHttpsConnector() {
        Connector connector = new Connector("org.apache.coyote.http11.Http11NioProtocol");
        connector.setScheme("https");
        connector.setSecure(true);
        connector.setPort(8443);
        
        Http11NioProtocol protocol = (Http11NioProtocol) connector.getProtocolHandler();
        protocol.setSSLEnabled(true);
        protocol.setKeystoreFile("/path/to/keystore.jks");
        protocol.setKeystorePass("password");
        protocol.setKeyAlias("tomcat");
        
        return connector;
    }
}
```

---

## 7. é¢è¯•è¦ç‚¹

### 7.1 é«˜é¢‘é¢è¯•é¢˜

#### Q1: SpringBootå†…åµŒTomcatçš„å¯åŠ¨æµç¨‹ï¼Ÿ

```
ç­”æ¡ˆè¦ç‚¹ï¼š
1. SpringApplication.run()å¯åŠ¨
2. åˆ›å»ºServletWebServerApplicationContext
3. refresh()è¿‡ç¨‹ä¸­è°ƒç”¨onRefresh()
4. è·å–ServletWebServerFactoryï¼ˆTomcatServletWebServerFactoryï¼‰
5. è°ƒç”¨getWebServer()åˆ›å»ºTomcatå®ä¾‹
6. é…ç½®Connectorã€Engineã€Hostã€Context
7. finishRefresh()ä¸­è°ƒç”¨WebServer.start()
8. Tomcatç»‘å®šç«¯å£ï¼Œå¼€å§‹ç›‘å¬è¯·æ±‚

å…³é”®ç±»ï¼š
- ServletWebServerApplicationContext
- TomcatServletWebServerFactory
- TomcatWebServer
```

#### Q2: å¦‚ä½•åˆ‡æ¢å†…åµŒå®¹å™¨ï¼Ÿ

```xml
<!-- æ’é™¤Tomcat -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- å¼•å…¥Jetty -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
</dependency>

åŸç†ï¼š
- è‡ªåŠ¨é…ç½®é€šè¿‡@ConditionalOnClassåˆ¤æ–­
- åªæœ‰å¯¹åº”å®¹å™¨ç±»å­˜åœ¨æ—¶æ‰ç”Ÿæ•ˆ
```

#### Q3: å†…åµŒTomcatå’Œå¤–éƒ¨Tomcatçš„åŒºåˆ«ï¼Ÿ

```
å†…åµŒTomcatï¼š
- æ‰“åŒ…ä¸ºå¯æ‰§è¡ŒJAR
- åº”ç”¨åŒ…å«å®¹å™¨
- java -jarå¯åŠ¨
- é…ç½®é€šè¿‡application.yml

å¤–éƒ¨Tomcatï¼š
- æ‰“åŒ…ä¸ºWAR
- éƒ¨ç½²åˆ°å®¹å™¨
- å®¹å™¨å¯åŠ¨åº”ç”¨
- é…ç½®é€šè¿‡server.xml

å†…åµŒä¼˜åŠ¿ï¼š
- ç®€åŒ–éƒ¨ç½²
- ç‰ˆæœ¬ä¸€è‡´æ€§
- å¿«é€Ÿå¯åŠ¨
- ä¾¿äºå¾®æœåŠ¡
```

### 7.2 çŸ¥è¯†ç‚¹æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SpringBootå†…åµŒTomcatæ€»ç»“                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ ¸å¿ƒç»„ä»¶ï¼š                                                  â”‚
â”‚  â”œâ”€â”€ ServletWebServerApplicationContext: Webåº”ç”¨ä¸Šä¸‹æ–‡      â”‚
â”‚  â”œâ”€â”€ TomcatServletWebServerFactory: Tomcatå·¥å‚             â”‚
â”‚  â”œâ”€â”€ TomcatWebServer: TomcatæœåŠ¡å™¨åŒ…è£…                     â”‚
â”‚  â””â”€â”€ WebServerFactoryCustomizer: å®šåˆ¶å™¨                    â”‚
â”‚                                                             â”‚
â”‚  å¯åŠ¨æµç¨‹ï¼š                                                  â”‚
â”‚  1. createApplicationContext()                             â”‚
â”‚  2. onRefresh() â†’ createWebServer()                        â”‚
â”‚  3. getWebServerFactory()                                  â”‚
â”‚  4. factory.getWebServer()                                 â”‚
â”‚  5. finishRefresh() â†’ webServer.start()                    â”‚
â”‚                                                             â”‚
â”‚  å®šåˆ¶æ–¹å¼ï¼š                                                  â”‚
â”‚  â”œâ”€â”€ application.ymlé…ç½®                                   â”‚
â”‚  â”œâ”€â”€ WebServerFactoryCustomizer                            â”‚
â”‚  â””â”€â”€ è‡ªå®šä¹‰TomcatServletWebServerFactory                   â”‚
â”‚                                                             â”‚
â”‚  æ”¯æŒçš„å®¹å™¨ï¼š                                                â”‚
â”‚  â”œâ”€â”€ Tomcatï¼ˆé»˜è®¤ï¼‰                                        â”‚
â”‚  â”œâ”€â”€ Jetty                                                 â”‚
â”‚  â”œâ”€â”€ Undertow                                              â”‚
â”‚  â””â”€â”€ Nettyï¼ˆWebFluxï¼‰                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [SpringBootå®˜æ–¹æ–‡æ¡£ - Embedded Web Servers](https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.servlet.embedded-container)
- [SpringBootæºç  - TomcatServletWebServerFactory](https://github.com/spring-projects/spring-boot)

---

**æŒæ¡å†…åµŒå®¹å™¨åŸç†ï¼Œæ·±å…¥ç†è§£SpringBoot Webå¯åŠ¨æœºåˆ¶ï¼** ğŸš€

*æœ€åæ›´æ–°ï¼š2025-12-28*
