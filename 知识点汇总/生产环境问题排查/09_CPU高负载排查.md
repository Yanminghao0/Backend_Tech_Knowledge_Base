# CPUé«˜è´Ÿè½½æ’æŸ¥

> å®æˆ˜æŒ‡å—ï¼šå¦‚ä½•æ’æŸ¥CPUé£™é«˜ã€çº¿ç¨‹æ­»å¾ªç¯ã€çƒ­ç‚¹ä»£ç ç­‰CPUé—®é¢˜

## ğŸ“‹ ç›®å½•
- [å¸¸è§é—®é¢˜ç±»å‹](#å¸¸è§é—®é¢˜ç±»å‹)
- [CPUé£™é«˜æ’æŸ¥](#cpué£™é«˜æ’æŸ¥)
- [çº¿ç¨‹æ­»å¾ªç¯](#çº¿ç¨‹æ­»å¾ªç¯)
- [çƒ­ç‚¹ä»£ç ](#çƒ­ç‚¹ä»£ç )
- [æ’æŸ¥å·¥å…·](#æ’æŸ¥å·¥å…·)

---

## å¸¸è§é—®é¢˜ç±»å‹

### 1. CPUä½¿ç”¨ç‡é«˜

**ç—‡çŠ¶**ï¼š
```
âœ… CPUä½¿ç”¨ç‡æŒç»­>80%
âœ… åº”ç”¨å“åº”å˜æ…¢
âœ… ç³»ç»Ÿè´Ÿè½½é«˜
```

### 2. CPUé£™é«˜

**ç—‡çŠ¶**ï¼š
```
âœ… CPUä½¿ç”¨ç‡çªç„¶é£™å‡åˆ°100%
âœ… ç³»ç»Ÿå“åº”å˜æ…¢
âœ… åº”ç”¨æ— å“åº”
```

### 3. çº¿ç¨‹æ­»å¾ªç¯

**ç—‡çŠ¶**ï¼š
```
âœ… CPUä½¿ç”¨ç‡100%
âœ… å•ä¸ªçº¿ç¨‹CPUä½¿ç”¨ç‡é«˜
âœ… åº”ç”¨å“åº”å˜æ…¢
```

---

## CPUé£™é«˜æ’æŸ¥

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹CPUä½¿ç”¨ç‡**

```bash
# æŸ¥çœ‹CPUä½¿ç”¨ç‡
top
htop
vmstat 1

# æŸ¥çœ‹Javaè¿›ç¨‹CPUä½¿ç”¨ç‡
top -H -p <pid>
```

**2. æŸ¥çœ‹çº¿ç¨‹å †æ ˆ**

```bash
# æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
jstack <pid>

# æŸ¥çœ‹CPUä½¿ç”¨ç‡é«˜çš„çº¿ç¨‹
top -H -p <pid> | head -20
# å°†çº¿ç¨‹IDè½¬æ¢ä¸º16è¿›åˆ¶
printf "%x\n" <thread_id>
# åœ¨jstackè¾“å‡ºä¸­æŸ¥æ‰¾è¯¥çº¿ç¨‹
```

**3. ä½¿ç”¨Arthas**

```bash
# å¯åŠ¨Arthas
java -jar arthas-boot.jar

# æŸ¥çœ‹CPUä½¿ç”¨ç‡é«˜çš„çº¿ç¨‹
thread

# æŸ¥çœ‹çƒ­ç‚¹æ–¹æ³•
profiler start
profiler stop
```

### å¸¸è§åŸå› 

**1. æ­»å¾ªç¯**

```java
// âŒ æ­»å¾ªç¯
while (true) {
    // æ— é™å¾ªç¯
}

// âœ… æ·»åŠ æ¡ä»¶
while (condition) {
    // å¾ªç¯é€»è¾‘
}
```

**2. é¢‘ç¹è®¡ç®—**

```java
// âŒ é¢‘ç¹è®¡ç®—
for (int i = 0; i < 1000000; i++) {
    complexCalculation();  // å¤æ‚è®¡ç®—
}

// âœ… ä¼˜åŒ–
// 1. å‡å°‘è®¡ç®—æ¬¡æ•°
// 2. ä½¿ç”¨ç¼“å­˜
// 3. ä¼˜åŒ–ç®—æ³•
```

**3. çº¿ç¨‹æ­»é”**

```java
// çº¿ç¨‹æ­»é”å¯¼è‡´CPUä½¿ç”¨ç‡é«˜
// æ’æŸ¥æ–¹æ³•ï¼šjstackæŸ¥çœ‹çº¿ç¨‹å †æ ˆ
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¿®å¤æ­»å¾ªç¯**

```java
// æ·»åŠ é€€å‡ºæ¡ä»¶
while (condition) {
    // å¾ªç¯é€»è¾‘
    if (shouldExit()) {
        break;
    }
}
```

**2. ä¼˜åŒ–çƒ­ç‚¹ä»£ç **

```java
// 1. å‡å°‘è®¡ç®—æ¬¡æ•°
// 2. ä½¿ç”¨ç¼“å­˜
// 3. ä¼˜åŒ–ç®—æ³•
// 4. ä½¿ç”¨å¼‚æ­¥å¤„ç†
```

**3. é™åˆ¶çº¿ç¨‹æ•°**

```java
// é™åˆ¶çº¿ç¨‹æ± å¤§å°
ExecutorService executor = Executors.newFixedThreadPool(10);
```

---

## çº¿ç¨‹æ­»å¾ªç¯

### æ’æŸ¥æ–¹æ³•

**1. æŸ¥çœ‹çº¿ç¨‹å †æ ˆ**

```bash
# æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
jstack <pid> | grep -A 20 "çº¿ç¨‹å"

# æŸ¥çœ‹CPUä½¿ç”¨ç‡é«˜çš„çº¿ç¨‹
top -H -p <pid>
```

**2. ä½¿ç”¨Arthas**

```bash
# æŸ¥çœ‹çº¿ç¨‹å †æ ˆ
thread <thread_id>

# æŸ¥çœ‹çƒ­ç‚¹æ–¹æ³•
profiler start
```

### å¸¸è§åŸå› 

**1. while(true)å¾ªç¯**

```java
// âŒ æ­»å¾ªç¯
while (true) {
    // æ— é™å¾ªç¯
}

// âœ… æ·»åŠ æ¡ä»¶
while (condition) {
    // å¾ªç¯é€»è¾‘
    if (shouldExit()) {
        break;
    }
}
```

**2. é€’å½’è°ƒç”¨**

```java
// âŒ æ— é™é€’å½’
public void recursive() {
    recursive();  // æ— é™é€’å½’
}

// âœ… æ·»åŠ ç»ˆæ­¢æ¡ä»¶
public void recursive(int depth) {
    if (depth <= 0) {
        return;
    }
    recursive(depth - 1);
}
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¿®å¤æ­»å¾ªç¯**

```java
// æ·»åŠ é€€å‡ºæ¡ä»¶
while (condition) {
    // å¾ªç¯é€»è¾‘
    if (shouldExit()) {
        break;
    }
}
```

**2. é™åˆ¶å¾ªç¯æ¬¡æ•°**

```java
// é™åˆ¶å¾ªç¯æ¬¡æ•°
int maxIterations = 1000;
int count = 0;
while (condition && count < maxIterations) {
    // å¾ªç¯é€»è¾‘
    count++;
}
```

---

## çƒ­ç‚¹ä»£ç 

### æ’æŸ¥æ–¹æ³•

**1. ä½¿ç”¨Arthas**

```bash
# å¯åŠ¨Arthas
java -jar arthas-boot.jar

# æŸ¥çœ‹çƒ­ç‚¹æ–¹æ³•
profiler start
# ç­‰å¾…ä¸€æ®µæ—¶é—´
profiler stop
# æŸ¥çœ‹åˆ†æç»“æœ
```

**2. ä½¿ç”¨JProfiler**

```bash
# ä½¿ç”¨JProfileråˆ†æçƒ­ç‚¹ä»£ç 
# 1. å¯åŠ¨JProfiler
# 2. è¿æ¥åº”ç”¨
# 3. æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ
# 4. åˆ†æçƒ­ç‚¹æ–¹æ³•
```

### å¸¸è§åŸå› 

**1. é¢‘ç¹è®¡ç®—**

```java
// âŒ é¢‘ç¹è®¡ç®—
for (int i = 0; i < 1000000; i++) {
    complexCalculation();  // å¤æ‚è®¡ç®—
}

// âœ… ä¼˜åŒ–
// 1. å‡å°‘è®¡ç®—æ¬¡æ•°
// 2. ä½¿ç”¨ç¼“å­˜
// 3. ä¼˜åŒ–ç®—æ³•
```

**2. é¢‘ç¹å­—ç¬¦ä¸²æ“ä½œ**

```java
// âŒ é¢‘ç¹å­—ç¬¦ä¸²æ‹¼æ¥
String result = "";
for (int i = 0; i < 10000; i++) {
    result += i;  // é¢‘ç¹åˆ›å»ºå¯¹è±¡
}

// âœ… ä½¿ç”¨StringBuilder
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 10000; i++) {
    sb.append(i);
}
String result = sb.toString();
```

**3. é¢‘ç¹IOæ“ä½œ**

```java
// âŒ é¢‘ç¹IOæ“ä½œ
for (int i = 0; i < 1000; i++) {
    File file = new File("file" + i);
    file.createNewFile();  // é¢‘ç¹IO
}

// âœ… æ‰¹é‡æ“ä½œ
// 1. æ‰¹é‡å¤„ç†
// 2. ä½¿ç”¨å¼‚æ­¥IO
// 3. ä½¿ç”¨ç¼“å†²
```

### è§£å†³æ–¹æ¡ˆ

**1. ä¼˜åŒ–ç®—æ³•**

```java
// 1. ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦
// 2. å‡å°‘è®¡ç®—æ¬¡æ•°
// 3. ä½¿ç”¨ç¼“å­˜
```

**2. ä½¿ç”¨ç¼“å­˜**

```java
// ç¼“å­˜è®¡ç®—ç»“æœ
private Map<String, Object> cache = new HashMap<>();

public Object compute(String key) {
    if (cache.containsKey(key)) {
        return cache.get(key);
    }
    Object result = expensiveComputation(key);
    cache.put(key, result);
    return result;
}
```

**3. å¼‚æ­¥å¤„ç†**

```java
// å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
CompletableFuture.supplyAsync(() -> {
    return expensiveComputation();
});
```

---

## æ’æŸ¥å·¥å…·

### 1. ç³»ç»Ÿå·¥å…·

```bash
# top - æŸ¥çœ‹CPUä½¿ç”¨ç‡
top
top -H -p <pid>

# htop - äº¤äº’å¼æŸ¥çœ‹
htop

# vmstat - ç³»ç»Ÿç»Ÿè®¡
vmstat 1
```

### 2. Javaå·¥å…·

```bash
# jstack - çº¿ç¨‹å †æ ˆ
jstack <pid>

# Arthas - Javaè¯Šæ–­å·¥å…·
java -jar arthas-boot.jar
thread
profiler start
```

### 3. æ€§èƒ½åˆ†æå·¥å…·

```bash
# JProfiler - Javaæ€§èƒ½åˆ†æ
# 1. å¯åŠ¨JProfiler
# 2. è¿æ¥åº”ç”¨
# 3. æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ

# VisualVM - Javaæ€§èƒ½åˆ†æ
# 1. å¯åŠ¨VisualVM
# 2. è¿æ¥åº”ç”¨
# 3. æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ€§èƒ½é—®é¢˜æ’æŸ¥](./01_æ€§èƒ½é—®é¢˜æ’æŸ¥.md)
- [å†…å­˜æ³„æ¼æ’æŸ¥](./08_å†…å­˜æ³„æ¼æ’æŸ¥.md)
- [JVMè°ƒä¼˜å®æˆ˜](../../11_æ€§èƒ½ä¼˜åŒ–/JVMè°ƒä¼˜å®æˆ˜.md)

---

**æœ€åæ›´æ–°**: 2025-10-29  
**æ–‡æ¡£çŠ¶æ€**: âœ… æ¡†æ¶å·²æ­å»ºï¼Œå†…å®¹æŒç»­å®Œå–„ä¸­

