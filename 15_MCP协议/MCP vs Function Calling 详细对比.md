# MCP vs Function Calling è¯¦ç»†å¯¹æ¯”

> ğŸ” æ·±å…¥ç†è§£MCPåè®®ä¸ä¼ ç»ŸFunction Callingçš„æœ¬è´¨åŒºåˆ«ã€ä½¿ç”¨åœºæ™¯åŠé€‰å‹æŒ‡å—

---

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒå®šä¹‰å¯¹æ¯”](#1-æ ¸å¿ƒå®šä¹‰å¯¹æ¯”)
2. [æ¶æ„è®¾è®¡å¯¹æ¯”](#2-æ¶æ„è®¾è®¡å¯¹æ¯”)
3. [æŠ€æœ¯å®ç°å¯¹æ¯”](#3-æŠ€æœ¯å®ç°å¯¹æ¯”)
4. [ä½¿ç”¨åœºæ™¯å¯¹æ¯”](#4-ä½¿ç”¨åœºæ™¯å¯¹æ¯”)
5. [ä¼˜åŠ£åŠ¿åˆ†æ](#5-ä¼˜åŠ£åŠ¿åˆ†æ)
6. [å®æˆ˜æ¡ˆä¾‹å¯¹æ¯”](#6-å®æˆ˜æ¡ˆä¾‹å¯¹æ¯”)
7. [é€‰å‹å†³ç­–æŒ‡å—](#7-é€‰å‹å†³ç­–æŒ‡å—)
8. [ç»“åˆä½¿ç”¨æ–¹æ¡ˆ](#8-ç»“åˆä½¿ç”¨æ–¹æ¡ˆ)

---

## 1. æ ¸å¿ƒå®šä¹‰å¯¹æ¯”

### 1.1 Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰

**å®šä¹‰**ï¼š
```
Function Calling æ˜¯AIå¤§æ¨¡å‹ï¼ˆå¦‚GPT-4ã€Claudeï¼‰çš„ä¸€ç§èƒ½åŠ›ï¼Œ
è®©æ¨¡å‹èƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œå¹¶ç”Ÿæˆç»“æ„åŒ–çš„å‡½æ•°è°ƒç”¨è¯·æ±‚ã€‚
```

**æœ¬è´¨ç‰¹ç‚¹**ï¼š
- âœ… **AIæ¨¡å‹çš„å†…ç½®åŠŸèƒ½**ï¼šOpenAI GPT-4ã€Anthropic Claudeã€Google Geminiç­‰éƒ½æ”¯æŒ
- âœ… **ç”Ÿæˆè°ƒç”¨è¯·æ±‚**ï¼šAIè¾“å‡ºJSONæ ¼å¼çš„å‡½æ•°è°ƒç”¨å‚æ•°
- âŒ **ä¸æ‰§è¡Œå‡½æ•°**ï¼šå¼€å‘è€…éœ€è¦æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°å¹¶è¿”å›ç»“æœ
- âŒ **æ— çŠ¶æ€**ï¼šæ¯æ¬¡APIè°ƒç”¨éƒ½éœ€è¦é‡æ–°ä¼ é€’å‡½æ•°å®šä¹‰

**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥ï¼š"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  â†“
AIåˆ†æï¼šéœ€è¦è°ƒç”¨get_weatherå‡½æ•°
  â†“
AIè¾“å‡ºï¼š
{
  "function_call": {
    "name": "get_weather",
    "arguments": '{"location": "åŒ—äº¬", "unit": "celsius"}'
  }
}
  â†“
å¼€å‘è€…æ‰§è¡Œï¼šweather = get_weather("åŒ—äº¬", "celsius")
  â†“
å¼€å‘è€…è¿”å›ç»“æœç»™AI
  â†“
AIç”Ÿæˆæœ€ç»ˆå›ç­”ï¼š"åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œ25Â°C"
```

**ä»£ç ç¤ºä¾‹ï¼ˆOpenAIï¼‰**ï¼š
```python
import openai

# å®šä¹‰å‡½æ•°schema
functions = [
    {
        "name": "get_weather",
        "description": "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
        "parameters": {
            "type": "object",
            "properties": {
                "location": {
                    "type": "string",
                    "description": "åŸå¸‚åç§°ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·"
                },
                "unit": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"],
                    "description": "æ¸©åº¦å•ä½"
                }
            },
            "required": ["location"]
        }
    }
]

# è°ƒç”¨AI
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}],
    functions=functions  # âš ï¸ æ¯æ¬¡è°ƒç”¨éƒ½è¦ä¼ é€’
)

# AIè¿”å›å‡½æ•°è°ƒç”¨è¯·æ±‚
if response.choices[0].message.get("function_call"):
    function_call = response.choices[0].message["function_call"]
    function_name = function_call["name"]
    function_args = json.loads(function_call["arguments"])
    
    # å¼€å‘è€…æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°
    if function_name == "get_weather":
        result = get_weather(**function_args)
        
        # å°†ç»“æœè¿”å›ç»™AI
        second_response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[
                {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"},
                response.choices[0].message,
                {"role": "function", "name": "get_weather", "content": str(result)}
            ]
        )
        
        print(second_response.choices[0].message["content"])
```


### 1.2 MCPï¼ˆModel Context Protocolï¼‰

**å®šä¹‰**ï¼š
```
MCP æ˜¯ç”±Anthropicæ¨å‡ºçš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œ
å®šä¹‰äº†AIåº”ç”¨ï¼ˆClientï¼‰ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆServerï¼‰ä¹‹é—´çš„æ ‡å‡†åŒ–äº¤äº’æ–¹å¼ã€‚
```

**æœ¬è´¨ç‰¹ç‚¹**ï¼š
- âœ… **ç‹¬ç«‹çš„åè®®æ ‡å‡†**ï¼šç±»ä¼¼HTTPã€WebSocketç­‰ç½‘ç»œåè®®
- âœ… **Client-Serveræ¶æ„**ï¼šServeræŒä¹…è¿è¡Œï¼Œæä¾›èƒ½åŠ›
- âœ… **è‡ªåŠ¨æ‰§è¡Œ**ï¼šServeræ¥æ”¶åˆ°è¯·æ±‚åè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€äººå·¥å¹²é¢„
- âœ… **æœ‰çŠ¶æ€**ï¼šServeræŒä¹…è¿è¡Œï¼Œèƒ½åŠ›é•¿æœŸå¯ç”¨
- âœ… **è·¨åº”ç”¨å¤ç”¨**ï¼šä¸€ä¸ªServerå¯è¢«å¤šä¸ªAIåº”ç”¨ä½¿ç”¨

**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·åœ¨Cursorä¸­è¾“å…¥ï¼š"è¯»å–README.mdæ–‡ä»¶å†…å®¹"
  â†“
Cursor AIè‡ªåŠ¨å‘ç°ï¼šå·²é…ç½®Filesystem MCP Server
  â†“
AIå†³å®šè°ƒç”¨ï¼šresources/read
  â†“
MCP Clientï¼ˆCursorï¼‰â†’ MCP Serverï¼ˆFilesystemï¼‰
  â†“
MCP Serverè‡ªåŠ¨æ‰§è¡Œï¼šè¯»å–æ–‡ä»¶
  â†“
MCP Serverè¿”å›ï¼šæ–‡ä»¶å†…å®¹
  â†“
AIç”Ÿæˆæœ€ç»ˆå›ç­”ï¼š"README.mdçš„å†…å®¹æ˜¯..."
```

**ä»£ç ç¤ºä¾‹ï¼ˆMCP Serverå¼€å‘ï¼‰**ï¼š
```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { CallToolRequestSchema, ListToolsRequestSchema } from "@modelcontextprotocol/sdk/types.js";

// åˆ›å»ºMCP Server
const server = new Server(
  {
    name: "weather-server",
    version: "1.0.0"
  },
  {
    capabilities: {
      tools: {}  // å£°æ˜æä¾›å·¥å…·èƒ½åŠ›
    }
  }
);

// æ³¨å†Œå·¥å…·åˆ—è¡¨
server.setRequestHandler(ListToolsRequestSchema, async () => {
  return {
    tools: [
      {
        name: "get_weather",
        description: "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
        inputSchema: {
          type: "object",
          properties: {
            location: {
              type: "string",
              description: "åŸå¸‚åç§°"
            },
            unit: {
              type: "string",
              enum: ["celsius", "fahrenheit"],
              description: "æ¸©åº¦å•ä½"
            }
          },
          required: ["location"]
        }
      }
    ]
  };
});

// å¤„ç†å·¥å…·è°ƒç”¨
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  if (request.params.name === "get_weather") {
    const { location, unit } = request.params.arguments;
    
    // Serverè‡ªåŠ¨æ‰§è¡Œå‡½æ•°
    const weather = await fetchWeatherData(location, unit);
    
    return {
      content: [
        {
          type: "text",
          text: JSON.stringify(weather)
        }
      ]
    };
  }
  
  throw new Error("Unknown tool");
});

// å¯åŠ¨Serverï¼ˆæŒä¹…è¿è¡Œï¼‰
const transport = new StdioServerTransport();
await server.connect(transport);
```

**é…ç½®åˆ°AIå®¢æˆ·ç«¯ï¼ˆCursorï¼‰**ï¼š
```json
// ~/.cursor/mcp.json
{
  "mcpServers": {
    "weather": {
      "command": "node",
      "args": ["/absolute/path/to/weather-server.js"]
    }
  }
}
```

**ä½¿ç”¨ï¼ˆå®Œå…¨è‡ªåŠ¨ï¼‰**ï¼š
```
ç”¨æˆ·åœ¨Cursorä¸­ï¼š"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  â†“
Cursorè‡ªåŠ¨ï¼š
1. å‘ç°weather Serveræä¾›get_weatherå·¥å…·
2. AIå†³å®šè°ƒç”¨å·¥å…·
3. MCP Clientè‡ªåŠ¨è°ƒç”¨Server
4. Serverè‡ªåŠ¨æ‰§è¡Œå¹¶è¿”å›ç»“æœ
5. AIç”Ÿæˆå›ç­”

âš ï¸ å¼€å‘è€…ä¸éœ€è¦åšä»»ä½•äº‹ï¼
```


### 1.3 æ ¸å¿ƒå·®å¼‚æ€»ç»“

| ç»´åº¦ | Function Calling | MCP |
|------|-----------------|-----|
| **å®šä¹‰** | AIæ¨¡å‹çš„èƒ½åŠ› | ç‹¬ç«‹çš„åè®®æ ‡å‡† |
| **å±‚æ¬¡** | åº”ç”¨å±‚åŠŸèƒ½ | åè®®å±‚æ ‡å‡† |
| **æ¶æ„** | æ— å›ºå®šæ¶æ„ | Client-Serveræ¶æ„ |
| **çŠ¶æ€** | æ— çŠ¶æ€ | æœ‰çŠ¶æ€ï¼ˆServeræŒä¹…è¿è¡Œï¼‰ |
| **æ‰§è¡Œè€…** | å¼€å‘è€…æ‰‹åŠ¨æ‰§è¡Œ | Serverè‡ªåŠ¨æ‰§è¡Œ |
| **é…ç½®** | æ¯æ¬¡APIè°ƒç”¨ä¼ é€’ | ä¸€æ¬¡é…ç½®ï¼Œé•¿æœŸä½¿ç”¨ |
| **å¤ç”¨æ€§** | âŒ æ¯ä¸ªåº”ç”¨é‡å¤å¼€å‘ | âœ… è·¨åº”ç”¨å¤ç”¨ |
| **æ ‡å‡†åŒ–** | å„å®¶æ ¼å¼ä¸åŒ | ç»Ÿä¸€MCPæ ‡å‡† |
| **ç”Ÿæ€** | æ— ç‹¬ç«‹ç”Ÿæ€ | å®˜æ–¹+ç¤¾åŒºServerç”Ÿæ€ |
| **å…¸å‹ä½¿ç”¨** | ChatGPTã€APIè°ƒç”¨ | Cursorã€Claude Desktop |

**ç±»æ¯”ç†è§£**ï¼š

```
Function Calling = é¥æ§å™¨
- AIæ˜¯é¥æ§å™¨ï¼Œå‘Šè¯‰ä½ æŒ‰å“ªä¸ªæŒ‰é’®
- ä½ ï¼ˆå¼€å‘è€…ï¼‰è¦æ‰‹åŠ¨æŒ‰æŒ‰é’®æ‰§è¡Œ
- æ¯ä¸ªæˆ¿é—´ï¼ˆåº”ç”¨ï¼‰éƒ½è¦é…ä¸€ä¸ªé¥æ§å™¨
- æ¯æ¬¡ä½¿ç”¨å‰è¦æ‹¿å‡ºè¯´æ˜ä¹¦ï¼ˆä¼ functionsï¼‰

MCP = æ™ºèƒ½å®¶å±…ç³»ç»Ÿ
- AIæ˜¯è¯­éŸ³åŠ©æ‰‹
- æ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼ˆMCP Serverï¼‰è‡ªåŠ¨æ‰§è¡Œ
- æ‰€æœ‰æˆ¿é—´ï¼ˆåº”ç”¨ï¼‰å…±äº«åŒä¸€ä¸ªç³»ç»Ÿ
- ä¸€æ¬¡å®‰è£…ï¼Œé•¿æœŸä½¿ç”¨
```

**å¦ä¸€ä¸ªç±»æ¯”**ï¼š

```
Function Calling = USBè®¾å¤‡é©±åŠ¨
- æ¯ä¸ªåº”ç”¨éƒ½è¦è‡ªå·±å®ç°é©±åŠ¨
- ä¸åŒåº”ç”¨çš„å®ç°æ–¹å¼å¯èƒ½ä¸åŒ
- åº”ç”¨è´Ÿè´£ç®¡ç†è®¾å¤‡

MCP = USBæ ‡å‡†åè®®
- è®¾å¤‡å®ç°USBæ ‡å‡†
- æ‰€æœ‰åº”ç”¨éƒ½èƒ½è¯†åˆ«USBè®¾å¤‡
- å³æ’å³ç”¨
```

---

## 2. æ¶æ„è®¾è®¡å¯¹æ¯”

### 2.1 Function Callingæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¼€å‘è€…åº”ç”¨ï¼ˆä½ çš„ä»£ç ï¼‰                  â”‚
â”‚                                                 â”‚
â”‚  1. å®šä¹‰functionsåˆ—è¡¨                           â”‚
â”‚  2. è°ƒç”¨AI APIï¼Œä¼ é€’functions                   â”‚
â”‚  3. æ¥æ”¶AIçš„function_callå“åº”                   â”‚
â”‚  4. æ‰‹åŠ¨è§£æå‚æ•°                                â”‚
â”‚  5. æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°                                â”‚
â”‚  6. æ‰‹åŠ¨å°†ç»“æœè¿”å›ç»™AI                          â”‚
â”‚  7. æ¥æ”¶AIçš„æœ€ç»ˆå›ç­”                            â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ APIè°ƒç”¨
                   â”‚ (HTTP Request)
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AIæœåŠ¡ï¼ˆOpenAI/Claudeï¼‰               â”‚
â”‚                                                 â”‚
â”‚  â€¢ åˆ†æç”¨æˆ·æ„å›¾                                 â”‚
â”‚  â€¢ é€‰æ‹©åˆé€‚çš„å‡½æ•°                               â”‚
â”‚  â€¢ ç”Ÿæˆå‡½æ•°è°ƒç”¨å‚æ•°                             â”‚
â”‚  â€¢ è¿”å›function_call                            â”‚
â”‚                                                 â”‚
â”‚  âš ï¸ ä¸æ‰§è¡Œå‡½æ•°ï¼Œåªè¿”å›è°ƒç”¨è¯·æ±‚                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**ï¼š
- âŒ **æ— æ¶æ„çº¦æŸ**ï¼šå¼€å‘è€…è‡ªç”±å®ç°
- âŒ **æ— çŠ¶æ€**ï¼šæ¯æ¬¡è°ƒç”¨ç‹¬ç«‹ï¼Œä¸ä¿å­˜ä¸Šä¸‹æ–‡
- âŒ **æ‰‹åŠ¨æ‰§è¡Œ**ï¼šAIåªè´Ÿè´£"æ™ºèƒ½"ï¼Œä¸è´Ÿè´£"æ‰§è¡Œ"
- âŒ **å•åº”ç”¨**ï¼šå‡½æ•°å®šä¹‰ç»‘å®šåˆ°å…·ä½“åº”ç”¨

**æ•°æ®æµ**ï¼š
```
[ç”¨æˆ·] â†’ [åº”ç”¨] â†’ [AI API] â†’ [åº”ç”¨] â†’ [æ‰§è¡Œå‡½æ•°] â†’ [åº”ç”¨] â†’ [AI API] â†’ [åº”ç”¨] â†’ [ç”¨æˆ·]
         â†‘                             â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€æ‰‹åŠ¨å¾ªç¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 2.2 MCPæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cursor   â”‚  â”‚  Claude   â”‚  â”‚ VS Code  â”‚  â”‚ è‡ªå®šä¹‰App â”‚  â† AIå®¢æˆ·ç«¯ï¼ˆMCP Clientï¼‰
â”‚          â”‚  â”‚ Desktop   â”‚  â”‚          â”‚  â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚              â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     MCP Protocol               â”‚  â† ç»Ÿä¸€åè®®å±‚
          â”‚     (JSON-RPC 2.0)             â”‚
          â”‚   â€¢ initialize                 â”‚
          â”‚   â€¢ resources/list             â”‚
          â”‚   â€¢ tools/list                 â”‚
          â”‚   â€¢ tools/call                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚              â”‚             â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Weather  â”‚  â”‚Database â”‚  â”‚Filesystem â”‚  â”‚  Git    â”‚  â† MCP Servers
â”‚ Server  â”‚  â”‚ Server  â”‚  â”‚  Server   â”‚  â”‚ Server  â”‚  ï¼ˆæŒä¹…è¿è¡Œï¼‰
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚             â”‚             â”‚
     â”‚            â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Weather  â”‚  â”‚ MySQL  â”‚  â”‚   File    â”‚  â”‚  Git    â”‚  â† å¤–éƒ¨ç³»ç»Ÿ
â”‚   API   â”‚  â”‚   DB   â”‚  â”‚  System   â”‚  â”‚  Repo   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**ï¼š
- âœ… **æ ‡å‡†æ¶æ„**ï¼šClient-Serveræ˜ç¡®åˆ†ç¦»
- âœ… **æœ‰çŠ¶æ€**ï¼šServeræŒä¹…è¿è¡Œï¼Œä¿å­˜è¿æ¥çŠ¶æ€
- âœ… **è‡ªåŠ¨æ‰§è¡Œ**ï¼šServeræ¥æ”¶è¯·æ±‚åè‡ªåŠ¨æ‰§è¡Œ
- âœ… **è·¨åº”ç”¨å¤ç”¨**ï¼šå¤šä¸ªClientå…±äº«åŒä¸€Server

**æ•°æ®æµ**ï¼š
```
[ç”¨æˆ·] â†’ [AI Client] â†’ [MCP Server] â†’ [å¤–éƒ¨ç³»ç»Ÿ]
                â†“            â†“
            è‡ªåŠ¨è°ƒç”¨      è‡ªåŠ¨æ‰§è¡Œ
                â†“            â†“
             è·å–ç»“æœ â† è¿”å›æ•°æ®
                â†“
            ç”Ÿæˆå›ç­” â†’ [ç”¨æˆ·]
```

**åè®®æ ˆ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Application     â”‚  â† Cursorã€Claude Desktopã€è‡ªå®šä¹‰åº”ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCP SDK            â”‚  â† MCP Clientåº“ï¼ˆTypeScript/Pythonï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCP Protocol       â”‚  â† JSON-RPC 2.0
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Transport Layer    â”‚  â† stdioã€HTTPã€WebSocket
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCP Server         â”‚  â† å…·ä½“å®ç°ï¼ˆFilesystemã€Databaseç­‰ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External System    â”‚  â† æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€API
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¶æ„å¯¹æ¯”æ€»ç»“

| ç»´åº¦ | Function Calling | MCP |
|------|-----------------|-----|
| **è§’è‰²åˆ’åˆ†** | AI + å¼€å‘è€…åº”ç”¨ | Client + Server + AI |
| **æ‰§è¡Œæ¨¡å‹** | è¯·æ±‚-å“åº”-æ‰‹åŠ¨æ‰§è¡Œ | è¯·æ±‚-è‡ªåŠ¨æ‰§è¡Œ-å“åº” |
| **ç”Ÿå‘½å‘¨æœŸ** | éšAPIè°ƒç”¨å¯åŠ¨å’Œç»“æŸ | ServeræŒä¹…è¿è¡Œ |
| **é€šä¿¡æ–¹å¼** | HTTP APIè°ƒç”¨ | MCPåè®®ï¼ˆstdio/HTTP/WebSocketï¼‰ |
| **èƒ½åŠ›å‘ç°** | æ¯æ¬¡ä¼ é€’å®šä¹‰ | Serveræ³¨å†Œèƒ½åŠ›ï¼ŒClientæŸ¥è¯¢ |
| **é”™è¯¯å¤„ç†** | å¼€å‘è€…å¤„ç† | Serverå†…éƒ¨å¤„ç† |
| **å¹¶å‘æ§åˆ¶** | å¼€å‘è€…ç®¡ç† | Serverç®¡ç† |
| **èµ„æºç®¡ç†** | å¼€å‘è€…ç®¡ç† | Serverç®¡ç† |

**å…³é”®åŒºåˆ«**ï¼š

```
Function Callingï¼š
- AIæ˜¯"é¡¾é—®"ï¼šå‘Šè¯‰ä½ è¯¥åšä»€ä¹ˆ
- å¼€å‘è€…æ˜¯"æ‰§è¡Œè€…"ï¼šå®é™…å»åš

MCPï¼š
- AIæ˜¯"ç®¡ç†è€…"ï¼šå†³å®šè°ƒç”¨å“ªä¸ªServer
- Serveræ˜¯"æ‰§è¡Œè€…"ï¼šè‡ªåŠ¨å®Œæˆä»»åŠ¡
- å¼€å‘è€…æ˜¯"æ¶æ„å¸ˆ"ï¼šæå‰é…ç½®å¥½ç³»ç»Ÿ
```

---

## 3. æŠ€æœ¯å®ç°å¯¹æ¯”

### 3.1 Function Callingå®ç°ç¤ºä¾‹

#### OpenAI Function Calling
```python
import openai
import json

def get_current_weather(location: str, unit: str = "celsius") -> dict:
    """è·å–å¤©æ°”ï¼ˆæ¨¡æ‹Ÿï¼‰"""
    return {
        "location": location,
        "temperature": "25",
        "unit": unit,
        "condition": "sunny"
    }

# å®šä¹‰å‡½æ•°schema
functions = [
    {
        "name": "get_current_weather",
        "description": "è·å–æŒ‡å®šåŸå¸‚çš„å½“å‰å¤©æ°”",
        "parameters": {
            "type": "object",
            "properties": {
                "location": {
                    "type": "string",
                    "description": "åŸå¸‚åç§°ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€æ·±åœ³"
                },
                "unit": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"],
                    "description": "æ¸©åº¦å•ä½"
                }
            },
            "required": ["location"]
        }
    }
]

# ç”¨æˆ·æ¶ˆæ¯
messages = [
    {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}
]

# ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šAIå†³å®šè°ƒç”¨å‡½æ•°
response = openai.ChatCompletion.create(
    model="gpt-4-1106-preview",
    messages=messages,
    functions=functions,
    function_call="auto"  # è®©AIè‡ªåŠ¨å†³å®šæ˜¯å¦è°ƒç”¨å‡½æ•°
)

# æ£€æŸ¥AIæ˜¯å¦è¦è°ƒç”¨å‡½æ•°
message = response.choices[0].message

if message.get("function_call"):
    # AIå†³å®šè°ƒç”¨å‡½æ•°
    function_name = message["function_call"]["name"]
    function_args = json.loads(message["function_call"]["arguments"])
    
    print(f"AIå†³å®šè°ƒç”¨ï¼š{function_name}")
    print(f"å‚æ•°ï¼š{function_args}")
    
    # æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°
    if function_name == "get_current_weather":
        function_response = get_current_weather(
            location=function_args.get("location"),
            unit=function_args.get("unit", "celsius")
        )
    
    # å°†å‡½æ•°ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯å†å²
    messages.append(message)
    messages.append({
        "role": "function",
        "name": function_name,
        "content": json.dumps(function_response)
    })
    
    # ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šè®©AIåŸºäºå‡½æ•°ç»“æœç”Ÿæˆå›ç­”
    second_response = openai.ChatCompletion.create(
        model="gpt-4-1106-preview",
        messages=messages
    )
    
    final_answer = second_response.choices[0].message["content"]
    print(f"æœ€ç»ˆå›ç­”ï¼š{final_answer}")
else:
    # AIæ²¡æœ‰è°ƒç”¨å‡½æ•°ï¼Œç›´æ¥å›ç­”
    print(message["content"])
```


**é—®é¢˜åˆ†æ**ï¼š
```
âŒ æ¯æ¬¡éƒ½è¦ä¼ functionså®šä¹‰ï¼ˆé‡å¤ä»£ç ï¼‰
âŒ éœ€è¦æ‰‹åŠ¨è§£æfunction_call
âŒ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°
âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯å†å²
âŒ éœ€è¦ç¬¬äºŒæ¬¡APIè°ƒç”¨æ‰èƒ½å¾—åˆ°æœ€ç»ˆå›ç­”
âŒ é”™è¯¯å¤„ç†éœ€è¦å¼€å‘è€…è‡ªå·±å®ç°
```

#### Claude Function Calling
```python
import anthropic

client = anthropic.Anthropic(api_key="your-api-key")

# å®šä¹‰å·¥å…·schema
tools = [
    {
        "name": "get_weather",
        "description": "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
        "input_schema": {
            "type": "object",
            "properties": {
                "location": {
                    "type": "string",
                    "description": "åŸå¸‚åç§°"
                },
                "unit": {
                    "type": "string",
                    "enum": ["celsius", "fahrenheit"],
                    "description": "æ¸©åº¦å•ä½"
                }
            },
            "required": ["location"]
        }
    }
]

# è°ƒç”¨Claude
response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    tools=tools,
    messages=[
        {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}
    ]
)

# æ£€æŸ¥æ˜¯å¦è°ƒç”¨å·¥å…·
for content in response.content:
    if content.type == "tool_use":
        tool_name = content.name
        tool_input = content.input
        
        # æ‰‹åŠ¨æ‰§è¡Œ
        if tool_name == "get_weather":
            result = get_weather(**tool_input)
        
        # è¿”å›ç»“æœç»™Claude
        final_response = client.messages.create(
            model="claude-3-5-sonnet-20241022",
            max_tokens=1024,
            messages=[
                {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"},
                {"role": "assistant", "content": response.content},
                {
                    "role": "user",
                    "content": [
                        {
                            "type": "tool_result",
                            "tool_use_id": content.id,
                            "content": str(result)
                        }
                    ]
                }
            ]
        )
```

**é—®é¢˜ç›¸åŒ**ï¼š
- âŒ æ‰‹åŠ¨æ‰§è¡Œ
- âŒ æ‰‹åŠ¨ç®¡ç†å¯¹è¯
- âŒ æ¯æ¬¡ä¼ toolså®šä¹‰


### 3.2 MCPå®ç°ç¤ºä¾‹

#### MCP Serverå¼€å‘ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰
```typescript
// weather-server.ts
import { Server } from "@modelcontextprotocol/sdk/server/index.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import {
  CallToolRequestSchema,
  ListToolsRequestSchema,
} from "@modelcontextprotocol/sdk/types.js";

// åˆ›å»ºMCP Server
const server = new Server(
  {
    name: "weather-server",
    version: "1.0.0",
  },
  {
    capabilities: {
      tools: {},  // å£°æ˜æä¾›å·¥å…·èƒ½åŠ›
    },
  }
);

// æ³¨å†Œå·¥å…·åˆ—è¡¨
server.setRequestHandler(ListToolsRequestSchema, async () => {
  return {
    tools: [
      {
        name: "get_weather",
        description: "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
        inputSchema: {
          type: "object",
          properties: {
            location: {
              type: "string",
              description: "åŸå¸‚åç§°",
            },
            unit: {
              type: "string",
              enum: ["celsius", "fahrenheit"],
              description: "æ¸©åº¦å•ä½",
            },
          },
          required: ["location"],
        },
      },
    ],
  };
});

// å¤„ç†å·¥å…·è°ƒç”¨ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  if (request.params.name === "get_weather") {
    const { location, unit = "celsius" } = request.params.arguments;

    try {
      // Serverè‡ªåŠ¨æ‰§è¡Œå‡½æ•°
      const weather = await fetchWeather(location, unit);

      return {
        content: [
          {
            type: "text",
            text: JSON.stringify({
              location,
              temperature: weather.temperature,
              condition: weather.condition,
              unit,
            }),
          },
        ],
      };
    } catch (error) {
      // Serverå†…éƒ¨å¤„ç†é”™è¯¯
      return {
        content: [
          {
            type: "text",
            text: `è·å–å¤©æ°”å¤±è´¥ï¼š${error.message}`,
          },
        ],
        isError: true,
      };
    }
  }

  throw new Error(`Unknown tool: ${request.params.name}`);
});

// å®é™…çš„å¤©æ°”æŸ¥è¯¢å‡½æ•°
async function fetchWeather(location: string, unit: string) {
  // è¿™é‡Œå¯ä»¥è°ƒç”¨çœŸå®çš„å¤©æ°”API
  return {
    temperature: 25,
    condition: "sunny",
  };
}

// å¯åŠ¨Serverï¼ˆæŒä¹…è¿è¡Œï¼‰
async function main() {
  const transport = new StdioServerTransport();
  await server.connect(transport);
  
  // Serverä¼šä¸€ç›´è¿è¡Œï¼Œç­‰å¾…Clientè°ƒç”¨
  console.error("Weather MCP Server started");
}

main().catch((error) => {
  console.error("Server error:", error);
  process.exit(1);
});
```

#### é…ç½®åˆ°AIå®¢æˆ·ç«¯
```json
// ~/.cursor/mcp.json
{
  "mcpServers": {
    "weather": {
      "command": "node",
      "args": ["/absolute/path/to/weather-server.js"]
    }
  }
}
```

#### ä½¿ç”¨ï¼ˆå®Œå…¨è‡ªåŠ¨ï¼‰
```
ç”¨æˆ·åœ¨Cursorä¸­ï¼š
"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"

Cursorè‡ªåŠ¨æµç¨‹ï¼š
1. âœ… å‘ç°weather Serveræä¾›get_weatherå·¥å…·
2. âœ… AIå†³å®šè°ƒç”¨å·¥å…·
3. âœ… MCP Clientè‡ªåŠ¨è°ƒç”¨Server
4. âœ… Serverè‡ªåŠ¨æ‰§è¡ŒfetchWeather
5. âœ… Serverè¿”å›ç»“æœ
6. âœ… AIç”Ÿæˆæœ€ç»ˆå›ç­”

å¼€å‘è€…ï¼šä»€ä¹ˆéƒ½ä¸ç”¨åšï¼
```

**ä¼˜åŠ¿æ€»ç»“**ï¼š
```
âœ… ServeræŒä¹…è¿è¡Œï¼Œä¸éœ€è¦é‡å¤å®šä¹‰
âœ… AI Clientè‡ªåŠ¨å‘ç°å·¥å…·
âœ… Serverè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨
âœ… Serverå†…éƒ¨å¤„ç†é”™è¯¯
âœ… ä¸€æ¬¡é…ç½®ï¼Œé•¿æœŸä½¿ç”¨
âœ… å¤šä¸ªAIåº”ç”¨å¯å¤ç”¨åŒä¸€Server
```


### 3.3 æŠ€æœ¯å®ç°å¯¹æ¯”æ€»ç»“

| ç»´åº¦ | Function Calling | MCP |
|------|-----------------|-----|
| **ä»£ç é‡** | å¤šï¼ˆæ¯æ¬¡è°ƒç”¨éƒ½è¦å¤„ç†ï¼‰ | å°‘ï¼ˆä¸€æ¬¡å¼€å‘ï¼Œé•¿æœŸå¤ç”¨ï¼‰ |
| **å¤æ‚åº¦** | é«˜ï¼ˆæ‰‹åŠ¨ç®¡ç†æµç¨‹ï¼‰ | ä½ï¼ˆæ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼‰ |
| **çŠ¶æ€ç®¡ç†** | æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯å†å² | Serverè‡ªåŠ¨ç®¡ç† |
| **é”™è¯¯å¤„ç†** | å¼€å‘è€…å®ç° | Serveræ¡†æ¶å¤„ç† |
| **ç±»å‹å®‰å…¨** | ä¾èµ–æ‰‹åŠ¨æ ¡éªŒ | SDKæä¾›ç±»å‹æ£€æŸ¥ |
| **è°ƒè¯•éš¾åº¦** | é«˜ï¼ˆéœ€è¦è¿½è¸ªå¤šæ¬¡APIè°ƒç”¨ï¼‰ | ä¸­ï¼ˆServeræ—¥å¿—æ¸…æ™°ï¼‰ |
| **éƒ¨ç½²æ–¹å¼** | åµŒå…¥åº”ç”¨ä»£ç  | ç‹¬ç«‹è¿›ç¨‹è¿è¡Œ |
| **æ‰©å±•æ€§** | âŒ éš¾æ‰©å±•ï¼ˆä»£ç è€¦åˆï¼‰ | âœ… æ˜“æ‰©å±•ï¼ˆæ·»åŠ æ–°Serverï¼‰ |

---

## 4. Function Calling æœºåˆ¶å’Œå·¥ä½œåŸç†æ·±åº¦è§£æ

### 4.1 Function Calling æ ¸å¿ƒæœºåˆ¶

#### 4.1.1 ä»€ä¹ˆæ˜¯ Function Callingï¼Ÿ

**å®˜æ–¹å®šä¹‰**ï¼ˆOpenAIï¼‰ï¼š
```
Function calling allows you to describe functions to the model 
and have it intelligently output a JSON object containing 
arguments to call those functions.
```

**æ ¸å¿ƒç†è§£**ï¼š
```
Function Calling ä¸æ˜¯è®©AI"æ‰§è¡Œ"å‡½æ•°ï¼Œ
è€Œæ˜¯è®©AI"ç†è§£"ç”¨æˆ·æ„å›¾ï¼Œå¹¶"ç”Ÿæˆ"è°ƒç”¨å‡½æ•°æ‰€éœ€çš„å‚æ•°ã€‚

AIçš„è§’è‰²ï¼šæ™ºèƒ½å‚æ•°æå–å™¨
å¼€å‘è€…çš„è§’è‰²ï¼šå‡½æ•°æ‰§è¡Œå™¨
```

**ç±»æ¯”**ï¼š
```
ä¼ ç»ŸAIå¯¹è¯ï¼š
ç”¨æˆ·ï¼š"åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AIï¼š"æŠ±æ­‰ï¼Œæˆ‘æ˜¯è¯­è¨€æ¨¡å‹ï¼Œæ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚"

Function Callingï¼š
ç”¨æˆ·ï¼š"åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AIï¼ˆå†…å¿ƒï¼‰ï¼š"ç”¨æˆ·æƒ³æŸ¥å¤©æ°” â†’ éœ€è¦è°ƒç”¨get_weatherå‡½æ•° â†’ å‚æ•°location='åŒ—äº¬'"
AIï¼ˆè¾“å‡ºï¼‰ï¼š{
  "function_call": {
    "name": "get_weather",
    "arguments": '{"location": "åŒ—äº¬"}'
  }
}
å¼€å‘è€…ï¼šæ”¶åˆ°å‚æ•° â†’ è°ƒç”¨çœŸå®çš„å¤©æ°”API â†’ è·å–ç»“æœ â†’ è¿”å›ç»™AI
AIï¼šåŸºäºç»“æœç”Ÿæˆäººæ€§åŒ–å›ç­”ï¼š"åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œ25Â°C"
```

#### 4.1.2 Function Calling å·¥ä½œæµç¨‹è¯¦è§£

**å®Œæ•´æµç¨‹å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: å¼€å‘è€…å®šä¹‰å‡½æ•°Schema                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  functions = [{                                             â”‚
â”‚    "name": "get_weather",                                   â”‚
â”‚    "description": "è·å–åŸå¸‚å¤©æ°”",                            â”‚
â”‚    "parameters": {                                          â”‚
â”‚      "type": "object",                                      â”‚
â”‚      "properties": {                                        â”‚
â”‚        "location": {"type": "string"},                      â”‚
â”‚        "unit": {"type": "string", "enum": ["C", "F"]}      â”‚
â”‚      },                                                     â”‚
â”‚      "required": ["location"]                               â”‚
â”‚    }                                                        â”‚
â”‚  }]                                                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å‘é€è¯·æ±‚ç»™AIï¼ˆåŒ…å«functionså®šä¹‰ï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  POST https://api.openai.com/v1/chat/completions           â”‚
â”‚  {                                                          â”‚
â”‚    "model": "gpt-4",                                        â”‚
â”‚    "messages": [                                            â”‚
â”‚      {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}     â”‚
â”‚    ],                                                       â”‚
â”‚    "functions": [...],  â† æ¯æ¬¡éƒ½è¦ä¼                         â”‚
â”‚    "function_call": "auto"  â† è®©AIå†³å®šæ˜¯å¦è°ƒç”¨               â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: AIåˆ†æå¹¶å†³å®šæ˜¯å¦è°ƒç”¨å‡½æ•°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  AIå†…éƒ¨æ¨ç†è¿‡ç¨‹ï¼š                                           â”‚
â”‚  1ï¸âƒ£ ç†è§£ç”¨æˆ·æ„å›¾ï¼š"ç”¨æˆ·æƒ³çŸ¥é“åŒ—äº¬çš„å¤©æ°”"                     â”‚
â”‚  2ï¸âƒ£ æ£€æŸ¥å¯ç”¨å‡½æ•°ï¼šå‘ç°æœ‰get_weatherå‡½æ•°                     â”‚
â”‚  3ï¸âƒ£ åŒ¹é…èƒ½åŠ›ï¼šget_weatherå¯ä»¥è·å–å¤©æ°”ä¿¡æ¯                    â”‚
â”‚  4ï¸âƒ£ æå–å‚æ•°ï¼šlocation="åŒ—äº¬"                               â”‚
â”‚  5ï¸âƒ£ ç”Ÿæˆå‡½æ•°è°ƒç”¨                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: AIè¿”å›å‡½æ•°è°ƒç”¨è¯·æ±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Response:                                                  â”‚
â”‚  {                                                          â”‚
â”‚    "id": "chatcmpl-xxx",                                    â”‚
â”‚    "choices": [{                                            â”‚
â”‚      "message": {                                           â”‚
â”‚        "role": "assistant",                                 â”‚
â”‚        "content": null,  â† æ²¡æœ‰æ–‡æœ¬å†…å®¹                      â”‚
â”‚        "function_call": {  â† å‡½æ•°è°ƒç”¨è¯·æ±‚                    â”‚
â”‚          "name": "get_weather",                             â”‚
â”‚          "arguments": "{\"location\": \"åŒ—äº¬\"}"             â”‚
â”‚        }                                                    â”‚
â”‚      },                                                     â”‚
â”‚      "finish_reason": "function_call"  â† æ ‡è¯†éœ€è¦è°ƒç”¨å‡½æ•°    â”‚
â”‚    }]                                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å¼€å‘è€…æ‰‹åŠ¨è§£æå¹¶æ‰§è¡Œå‡½æ•°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  # è§£æå“åº”                                                 â”‚
â”‚  message = response.choices[0].message                      â”‚
â”‚  function_call = message.get("function_call")               â”‚
â”‚                                                             â”‚
â”‚  # æå–å‚æ•°                                                 â”‚
â”‚  function_name = function_call["name"]                      â”‚
â”‚  function_args = json.loads(function_call["arguments"])     â”‚
â”‚                                                             â”‚
â”‚  # æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°                                             â”‚
â”‚  if function_name == "get_weather":                         â”‚
â”‚      result = get_weather(**function_args)                  â”‚
â”‚      # result = {"temp": 25, "condition": "sunny"}          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: å°†å‡½æ•°ç»“æœè¿”å›ç»™AI                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  POST https://api.openai.com/v1/chat/completions           â”‚
â”‚  {                                                          â”‚
â”‚    "model": "gpt-4",                                        â”‚
â”‚    "messages": [                                            â”‚
â”‚      {"role": "user", "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"},    â”‚
â”‚      {  â† ç¬¬ä¸€æ¬¡AIçš„å“åº”                                     â”‚
â”‚        "role": "assistant",                                 â”‚
â”‚        "content": null,                                     â”‚
â”‚        "function_call": {                                   â”‚
â”‚          "name": "get_weather",                             â”‚
â”‚          "arguments": "{\"location\": \"åŒ—äº¬\"}"             â”‚
â”‚        }                                                    â”‚
â”‚      },                                                     â”‚
â”‚      {  â† å‡½æ•°æ‰§è¡Œç»“æœ                                       â”‚
â”‚        "role": "function",                                  â”‚
â”‚        "name": "get_weather",                               â”‚
â”‚        "content": "{\"temp\": 25, \"condition\": \"sunny\"}" â”‚
â”‚      }                                                      â”‚
â”‚    ]                                                        â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: AIç”Ÿæˆæœ€ç»ˆçš„äººæ€§åŒ–å›ç­”                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Response:                                                  â”‚
â”‚  {                                                          â”‚
â”‚    "choices": [{                                            â”‚
â”‚      "message": {                                           â”‚
â”‚        "role": "assistant",                                 â”‚
â”‚        "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œæ™´å¤©ï¼Œæ¸©åº¦25Â°Cã€‚"        â”‚
â”‚      },                                                     â”‚
â”‚      "finish_reason": "stop"  â† æ­£å¸¸ç»“æŸ                     â”‚
â”‚    }]                                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è¦ç‚¹**ï¼š
```
1ï¸âƒ£ AIä¸æ‰§è¡Œå‡½æ•°ï¼Œåªç”Ÿæˆè°ƒç”¨å‚æ•°
2ï¸âƒ£ éœ€è¦2æ¬¡APIè°ƒç”¨æ‰èƒ½å®Œæˆä¸€æ¬¡å¯¹è¯
3ï¸âƒ£ å¼€å‘è€…è´Ÿè´£æ‰§è¡Œå‡½æ•°å’Œç®¡ç†æ¶ˆæ¯å†å²
4ï¸âƒ£ æ¯æ¬¡è°ƒç”¨éƒ½è¦ä¼ é€’functionså®šä¹‰
```


#### 4.1.3 Function Schema è¯¦è§£

**Schema ç»“æ„**ï¼š
```json
{
  "name": "å‡½æ•°åç§°",
  "description": "å‡½æ•°æè¿°ï¼ˆAIç”¨æ¥ç†è§£å‡½æ•°ç”¨é€”ï¼‰",
  "parameters": {
    "type": "object",
    "properties": {
      "å‚æ•°å1": {
        "type": "å‚æ•°ç±»å‹",
        "description": "å‚æ•°æè¿°ï¼ˆå¸®åŠ©AIç†è§£å¦‚ä½•æå–å€¼ï¼‰",
        "enum": ["å¯é€‰å€¼1", "å¯é€‰å€¼2"]  // å¯é€‰
      },
      "å‚æ•°å2": {
        "type": "string",
        "description": "..."
      }
    },
    "required": ["å¿…éœ€å‚æ•°åˆ—è¡¨"]
  }
}
```

**å®é™…ä¾‹å­**ï¼š
```python
{
    "name": "search_restaurants",
    "description": "æœç´¢é™„è¿‘çš„é¤å…ï¼Œå¯ä»¥æ ¹æ®èœç³»ã€ä»·æ ¼ã€è¯„åˆ†ç­‰æ¡ä»¶ç­›é€‰",
    "parameters": {
        "type": "object",
        "properties": {
            "location": {
                "type": "string",
                "description": "æœç´¢ä½ç½®ï¼Œå¦‚ï¼š'åŒ—äº¬å¸‚æœé˜³åŒº'ã€'ä¸Šæµ·æµ¦ä¸œæ–°åŒº'"
            },
            "cuisine": {
                "type": "string",
                "enum": ["ä¸­é¤", "è¥¿é¤", "æ—¥æ–™", "éŸ©é¤", "ä¸œå—äºš"],
                "description": "èœç³»ç±»å‹"
            },
            "price_range": {
                "type": "string",
                "enum": ["ç»æµå®æƒ ", "ä¸­ç­‰æ¶ˆè´¹", "é«˜æ¡£æ¶ˆè´¹"],
                "description": "ä»·æ ¼åŒºé—´"
            },
            "min_rating": {
                "type": "number",
                "description": "æœ€ä½è¯„åˆ†ï¼ŒèŒƒå›´1-5",
                "minimum": 1,
                "maximum": 5
            },
            "max_distance": {
                "type": "number",
                "description": "æœ€å¤§è·ç¦»ï¼ˆå…¬é‡Œï¼‰"
            }
        },
        "required": ["location"]  # åªæœ‰locationæ˜¯å¿…éœ€çš„
    }
}
```

**AIå¦‚ä½•ä½¿ç”¨Schema**ï¼š
```
ç”¨æˆ·ï¼š"æˆ‘æƒ³åœ¨æœé˜³åŒºæ‰¾å®¶å¥½åƒä¸è´µçš„å·èœé¦†"

AIæ¨ç†è¿‡ç¨‹ï¼š
1. è¯†åˆ«æ„å›¾ï¼šæœç´¢é¤å…
2. æå–å‚æ•°ï¼š
   - location: "æœé˜³åŒº" ï¼ˆå¿…éœ€å‚æ•°ï¼‰
   - cuisine: "ä¸­é¤" ï¼ˆå·èœå±äºä¸­é¤ï¼‰
   - price_range: "ç»æµå®æƒ " ï¼ˆ"ä¸è´µ"æ˜ å°„åˆ°æ­¤ï¼‰
3. ç”Ÿæˆè°ƒç”¨ï¼š
{
  "name": "search_restaurants",
  "arguments": {
    "location": "æœé˜³åŒº",
    "cuisine": "ä¸­é¤",
    "price_range": "ç»æµå®æƒ "
  }
}
```

**Schema è®¾è®¡æœ€ä½³å®è·µ**ï¼š

```python
# âŒ å·®çš„è®¾è®¡
{
    "name": "func",  # åç§°ä¸æ¸…æ™°
    "description": "do something",  # æè¿°æ¨¡ç³Š
    "parameters": {
        "type": "object",
        "properties": {
            "param1": {  # å‚æ•°åä¸æ˜ç¡®
                "type": "string"  # ç¼ºå°‘description
            }
        }
    }
}

# âœ… å¥½çš„è®¾è®¡
{
    "name": "send_email",  # æ¸…æ™°çš„åŠ¨è¯+åè¯
    "description": "å‘é€ç”µå­é‚®ä»¶ç»™æŒ‡å®šæ”¶ä»¶äººï¼Œæ”¯æŒHTMLæ ¼å¼å’Œé™„ä»¶",
    "parameters": {
        "type": "object",
        "properties": {
            "to": {
                "type": "string",
                "description": "æ”¶ä»¶äººé‚®ç®±åœ°å€ï¼Œå¦‚ï¼šuser@example.com"
            },
            "subject": {
                "type": "string",
                "description": "é‚®ä»¶ä¸»é¢˜"
            },
            "body": {
                "type": "string",
                "description": "é‚®ä»¶æ­£æ–‡å†…å®¹ï¼Œæ”¯æŒHTMLæ ¼å¼"
            },
            "cc": {
                "type": "array",
                "items": {"type": "string"},
                "description": "æŠ„é€äººé‚®ç®±åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰"
            },
            "attachments": {
                "type": "array",
                "items": {"type": "string"},
                "description": "é™„ä»¶æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰"
            }
        },
        "required": ["to", "subject", "body"]
    }
}
```

**Schema è®¾è®¡åŸåˆ™**ï¼š
```
1ï¸âƒ£ æè¿°è¦è¯¦ç»†
   - å¸®åŠ©AIå‡†ç¡®ç†è§£å‡½æ•°ç”¨é€”
   - åŒ…å«ä½¿ç”¨åœºæ™¯å’Œé™åˆ¶

2ï¸âƒ£ å‚æ•°æè¿°è¦æ¸…æ™°
   - è¯´æ˜å‚æ•°çš„æ ¼å¼å’Œç¤ºä¾‹
   - ä½¿ç”¨enumé™åˆ¶å¯é€‰å€¼
   - ä½¿ç”¨minimum/maximumé™åˆ¶æ•°å€¼èŒƒå›´

3ï¸âƒ£ å‘½åè¦è¯­ä¹‰åŒ–
   - å‡½æ•°åï¼šåŠ¨è¯+åè¯ï¼ˆget_weather, send_emailï¼‰
   - å‚æ•°åï¼šæ¸…æ™°çš„ä¸šåŠ¡å«ä¹‰ï¼ˆlocation, not locï¼‰

4ï¸âƒ£ åˆç†ä½¿ç”¨required
   - åªæ ‡è®°çœŸæ­£å¿…éœ€çš„å‚æ•°
   - å¯é€‰å‚æ•°æä¾›é»˜è®¤å€¼é€»è¾‘
```


#### 4.1.4 function_call å‚æ•°æ§åˆ¶

**function_call å‚æ•°ä½œç”¨**ï¼š
```
æ§åˆ¶AIæ˜¯å¦ä»¥åŠå¦‚ä½•è°ƒç”¨å‡½æ•°
```

**å¯é€‰å€¼**ï¼š
```json
{
  "function_call": "auto"      // è®©AIè‡ªåŠ¨å†³å®šï¼ˆæ¨èï¼‰
  "function_call": "none"      // ç¦æ­¢è°ƒç”¨å‡½æ•°
  "function_call": {"name": "specific_function"}  // å¼ºåˆ¶è°ƒç”¨ç‰¹å®šå‡½æ•°
}
```

**è¯¦ç»†è¯´æ˜**ï¼š

```python
# 1ï¸âƒ£ autoï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}],
    functions=[get_weather_function],
    function_call="auto"  # AIè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å‡½æ•°
)

# AIè¡Œä¸ºï¼š
# - å¦‚æœç”¨æˆ·é—®å¤©æ°” â†’ è°ƒç”¨get_weather
# - å¦‚æœç”¨æˆ·é—®"ä½ å¥½" â†’ ç›´æ¥å›ç­”ï¼Œä¸è°ƒç”¨å‡½æ•°
# - AIä¼šæ™ºèƒ½åˆ¤æ–­


# 2ï¸âƒ£ noneï¼ˆç¦ç”¨å‡½æ•°ï¼‰
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}],
    functions=[get_weather_function],
    function_call="none"  # å³ä½¿æœ‰å‡½æ•°ï¼Œä¹Ÿä¸è°ƒç”¨
)

# AIè¡Œä¸ºï¼š
# - ä¸ä¼šè°ƒç”¨ä»»ä½•å‡½æ•°
# - ç›´æ¥ç”¨æ–‡æœ¬å›ç­”ï¼š"æŠ±æ­‰ï¼Œæˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”..."
# - é€‚ç”¨åœºæ™¯ï¼šä¸´æ—¶ç¦ç”¨å‡½æ•°ï¼Œä½†ä¿ç•™å‡½æ•°å®šä¹‰


# 3ï¸âƒ£ {"name": "å‡½æ•°å"}ï¼ˆå¼ºåˆ¶è°ƒç”¨ï¼‰
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "ä½ å¥½"}],  # ä¸å¤©æ°”æ— å…³
    functions=[get_weather_function],
    function_call={"name": "get_weather"}  # å¼ºåˆ¶è°ƒç”¨
)

# AIè¡Œä¸ºï¼š
# - æ— è®ºç”¨æˆ·è¯´ä»€ä¹ˆï¼Œéƒ½ä¼šè°ƒç”¨get_weather
# - AIä¼šå°½åŠ›ä»ä¸Šä¸‹æ–‡æå–å‚æ•°
# - å¦‚æœæ²¡æœ‰è¶³å¤Ÿä¿¡æ¯ï¼Œå¯èƒ½ç”Ÿæˆé»˜è®¤å€¼æˆ–æŠ¥é”™
# - é€‚ç”¨åœºæ™¯ï¼šç¡®å®šè¦è°ƒç”¨çš„å‡½æ•°ï¼Œåªéœ€è¦AIæå–å‚æ•°
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

```python
# åœºæ™¯1ï¼šæ™ºèƒ½å®¢æœï¼ˆautoï¼‰
functions = [
    order_query_function,
    refund_function,
    complaint_function,
    chitchat_function
]

response = openai.ChatCompletion.create(
    messages=[{"role": "user", "content": "æˆ‘è¦é€€è´§"}],
    functions=functions,
    function_call="auto"  # è®©AIè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å‡½æ•°
)
# AIä¼šé€‰æ‹©è°ƒç”¨refund_function


# åœºæ™¯2ï¼šè¡¨å•å¡«å†™åŠ©æ‰‹ï¼ˆå¼ºåˆ¶è°ƒç”¨ï¼‰
form_function = {
    "name": "fill_form",
    "parameters": {
        "properties": {
            "name": {"type": "string"},
            "email": {"type": "string"},
            "phone": {"type": "string"},
            "address": {"type": "string"}
        }
    }
}

response = openai.ChatCompletion.create(
    messages=[
        {"role": "user", "content": "æˆ‘å«å¼ ä¸‰ï¼Œé‚®ç®±æ˜¯zhang@example.comï¼Œç”µè¯13800138000"}
    ],
    functions=[form_function],
    function_call={"name": "fill_form"}  # å¼ºåˆ¶è°ƒç”¨ï¼Œæå–æ‰€æœ‰ä¿¡æ¯
)
# AIä¼šå°½åŠ›æå–nameã€emailã€phoneï¼Œaddresså¯èƒ½ä¸ºç©º


# åœºæ™¯3ï¼šçº¯èŠå¤©æ¨¡å¼ï¼ˆnoneï¼‰
response = openai.ChatCompletion.create(
    messages=[{"role": "user", "content": "è®²ä¸ªç¬‘è¯"}],
    functions=some_functions,
    function_call="none"  # è¿™æ¬¡åªæ˜¯èŠå¤©ï¼Œä¸éœ€è¦è°ƒç”¨å‡½æ•°
)
```

**é€‰æ‹©å»ºè®®**ï¼š
```
âœ… å¤§å¤šæ•°æƒ…å†µï¼šä½¿ç”¨ "auto"
   - AIæ™ºèƒ½åˆ¤æ–­
   - ç”¨æˆ·ä½“éªŒæœ€å¥½

âœ… ä¿¡æ¯æå–åœºæ™¯ï¼šä½¿ç”¨ {"name": "specific"}
   - è¡¨å•å¡«å†™
   - æ•°æ®æå–
   - ç»“æ„åŒ–è¾“å‡º

âœ… ä¸´æ—¶ç¦ç”¨ï¼šä½¿ç”¨ "none"
   - çº¯èŠå¤©
   - è°ƒè¯•æ—¶ç¦ç”¨å‡½æ•°
```


### 3.3 å®ç°å¯¹æ¯”æ€»ç»“è¡¨

| ç»´åº¦ | Function Calling | MCP |
|------|-----------------|-----|
| **å¼€å‘å·¥ä½œé‡** | æ¯ä¸ªåº”ç”¨éƒ½è¦å†™è°ƒç”¨é€»è¾‘ | åªå¼€å‘Serverï¼Œå¤šåº”ç”¨å¤ç”¨ |
| **ä»£ç å¤æ‚åº¦** | éœ€è¦æ‰‹åŠ¨ç®¡ç†è°ƒç”¨æµç¨‹ | Serverå†…éƒ¨è‡ªåŠ¨å¤„ç† |
| **é”™è¯¯å¤„ç†** | å¼€å‘è€…æ‰‹åŠ¨try-catch | Serverç»Ÿä¸€å¤„ç† |
| **çŠ¶æ€ç®¡ç†** | å¼€å‘è€…æ‰‹åŠ¨ç®¡ç† | Serverè‡ªåŠ¨ç®¡ç† |
| **å¹¶å‘æ§åˆ¶** | å¼€å‘è€…å¤„ç† | Serverå†…éƒ¨å¤„ç† |
| **é…ç½®æ–¹å¼** | ä»£ç ä¸­ç¡¬ç¼–ç  | é…ç½®æ–‡ä»¶å£°æ˜ |
| **çƒ­æ›´æ–°** | éœ€è¦é‡å¯åº”ç”¨ | Serverå¯ç‹¬ç«‹æ›´æ–° |
| **å¯æµ‹è¯•æ€§** | éš¾ä»¥å•ç‹¬æµ‹è¯• | Serverå¯ç‹¬ç«‹æµ‹è¯• |
| **å¯ç»´æŠ¤æ€§** | åˆ†æ•£åœ¨å„åº”ç”¨ä¸­ | é›†ä¸­åœ¨Serverä¸­ |

---

## 4. ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### 4.1 Function Callingé€‚ç”¨åœºæ™¯

#### âœ… é€‚åˆåœºæ™¯

**1. ç®€å•çš„APIè°ƒç”¨åœºæ™¯**
```python
# åœºæ™¯ï¼šèŠå¤©æœºå™¨äººéœ€è¦è°ƒç”¨å¤©æ°”API
# ç‰¹ç‚¹ï¼šé€»è¾‘ç®€å•ï¼Œä¸éœ€è¦çŠ¶æ€ç®¡ç†

functions = [
    {
        "name": "get_weather",
        "description": "è·å–å¤©æ°”",
        "parameters": {...}
    }
]

# é€‚åˆåŸå› ï¼š
# âœ… å‡½æ•°è°ƒç”¨é€»è¾‘ç®€å•
# âœ… ä¸éœ€è¦æŒä¹…åŒ–çŠ¶æ€
# âœ… å¿«é€Ÿå®ç°
```

**2. ä¸€æ¬¡æ€§è„šæœ¬æˆ–åŸå‹å¼€å‘**
```python
# åœºæ™¯ï¼šå¿«é€ŸéªŒè¯AIèƒ½å¦æ­£ç¡®è°ƒç”¨å‡½æ•°
# ç‰¹ç‚¹ï¼šä¸´æ—¶æ€§ï¼Œä¸éœ€è¦é•¿æœŸç»´æŠ¤

# é€‚åˆåŸå› ï¼š
# âœ… å¿«é€Ÿä¸Šæ‰‹
# âœ… ä¸éœ€è¦é¢å¤–çš„Serveré…ç½®
# âœ… ä»£ç é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶
```

**3. åº”ç”¨ä¸“å±çš„ä¸šåŠ¡é€»è¾‘**
```python
# åœºæ™¯ï¼šç”µå•†ç³»ç»Ÿçš„è®¢å•å¤„ç†
# ç‰¹ç‚¹ï¼šé«˜åº¦å®šåˆ¶åŒ–ï¼Œä¸éœ€è¦è·¨åº”ç”¨å¤ç”¨

functions = [
    {"name": "create_order", ...},
    {"name": "cancel_order", ...},
    {"name": "refund_order", ...}
]

# é€‚åˆåŸå› ï¼š
# âœ… ä¸šåŠ¡é€»è¾‘ä¸“å±äºå½“å‰åº”ç”¨
# âœ… ä¸éœ€è¦è¢«å…¶ä»–åº”ç”¨å¤ç”¨
# âœ… ä¸ä¸šåŠ¡ä»£ç ç´§å¯†è€¦åˆ
```

**4. æ•™å­¦å’Œå­¦ä¹ ç›®çš„**
```python
# åœºæ™¯ï¼šå­¦ä¹ AI Function Callingæœºåˆ¶
# ç‰¹ç‚¹ï¼šç†è§£åŸç†

# é€‚åˆåŸå› ï¼š
# âœ… ç›´è§‚å±•ç¤ºè°ƒç”¨æµç¨‹
# âœ… å®Œå…¨æ§åˆ¶æ¯ä¸ªæ­¥éª¤
# âœ… ä¾¿äºç†è§£AIå†³ç­–è¿‡ç¨‹
```

#### âŒ ä¸é€‚åˆåœºæ™¯

**1. éœ€è¦è·¨åº”ç”¨å¤ç”¨çš„èƒ½åŠ›**
```
é—®é¢˜ï¼šæ¯ä¸ªåº”ç”¨éƒ½è¦é‡å¤å®ç°ç›¸åŒçš„åŠŸèƒ½
ä¾‹å¦‚ï¼šæ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€æ•°æ®åº“æŸ¥è¯¢ã€Gitæ“ä½œ

Function Callingï¼š
- App Aå®ç°æ–‡ä»¶è¯»å–
- App Bä¹Ÿè¦å®ç°æ–‡ä»¶è¯»å–
- App Cè¿˜è¦å®ç°æ–‡ä»¶è¯»å–
âŒ é‡å¤å¼€å‘ï¼Œä»£ç å†—ä½™

MCPï¼š
- ä¸€ä¸ªFilesystem Server
- æ‰€æœ‰åº”ç”¨å…±äº«
âœ… ä¸€æ¬¡å¼€å‘ï¼Œå¤šå¤„å¤ç”¨
```

**2. éœ€è¦æŒä¹…åŒ–çŠ¶æ€çš„åœºæ™¯**
```python
# é—®é¢˜ï¼šFunction Callingæ˜¯æ— çŠ¶æ€çš„

# åœºæ™¯ï¼šæ•°æ®åº“è¿æ¥æ± 
functions = [
    {"name": "query_database", ...}
]

# æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦ï¼š
âŒ é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥
âŒ é‡æ–°åˆå§‹åŒ–èµ„æº
âŒ æ€§èƒ½ä½ä¸‹

# MCPæ–¹æ¡ˆï¼š
# ServeræŒä¹…è¿è¡Œï¼Œç»´æŠ¤è¿æ¥æ± 
âœ… è¿æ¥å¤ç”¨
âœ… æ€§èƒ½ä¼˜åŒ–
```

**3. å¤æ‚çš„èµ„æºç®¡ç†**
```python
# åœºæ™¯ï¼šç®¡ç†å¤šä¸ªå¤–éƒ¨ç³»ç»Ÿè¿æ¥
# - Redisè¿æ¥
# - MySQLè¿æ¥
# - Elasticsearchè¿æ¥

# Function Callingé—®é¢˜ï¼š
âŒ æ¯æ¬¡è°ƒç”¨éƒ½è¦ä¼ é€’è¿æ¥ä¿¡æ¯
âŒ éš¾ä»¥ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸ
âŒ èµ„æºæ³„æ¼é£é™©

# MCPä¼˜åŠ¿ï¼š
âœ… Serverç®¡ç†æ‰€æœ‰è¿æ¥
âœ… ç»Ÿä¸€çš„èµ„æºç®¡ç†
âœ… è‡ªåŠ¨æ¸…ç†èµ„æº
```

**4. éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡**
```python
# åœºæ™¯ï¼šå¤§æ–‡ä»¶å¤„ç†ã€æ‰¹é‡æ“ä½œ

# Function Callingé—®é¢˜ï¼š
âŒ HTTPè¶…æ—¶é™åˆ¶
âŒ æ— æ³•è¿½è¸ªè¿›åº¦
âŒ å¤±è´¥åæ— æ³•æ¢å¤

# MCPä¼˜åŠ¿ï¼š
âœ… Serverå¼‚æ­¥å¤„ç†
âœ… å¯ä»¥è¿”å›ä»»åŠ¡ID
âœ… æ”¯æŒè¿›åº¦æŸ¥è¯¢
```


### 4.2 MCPé€‚ç”¨åœºæ™¯

#### âœ… é€‚åˆåœºæ™¯

**1. é€šç”¨èƒ½åŠ›æœåŠ¡**
```typescript
// åœºæ™¯ï¼šæ–‡ä»¶ç³»ç»Ÿè®¿é—®
// ç‰¹ç‚¹ï¼šæ‰€æœ‰AIåº”ç”¨éƒ½å¯èƒ½éœ€è¦

MCP Filesystem Server:
- Cursorä½¿ç”¨ï¼šä»£ç ç”Ÿæˆæ—¶è¯»å†™æ–‡ä»¶
- Claude Desktopä½¿ç”¨ï¼šæ–‡æ¡£å¤„ç†
- è‡ªå®šä¹‰Appä½¿ç”¨ï¼šæ•°æ®åˆ†æ
- VS Codeä½¿ç”¨ï¼šä»£ç å®¡æŸ¥

ä¼˜åŠ¿ï¼š
âœ… ä¸€æ¬¡å¼€å‘ï¼Œæ— é™å¤ç”¨
âœ… ç»Ÿä¸€çš„API
âœ… é›†ä¸­ç»´æŠ¤
```

**2. éœ€è¦æŒä¹…åŒ–çŠ¶æ€**
```typescript
// åœºæ™¯ï¼šæ•°æ®åº“è¿æ¥ç®¡ç†

class DatabaseMCPServer {
  private connectionPool: Pool;
  
  constructor() {
    // Serverå¯åŠ¨æ—¶åˆå§‹åŒ–è¿æ¥æ± 
    this.connectionPool = createPool({...});
  }
  
  async handleQuery(sql: string) {
    // å¤ç”¨è¿æ¥æ± 
    const conn = await this.connectionPool.getConnection();
    const result = await conn.query(sql);
    conn.release();
    return result;
  }
}

ä¼˜åŠ¿ï¼š
âœ… è¿æ¥æ± å¸¸é©»å†…å­˜
âœ… é«˜æ€§èƒ½
âœ… èµ„æºç®¡ç†æ¸…æ™°
```

**3. å¤æ‚çš„å¤–éƒ¨ç³»ç»Ÿé›†æˆ**
```typescript
// åœºæ™¯ï¼šGitæ“ä½œ

MCP Git Server:
- å…‹éš†ä»“åº“
- æäº¤ä»£ç 
- åˆ›å»ºåˆ†æ”¯
- åˆå¹¶PR
- æŸ¥çœ‹å†å²

ç‰¹ç‚¹ï¼š
âœ… å¤æ‚çš„çŠ¶æ€ç®¡ç†ï¼ˆå·¥ä½œåŒºã€æš‚å­˜åŒºï¼‰
âœ… éœ€è¦ç»´æŠ¤Gité…ç½®
âœ… éœ€è¦è®¤è¯ä¿¡æ¯
âœ… é€‚åˆå°è£…æˆç‹¬ç«‹Server
```

**4. ä¼ä¸šçº§é›†æˆ**
```typescript
// åœºæ™¯ï¼šä¼ä¸šå†…éƒ¨ç³»ç»Ÿé›†æˆ

MCP Enterprise Server:
- è¿æ¥ä¼ä¸šæ•°æ®åº“
- è®¿é—®å†…éƒ¨API
- å¯¹æ¥OAç³»ç»Ÿ
- é›†æˆç›‘æ§ç³»ç»Ÿ

ä¼˜åŠ¿ï¼š
âœ… ç»Ÿä¸€çš„è®¤è¯å’Œæˆæƒ
âœ… å®‰å…¨æ€§å¯æ§
âœ… é›†ä¸­çš„æ—¥å¿—å’Œå®¡è®¡
âœ… æ˜“äºæƒé™ç®¡ç†
```

**5. AI Agentå¼€å‘**
```typescript
// åœºæ™¯ï¼šè‡ªä¸»AI Agent

Agentæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Decision â”‚
â”‚   Engine    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
   â”‚  MCP  â”‚
   â”‚ Clientâ”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚           â”‚          â”‚         â”‚
â”Œâ”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚Filesâ”‚   â”‚Searchâ”‚   â”‚Databaseâ”‚ â”‚ API  â”‚
â”‚Serverâ”‚   â”‚Serverâ”‚   â”‚Server  â”‚ â”‚Serverâ”‚
â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
âœ… Agentå¯ç»„åˆå¤šä¸ªServerèƒ½åŠ›
âœ… æ¨¡å—åŒ–è®¾è®¡
âœ… æ˜“äºæ‰©å±•æ–°èƒ½åŠ›
```

#### âŒ ä¸é€‚åˆåœºæ™¯

**1. æç®€å•çš„ä¸€æ¬¡æ€§ä»»åŠ¡**
```
åœºæ™¯ï¼šå†™ä¸ªè„šæœ¬è°ƒç”¨ä¸€æ¬¡APIå°±å¤Ÿäº†

é—®é¢˜ï¼š
âŒ å¼€å‘MCP Serverè¿‡äºé‡é‡çº§
âŒ ä¸éœ€è¦æŒä¹…è¿è¡Œ
âŒ ä¸éœ€è¦å¤ç”¨

å»ºè®®ï¼šç›´æ¥ç”¨Function Calling
```

**2. é«˜åº¦å®šåˆ¶åŒ–çš„ä¸šåŠ¡é€»è¾‘**
```
åœºæ™¯ï¼šç”µå•†è®¢å•å¤„ç†æµç¨‹
- æ¶‰åŠå…·ä½“ä¸šåŠ¡è§„åˆ™
- ä¸å…¶ä»–æ¨¡å—ç´§å¯†è€¦åˆ
- ä¸éœ€è¦è¢«å…¶ä»–åº”ç”¨ä½¿ç”¨

é—®é¢˜ï¼š
âŒ å°è£…æˆMCP Serveråè€Œå¢åŠ å¤æ‚åº¦
âŒ ä¸éœ€è¦è·¨åº”ç”¨å¤ç”¨

å»ºè®®ï¼šåœ¨åº”ç”¨å†…éƒ¨å®ç°
```

**3. å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯**
```
åœºæ™¯ï¼šé«˜é¢‘äº¤æ˜“ç³»ç»Ÿ

é—®é¢˜ï¼š
âŒ MCPåè®®æœ‰é¢å¤–çš„é€šä¿¡å¼€é”€
âŒ JSONåºåˆ—åŒ–/ååºåˆ—åŒ–è€—æ—¶

å»ºè®®ï¼šç›´æ¥è°ƒç”¨æœ¬åœ°å‡½æ•°
```

### 4.3 åœºæ™¯é€‰æ‹©å†³ç­–æ ‘

```
å¼€å§‹
  â†“
æ˜¯å¦éœ€è¦è·¨åº”ç”¨å¤ç”¨ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ æ˜¯å¦éœ€è¦æŒä¹…åŒ–çŠ¶æ€ï¼Ÿ
  â”‚       â”œâ”€ æ˜¯ â†’ âœ… ä½¿ç”¨MCP
  â”‚       â””â”€ å¦ â†’ åŠŸèƒ½æ˜¯å¦é€šç”¨ï¼Ÿ
  â”‚               â”œâ”€ æ˜¯ â†’ âœ… ä½¿ç”¨MCPï¼ˆå»ºç«‹ç”Ÿæ€ï¼‰
  â”‚               â””â”€ å¦ â†’ âš–ï¸ Function Callingæˆ–MCPéƒ½å¯
  â”‚
  â””â”€ å¦ â†’ æ˜¯å¦éœ€è¦ç‹¬ç«‹ç»´æŠ¤ï¼Ÿ
          â”œâ”€ æ˜¯ â†’ âœ… ä½¿ç”¨MCP
          â””â”€ å¦ â†’ å¤æ‚åº¦å¦‚ä½•ï¼Ÿ
                  â”œâ”€ ç®€å• â†’ âœ… Function Calling
                  â””â”€ å¤æ‚ â†’ âœ… ä½¿ç”¨MCPï¼ˆä¾¿äºæµ‹è¯•å’Œç»´æŠ¤ï¼‰
```

### 4.4 å®é™…åœºæ™¯ä¸¾ä¾‹

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| èŠå¤©æœºå™¨äººè°ƒç”¨å¤©æ°”API | Function Calling | ç®€å•ã€ä¸€æ¬¡æ€§ã€ä¸éœ€è¦å¤ç”¨ |
| AIä»£ç ç¼–è¾‘å™¨çš„æ–‡ä»¶æ“ä½œ | MCP | é€šç”¨èƒ½åŠ›ã€éœ€è¦çŠ¶æ€ã€è·¨åº”ç”¨å¤ç”¨ |
| ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“æŸ¥è¯¢ | MCP | éœ€è¦è®¤è¯ã€æŒä¹…è¿æ¥ã€å¤šåº”ç”¨ä½¿ç”¨ |
| å¿«é€ŸåŸå‹éªŒè¯ | Function Calling | å¿«é€Ÿå¼€å‘ã€ä¸´æ—¶æ€§ |
| AI Agentç³»ç»Ÿ | MCP | éœ€è¦ç»„åˆå¤šç§èƒ½åŠ›ã€æ¨¡å—åŒ– |
| è®¢å•ç³»ç»Ÿä¸šåŠ¡é€»è¾‘ | Function Calling | ä¸šåŠ¡ä¸“å±ã€ä¸éœ€è¦å¤ç”¨ |
| æ•°æ®åº“æŸ¥è¯¢å·¥å…· | MCP | è¿æ¥æ± ç®¡ç†ã€è·¨åº”ç”¨å¤ç”¨ |
| ä¸´æ—¶æ•°æ®å¤„ç†è„šæœ¬ | Function Calling | ä¸€æ¬¡æ€§ä»»åŠ¡ã€ä¸éœ€è¦æŒä¹…åŒ– |

---

## 5. ä¼˜åŠ£åŠ¿åˆ†æ

### 5.1 Function Callingä¼˜åŠ£åŠ¿

#### âœ… ä¼˜åŠ¿

**1. ç®€å•ç›´æ¥**
```python
# ä»£ç ç®€å•ï¼Œå®¹æ˜“ç†è§£
functions = [{"name": "get_data", ...}]
response = openai.ChatCompletion.create(
    messages=[...],
    functions=functions
)

ä¼˜åŠ¿ï¼š
âœ… å­¦ä¹ æ›²çº¿å¹³ç¼“
âœ… ä»£ç é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶
âœ… è°ƒè¯•å®¹æ˜“ï¼ˆæ‰€æœ‰é€»è¾‘åœ¨ä¸€å¤„ï¼‰
```

**2. çµæ´»æ€§é«˜**
```python
# å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€å†³å®šä¼ é€’å“ªäº›å‡½æ•°
if user.is_admin:
    functions = admin_functions
else:
    functions = normal_functions

ä¼˜åŠ¿ï¼š
âœ… å®Œå…¨æ§åˆ¶å‡½æ•°å®šä¹‰
âœ… å¯åŠ¨æ€è°ƒæ•´
âœ… æ˜“äºA/Bæµ‹è¯•
```

**3. æ— éœ€é¢å¤–é…ç½®**
```python
# ä¸éœ€è¦å®‰è£…MCP Server
# ä¸éœ€è¦é…ç½®æ–‡ä»¶
# åªéœ€è¦è°ƒç”¨API

ä¼˜åŠ¿ï¼š
âœ… é›¶é…ç½®
âœ… å¿«é€Ÿä¸Šæ‰‹
âœ… é€‚åˆäº‘ç«¯éƒ¨ç½²
```

**4. é€‚åˆå¿«é€ŸåŸå‹**
```python
# 5åˆ†é’Ÿå°±èƒ½éªŒè¯æƒ³æ³•
def my_function():
    return "result"

functions = [{"name": "my_function", ...}]
response = call_ai(functions=functions)

ä¼˜åŠ¿ï¼š
âœ… å¿«é€Ÿè¿­ä»£
âœ… å³æ—¶åé¦ˆ
âœ… é€‚åˆå­¦ä¹ 
```

#### âŒ åŠ£åŠ¿

**1. é‡å¤å¼€å‘**
```python
# App A
functions = [{"name": "read_file", ...}]

# App B
functions = [{"name": "read_file", ...}]  # é‡å¤ï¼

# App C
functions = [{"name": "read_file", ...}]  # é‡å¤ï¼

é—®é¢˜ï¼š
âŒ ä»£ç é‡å¤
âŒ ç»´æŠ¤æˆæœ¬é«˜
âŒ å®¹æ˜“ä¸ä¸€è‡´
```

**2. æ— çŠ¶æ€é™åˆ¶**
```python
# æ¯æ¬¡è°ƒç”¨éƒ½è¦é‡æ–°åˆå§‹åŒ–
db = connect_database()  # é‡å¤è¿æ¥
result = query_data(db)
db.close()

ä¸‹æ¬¡è°ƒç”¨ï¼š
db = connect_database()  # åˆè¦é‡æ–°è¿æ¥
result = query_data(db)
db.close()

é—®é¢˜ï¼š
âŒ æ€§èƒ½ä½ä¸‹
âŒ èµ„æºæµªè´¹
âŒ è¿æ¥æ± éš¾ä»¥å®ç°
```

**3. æ‰‹åŠ¨ç®¡ç†å¤æ‚**
```python
# éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š
1. è§£æfunction_call
2. æ‰§è¡Œå‡½æ•°
3. å¤„ç†é”™è¯¯
4. ç®¡ç†å¯¹è¯å†å²
5. é‡æ–°è°ƒç”¨API

é—®é¢˜ï¼š
âŒ ä»£ç å†—é•¿
âŒ å®¹æ˜“å‡ºé”™
âŒ éš¾ä»¥ç»´æŠ¤
```

**4. ç¼ºä¹æ ‡å‡†åŒ–**
```python
# OpenAIçš„æ ¼å¼
{"function_call": {"name": "...", "arguments": "..."}}

# Claudeçš„æ ¼å¼
{"tool_use": {"name": "...", "input": {...}}}

# Googleçš„æ ¼å¼
{"function_call": {"name": "...", "args": {...}}}

é—®é¢˜ï¼š
âŒ æ ¼å¼ä¸ç»Ÿä¸€
âŒ åˆ‡æ¢æˆæœ¬é«˜
âŒ éš¾ä»¥é€šç”¨åŒ–
```


### 3.3 Function Callingå·¥ä½œæœºåˆ¶è¯¦è§£

#### æ ¸å¿ƒå·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Function Calling å®Œæ•´æµç¨‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤1: å¼€å‘è€…å®šä¹‰å‡½æ•°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ functions = [{                          â”‚
â”‚   "name": "get_weather",                â”‚
â”‚   "description": "è·å–å¤©æ°”",            â”‚
â”‚   "parameters": {...}                   â”‚
â”‚ }]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
æ­¥éª¤2: è°ƒç”¨AI APIï¼ˆå¸¦å‡½æ•°å®šä¹‰ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ openai.ChatCompletion.create(           â”‚
â”‚   messages=[...],                       â”‚
â”‚   functions=functions  â† æ¯æ¬¡éƒ½è¦ä¼      â”‚
â”‚ )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
æ­¥éª¤3: AIåˆ†æå¹¶è¿”å›function_call
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                       â”‚
â”‚   "function_call": {                    â”‚
â”‚     "name": "get_weather",              â”‚
â”‚     "arguments": '{"location": "åŒ—äº¬"}' â”‚
â”‚   }                                     â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
æ­¥éª¤4: å¼€å‘è€…æ‰‹åŠ¨è§£æå’Œæ‰§è¡Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ func_name = resp["function_call"]["name"]â”‚
â”‚ args = json.loads(resp["..."]["arguments"])â”‚
â”‚ result = get_weather(**args) â† æ‰‹åŠ¨æ‰§è¡Œ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
æ­¥éª¤5: å°†ç»“æœè¿”å›ç»™AIï¼ˆç¬¬äºŒæ¬¡è°ƒç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ openai.ChatCompletion.create(           â”‚
â”‚   messages=[                            â”‚
â”‚     åŸå§‹æ¶ˆæ¯,                           â”‚
â”‚     AIçš„function_call,                  â”‚
â”‚     {"role": "function",                â”‚
â”‚      "content": str(result)}           â”‚
â”‚   ]                                     â”‚
â”‚ )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
æ­¥éª¤6: AIç”Ÿæˆæœ€ç»ˆå›ç­”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œ25Â°C"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯ç»†èŠ‚

##### 1. å‡½æ•°å®šä¹‰æ ¼å¼ï¼ˆJSON Schemaï¼‰

```python
# OpenAIæ ¼å¼
{
    "name": "get_current_weather",
    "description": "è·å–æŒ‡å®šä½ç½®çš„å½“å‰å¤©æ°”ã€‚è°ƒç”¨æ—¶éœ€è¦æä¾›ä½ç½®ä¿¡æ¯ã€‚",
    "parameters": {
        "type": "object",
        "properties": {
            "location": {
                "type": "string",
                "description": "åŸå¸‚åç§°ï¼Œä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€æ·±åœ³"
            },
            "unit": {
                "type": "string",
                "enum": ["celsius", "fahrenheit"],
                "description": "æ¸©åº¦å•ä½ï¼Œé»˜è®¤ä¸ºæ‘„æ°åº¦"
            }
        },
        "required": ["location"]  # å¿…å¡«å‚æ•°
    }
}

# Claudeæ ¼å¼ï¼ˆtoolsï¼‰
{
    "name": "get_weather",
    "description": "è·å–å¤©æ°”ä¿¡æ¯",
    "input_schema": {  # â† æ³¨æ„æ˜¯input_schemaï¼Œä¸æ˜¯parameters
        "type": "object",
        "properties": {
            "location": {"type": "string"},
            "unit": {"type": "string", "enum": ["celsius", "fahrenheit"]}
        },
        "required": ["location"]
    }
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… `description`ï¼šAIç”¨æ¥åˆ¤æ–­ä½•æ—¶è°ƒç”¨æ­¤å‡½æ•°
- âœ… `parameters`ï¼šå®šä¹‰å‡½æ•°å‚æ•°çš„JSON Schema
- âœ… `required`ï¼šæŒ‡å®šå¿…å¡«å‚æ•°
- âš ï¸ ä¸åŒå‚å•†æ ¼å¼ç•¥æœ‰å·®å¼‚ï¼ˆOpenAIç”¨`parameters`ï¼ŒClaudeç”¨`input_schema`ï¼‰

##### 2. AIçš„å†³ç­–è¿‡ç¨‹

```
ç”¨æˆ·è¾“å…¥ï¼š"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AIå†…éƒ¨æ¨ç†è¿‡ç¨‹ï¼ˆé»‘ç›’ï¼‰            â”‚
â”‚                                     â”‚
â”‚ 1. ç†è§£ç”¨æˆ·æ„å›¾ï¼šæŸ¥è¯¢å¤©æ°”           â”‚
â”‚ 2. æ‰«æå¯ç”¨å‡½æ•°åˆ—è¡¨                 â”‚
â”‚ 3. åŒ¹é…å‡½æ•°æè¿°ï¼šget_weatheræœ€åˆé€‚  â”‚
â”‚ 4. ä»ç”¨æˆ·è¾“å…¥æå–å‚æ•°ï¼š             â”‚
â”‚    - location = "åŒ—äº¬"              â”‚
â”‚    - unit = æœªæåŠï¼Œä½¿ç”¨é»˜è®¤         â”‚
â”‚ 5. ç”Ÿæˆå‡½æ•°è°ƒç”¨JSON                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
è¾“å‡ºï¼š
{
  "function_call": {
    "name": "get_weather",
    "arguments": '{"location": "åŒ—äº¬"}'
  }
}
```

**AIå¦‚ä½•é€‰æ‹©å‡½æ•°**ï¼š
1. **è¯­ä¹‰åŒ¹é…**ï¼šå¯¹æ¯”ç”¨æˆ·æ„å›¾ä¸å‡½æ•°`description`
2. **å‚æ•°å¯ç”¨æ€§**ï¼šæ£€æŸ¥æ˜¯å¦èƒ½ä»å¯¹è¯ä¸­æå–æ‰€éœ€å‚æ•°
3. **ä¼˜å…ˆçº§**ï¼šå¦‚æœå¤šä¸ªå‡½æ•°åŒ¹é…ï¼Œé€‰æ‹©æœ€ç›¸å…³çš„
4. **ç½®ä¿¡åº¦**ï¼šå¦‚æœä¸ç¡®å®šï¼Œå¯èƒ½ä¼šç›´æ¥å›ç­”è€Œä¸è°ƒç”¨å‡½æ•°

##### 3. å‚æ•°æå–æœºåˆ¶

```python
# æ¡ˆä¾‹1: æ˜ç¡®å‚æ•°
ç”¨æˆ·ï¼š"æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”ï¼Œç”¨åæ°åº¦"
AIæå–ï¼š{"location": "åŒ—äº¬", "unit": "fahrenheit"}

# æ¡ˆä¾‹2: éƒ¨åˆ†å‚æ•°
ç”¨æˆ·ï¼š"åŒ—äº¬å¤©æ°”"
AIæå–ï¼š{"location": "åŒ—äº¬"}  # unitä½¿ç”¨é»˜è®¤å€¼

# æ¡ˆä¾‹3: éœ€è¦æ¨ç†
ç”¨æˆ·ï¼š"æˆ‘åœ¨æœé˜³åŒºï¼Œä»Šå¤©ç©¿ä»€ä¹ˆè¡£æœï¼Ÿ"
AIæ¨ç†ï¼šéœ€è¦å¤©æ°”ä¿¡æ¯ â†’ æœé˜³åŒºåœ¨åŒ—äº¬
AIæå–ï¼š{"location": "åŒ—äº¬"}

# æ¡ˆä¾‹4: å‚æ•°ä¸è¶³
ç”¨æˆ·ï¼š"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AIå¯èƒ½ï¼š
- é€‰é¡¹A: è¦æ±‚ç”¨æˆ·æä¾›ä½ç½®
- é€‰é¡¹B: ä½¿ç”¨ä¸Šä¸‹æ–‡æ¨æ–­ä½ç½®
- é€‰é¡¹C: ä¸è°ƒç”¨å‡½æ•°ï¼Œç›´æ¥å›ç­”æ— æ³•è·å–
```

##### 4. è¿”å›å€¼å¤„ç†

```python
# å‡½æ•°æ‰§è¡Œç»“æœ
weather_data = {
    "location": "åŒ—äº¬",
    "temperature": 25,
    "condition": "æ™´å¤©",
    "humidity": 45
}

# è¿”å›ç»™AIçš„æ ¼å¼
{
    "role": "function",
    "name": "get_weather",
    "content": json.dumps(weather_data)  # âš ï¸ å¿…é¡»æ˜¯å­—ç¬¦ä¸²
}

# AIåŸºäºç»“æœç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”
"åŒ—äº¬ä»Šå¤©æ˜¯æ™´å¤©ï¼Œæ¸©åº¦25Â°Cï¼Œæ¹¿åº¦45%ï¼Œé€‚åˆå¤–å‡ºã€‚"
```

**å…³é”®ç‚¹**ï¼š
- âš ï¸ å‡½æ•°è¿”å›å€¼å¿…é¡»æ˜¯**å­—ç¬¦ä¸²**ï¼ˆé€šå¸¸æ˜¯JSONå­—ç¬¦ä¸²ï¼‰
- âš ï¸ AIä¸èƒ½ç›´æ¥è®¿é—®å‡½æ•°è¿”å›çš„åŸå§‹å¯¹è±¡
- âš ï¸ éœ€è¦å¼€å‘è€…åºåˆ—åŒ–åä¼ é€’

