# Kafkaæ ¸å¿ƒæœºåˆ¶è¯¦è§£

> å¤§å‚æ ‡é…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ—¥å¿—ã€ç›‘æ§ã€å¤§æ•°æ®åœºæ™¯é¦–é€‰

---

## ğŸ“‹ ç›®å½•

- [1. Kafkaç®€ä»‹](#1-kafkaç®€ä»‹)
- [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
- [3. æ¶ˆæ¯å­˜å‚¨](#3-æ¶ˆæ¯å­˜å‚¨)
- [4. ç”Ÿäº§è€…æœºåˆ¶](#4-ç”Ÿäº§è€…æœºåˆ¶)
- [5. æ¶ˆè´¹è€…æœºåˆ¶](#5-æ¶ˆè´¹è€…æœºåˆ¶)
- [6. é«˜å¯ç”¨æœºåˆ¶](#6-é«˜å¯ç”¨æœºåˆ¶)
- [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
- [8. å¯¹æ¯”åˆ†æ](#8-å¯¹æ¯”åˆ†æ)
- [9. å®æˆ˜æ¡ˆä¾‹](#9-å®æˆ˜æ¡ˆä¾‹)

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å°†æŒæ¡ï¼š
- âœ… Kafkaæ¶æ„è®¾è®¡ä¸æ ¸å¿ƒç»„ä»¶
- âœ… æ¶ˆæ¯å­˜å‚¨æœºåˆ¶ï¼ˆé›¶æ‹·è´ã€é¡µç¼“å­˜ï¼‰
- âœ… ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ ¸å¿ƒæœºåˆ¶
- âœ… é«˜å¯ç”¨æœºåˆ¶ï¼ˆISRã€å‰¯æœ¬åŒæ­¥ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜å®æˆ˜
- âœ… Kafka vs RocketMQ vs RabbitMQå¯¹æ¯”
- âœ… ç”Ÿäº§ç¯å¢ƒå®æˆ˜æ¡ˆä¾‹

---

## 1. Kafkaç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯Kafka

**Kafka** æ˜¯ç”±LinkedInå¼€å‘ï¼ŒåæçŒ®ç»™Apacheçš„**åˆ†å¸ƒå¼æµå¤„ç†å¹³å°**å’Œ**æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ**ã€‚

**æ ¸å¿ƒå®šä½**ï¼š
- ğŸ“Š **é«˜ååé‡**ï¼šå•æœºç™¾ä¸‡çº§TPS
- âš¡ **ä½å»¶è¿Ÿ**ï¼šæ¯«ç§’çº§
- ğŸ“ˆ **å¯æ‰©å±•**ï¼šæ°´å¹³æ‰©å±•
- ğŸ”„ **æŒä¹…åŒ–**ï¼šæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜
- ğŸ” **å®æ—¶æµå¤„ç†**ï¼šKafka Streams

### 1.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **é«˜åå** | é›¶æ‹·è´ã€æ‰¹é‡å‘é€ã€é¡ºåºå†™ç›˜ |
| **æŒä¹…åŒ–** | æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¸ä¸¢å¤± |
| **åˆ†å¸ƒå¼** | é›†ç¾¤æ¶æ„ï¼Œæ°´å¹³æ‰©å±• |
| **å¤šè®¢é˜…** | æ”¯æŒå¤šæ¶ˆè´¹è€…ç»„ç‹¬ç«‹æ¶ˆè´¹ |
| **å®¹é”™æ€§** | å‰¯æœ¬æœºåˆ¶ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§» |
| **å®æ—¶æ€§** | æ¯«ç§’çº§å»¶è¿Ÿ |

### 1.3 åº”ç”¨åœºæ™¯

**1. æ—¥å¿—æ”¶é›†**
```
åº”ç”¨æœåŠ¡å™¨ â†’ Kafka â†’ Elasticsearch â†’ Kibana
- å®æ—¶æ—¥å¿—é‡‡é›†
- é›†ä¸­å¼æ—¥å¿—å­˜å‚¨
- æ—¥å¿—åˆ†æä¸æ£€ç´¢
```

**2. ç›‘æ§æŒ‡æ ‡**
```
åº”ç”¨æœåŠ¡å™¨ â†’ Kafka â†’ Prometheus â†’ Grafana
- å®æ—¶æŒ‡æ ‡é‡‡é›†
- æ—¶åºæ•°æ®å­˜å‚¨
- å¯è§†åŒ–ç›‘æ§
```

**3. å®æ—¶æ•°æ®å¤„ç†**
```
æ•°æ®æº â†’ Kafka â†’ Spark/Flink â†’ æ•°æ®ä»“åº“
- å®æ—¶ETL
- æµå¼è®¡ç®—
- å®æ—¶æŠ¥è¡¨
```

**4. å¼‚æ­¥è§£è€¦**
```
è®¢å•æœåŠ¡ â†’ Kafka â†’ [åº“å­˜æœåŠ¡, ç§¯åˆ†æœåŠ¡, é€šçŸ¥æœåŠ¡]
- ç³»ç»Ÿè§£è€¦
- å‰Šå³°å¡«è°·
- æœ€ç»ˆä¸€è‡´æ€§
```

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Kafka Cluster                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Broker â”‚   â”‚ Broker â”‚   â”‚ Broker â”‚               â”‚
â”‚  â”‚   0    â”‚   â”‚   1    â”‚   â”‚   2    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚      â”‚             â”‚             â”‚                   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                    â”‚                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚ ZooKeeper â”‚                           â”‚
â”‚              â”‚  Cluster  â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                           â”‚
       â”‚                           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Producerâ”‚                  â”‚Consumer â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  Group  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶è¯´æ˜**ï¼š

| ç»„ä»¶ | ä½œç”¨ |
|------|------|
| **Broker** | KafkaæœåŠ¡å™¨ï¼Œè´Ÿè´£å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ |
| **Topic** | æ¶ˆæ¯ä¸»é¢˜ï¼Œæ¶ˆæ¯çš„é€»è¾‘åˆ†ç±» |
| **Partition** | åˆ†åŒºï¼ŒTopicçš„ç‰©ç†åˆ†ç‰‡ |
| **Producer** | ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ°Kafka |
| **Consumer** | æ¶ˆè´¹è€…ï¼Œä»Kafkaè¯»å–æ¶ˆæ¯ |
| **Consumer Group** | æ¶ˆè´¹è€…ç»„ï¼Œå®ç°è´Ÿè½½å‡è¡¡ |
| **ZooKeeper** | é›†ç¾¤åè°ƒæœåŠ¡ï¼ˆKafka 3.xå¯ç”¨Kraftæ›¿ä»£ï¼‰ |

### 2.2 Topicä¸Partition

**Topicï¼ˆä¸»é¢˜ï¼‰**ï¼šæ¶ˆæ¯çš„é€»è¾‘åˆ†ç±»

**Partitionï¼ˆåˆ†åŒºï¼‰**ï¼šTopicçš„ç‰©ç†åˆ†ç‰‡

```
Topic: order-events (4ä¸ªåˆ†åŒº)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Partition 0  â”‚ Partition 1  â”‚ Partition 2  â”‚ Partition 3  â”‚
â”‚   Leader     â”‚   Leader     â”‚   Leader     â”‚   Leader     â”‚
â”‚   Broker 0   â”‚   Broker 1   â”‚   Broker 2   â”‚   Broker 0   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Replica 1   â”‚  Replica 1   â”‚  Replica 1   â”‚  Replica 1   â”‚
â”‚   Broker 1   â”‚   Broker 2   â”‚   Broker 0   â”‚   Broker 1   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Replica 2   â”‚  Replica 2   â”‚  Replica 2   â”‚  Replica 2   â”‚
â”‚   Broker 2   â”‚   Broker 0   â”‚   Broker 1   â”‚   Broker 2   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†åŒºçš„ä½œç”¨**ï¼š
- âœ… **å¹¶è¡Œå¤„ç†**ï¼šå¤šä¸ªåˆ†åŒºå¯ä»¥å¹¶è¡Œè¯»å†™
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šåˆ†åŒºåˆ†æ•£åˆ°ä¸åŒBroker
- âœ… **æœ‰åºæ€§**ï¼šå•ä¸ªåˆ†åŒºå†…æ¶ˆæ¯æœ‰åº
- âœ… **æ‰©å±•æ€§**ï¼šå¢åŠ åˆ†åŒºæå‡ååé‡

**åˆ†åŒºæ•°é‡é€‰æ‹©**ï¼š
```
åˆ†åŒºæ•° = max(æœŸæœ›ååé‡ / å•åˆ†åŒºååé‡, æ¶ˆè´¹è€…æ•°é‡)

ç¤ºä¾‹ï¼š
æœŸæœ›ååé‡ï¼š100ä¸‡æ¡/ç§’
å•åˆ†åŒºååé‡ï¼š10ä¸‡æ¡/ç§’
æ¶ˆè´¹è€…æ•°é‡ï¼š20ä¸ª
åˆ†åŒºæ•° = max(100/10, 20) = 20ä¸ªåˆ†åŒº
```

### 2.3 å‰¯æœ¬æœºåˆ¶

**Leader-Followeræ¨¡å‹**ï¼š

```
Partition 0ï¼ˆ3ä¸ªå‰¯æœ¬ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Leader Replica (Broker 0)               â”‚
â”‚ - å¤„ç†æ‰€æœ‰è¯»å†™è¯·æ±‚                       â”‚
â”‚ - ç»´æŠ¤ISRåˆ—è¡¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€åŒæ­¥â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Follower (B1) â”‚  â”‚Follower (B2) â”‚
â”‚- åŒæ­¥Leader  â”‚  â”‚- åŒæ­¥Leader  â”‚
â”‚- ä¸å¤„ç†è¯·æ±‚  â”‚  â”‚- ä¸å¤„ç†è¯·æ±‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‰¯æœ¬ä½œç”¨**ï¼š
- âœ… **é«˜å¯ç”¨**ï¼šLeaderæ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢
- âœ… **æ•°æ®å®‰å…¨**ï¼šå¤šå‰¯æœ¬é˜²æ­¢æ•°æ®ä¸¢å¤±
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šLeaderåˆ†æ•£åœ¨ä¸åŒBroker

---

## 3. æ¶ˆæ¯å­˜å‚¨

### 3.1 å­˜å‚¨ç»“æ„

**åˆ†æ®µæ—¥å¿—ï¼ˆLog Segmentï¼‰**ï¼š

```
/kafka-logs/topic-0/
â”œâ”€â”€ 00000000000000000000.log    # Segment 0
â”œâ”€â”€ 00000000000000000000.index  # åç§»é‡ç´¢å¼•
â”œâ”€â”€ 00000000000000000000.timeindex  # æ—¶é—´æˆ³ç´¢å¼•
â”œâ”€â”€ 00000000000000368769.log    # Segment 1
â”œâ”€â”€ 00000000000000368769.index
â”œâ”€â”€ 00000000000000368769.timeindex
â””â”€â”€ ...
```

**ä¸ºä»€ä¹ˆåˆ†æ®µ**ï¼š
- âœ… **å¿«é€Ÿåˆ é™¤**ï¼šè¿‡æœŸæ•°æ®ç›´æ¥åˆ é™¤æ•´ä¸ªSegment
- âœ… **å¿«é€ŸæŸ¥æ‰¾**ï¼šé€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½
- âœ… **é¿å…å¤§æ–‡ä»¶**ï¼šå•ä¸ªæ–‡ä»¶ä¸ä¼šå¤ªå¤§

**Segmentç»„æˆ**ï¼š

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| `.log` | å®é™…æ¶ˆæ¯æ•°æ® |
| `.index` | åç§»é‡ç´¢å¼•ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ |
| `.timeindex` | æ—¶é—´æˆ³ç´¢å¼• |

### 3.2 æ¶ˆæ¯æ ¼å¼

**æ¶ˆæ¯æ ¼å¼ï¼ˆv2ç‰ˆæœ¬ï¼‰**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Offset (8å­—èŠ‚)                          â”‚ â† æ¶ˆæ¯åç§»é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Message Size (4å­—èŠ‚)                    â”‚ â† æ¶ˆæ¯å¤§å°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CRC (4å­—èŠ‚)                              â”‚ â† æ ¡éªŒå’Œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Magic (1å­—èŠ‚)                            â”‚ â† ç‰ˆæœ¬å·
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Attributes (1å­—èŠ‚)                       â”‚ â† å‹ç¼©ç±»å‹ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Timestamp (8å­—èŠ‚)                        â”‚ â† æ—¶é—´æˆ³
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Key Length (4å­—èŠ‚)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Key (å¯å˜)                               â”‚ â† æ¶ˆæ¯é”®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Value Length (4å­—èŠ‚)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Value (å¯å˜)                             â”‚ â† æ¶ˆæ¯å€¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ç´¢å¼•æœºåˆ¶

**ç¨€ç–ç´¢å¼•ï¼ˆSparse Indexï¼‰**ï¼š

```
åç§»é‡ç´¢å¼•æ–‡ä»¶ (.index)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Offset â”‚Positionâ”‚  â† æ¯éš”4KBè®°å½•ä¸€ä¸ªç´¢å¼•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   0    â”‚   0    â”‚
â”‚  100   â”‚ 12345  â”‚
â”‚  200   â”‚ 24680  â”‚
â”‚  ...   â”‚  ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŸ¥æ‰¾è¿‡ç¨‹**ï¼š
```
1. æ ¹æ®Offsetæ‰¾åˆ°å¯¹åº”çš„Segmentæ–‡ä»¶
2. åœ¨ç´¢å¼•æ–‡ä»¶ä¸­äºŒåˆ†æŸ¥æ‰¾æœ€è¿‘çš„ç´¢å¼•é¡¹
3. ä»ç´¢å¼•é¡¹çš„ç‰©ç†ä½ç½®å¼€å§‹é¡ºåºæ‰«æ
```

**ç¤ºä¾‹**ï¼šæŸ¥æ‰¾Offset=150çš„æ¶ˆæ¯
```
1. ç´¢å¼•ä¸­æ‰¾åˆ°ï¼šOffset 100 â†’ Position 12345
2. ä»Position 12345å¼€å§‹é¡ºåºæ‰«æ
3. æ‰¾åˆ°Offset=150çš„æ¶ˆæ¯
```

### 3.4 é›¶æ‹·è´æŠ€æœ¯

**ä¼ ç»ŸIOæµç¨‹**ï¼ˆ4æ¬¡æ‹·è´ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â‘ è¯»   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â‘¡æ‹·è´  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç£ç›˜    â”‚ â”€â”€â”€â”€â†’  â”‚å†…æ ¸ç¼“å†²åŒºâ”‚ â”€â”€â”€â”€â†’  â”‚ç”¨æˆ·ç¼“å†²åŒºâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                         â‘¢æ‹·è´               â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â‘£å‘é€      â”‚
                   â”‚Socketç¼“å†²â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  ç½‘ç»œ    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é›¶æ‹·è´ï¼ˆsendfileï¼‰**ï¼ˆ2æ¬¡æ‹·è´ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â‘ è¯»   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â‘¡DMAæ‹·è´ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç£ç›˜    â”‚ â”€â”€â”€â”€â†’  â”‚å†…æ ¸ç¼“å†²åŒºâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  ç½‘ç»œ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Javaä»£ç **ï¼š
```java
// ä¼ ç»ŸIO
FileInputStream in = new FileInputStream(file);
OutputStream out = socket.getOutputStream();
byte[] buffer = new byte[4096];
while (in.read(buffer) > 0) {
    out.write(buffer);
}

// é›¶æ‹·è´
FileChannel fileChannel = new FileInputStream(file).getChannel();
SocketChannel socketChannel = SocketChannel.open();
fileChannel.transferTo(0, fileChannel.size(), socketChannel);
```

**æ€§èƒ½æå‡**ï¼š
- âœ… å‡å°‘2æ¬¡æ•°æ®æ‹·è´
- âœ… å‡å°‘2æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢
- âœ… æå‡2-3å€ååé‡

### 3.5 é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰

**Kafkaå……åˆ†åˆ©ç”¨OSçš„Page Cache**ï¼š

```
å†™å…¥æµç¨‹ï¼š
Producer â†’ Broker â†’ å†…å­˜(Page Cache) â†’ ç£ç›˜(å¼‚æ­¥åˆ·ç›˜)
                         â†‘
                    è¯»å–æ—¶ç›´æ¥ä»å†…å­˜è¿”å›
```

**ä¼˜åŠ¿**ï¼š
- âœ… **å†™å…¥å¿«**ï¼šå†™åˆ°å†…å­˜å³è¿”å›
- âœ… **è¯»å–å¿«**ï¼šçƒ­æ•°æ®åœ¨å†…å­˜ä¸­
- âœ… **OSä¼˜åŒ–**ï¼šåˆ©ç”¨OSçš„é¢„è¯»å’Œåå†™

**åˆ·ç›˜ç­–ç•¥**ï¼š
```properties
# ç«‹å³åˆ·ç›˜ï¼ˆåŒæ­¥ï¼Œæ€§èƒ½å·®ä½†å¯é ï¼‰
log.flush.interval.messages=1

# å®šæ—¶åˆ·ç›˜ï¼ˆå¼‚æ­¥ï¼Œé«˜æ€§èƒ½ï¼‰
log.flush.interval.ms=1000
log.flush.scheduler.interval.ms=3000
```

---

## 4. ç”Ÿäº§è€…æœºåˆ¶

### 4.1 åˆ†åŒºç­–ç•¥

**1. è½®è¯¢ï¼ˆRound-Robinï¼‰**
```java
// é»˜è®¤ç­–ç•¥ï¼Œæ¶ˆæ¯å‡åŒ€åˆ†å¸ƒ
ProducerRecord<String, String> record = 
    new ProducerRecord<>("topic", null, "value");
```

**2. å“ˆå¸Œï¼ˆHashï¼‰**
```java
// ç›¸åŒKeyçš„æ¶ˆæ¯å‘åˆ°åŒä¸€åˆ†åŒºï¼ˆæœ‰åºï¼‰
ProducerRecord<String, String> record = 
    new ProducerRecord<>("topic", "userId123", "value");
```

**3. è‡ªå®šä¹‰åˆ†åŒº**
```java
public class CustomPartitioner implements Partitioner {
    @Override
    public int partition(String topic, Object key, byte[] keyBytes,
                         Object value, byte[] valueBytes, Cluster cluster) {
        // è‡ªå®šä¹‰åˆ†åŒºé€»è¾‘
        String keyStr = (String) key;
        int partitionNum = cluster.partitionsForTopic(topic).size();
        
        // ç¤ºä¾‹ï¼šVIPç”¨æˆ·å‘åˆ°ç‰¹å®šåˆ†åŒº
        if (keyStr.startsWith("VIP")) {
            return 0;  // åˆ†åŒº0ä¸“é—¨å¤„ç†VIPç”¨æˆ·
        }
        return Math.abs(keyStr.hashCode()) % partitionNum;
    }
}
```

### 4.2 æ¶ˆæ¯å‘é€æ¨¡å¼

**1. åŒæ­¥å‘é€ï¼ˆSyncï¼‰**
```java
ProducerRecord<String, String> record = 
    new ProducerRecord<>("topic", "key", "value");

try {
    // é˜»å¡ç­‰å¾…ç»“æœ
    RecordMetadata metadata = producer.send(record).get();
    System.out.println("Offset: " + metadata.offset());
} catch (Exception e) {
    e.printStackTrace();
}
```

**2. å¼‚æ­¥å‘é€ï¼ˆAsyncï¼‰**
```java
producer.send(record, new Callback() {
    @Override
    public void onCompletion(RecordMetadata metadata, Exception e) {
        if (e == null) {
            System.out.println("Success: " + metadata.offset());
        } else {
            System.err.println("Failed: " + e.getMessage());
        }
    }
});
```

**3. OneWayï¼ˆä¸å…³å¿ƒç»“æœï¼‰**
```java
// åªç®¡å‘é€ï¼Œä¸å…³å¿ƒç»“æœ
producer.send(record);
```

**å¯¹æ¯”**ï¼š

| æ¨¡å¼ | ååé‡ | å»¶è¿Ÿ | å¯é æ€§ | åœºæ™¯ |
|------|--------|------|--------|------|
| åŒæ­¥ | ä½ | é«˜ | é«˜ | å…³é”®ä¸šåŠ¡ |
| å¼‚æ­¥ | é«˜ | ä½ | ä¸­ | ä¸€èˆ¬ä¸šåŠ¡ |
| OneWay | æœ€é«˜ | æœ€ä½ | ä½ | æ—¥å¿—é‡‡é›† |

### 4.3 ACKæœºåˆ¶

**ackså‚æ•°**ï¼šæ§åˆ¶æ¶ˆæ¯å¯é æ€§

```properties
# acks=0ï¼šä¸ç­‰å¾…Brokerç¡®è®¤ï¼ˆæœ€å¿«ï¼Œå¯èƒ½ä¸¢å¤±ï¼‰
acks=0

# acks=1ï¼šLeaderç¡®è®¤å³è¿”å›ï¼ˆé»˜è®¤ï¼‰
acks=1

# acks=-1/allï¼šæ‰€æœ‰ISRå‰¯æœ¬ç¡®è®¤ï¼ˆæœ€å¯é ï¼‰
acks=all
```

**æµç¨‹å¯¹æ¯”**ï¼š

```
acks=0:
Producer â†’ Broker Leader (ä¸ç­‰å¾…)

acks=1:
Producer â†’ Broker Leader â†’ ACK â† Producer

acks=all:
Producer â†’ Broker Leader â†’ Follower1 åŒæ­¥
                         â†’ Follower2 åŒæ­¥
         â† ACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Leader
```

### 4.4 å¹‚ç­‰æ€§

**é—®é¢˜**ï¼šç½‘ç»œæŠ–åŠ¨å¯¼è‡´é‡å¤å‘é€

```
Producer â†’ Broker: æ¶ˆæ¯1
         â† Broker: ç¡®è®¤ï¼ˆç½‘ç»œä¸¢å¤±ï¼‰
Producer â†’ Broker: æ¶ˆæ¯1ï¼ˆé‡è¯•ï¼‰ â† é‡å¤ï¼
```

**è§£å†³**ï¼šå¼€å¯å¹‚ç­‰æ€§

```properties
# å¼€å¯å¹‚ç­‰æ€§
enable.idempotence=true
```

**åŸç†**ï¼š
```
æ¯æ¡æ¶ˆæ¯å¸¦ä¸Šï¼š
- Producer ID (PID)
- Sequence Number

Brokeråˆ¤æ–­ï¼š
if (seq == lastSeq + 1) {
    // æ­£å¸¸æ¶ˆæ¯ï¼Œæ¥æ”¶
} else if (seq <= lastSeq) {
    // é‡å¤æ¶ˆæ¯ï¼Œä¸¢å¼ƒ
} else {
    // seqè·³è·ƒï¼Œè¯´æ˜æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼Œæ‹’ç»
}
```

### 4.5 äº‹åŠ¡

**åœºæ™¯**ï¼šä¿è¯å¤šæ¡æ¶ˆæ¯çš„åŸå­æ€§

```java
// é…ç½®äº‹åŠ¡ID
props.put("transactional.id", "my-transactional-id");

KafkaProducer<String, String> producer = new KafkaProducer<>(props);

// åˆå§‹åŒ–äº‹åŠ¡
producer.initTransactions();

try {
    // å¼€å¯äº‹åŠ¡
    producer.beginTransaction();
    
    // å‘é€å¤šæ¡æ¶ˆæ¯
    producer.send(new ProducerRecord<>("topic1", "msg1"));
    producer.send(new ProducerRecord<>("topic2", "msg2"));
    producer.send(new ProducerRecord<>("topic3", "msg3"));
    
    // æäº¤äº‹åŠ¡
    producer.commitTransaction();
} catch (Exception e) {
    // å›æ»šäº‹åŠ¡
    producer.abortTransaction();
}
```

**åŸç†**ï¼š
```
1. å¼€å¯äº‹åŠ¡ï¼šå‘Transaction Coordinatoræ³¨å†Œ
2. å‘é€æ¶ˆæ¯ï¼šæ¶ˆæ¯æ ‡è®°ä¸º"äº‹åŠ¡ä¸­"
3. æäº¤äº‹åŠ¡ï¼šæ‰€æœ‰åˆ†åŒºå†™å…¥äº‹åŠ¡æäº¤æ ‡è®°
4. æ¶ˆè´¹è€…ï¼šåªèƒ½æ¶ˆè´¹å·²æäº¤çš„æ¶ˆæ¯
```

---

## 5. æ¶ˆè´¹è€…æœºåˆ¶

### 5.1 æ¶ˆè´¹è€…ç»„

**Consumer Groupæ¦‚å¿µ**ï¼š

```
Topic: order-events (4ä¸ªåˆ†åŒº)
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ P0   â”‚ P1   â”‚ P2   â”‚ P3   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
   â”‚      â”‚      â”‚      â”‚
   â””â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”€â”˜
      â”‚      â”‚      â”‚
  â”Œâ”€â”€â”€â–¼â”€â”€â”¬â”€â”€â”€â–¼â”€â”€â”¬â”€â”€â”€â–¼â”€â”€â”
  â”‚  C0  â”‚  C1  â”‚  C2  â”‚  â† Consumer Group A
  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

      â”‚      â”‚      â”‚      â”‚
  â”Œâ”€â”€â”€â–¼â”€â”€â”¬â”€â”€â”€â–¼â”€â”€â”¬â”€â”€â”€â–¼â”€â”€â”¬â”€â”€â”€â–¼â”€â”€â”
  â”‚  C0  â”‚  C1  â”‚  C2  â”‚  C3  â”‚  â† Consumer Group B
  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**ï¼š
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šåˆ†åŒºå‡åŒ€åˆ†é…ç»™æ¶ˆè´¹è€…
- âœ… **ç‹¬ç«‹æ¶ˆè´¹**ï¼šä¸åŒç»„ç‹¬ç«‹æ¶ˆè´¹
- âœ… **æ•…éšœè½¬ç§»**ï¼šæ¶ˆè´¹è€…æ•…éšœæ—¶é‡æ–°åˆ†é…

**åˆ†é…åŸåˆ™**ï¼š
```
1. ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«åŒç»„çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹
2. ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªåˆ†åŒº
3. æ¶ˆè´¹è€…æ•° > åˆ†åŒºæ•°ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…ç©ºé—²
```

### 5.2 åˆ†åŒºåˆ†é…ç­–ç•¥

**1. Rangeï¼ˆèŒƒå›´åˆ†é…ï¼‰**

```
Topic1: 7ä¸ªåˆ†åŒºï¼Œ3ä¸ªæ¶ˆè´¹è€…
C0: P0, P1, P2  (3ä¸ª)
C1: P3, P4      (2ä¸ª)
C2: P5, P6      (2ä¸ª)

é—®é¢˜ï¼šåˆ†é…ä¸å‡åŒ€
```

**2. RoundRobinï¼ˆè½®è¯¢åˆ†é…ï¼‰**

```
Topic1: 7ä¸ªåˆ†åŒºï¼Œ3ä¸ªæ¶ˆè´¹è€…
C0: P0, P3, P6  (3ä¸ª)
C1: P1, P4      (2ä¸ª)
C2: P2, P5      (2ä¸ª)

ä¼˜ç‚¹ï¼šæ›´å‡åŒ€
```

**3. Stickyï¼ˆç²˜æ€§åˆ†é…ï¼‰**

```
ç‰¹ç‚¹ï¼š
- å°½é‡ä¿æŒåŸæœ‰åˆ†é…
- Rebalanceæ—¶å‡å°‘åˆ†åŒºè¿ç§»

ç¤ºä¾‹ï¼ˆC1ä¸‹çº¿ï¼‰ï¼š
åŸåˆ†é…ï¼š
C0: P0, P3
C1: P1, P4  â† ä¸‹çº¿
C2: P2, P5

Stickyåˆ†é…ï¼š
C0: P0, P3, P1  â† åªæ¥æ”¶P1
C2: P2, P5, P4  â† åªæ¥æ”¶P4
```

### 5.3 ä½ç§»æäº¤

**Offsetæ¦‚å¿µ**ï¼š

```
Partition 0
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  0  â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚  5  â”‚  â† Offset
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
        â–²
        â””â”€ Current Offset (å·²æ¶ˆè´¹åˆ°2)
```

**Offsetå­˜å‚¨**ï¼š
- Kafka 0.9ä¹‹å‰ï¼šZooKeeper
- Kafka 0.9ä¹‹åï¼š`__consumer_offsets` Topic

**æäº¤æ–¹å¼**ï¼š

**1. è‡ªåŠ¨æäº¤**
```java
props.put("enable.auto.commit", "true");
props.put("auto.commit.interval.ms", "5000");  // æ¯5ç§’æäº¤ä¸€æ¬¡
```

**2. æ‰‹åŠ¨åŒæ­¥æäº¤**
```java
while (true) {
    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
    
    for (ConsumerRecord<String, String> record : records) {
        // å¤„ç†æ¶ˆæ¯
        process(record);
    }
    
    // åŒæ­¥æäº¤ï¼ˆé˜»å¡ï¼‰
    consumer.commitSync();
}
```

**3. æ‰‹åŠ¨å¼‚æ­¥æäº¤**
```java
consumer.commitAsync((offsets, exception) -> {
    if (exception != null) {
        System.err.println("Commit failed: " + exception.getMessage());
    }
});
```

**4. æ‰‹åŠ¨æäº¤æŒ‡å®šOffset**
```java
Map<TopicPartition, OffsetAndMetadata> offsets = new HashMap<>();
offsets.put(
    new TopicPartition("topic", 0),
    new OffsetAndMetadata(100)
);
consumer.commitSync(offsets);
```

**æäº¤æ—¶æœºå¯¹æ¯”**ï¼š

| æäº¤æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | åœºæ™¯ |
|---------|------|------|------|
| è‡ªåŠ¨æäº¤ | ç®€å• | å¯èƒ½é‡å¤æ¶ˆè´¹ | å…è®¸é‡å¤çš„åœºæ™¯ |
| åŒæ­¥æäº¤ | å¯é  | é˜»å¡ï¼Œååé‡ä½ | å¼ºä¸€è‡´æ€§åœºæ™¯ |
| å¼‚æ­¥æäº¤ | é«˜åå | å¯èƒ½é‡å¤æ¶ˆè´¹ | ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ |

### 5.4 Rebalanceï¼ˆå†å¹³è¡¡ï¼‰

**è§¦å‘æ¡ä»¶**ï¼š
1. æ¶ˆè´¹è€…åŠ å…¥
2. æ¶ˆè´¹è€…é€€å‡º
3. åˆ†åŒºæ•°å˜åŒ–
4. æ¶ˆè´¹è€…è®¢é˜…Topicå˜åŒ–

**Rebalanceæµç¨‹**ï¼š

```
1. JoinGroupï¼šæ¶ˆè´¹è€…å‘Coordinatorå‘èµ·åŠ å…¥è¯·æ±‚
2. SyncGroupï¼šCoordinatoråˆ†é…åˆ†åŒºæ–¹æ¡ˆ
3. Heartbeatï¼šå®šæœŸå‘é€å¿ƒè·³ä¿æŒå­˜æ´»

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  Join   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Consumerâ”‚ â”€â”€â”€â”€â”€â”€â†’ â”‚Coordinator â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚
    â”‚  â†â”€â”€â”€â”€â”€â”€ Sync â”€â”€â”€â”€â”€â”¤
    â”‚  åˆ†åŒºåˆ†é…æ–¹æ¡ˆ       â”‚
    â”‚                    â”‚
    â”‚ â”€â”€â”€ Heartbeat â”€â”€â”€â”€â†’â”‚
    â”‚                    â”‚
```

**Rebalanceé—®é¢˜**ï¼š
- âŒ **Stop-The-World**ï¼šRebalanceæœŸé—´åœæ­¢æ¶ˆè´¹
- âŒ **åˆ†åŒºé‡æ–°åˆ†é…**ï¼šæ¶ˆè´¹è€…éœ€è¦é‡æ–°å»ºç«‹è¿æ¥
- âŒ **å¯èƒ½é‡å¤æ¶ˆè´¹**ï¼šå·²å¤„ç†ä½†æœªæäº¤çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°æ¶ˆè´¹

**ä¼˜åŒ–å»ºè®®**ï¼š
```properties
# å¢åŠ å¿ƒè·³é—´éš”ï¼ˆå‡å°‘è¯¯åˆ¤ï¼‰
heartbeat.interval.ms=3000
session.timeout.ms=30000

# å¢åŠ å¤„ç†æ—¶é—´
max.poll.interval.ms=300000

# ä½¿ç”¨Stickyåˆ†é…ç­–ç•¥
partition.assignment.strategy=org.apache.kafka.clients.consumer.StickyAssignor
```

---

## 6. é«˜å¯ç”¨æœºåˆ¶

### 6.1 ISRæœºåˆ¶

**ISRï¼ˆIn-Sync Replicasï¼‰**ï¼šä¸Leaderä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ

```
Partition 0 (3ä¸ªå‰¯æœ¬)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Leader (Broker 0)               â”‚
â”‚ - offset: 0~1000               â”‚
â”‚ - ISR: [0, 1, 2]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€ åŒæ­¥ â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
         â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Follower (B1) â”‚  â”‚Follower (B2) â”‚
â”‚offset: 0~1000â”‚  â”‚offset: 0~950 â”‚
â”‚   (In ISR)   â”‚  â”‚  (Out ISR)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ISRç®¡ç†**ï¼š

```
åŒæ­¥æ¡ä»¶ï¼š
1. Followerå¿…é¡»å®šæœŸå‘é€Fetchè¯·æ±‚
2. Followerçš„Offsetä¸èƒ½è½åå¤ªå¤š

é…ç½®ï¼š
replica.lag.time.max.ms=10000  # 10ç§’å†…æ²¡åŒæ­¥å°±ç§»å‡ºISR
```

**ISRä½œç”¨**ï¼š
- âœ… **æ•°æ®å®‰å…¨**ï¼šacks=allæ—¶åªéœ€ç­‰å¾…ISRå‰¯æœ¬
- âœ… **æ•…éšœè½¬ç§»**ï¼šLeaderæ•…éšœæ—¶ä»ISRä¸­é€‰ä¸¾
- âœ… **æ€§èƒ½å¹³è¡¡**ï¼šä¸éœ€è¦ç­‰æ‰€æœ‰å‰¯æœ¬

### 6.2 Leaderé€‰ä¸¾

**é€‰ä¸¾æ—¶æœº**ï¼š
1. Brokerå¯åŠ¨æ—¶
2. Leaderæ•…éšœæ—¶
3. æ‰‹åŠ¨è§¦å‘

**é€‰ä¸¾æµç¨‹**ï¼š

```
1. Controlleræ£€æµ‹åˆ°Leaderæ•…éšœ
2. ä»ISRä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªå‰¯æœ¬ä½œä¸ºæ–°Leader
3. æ›´æ–°å…ƒæ•°æ®
4. é€šçŸ¥æ‰€æœ‰Broker

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller  â”‚  â† ZooKeeperé€šçŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ é€‰ä¸¾æ–°Leader
       â”‚
       â–¼
ISR: [1, 2]  â†’ é€‰æ‹©1ä½œä¸ºLeader
```

**é€‰ä¸¾ä¼˜å…ˆçº§**ï¼š
```
1. ISRä¸­çš„å‰¯æœ¬ï¼ˆä¼˜å…ˆï¼‰
2. OSRä¸­çš„å‰¯æœ¬ï¼ˆå¯èƒ½ä¸¢æ•°æ®ï¼‰
3. åˆ›å»ºæ–°åˆ†åŒºï¼ˆæç«¯æƒ…å†µï¼‰
```

**unclean.leader.election.enable**ï¼š
```properties
# falseï¼šåªä»ISRé€‰ä¸¾ï¼ˆæ•°æ®å®‰å…¨ï¼‰
# trueï¼šå…è®¸ä»OSRé€‰ä¸¾ï¼ˆå¯ç”¨æ€§ä¼˜å…ˆï¼‰
unclean.leader.election.enable=false
```

### 6.3 æ•°æ®ä¸€è‡´æ€§

**HWä¸LEO**ï¼š

```
Leader:  |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€| LEO (Log End Offset)
         |â”€â”€â”€â”€â”€â”€â”€â”€â”€|     HW (High Watermark)
         
Follower:|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|   LEO
         |â”€â”€â”€â”€â”€â”€â”€â”€â”€|     HW
         
Consumeråªèƒ½è¯»åˆ°HWä¹‹å‰çš„æ•°æ®
```

**HWæ›´æ–°æµç¨‹**ï¼š

```
1. Leaderå†™å…¥æ¶ˆæ¯ï¼ŒLEOå¢åŠ 
2. Followeræ‹‰å–æ¶ˆæ¯ï¼ŒLEOå¢åŠ 
3. Leaderæ”¶åˆ°Followerçš„LEOï¼Œæ›´æ–°HW
4. Followeræ”¶åˆ°Leaderçš„HWï¼Œæ›´æ–°æœ¬åœ°HW

ç¤ºä¾‹ï¼š
T1: Leader LEO=10, HW=8
    Follower1 LEO=9, HW=8
    Follower2 LEO=8, HW=8

T2: Follower1æ‹‰å–æ•°æ®
    Leader HW = min(10, 9, 8) = 8

T3: Follower2æ‹‰å–æ•°æ®
    Leader HW = min(10, 10, 9) = 9
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç”Ÿäº§è€…è°ƒä¼˜

**æ‰¹é‡å‘é€**ï¼š
```properties
# æ‰¹é‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰
batch.size=16384

# ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
linger.ms=10

# ç¼“å†²åŒºå¤§å°
buffer.memory=33554432
```

**å‹ç¼©**ï¼š
```properties
# å‹ç¼©ç®—æ³•ï¼šgzip, snappy, lz4, zstd
compression.type=lz4

å‹ç¼©ç‡å¯¹æ¯”ï¼š
gzip:   é«˜å‹ç¼©ç‡ï¼ŒCPUæ¶ˆè€—é«˜
snappy: å‹ç¼©ç‡ä¸­ç­‰ï¼Œé€Ÿåº¦å¿«
lz4:    å‹ç¼©ç‡ä½ï¼Œé€Ÿåº¦æœ€å¿«ï¼ˆæ¨èï¼‰
zstd:   å‹ç¼©ç‡é«˜ï¼Œé€Ÿåº¦å¿«ï¼ˆKafka 2.1+ï¼‰
```

**å‚æ•°ä¼˜åŒ–**ï¼š
```properties
# ç¼“å†²åŒºå¤§å°ï¼ˆ32MBï¼‰
buffer.memory=33554432

# æ¯ä¸ªè¿æ¥çš„æœ€å¤§è¯·æ±‚æ•°
max.in.flight.requests.per.connection=5

# è¯·æ±‚è¶…æ—¶æ—¶é—´
request.timeout.ms=30000

# é‡è¯•æ¬¡æ•°
retries=3

# é‡è¯•é—´éš”
retry.backoff.ms=100
```

### 7.2 æ¶ˆè´¹è€…è°ƒä¼˜

**æ‹‰å–ç­–ç•¥**ï¼š
```properties
# æ¯æ¬¡æ‹‰å–æœ€å°å­—èŠ‚æ•°
fetch.min.bytes=1

# ç­‰å¾…æ—¶é—´
fetch.max.wait.ms=500

# æ¯æ¬¡æ‹‰å–æœ€å¤§å­—èŠ‚æ•°
fetch.max.bytes=52428800

# æ¯ä¸ªåˆ†åŒºæ‹‰å–æœ€å¤§å­—èŠ‚æ•°
max.partition.fetch.bytes=1048576
```

**å¹¶è¡Œåº¦**ï¼š
```java
// å¤šçº¿ç¨‹æ¶ˆè´¹ï¼ˆä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰
ExecutorService executor = Executors.newFixedThreadPool(10);

while (true) {
    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
    
    for (ConsumerRecord<String, String> record : records) {
        executor.submit(() -> process(record));
    }
}

// æˆ–è€…ï¼šå¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼ˆæ¨èï¼‰
// å¯åŠ¨3ä¸ªConsumerå®ä¾‹ï¼Œè‡ªåŠ¨è´Ÿè½½å‡è¡¡
```

### 7.3 Brokerè°ƒä¼˜

**JVMå‚æ•°**ï¼š
```bash
# å †å†…å­˜ï¼ˆæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´ï¼‰
-Xms6g -Xmx6g

# GCï¼ˆG1 GCæ¨èï¼‰
-XX:+UseG1GC
-XX:MaxGCPauseMillis=20
-XX:InitiatingHeapOccupancyPercent=35

# GCæ—¥å¿—
-Xlog:gc*:file=/var/log/kafka/gc.log:time,tags:filecount=10,filesize=100M
```

**ç£ç›˜ä¼˜åŒ–**ï¼š
```properties
# æ—¥å¿—ç›®å½•ï¼ˆå¤šç›˜JBODï¼‰
log.dirs=/data1/kafka,/data2/kafka,/data3/kafka

# åˆ·ç›˜ç­–ç•¥ï¼ˆä¾èµ–Page Cacheï¼‰
log.flush.interval.messages=Long.MAX_VALUE
log.flush.interval.ms=Long.MAX_VALUE

# Segmentå¤§å°ï¼ˆ1GBï¼‰
log.segment.bytes=1073741824

# æ—¥å¿—ä¿ç•™ï¼ˆ7å¤©ï¼‰
log.retention.hours=168
```

**ç½‘ç»œä¼˜åŒ–**ï¼š
```properties
# Socketç¼“å†²åŒºå¤§å°
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600

# ç½‘ç»œçº¿ç¨‹æ•°
num.network.threads=8

# IOçº¿ç¨‹æ•°
num.io.threads=8
```

### 7.4 ç›‘æ§æŒ‡æ ‡

**æ ¸å¿ƒæŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ | æ­£å¸¸å€¼ |
|------|------|--------|
| **MessagesInPerSec** | æ¯ç§’æ¶ˆæ¯æ•° | æ ¹æ®ä¸šåŠ¡ |
| **BytesInPerSec** | æ¯ç§’å­—èŠ‚æ•° | æ ¹æ®ä¸šåŠ¡ |
| **UnderReplicatedPartitions** | æœªå……åˆ†å¤åˆ¶çš„åˆ†åŒºæ•° | 0 |
| **OfflinePartitionsCount** | ç¦»çº¿åˆ†åŒºæ•° | 0 |
| **ActiveControllerCount** | æ´»è·ƒControlleræ•° | 1 |
| **RequestHandlerAvgIdlePercent** | è¯·æ±‚å¤„ç†å™¨ç©ºé—²ç‡ | >20% |
| **NetworkProcessorAvgIdlePercent** | ç½‘ç»œå¤„ç†å™¨ç©ºé—²ç‡ | >20% |
| **Consumer Lag** | æ¶ˆè´¹å»¶è¿Ÿ | <1000 |

**JMXç›‘æ§**ï¼š
```bash
# å¼€å¯JMX
export JMX_PORT=9999

# ä½¿ç”¨JConsoleè¿æ¥
jconsole localhost:9999
```

**Kafka Manager**ï¼š
```bash
# ä½¿ç”¨Yahooå¼€æºçš„Kafka Manager
docker run -d -p 9000:9000 \
  -e ZK_HOSTS="zk1:2181,zk2:2181,zk3:2181" \
  kafkamanager/kafka-manager
```

---

## 8. å¯¹æ¯”åˆ†æ

### 8.1 Kafka vs RocketMQ vs RabbitMQ

| ç‰¹æ€§ | Kafka | RocketMQ | RabbitMQ |
|------|-------|----------|----------|
| **ååé‡** | ç™¾ä¸‡çº§/ç§’ | åä¸‡çº§/ç§’ | ä¸‡çº§/ç§’ |
| **å»¶è¿Ÿ** | æ¯«ç§’çº§ | æ¯«ç§’çº§ | å¾®ç§’çº§ |
| **æ¶ˆæ¯é¡ºåº** | åˆ†åŒºæœ‰åº | å…¨å±€æœ‰åº/åˆ†åŒºæœ‰åº | é˜Ÿåˆ—æœ‰åº |
| **æ¶ˆæ¯å †ç§¯** | äº¿çº§ | äº¿çº§ | ç™¾ä¸‡çº§ |
| **æŒä¹…åŒ–** | ç£ç›˜ | ç£ç›˜ | å†…å­˜+ç£ç›˜ |
| **äº‹åŠ¡** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **å»¶è¿Ÿæ¶ˆæ¯** | ä¸æ”¯æŒ | æ”¯æŒ | æ’ä»¶æ”¯æŒ |
| **æ­»ä¿¡é˜Ÿåˆ—** | ä¸æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **æ¶ˆæ¯å›æº¯** | æ”¯æŒ | æ”¯æŒ | ä¸æ”¯æŒ |
| **åè®®** | è‡ªå®šä¹‰ | è‡ªå®šä¹‰ | AMQP |
| **è¯­è¨€** | Scala | Java | Erlang |
| **ä¸»è¦åœºæ™¯** | æ—¥å¿—ã€å¤§æ•°æ® | ä¸šåŠ¡æ¶ˆæ¯ | ä¸šåŠ¡æ¶ˆæ¯ |

### 8.2 åœºæ™¯é€‰å‹

**é€‰æ‹©Kafka**ï¼š
- âœ… æ—¥å¿—æ”¶é›†ï¼ˆELKï¼‰
- âœ… ç›‘æ§æŒ‡æ ‡é‡‡é›†
- âœ… å®æ—¶æ•°æ®å¤„ç†ï¼ˆFlinkã€Sparkï¼‰
- âœ… å¤§æ•°æ®åœºæ™¯
- âœ… é«˜ååé‡éœ€æ±‚

**é€‰æ‹©RocketMQ**ï¼š
- âœ… ä¸šåŠ¡æ¶ˆæ¯
- âœ… åˆ†å¸ƒå¼äº‹åŠ¡
- âœ… å»¶è¿Ÿæ¶ˆæ¯
- âœ… é¡ºåºæ¶ˆæ¯
- âœ… ä¸­æ–‡æ–‡æ¡£å‹å¥½

**é€‰æ‹©RabbitMQ**ï¼š
- âœ… è½»é‡çº§åœºæ™¯
- âœ… å¤æ‚è·¯ç”±
- âœ… ä½å»¶è¿Ÿéœ€æ±‚
- âœ… AMQPåè®®

---

## 9. å®æˆ˜æ¡ˆä¾‹

### 9.1 ç™¾ä¸‡çº§TPSæ¶ˆæ¯ç³»ç»Ÿ

**åœºæ™¯**ï¼šç”µå•†å¤§ä¿ƒï¼Œè®¢å•æ¶ˆæ¯å¤„ç†

**æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•æœåŠ¡(20) â”‚ â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•†å“æœåŠ¡(20) â”‚ â”€â”€â”€â”€â”€â”¼â”€â”€â”€â†’â”‚ Kafka Cluster â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚  (10 Brokers) â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚   (50åˆ†åŒº)    â”‚
â”‚ ç”¨æˆ·æœåŠ¡(20) â”‚ â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                                 â”œâ”€â”€â”€â”€â”€â”
                                 â”‚     â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚
                          â”‚åº“å­˜æœåŠ¡  â”‚ â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚
                          â”‚ç§¯åˆ†æœåŠ¡  â”‚ â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚
                          â”‚é€šçŸ¥æœåŠ¡  â”‚â—„â”˜
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ä¼˜åŒ–**ï¼š

```properties
# Brokeré…ç½®
num.network.threads=16
num.io.threads=16
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
log.segment.bytes=1073741824
num.replica.fetchers=4

# Produceré…ç½®
acks=1
compression.type=lz4
batch.size=65536
linger.ms=10
buffer.memory=67108864
max.in.flight.requests.per.connection=5

# Consumeré…ç½®
fetch.min.bytes=1048576
fetch.max.wait.ms=500
max.poll.records=1000
```

**å‹æµ‹ç»“æœ**ï¼š
```
TPS: 120ä¸‡/ç§’
å»¶è¿ŸP99: 5ms
CPU: 60%
å†…å­˜: 10GB
ç£ç›˜IO: 500MB/s
```

### 9.2 å®æ—¶æ•°æ®å¤„ç†ç®¡é“

**åœºæ™¯**ï¼šç”¨æˆ·è¡Œä¸ºæ•°æ®å®æ—¶å¤„ç†

**æ¶æ„**ï¼š
```
ç”¨æˆ·APP
   â”‚
   â–¼
Nginx (åŸ‹ç‚¹)
   â”‚
   â–¼
Kafka Topic: user-behavior (100åˆ†åŒº)
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â†’ Flinkå®æ—¶è®¡ç®— â†’ Redis (å®æ—¶å¤§å±)
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â†’ Sparkæ‰¹å¤„ç† â†’ Hive (æ•°æ®ä»“åº“)
   â”‚
   â””â”€â”€â”€â”€â”€â”€â†’ Elasticsearch (è¡Œä¸ºåˆ†æ)
```

**Flinkæ¶ˆè´¹Kafka**ï¼š
```java
Properties props = new Properties();
props.setProperty("bootstrap.servers", "kafka1:9092,kafka2:9092");
props.setProperty("group.id", "flink-consumer");

FlinkKafkaConsumer<String> consumer = new FlinkKafkaConsumer<>(
    "user-behavior",
    new SimpleStringSchema(),
    props
);

DataStream<String> stream = env.addSource(consumer);

// å®æ—¶ç»Ÿè®¡PV/UV
stream
    .map(json -> parseUser(json))
    .keyBy(User::getUserId)
    .timeWindow(Time.minutes(1))
    .aggregate(new CountAggregator())
    .addSink(new RedisSink());
```

### 9.3 æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼ˆELKï¼‰

**æ¶æ„**ï¼š
```
åº”ç”¨æœåŠ¡å™¨ (Filebeat)
   â”‚
   â–¼
Kafka Topic: application-logs
   â”‚
   â–¼
Logstash
   â”‚
   â–¼
Elasticsearch
   â”‚
   â–¼
Kibana (å¯è§†åŒ–)
```

**Filebeaté…ç½®**ï¼š
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/app/*.log

output.kafka:
  hosts: ["kafka1:9092", "kafka2:9092", "kafka3:9092"]
  topic: "application-logs"
  partition.round_robin:
    reachable_only: false
  compression: gzip
```

**Logstashé…ç½®**ï¼š
```ruby
input {
  kafka {
    bootstrap_servers => "kafka1:9092,kafka2:9092"
    topics => ["application-logs"]
    group_id => "logstash-consumer"
    codec => "json"
  }
}

filter {
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:message}" }
  }
}

output {
  elasticsearch {
    hosts => ["es1:9200", "es2:9200"]
    index => "logs-%{+YYYY.MM.dd}"
  }
}
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

**æ¶æ„è®¾è®¡**ï¼š
- âœ… Brokeré›†ç¾¤ + ZooKeeper/Kraft
- âœ… Topicåˆ†åŒº + å‰¯æœ¬æœºåˆ¶
- âœ… Producer + Consumer Group

**æ¶ˆæ¯å­˜å‚¨**ï¼š
- âœ… åˆ†æ®µæ—¥å¿— + ç¨€ç–ç´¢å¼•
- âœ… é›¶æ‹·è´ + é¡µç¼“å­˜
- âœ… é¡ºåºå†™ + æ‰¹é‡è¯»

**é«˜å¯ç”¨**ï¼š
- âœ… ISRæœºåˆ¶
- âœ… Leaderé€‰ä¸¾
- âœ… HWä¿è¯ä¸€è‡´æ€§

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- âœ… æ‰¹é‡å‘é€ + å‹ç¼©
- âœ… å¼‚æ­¥å‘é€
- âœ… åˆç†åˆ†åŒºæ•°

### é¢è¯•é«˜é¢‘

1. **Kafkaå¦‚ä½•ä¿è¯é«˜ååé‡**ï¼Ÿ
   - é›¶æ‹·è´ã€é¡µç¼“å­˜ã€æ‰¹é‡å‘é€ã€é¡ºåºå†™

2. **Kafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±**ï¼Ÿ
   - acks=allã€ISRæœºåˆ¶ã€å‰¯æœ¬åŒæ­¥

3. **Kafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸é‡å¤**ï¼Ÿ
   - å¹‚ç­‰æ€§ã€äº‹åŠ¡

4. **Kafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº**ï¼Ÿ
   - å•åˆ†åŒºæœ‰åºã€Keyåˆ†åŒº

5. **ISRæœºåˆ¶æ˜¯ä»€ä¹ˆ**ï¼Ÿ
   - In-Sync Replicasï¼Œä¸LeaderåŒæ­¥çš„å‰¯æœ¬é›†åˆ

### æœ€ä½³å®è·µ

1. **åˆ†åŒºæ•°è®¾ç½®**ï¼šæœŸæœ›ååé‡ / å•åˆ†åŒºååé‡
2. **å‰¯æœ¬æ•°è®¾ç½®**ï¼š3ä¸ªå‰¯æœ¬ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
3. **acksè®¾ç½®**ï¼šacks=1ï¼ˆå¹³è¡¡æ€§èƒ½å’Œå¯é æ€§ï¼‰
4. **å‹ç¼©ç®—æ³•**ï¼šlz4ï¼ˆæ€§èƒ½æœ€ä½³ï¼‰
5. **ç›‘æ§**ï¼šKafka Manager + Prometheus + Grafana

---

*æœ€åæ›´æ–°ï¼š2025-10-27*  
*æ–‡æ¡£çŠ¶æ€ï¼šv1.0 å®Œæˆ*  
*ä½œè€…ï¼šæŠ€æœ¯çŸ¥è¯†åº“å›¢é˜Ÿ*
